function e(){e=function(){return t};var t={},i=Object.prototype,r=i.hasOwnProperty,n=Object.defineProperty||function(e,t,i){e[t]=i.value},o="function"==typeof Symbol?Symbol:{},s=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function l(e,t,i){return Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,i){return e[t]=i}}function h(e,t,i,r){var o=Object.create((t&&t.prototype instanceof f?t:f).prototype),s=new x(r||[]);return n(o,"_invoke",{value:E(e,i,s)}),o}function u(e,t,i){try{return{type:"normal",arg:e.call(t,i)}}catch(e){return{type:"throw",arg:e}}}t.wrap=h;var d={};function f(){}function v(){}function p(){}var y={};l(y,s,function(){return this});var m=Object.getPrototypeOf,g=m&&m(m(S([])));g&&g!==i&&r.call(g,s)&&(y=g);var b=p.prototype=f.prototype=Object.create(y);function w(e){["next","throw","return"].forEach(function(t){l(e,t,function(e){return this._invoke(t,e)})})}function P(e,t){function i(n,o,s,a){var c=u(e[n],e,o);if("throw"!==c.type){var l=c.arg,h=l.value;return h&&"object"==typeof h&&r.call(h,"__await")?t.resolve(h.__await).then(function(e){i("next",e,s,a)},function(e){i("throw",e,s,a)}):t.resolve(h).then(function(e){l.value=e,s(l)},function(e){return i("throw",e,s,a)})}a(c.arg)}var o;n(this,"_invoke",{value:function(e,r){function n(){return new t(function(t,n){i(e,r,t,n)})}return o=o?o.then(n,n):n()}})}function E(e,t,i){var r="suspendedStart";return function(n,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===n)throw o;return{value:void 0,done:!0}}for(i.method=n,i.arg=o;;){var s=i.delegate;if(s){var a=T(s,i);if(a){if(a===d)continue;return a}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if("suspendedStart"===r)throw r="completed",i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);r="executing";var c=u(e,t,i);if("normal"===c.type){if(r=i.done?"completed":"suspendedYield",c.arg===d)continue;return{value:c.arg,done:i.done}}"throw"===c.type&&(r="completed",i.method="throw",i.arg=c.arg)}}}function T(e,t){var i=t.method,r=e.iterator[i];if(void 0===r)return t.delegate=null,"throw"===i&&e.iterator.return&&(t.method="return",t.arg=void 0,T(e,t),"throw"===t.method)||"return"!==i&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+i+"' method")),d;var n=u(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,d;var o=n.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,d):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,d)}function _(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function I(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function x(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(_,this),this.reset(!0)}function S(e){if(e){var t=e[s];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,n=function t(){for(;++i<e.length;)if(r.call(e,i))return t.value=e[i],t.done=!1,t;return t.value=void 0,t.done=!0,t};return n.next=n}}return{next:M}}function M(){return{value:void 0,done:!0}}return v.prototype=p,n(b,"constructor",{value:p,configurable:!0}),n(p,"constructor",{value:v,configurable:!0}),v.displayName=l(p,c,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,l(e,c,"GeneratorFunction")),e.prototype=Object.create(b),e},t.awrap=function(e){return{__await:e}},w(P.prototype),l(P.prototype,a,function(){return this}),t.AsyncIterator=P,t.async=function(e,i,r,n,o){void 0===o&&(o=Promise);var s=new P(h(e,i,r,n),o);return t.isGeneratorFunction(i)?s:s.next().then(function(e){return e.done?e.value:s.next()})},w(b),l(b,c,"Generator"),l(b,s,function(){return this}),l(b,"toString",function(){return"[object Generator]"}),t.keys=function(e){var t=Object(e),i=[];for(var r in t)i.push(r);return i.reverse(),function e(){for(;i.length;){var r=i.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=S,x.prototype={constructor:x,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(I),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function i(i,r){return s.type="throw",s.arg=e,t.next=i,r&&(t.method="next",t.arg=void 0),!!r}for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n],s=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var a=r.call(o,"catchLoc"),c=r.call(o,"finallyLoc");if(a&&c){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(a){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(e,t){for(var i=this.tryEntries.length-1;i>=0;--i){var n=this.tryEntries[i];if(n.tryLoc<=this.prev&&r.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var s=o?o.completion:{};return s.type=e,s.arg=t,o?(this.method="next",this.next=o.finallyLoc,d):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),d},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.finallyLoc===e)return this.complete(i.completion,i.afterLoc),I(i),d}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.tryLoc===e){var r=i.completion;if("throw"===r.type){var n=r.arg;I(i)}return n}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,i){return this.delegate={iterator:S(e),resultName:t,nextLoc:i},"next"===this.method&&(this.arg=void 0),d}},t}function t(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,"symbol"==typeof(n=function(e,t){if("object"!=typeof e||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(r.key))?n:String(n),r)}var n}function i(e,i,r){return i&&t(e.prototype,i),r&&t(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function r(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,o(e,t)}function n(e){return n=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},n(e)}function o(e,t){return o=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},o(e,t)}function s(e,t,i){return s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}()?Reflect.construct.bind():function(e,t,i){var r=[null];r.push.apply(r,t);var n=new(Function.bind.apply(e,r));return i&&o(n,i.prototype),n},s.apply(null,arguments)}function a(e){var t="function"==typeof Map?new Map:void 0;return a=function(e){if(null===e||-1===Function.toString.call(e).indexOf("[native code]"))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,i)}function i(){return s(e,arguments,n(this).constructor)}return i.prototype=Object.create(e.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),o(i,e)},a(e)}function c(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,r=new Array(t);i<t;i++)r[i]=e[i];return r}function h(e,t){var i="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(i)return(i=i.call(e)).next.bind(i);if(Array.isArray(e)||(i=function(e,t){if(e){if("string"==typeof e)return l(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?l(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){i&&(e=i);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var u=0;function d(e){return"__private_"+u+++"_"+e}function f(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}var v=/*#__PURE__*/d("ievent"),p=/*#__PURE__*/function(){function e(e){Object.defineProperty(this,v,{writable:!0,value:void 0}),f(this,v)[v]=e}var t=e.prototype;return t.subscribe=function(e){return f(this,v)[v].asEvent().subscribe(e)},t.dispatch=function(e,t){f(this,v)[v].dispatch(e,t)},t.sub=function(e){return f(this,v)[v].asEvent().sub(e)},t.unsubscribe=function(e){f(this,v)[v].asEvent().unsubscribe(e)},t.unsub=function(e){f(this,v)[v].asEvent().unsub(e)},t.one=function(e){return f(this,v)[v].asEvent().one(e)},t.has=function(e){return f(this,v)[v].asEvent().has(e)},t.clear=function(){f(this,v)[v].asEvent().clear()},i(e,[{key:"count",get:function(){return f(this,v)[v].count}}]),e}();function y(e){var t={exports:{}};return e(t,t.exports),t.exports}var m=y(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.DispatcherWrapper=void 0,t.DispatcherWrapper=class{constructor(e){this._subscribe=t=>e.subscribe(t),this._unsubscribe=t=>e.unsubscribe(t),this._one=t=>e.one(t),this._has=t=>e.has(t),this._clear=()=>e.clear(),this._count=()=>e.count,this._onSubscriptionChange=()=>e.onSubscriptionChange}get onSubscriptionChange(){return this._onSubscriptionChange()}get count(){return this._count()}subscribe(e){return this._subscribe(e)}sub(e){return this.subscribe(e)}unsubscribe(e){this._unsubscribe(e)}unsub(e){this.unsubscribe(e)}one(e){return this._one(e)}has(e){return this._has(e)}clear(){this._clear()}}}),g=y(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Subscription=void 0,t.Subscription=class{constructor(e,t){this.handler=e,this.isOnce=t,this.isExecuted=!1}execute(e,t,i){if(!this.isOnce||!this.isExecuted){this.isExecuted=!0;var r=this.handler;e?setTimeout(()=>{r.apply(t,i)},1):r.apply(t,i)}}}}),b=y(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.EventManagement=void 0,t.EventManagement=class{constructor(e){this.unsub=e,this.propagationStopped=!1}stopPropagation(){this.propagationStopped=!0}}}),w=y(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.SubscriptionChangeEventDispatcher=t.DispatcherBase=void 0;class i{constructor(){this._subscriptions=new Array}get count(){return this._subscriptions.length}get onSubscriptionChange(){return null==this._onSubscriptionChange&&(this._onSubscriptionChange=new r),this._onSubscriptionChange.asEvent()}subscribe(e){return e&&(this._subscriptions.push(this.createSubscription(e,!1)),this.triggerSubscriptionChange()),()=>{this.unsubscribe(e)}}sub(e){return this.subscribe(e)}one(e){return e&&(this._subscriptions.push(this.createSubscription(e,!0)),this.triggerSubscriptionChange()),()=>{this.unsubscribe(e)}}has(e){return!!e&&this._subscriptions.some(t=>t.handler==e)}unsubscribe(e){if(!e)return;let t=!1;for(let i=0;i<this._subscriptions.length;i++)if(this._subscriptions[i].handler==e){this._subscriptions.splice(i,1),t=!0;break}t&&this.triggerSubscriptionChange()}unsub(e){this.unsubscribe(e)}_dispatch(e,t,i){for(let r of[...this._subscriptions]){let n=new b.EventManagement(()=>this.unsub(r.handler)),o=Array.prototype.slice.call(i);if(o.push(n),r.execute(e,t,o),this.cleanup(r),!e&&n.propagationStopped)return{propagationStopped:!0}}return e?null:{propagationStopped:!1}}createSubscription(e,t){return new g.Subscription(e,t)}cleanup(e){let t=!1;if(e.isOnce&&e.isExecuted){let i=this._subscriptions.indexOf(e);i>-1&&(this._subscriptions.splice(i,1),t=!0)}t&&this.triggerSubscriptionChange()}asEvent(){return null==this._wrap&&(this._wrap=new m.DispatcherWrapper(this)),this._wrap}clear(){0!=this._subscriptions.length&&(this._subscriptions.splice(0,this._subscriptions.length),this.triggerSubscriptionChange())}triggerSubscriptionChange(){null!=this._onSubscriptionChange&&this._onSubscriptionChange.dispatch(this.count)}}t.DispatcherBase=i;class r extends i{dispatch(e){this._dispatch(!1,this,arguments)}}t.SubscriptionChangeEventDispatcher=r}),P=y(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.DispatchError=void 0;class i extends Error{constructor(e){super(e)}}t.DispatchError=i}),E=y(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.EventListBase=void 0,t.EventListBase=class{constructor(){this._events={}}get(e){let t=this._events[e];return t||(t=this.createDispatcher(),this._events[e]=t,t)}remove(e){delete this._events[e]}}}),T=y(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.HandlingBase=void 0,t.HandlingBase=class{constructor(e){this.events=e}one(e,t){this.events.get(e).one(t)}has(e,t){return this.events.get(e).has(t)}subscribe(e,t){this.events.get(e).subscribe(t)}sub(e,t){this.subscribe(e,t)}unsubscribe(e,t){this.events.get(e).unsubscribe(t)}unsub(e,t){this.unsubscribe(e,t)}}}),_=y(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.PromiseSubscription=void 0,t.PromiseSubscription=class{constructor(e,t){this.handler=e,this.isOnce=t,this.isExecuted=!1}async execute(e,t,i){if(!this.isOnce||!this.isExecuted){this.isExecuted=!0;var r=this.handler;if(e)return void setTimeout(()=>{r.apply(t,i)},1);let n=r.apply(t,i);await n}}}}),I=y(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.PromiseDispatcherBase=void 0,t.PromiseDispatcherBase=class extends w.DispatcherBase{_dispatch(e,t,i){throw new P.DispatchError("_dispatch not supported. Use _dispatchAsPromise.")}createSubscription(e,t){return new _.PromiseSubscription(e,t)}async _dispatchAsPromise(e,t,i){for(let r of[...this._subscriptions]){let n=new b.EventManagement(()=>this.unsub(r.handler)),o=Array.prototype.slice.call(i);o.push(n);let s=r;if(await s.execute(e,t,o),this.cleanup(r),!e&&n.propagationStopped)return{propagationStopped:!0}}return e?null:{propagationStopped:!1}}}}),x=y(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.SubscriptionChangeEventDispatcher=t.HandlingBase=t.PromiseDispatcherBase=t.PromiseSubscription=t.DispatchError=t.EventManagement=t.EventListBase=t.DispatcherWrapper=t.DispatcherBase=t.Subscription=void 0,Object.defineProperty(t,"DispatcherBase",{enumerable:!0,get:function(){return w.DispatcherBase}}),Object.defineProperty(t,"SubscriptionChangeEventDispatcher",{enumerable:!0,get:function(){return w.SubscriptionChangeEventDispatcher}}),Object.defineProperty(t,"DispatchError",{enumerable:!0,get:function(){return P.DispatchError}}),Object.defineProperty(t,"DispatcherWrapper",{enumerable:!0,get:function(){return m.DispatcherWrapper}}),Object.defineProperty(t,"EventListBase",{enumerable:!0,get:function(){return E.EventListBase}}),Object.defineProperty(t,"EventManagement",{enumerable:!0,get:function(){return b.EventManagement}}),Object.defineProperty(t,"HandlingBase",{enumerable:!0,get:function(){return T.HandlingBase}}),Object.defineProperty(t,"PromiseDispatcherBase",{enumerable:!0,get:function(){return I.PromiseDispatcherBase}}),Object.defineProperty(t,"PromiseSubscription",{enumerable:!0,get:function(){return _.PromiseSubscription}}),Object.defineProperty(t,"Subscription",{enumerable:!0,get:function(){return g.Subscription}})}),S=y(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.EventDispatcher=void 0,t.EventDispatcher=class extends x.DispatcherBase{constructor(){super()}dispatch(e,t){const i=this._dispatch(!1,this,arguments);if(null==i)throw new x.DispatchError("Got `null` back from dispatch.");return i}dispatchAsync(e,t){this._dispatch(!0,this,arguments)}asEvent(){return super.asEvent()}}}),M=y(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.EventList=void 0,t.EventList=class extends x.EventListBase{constructor(){super()}createDispatcher(){return new S.EventDispatcher}}}),O=y(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.EventHandlingBase=void 0,t.EventHandlingBase=class extends x.HandlingBase{constructor(){super(new M.EventList)}}}),R=y(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.NonUniformEventList=void 0,t.NonUniformEventList=class{constructor(){this._events={}}get(e){if(this._events[e])return this._events[e];const t=this.createDispatcher();return this._events[e]=t,t}remove(e){delete this._events[e]}createDispatcher(){return new S.EventDispatcher}}}),j=y(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.NonUniformEventList=t.EventList=t.EventHandlingBase=t.EventDispatcher=void 0,Object.defineProperty(t,"EventDispatcher",{enumerable:!0,get:function(){return S.EventDispatcher}}),Object.defineProperty(t,"EventHandlingBase",{enumerable:!0,get:function(){return O.EventHandlingBase}}),Object.defineProperty(t,"EventList",{enumerable:!0,get:function(){return M.EventList}}),Object.defineProperty(t,"NonUniformEventList",{enumerable:!0,get:function(){return R.NonUniformEventList}})}),D=y(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.SimpleEventDispatcher=void 0,t.SimpleEventDispatcher=class extends x.DispatcherBase{constructor(){super()}dispatch(e){const t=this._dispatch(!1,this,arguments);if(null==t)throw new x.DispatchError("Got `null` back from dispatch.");return t}dispatchAsync(e){this._dispatch(!0,this,arguments)}asEvent(){return super.asEvent()}}}),A=y(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.SimpleEventList=void 0,t.SimpleEventList=class extends x.EventListBase{constructor(){super()}createDispatcher(){return new D.SimpleEventDispatcher}}}),C=y(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.SimpleEventHandlingBase=void 0,t.SimpleEventHandlingBase=class extends x.HandlingBase{constructor(){super(new A.SimpleEventList)}}}),B=y(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.NonUniformSimpleEventList=void 0,t.NonUniformSimpleEventList=class{constructor(){this._events={}}get(e){if(this._events[e])return this._events[e];const t=this.createDispatcher();return this._events[e]=t,t}remove(e){delete this._events[e]}createDispatcher(){return new D.SimpleEventDispatcher}}}),k=y(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.NonUniformSimpleEventList=t.SimpleEventList=t.SimpleEventHandlingBase=t.SimpleEventDispatcher=void 0,Object.defineProperty(t,"SimpleEventDispatcher",{enumerable:!0,get:function(){return D.SimpleEventDispatcher}}),Object.defineProperty(t,"SimpleEventHandlingBase",{enumerable:!0,get:function(){return C.SimpleEventHandlingBase}}),Object.defineProperty(t,"NonUniformSimpleEventList",{enumerable:!0,get:function(){return B.NonUniformSimpleEventList}}),Object.defineProperty(t,"SimpleEventList",{enumerable:!0,get:function(){return A.SimpleEventList}})}),L=y(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.SignalDispatcher=void 0,t.SignalDispatcher=class extends x.DispatcherBase{dispatch(){const e=this._dispatch(!1,this,arguments);if(null==e)throw new x.DispatchError("Got `null` back from dispatch.");return e}dispatchAsync(){this._dispatch(!0,this,arguments)}asEvent(){return super.asEvent()}}}),F=y(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.SignalList=void 0,t.SignalList=class extends x.EventListBase{constructor(){super()}createDispatcher(){return new L.SignalDispatcher}}}),U=y(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.SignalHandlingBase=void 0,t.SignalHandlingBase=class extends x.HandlingBase{constructor(){super(new F.SignalList)}}}),N=y(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.SignalList=t.SignalHandlingBase=t.SignalDispatcher=void 0,Object.defineProperty(t,"SignalDispatcher",{enumerable:!0,get:function(){return L.SignalDispatcher}}),Object.defineProperty(t,"SignalHandlingBase",{enumerable:!0,get:function(){return U.SignalHandlingBase}}),Object.defineProperty(t,"SignalList",{enumerable:!0,get:function(){return F.SignalList}})}),G=y(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.PromiseEventDispatcher=void 0,t.PromiseEventDispatcher=class extends x.PromiseDispatcherBase{constructor(){super()}async dispatch(e,t){const i=await this._dispatchAsPromise(!1,this,arguments);if(null==i)throw new x.DispatchError("Got `null` back from dispatch.");return i}dispatchAsync(e,t){this._dispatchAsPromise(!0,this,arguments)}asEvent(){return super.asEvent()}}}),V=y(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.PromiseEventList=void 0,t.PromiseEventList=class extends x.EventListBase{constructor(){super()}createDispatcher(){return new G.PromiseEventDispatcher}}}),H=y(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.PromiseEventHandlingBase=void 0,t.PromiseEventHandlingBase=class extends x.HandlingBase{constructor(){super(new V.PromiseEventList)}}}),X=y(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.NonUniformPromiseEventList=void 0,t.NonUniformPromiseEventList=class{constructor(){this._events={}}get(e){if(this._events[e])return this._events[e];const t=this.createDispatcher();return this._events[e]=t,t}remove(e){delete this._events[e]}createDispatcher(){return new G.PromiseEventDispatcher}}}),W=y(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.NonUniformPromiseEventList=t.PromiseEventList=t.PromiseEventHandlingBase=t.PromiseEventDispatcher=void 0,Object.defineProperty(t,"PromiseEventDispatcher",{enumerable:!0,get:function(){return G.PromiseEventDispatcher}}),Object.defineProperty(t,"PromiseEventHandlingBase",{enumerable:!0,get:function(){return H.PromiseEventHandlingBase}}),Object.defineProperty(t,"PromiseEventList",{enumerable:!0,get:function(){return V.PromiseEventList}}),Object.defineProperty(t,"NonUniformPromiseEventList",{enumerable:!0,get:function(){return X.NonUniformPromiseEventList}})}),Y=y(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.PromiseSignalDispatcher=void 0,t.PromiseSignalDispatcher=class extends x.PromiseDispatcherBase{constructor(){super()}async dispatch(){const e=await this._dispatchAsPromise(!1,this,arguments);if(null==e)throw new x.DispatchError("Got `null` back from dispatch.");return e}dispatchAsync(){this._dispatchAsPromise(!0,this,arguments)}asEvent(){return super.asEvent()}}}),K=y(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.PromiseSignalList=void 0,t.PromiseSignalList=class extends x.EventListBase{constructor(){super()}createDispatcher(){return new Y.PromiseSignalDispatcher}}}),z=y(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.PromiseSignalHandlingBase=void 0,t.PromiseSignalHandlingBase=class extends x.HandlingBase{constructor(){super(new K.PromiseSignalList)}}}),q=y(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.PromiseSignalList=t.PromiseSignalHandlingBase=t.PromiseSignalDispatcher=void 0,Object.defineProperty(t,"PromiseSignalDispatcher",{enumerable:!0,get:function(){return Y.PromiseSignalDispatcher}}),Object.defineProperty(t,"PromiseSignalHandlingBase",{enumerable:!0,get:function(){return z.PromiseSignalHandlingBase}}),Object.defineProperty(t,"PromiseSignalList",{enumerable:!0,get:function(){return K.PromiseSignalList}})}),Z=y(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.PromiseSimpleEventDispatcher=void 0,t.PromiseSimpleEventDispatcher=class extends x.PromiseDispatcherBase{constructor(){super()}async dispatch(e){const t=await this._dispatchAsPromise(!1,this,arguments);if(null==t)throw new x.DispatchError("Got `null` back from dispatch.");return t}dispatchAsync(e){this._dispatchAsPromise(!0,this,arguments)}asEvent(){return super.asEvent()}}}),Q=y(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.NonUniformPromiseSimpleEventList=void 0,t.NonUniformPromiseSimpleEventList=class{constructor(){this._events={}}get(e){if(this._events[e])return this._events[e];const t=this.createDispatcher();return this._events[e]=t,t}remove(e){delete this._events[e]}createDispatcher(){return new Z.PromiseSimpleEventDispatcher}}}),J=y(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.PromiseSimpleEventList=void 0,t.PromiseSimpleEventList=class extends x.EventListBase{constructor(){super()}createDispatcher(){return new Z.PromiseSimpleEventDispatcher}}}),$=y(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.PromiseSimpleEventHandlingBase=void 0,t.PromiseSimpleEventHandlingBase=class extends x.HandlingBase{constructor(){super(new J.PromiseSimpleEventList)}}}),ee=y(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.NonUniformPromiseSimpleEventList=t.PromiseSimpleEventList=t.PromiseSimpleEventHandlingBase=t.PromiseSimpleEventDispatcher=void 0,Object.defineProperty(t,"NonUniformPromiseSimpleEventList",{enumerable:!0,get:function(){return Q.NonUniformPromiseSimpleEventList}}),Object.defineProperty(t,"PromiseSimpleEventDispatcher",{enumerable:!0,get:function(){return Z.PromiseSimpleEventDispatcher}}),Object.defineProperty(t,"PromiseSimpleEventHandlingBase",{enumerable:!0,get:function(){return $.PromiseSimpleEventHandlingBase}}),Object.defineProperty(t,"PromiseSimpleEventList",{enumerable:!0,get:function(){return J.PromiseSimpleEventList}})}),te=y(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.NonUniformPromiseSimpleEventList=t.PromiseSimpleEventList=t.PromiseSimpleEventHandlingBase=t.PromiseSimpleEventDispatcher=t.PromiseSignalList=t.PromiseSignalHandlingBase=t.PromiseSignalDispatcher=t.NonUniformPromiseEventList=t.PromiseEventList=t.PromiseEventHandlingBase=t.PromiseEventDispatcher=t.SignalList=t.SignalHandlingBase=t.SignalDispatcher=t.NonUniformSimpleEventList=t.SimpleEventList=t.SimpleEventHandlingBase=t.SimpleEventDispatcher=t.NonUniformEventList=t.EventList=t.EventHandlingBase=t.EventDispatcher=t.HandlingBase=t.PromiseDispatcherBase=t.PromiseSubscription=t.DispatchError=t.EventManagement=t.EventListBase=t.DispatcherWrapper=t.DispatcherBase=t.Subscription=void 0,Object.defineProperty(t,"Subscription",{enumerable:!0,get:function(){return x.Subscription}}),Object.defineProperty(t,"DispatcherBase",{enumerable:!0,get:function(){return x.DispatcherBase}}),Object.defineProperty(t,"DispatcherWrapper",{enumerable:!0,get:function(){return x.DispatcherWrapper}}),Object.defineProperty(t,"EventListBase",{enumerable:!0,get:function(){return x.EventListBase}}),Object.defineProperty(t,"EventManagement",{enumerable:!0,get:function(){return x.EventManagement}}),Object.defineProperty(t,"DispatchError",{enumerable:!0,get:function(){return x.DispatchError}}),Object.defineProperty(t,"PromiseSubscription",{enumerable:!0,get:function(){return x.PromiseSubscription}}),Object.defineProperty(t,"PromiseDispatcherBase",{enumerable:!0,get:function(){return x.PromiseDispatcherBase}}),Object.defineProperty(t,"HandlingBase",{enumerable:!0,get:function(){return x.HandlingBase}}),Object.defineProperty(t,"EventDispatcher",{enumerable:!0,get:function(){return j.EventDispatcher}}),Object.defineProperty(t,"EventHandlingBase",{enumerable:!0,get:function(){return j.EventHandlingBase}}),Object.defineProperty(t,"EventList",{enumerable:!0,get:function(){return j.EventList}}),Object.defineProperty(t,"NonUniformEventList",{enumerable:!0,get:function(){return j.NonUniformEventList}}),Object.defineProperty(t,"SimpleEventDispatcher",{enumerable:!0,get:function(){return k.SimpleEventDispatcher}}),Object.defineProperty(t,"SimpleEventHandlingBase",{enumerable:!0,get:function(){return k.SimpleEventHandlingBase}}),Object.defineProperty(t,"SimpleEventList",{enumerable:!0,get:function(){return k.SimpleEventList}}),Object.defineProperty(t,"NonUniformSimpleEventList",{enumerable:!0,get:function(){return k.NonUniformSimpleEventList}}),Object.defineProperty(t,"SignalDispatcher",{enumerable:!0,get:function(){return N.SignalDispatcher}}),Object.defineProperty(t,"SignalHandlingBase",{enumerable:!0,get:function(){return N.SignalHandlingBase}}),Object.defineProperty(t,"SignalList",{enumerable:!0,get:function(){return N.SignalList}}),Object.defineProperty(t,"PromiseEventDispatcher",{enumerable:!0,get:function(){return W.PromiseEventDispatcher}}),Object.defineProperty(t,"PromiseEventHandlingBase",{enumerable:!0,get:function(){return W.PromiseEventHandlingBase}}),Object.defineProperty(t,"PromiseEventList",{enumerable:!0,get:function(){return W.PromiseEventList}}),Object.defineProperty(t,"NonUniformPromiseEventList",{enumerable:!0,get:function(){return W.NonUniformPromiseEventList}}),Object.defineProperty(t,"PromiseSignalDispatcher",{enumerable:!0,get:function(){return q.PromiseSignalDispatcher}}),Object.defineProperty(t,"PromiseSignalHandlingBase",{enumerable:!0,get:function(){return q.PromiseSignalHandlingBase}}),Object.defineProperty(t,"PromiseSignalList",{enumerable:!0,get:function(){return q.PromiseSignalList}}),Object.defineProperty(t,"PromiseSimpleEventDispatcher",{enumerable:!0,get:function(){return ee.PromiseSimpleEventDispatcher}}),Object.defineProperty(t,"PromiseSimpleEventHandlingBase",{enumerable:!0,get:function(){return ee.PromiseSimpleEventHandlingBase}}),Object.defineProperty(t,"PromiseSimpleEventList",{enumerable:!0,get:function(){return ee.PromiseSimpleEventList}}),Object.defineProperty(t,"NonUniformPromiseSimpleEventList",{enumerable:!0,get:function(){return ee.NonUniformPromiseSimpleEventList}})}),ie=function(){for(var e=[],t=0;t<256;t++)e[t]=(t<16?"0":"")+t.toString(16);return function(){var t=4294967295*Math.random()|0,i=4294967295*Math.random()|0,r=4294967295*Math.random()|0,n=4294967295*Math.random()|0;return e[255&t]+e[t>>8&255]+e[t>>16&255]+e[t>>24&255]+"-"+e[255&i]+e[i>>8&255]+"-"+e[i>>16&15|64]+e[i>>24&255]+"-"+e[63&r|128]+e[r>>8&255]+"-"+e[r>>16&255]+e[r>>24&255]+e[255&n]+e[n>>8&255]+e[n>>16&255]+e[n>>24&255]}}(),re=/*#__PURE__*/d("owner"),ne=/*#__PURE__*/d("ownedComponents"),oe=/*#__PURE__*/d("prefixMessageWithID"),se=/*#__PURE__*/d("own"),ae=/*#__PURE__*/function(){function e(e,t){void 0===t&&(t={}),Object.defineProperty(this,se,{value:le}),Object.defineProperty(this,oe,{value:ce}),this.id=void 0,this.destroyed=void 0,this.dirty=void 0,Object.defineProperty(this,re,{writable:!0,value:void 0}),Object.defineProperty(this,ne,{writable:!0,value:void 0}),this.onDestroyed=void 0,f(this,re)[re]=e,this.id=t.id||ie(),this.destroyed=!1,f(this,ne)[ne]=null,this.dirty=!1,this.onDestroyed=new p(new te.EventDispatcher),e&&f(e,se)[se](this)}var t=e.prototype;return t.log=function(e){e="[LOG] "+f(this,oe)[oe](e),console.log(e)},t.warn=function(e){e="[WARN] "+f(this,oe)[oe](e),console.warn(e)},t.error=function(e){e="[ERROR] "+f(this,oe)[oe](e),console.error(e)},t.setDirty=function(){this.dirty||(this.dirty=!0)},t.cleanIfDirty=function(){this.dirty&&(this.dirty=!1,this.clean())},t.clean=function(){},t.destroy=function(){if(!this.destroyed){if(this.destroyed=!0,f(this,ne)[ne])for(var e in f(this,ne)[ne])f(this,ne)[ne].hasOwnProperty(e)&&(f(this,ne)[ne][e].destroy(),delete f(this,ne)[ne][e]);f(this,ne)[ne]=null,this.dirty=!1,this.onDestroyed.dispatch(this,null),this.onDestroyed.clear()}},e}();function ce(e){return" ["+this.constructor.name+' "'+this.id+'"]: '+e}function le(e){var t=this;f(this,ne)[ne]||(f(this,ne)[ne]={}),f(this,ne)[ne][e.id]||(f(this,ne)[ne][e.id]=e),e.onDestroyed.one(function(){delete f(t,ne)[ne][e.id]})}var he=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}return r(t,e),t}(/*#__PURE__*/a(Error)),ue={__proto__:null,Component:ae,SDKError:he,EventEmitter:p},de=1e3,fe=1003,ve=1006,pe=1007,ye=1008,me=1009,ge=1023,be=33776,we=33777,Pe=33778,Ee=33779,Te=35840,_e=35841,Ie=35842,xe=35843,Se=36196,Me=37492,Oe=37496,Re=37808,je=37809,De=37810,Ae=37811,Ce=37812,Be=37813,ke=37814,Le=37815,Fe=37816,Ue=37817,Ne=37818,Ge=37819,Ve=37820,He=37821,Xe=36492,We=3e3,Ye=3001,Ke=2e4,ze=20001,qe=20002,Ze=20003,Qe=20004,Je=3e4,$e=4e5,et=5e5,tt=500001,it=500002,rt=500003,nt={__proto__:null,RepeatWrapping:de,ClampToEdgeWrapping:1001,MirroredRepeatWrapping:1002,NearestFilter:fe,NearestMipMapNearestFilter:1004,NearestMipmapNearestFilter:1004,NearestMipmapLinearFilter:1005,NearestMipMapLinearFilter:1005,LinearFilter:ve,LinearMipmapNearestFilter:1007,LinearMipMapNearestFilter:pe,LinearMipmapLinearFilter:ye,LinearMipMapLinearFilter:1008,UnsignedByteType:me,ByteType:1010,ShortType:1011,UnsignedShortType:1012,IntType:1013,UnsignedIntType:1014,FloatType:1015,HalfFloatType:1016,UnsignedShort4444Type:1017,UnsignedShort5551Type:1018,UnsignedInt248Type:1020,AlphaFormat:1021,RGBFormat:1022,RGBAFormat:ge,LuminanceFormat:1024,LuminanceAlphaFormat:1025,DepthFormat:1026,DepthStencilFormat:1027,RedFormat:1028,RedIntegerFormat:1029,RGFormat:1030,RGIntegerFormat:1031,RGBAIntegerFormat:1033,RGB_S3TC_DXT1_Format:be,RGBA_S3TC_DXT1_Format:we,RGBA_S3TC_DXT3_Format:Pe,RGBA_S3TC_DXT5_Format:Ee,RGB_PVRTC_4BPPV1_Format:Te,RGB_PVRTC_2BPPV1_Format:_e,RGBA_PVRTC_4BPPV1_Format:Ie,RGBA_PVRTC_2BPPV1_Format:xe,RGB_ETC1_Format:Se,RGB_ETC2_Format:Me,RGBA_ETC2_EAC_Format:Oe,RGBA_ASTC_4x4_Format:Re,RGBA_ASTC_5x4_Format:je,RGBA_ASTC_5x5_Format:De,RGBA_ASTC_6x5_Format:Ae,RGBA_ASTC_6x6_Format:Ce,RGBA_ASTC_8x5_Format:Be,RGBA_ASTC_8x6_Format:ke,RGBA_ASTC_8x8_Format:Le,RGBA_ASTC_10x5_Format:Fe,RGBA_ASTC_10x6_Format:Ue,RGBA_ASTC_10x8_Format:Ne,RGBA_ASTC_10x10_Format:Ge,RGBA_ASTC_12x10_Format:Ve,RGBA_ASTC_12x12_Format:He,RGBA_BPTC_Format:Xe,LinearEncoding:We,sRGBEncoding:Ye,GIFMediaType:1e4,JPEGMediaType:10001,PNGMediaType:10002,PointsPrimitive:Ke,LinesPrimitive:ze,TrianglesPrimitive:qe,SolidPrimitive:Ze,SurfacePrimitive:Qe,QualityRender:Je,FastRender:300001,MetersUnit:$e,CentimetersUnit:400001,MillimetersUnit:400002,YardsUnit:400003,FeetUnit:400004,InchesUnit:400005,PerspectiveProjectionType:et,OrthoProjectionType:tt,FrustumProjectionType:it,CustomProjectionType:rt},ot=-Number.MAX_SAFE_INTEGER,st=Number.MAX_SAFE_INTEGER,at=.0174532925;function ct(e,t,i){return Math.max(t,Math.min(i,e))}function lt(e){return new Float64Array(e)}var ht={__proto__:null,MIN_DOUBLE:ot,MAX_DOUBLE:st,DEGTORAD:at,RADTODEG:57.295779513,clamp:ct,newFloatArray:lt},ut=Pt(),dt=wt(),ft=wt(),vt=wt(),pt=wt(),yt=wt(),mt=Pt();function gt(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function bt(e){return new Float64Array(e||2)}function wt(e){return new Float64Array(e||3)}function Pt(e){return new Float64Array(e||4)}function Et(e,t,i){return i||(i=e),i[0]=e[0]+t[0],i[1]=e[1]+t[1],i[2]=e[2]+t[2],i[3]=e[3]+t[3],i}function Tt(e,t,i){return i||(i=e),i[0]=e[0]*t,i[1]=e[1]*t,i[2]=e[2]*t,i[3]=e[3]*t,i}function _t(e,t,i){return i||(i=e),i[0]=e[0]*t,i[1]=e[1]*t,i[2]=e[2]*t,i}function It(e,t,i){return i||(i=e),i[0]=e[0]*t,i[1]=e[1]*t,i}function xt(e,t,i){return i||(i=e),i[0]=e[0]+t[0],i[1]=e[1]+t[1],i[2]=e[2]+t[2],i}function St(e,t,i){return i||(i=e),i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],i[3]=e[3]-t[3],i}function Mt(e,t,i){return i||(i=e),i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],i}function Ot(e,t,i){return i||(i=e),i[0]=e[0]-t[0],i[1]=e[1]-t[1],i}function Rt(){for(var e=[].slice.call(arguments),t=new Float32Array(e[0]),i=1;i<e.length;i++)t[0]+=e[i][0],t[1]+=e[i][1];return t[0]/=e.length,t[1]/=e.length,t}function jt(e,t,i){return i||(i=t),i[0]=e/t[0],i[1]=e/t[1],i[2]=e/t[2],i}function Dt(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function At(e,t,i){i||(i=e);var r=e[0],n=e[1],o=e[2],s=t[0],a=t[1],c=t[2];return i[0]=n*c-o*a,i[1]=o*s-r*c,i[2]=r*a-n*s,i}function Ct(e){return Dt(e,e)}function Bt(e){return Math.sqrt(Ct(e))}function kt(e,t){return e[0]*t[0]+e[1]*t[1]}function Lt(e){return gt(e,e)}function Ft(e){return kt(e,e)}function Ut(e){return Math.sqrt(Lt(e))}var Nt,Gt=(Nt=wt(),function(e,t){return Ut(Mt(e,t,Nt))});function Vt(e){return Math.sqrt(Ft(e))}function Ht(e,t,i,r,n,o){var s=o||wt(),a=(e-t)/(i-t);return s[0]=r[0]+a*(n[0]-r[0]),s[1]=r[1]+a*(n[1]-r[1]),s[2]=r[2]+a*(n[2]-r[2]),s}var Xt=function(){var e=bt();return function(t,i){return Vt(Ot(t,i,e))}}();function Wt(e,t){return Tt(e,1/Bt(e),t)}function Yt(e,t){return _t(e,1/Ut(e),t)}var Kt=function(){var e=wt();return function(t,i){return e[0]=t[0],e[1]=t[1],e[2]=t[2],i[0]=Ut(e),e[0]=t[4],e[1]=t[5],e[2]=t[6],i[1]=Ut(e),e[0]=t[8],e[1]=t[9],e[2]=t[10],i[2]=Ut(e),i}}();function zt(e){return Math.round(1e5*e)/1e5}function qt(e){return new lt(e||9)}function Zt(e){return lt(e||16)}var Qt=Zt(),Jt=Zt();function $t(e,t,i,r,n){var o=[],s=[];return o[2]=i,s[2]=r,s[1]=o[2]*Math.tan(e/2),o[1]=-s[1],s[0]=s[1]*t,o[0]=-s[0],ei(o,s,n)}function ei(e,t,i){i||(i=Zt());var r=[e[0],e[1],e[2],0],n=[t[0],t[1],t[2],0];Et(n,r,Qt),St(n,r,Jt);var o=2*r[2],s=Jt[0],a=Jt[1],c=Jt[2];return i[0]=o/s,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=o/a,i[6]=0,i[7]=0,i[8]=Qt[0]/s,i[9]=Qt[1]/a,i[10]=-Qt[2]/c,i[11]=-1,i[12]=0,i[13]=0,i[14]=-o*n[2]/c,i[15]=0,i}function ti(e,t,i,r,n,o,s){s||(s=Zt());var a=t-e,c=r-i,l=o-n;return s[0]=2/a,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=2/c,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=-2/l,s[11]=0,s[12]=-(e+t)/a,s[13]=-(r+i)/c,s[14]=-(o+n)/l,s[15]=1,s}function ii(e,t,i,r,n,o,s){s||(s=Zt());var a=t-e,c=r-i,l=o-n;return s[0]=2*n/a,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=2*n/c,s[6]=0,s[7]=0,s[8]=(t+e)/a,s[9]=(r+i)/c,s[10]=-(o+n)/l,s[11]=-1,s[12]=0,s[13]=0,s[14]=-o*n*2/l,s[15]=0,s}function ri(e){return e||(e=Zt()),e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function ni(e){return e||(e=Zt()),e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function oi(e,t,i){i||(i=Zt());var r,n,o,s,a,c,l=Wt([t[0],t[1],t[2],0],[]),h=Math.sin(e),u=Math.cos(e),d=1-u,f=l[0],v=l[1],p=l[2];return r=f*v,n=v*p,o=p*f,s=f*h,a=v*h,c=p*h,i[0]=d*f*f+u,i[1]=d*r+c,i[2]=d*o-a,i[3]=0,i[4]=d*r-c,i[5]=d*v*v+u,i[6]=d*n+s,i[7]=0,i[8]=d*o+a,i[9]=d*n-s,i[10]=d*p*p+u,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function si(e,t,i,r){r||(r=Zt());var n,o,s,a,c,l,h,u,d,f,v=e[0],p=e[1],y=e[2],m=i[0],g=i[1],b=i[2],w=t[0],P=t[1],E=t[2];return v===w&&p===P&&y===E?ri():(n=v-w,o=p-P,s=y-E,a=g*(s*=f=1/Math.sqrt(n*n+o*o+s*s))-b*(o*=f),c=b*(n*=f)-m*s,l=m*o-g*n,(f=Math.sqrt(a*a+c*c+l*l))?(a*=f=1/f,c*=f,l*=f):(a=0,c=0,l=0),h=o*l-s*c,u=s*a-n*l,d=n*c-o*a,(f=Math.sqrt(h*h+u*u+d*d))?(h*=f=1/f,u*=f,d*=f):(h=0,u=0,d=0),r[0]=a,r[1]=h,r[2]=n,r[3]=0,r[4]=c,r[5]=u,r[6]=o,r[7]=0,r[8]=l,r[9]=d,r[10]=s,r[11]=0,r[12]=-(a*v+c*p+l*y),r[13]=-(h*v+u*p+d*y),r[14]=-(n*v+o*p+s*y),r[15]=1,r)}function ai(e,t){t||(t=e);var i=e[0],r=e[1],n=e[2],o=e[3],s=e[4],a=e[5],c=e[6],l=e[7],h=e[8],u=e[9],d=e[10],f=e[11],v=e[12],p=e[13],y=e[14],m=e[15],g=i*a-r*s,b=i*c-n*s,w=i*l-o*s,P=r*c-n*a,E=r*l-o*a,T=n*l-o*c,_=h*p-u*v,I=h*y-d*v,x=h*m-f*v,S=u*y-d*p,M=u*m-f*p,O=d*m-f*y,R=1/(g*O-b*M+w*S+P*x-E*I+T*_);return t[0]=(a*O-c*M+l*S)*R,t[1]=(-r*O+n*M-o*S)*R,t[2]=(p*T-y*E+m*P)*R,t[3]=(-u*T+d*E-f*P)*R,t[4]=(-s*O+c*x-l*I)*R,t[5]=(i*O-n*x+o*I)*R,t[6]=(-v*T+y*w-m*b)*R,t[7]=(h*T-d*w+f*b)*R,t[8]=(s*M-a*x+l*_)*R,t[9]=(-i*M+r*x-o*_)*R,t[10]=(v*E-p*w+m*g)*R,t[11]=(-h*E+u*w-f*g)*R,t[12]=(-s*S+a*I-c*_)*R,t[13]=(i*S-r*I+n*_)*R,t[14]=(-v*P+p*b-y*g)*R,t[15]=(h*P-u*b+d*g)*R,t}function ci(e,t){var i=e[4],r=e[14],n=e[8],o=e[13],s=e[12],a=e[9];if(!t||e===t){var c=e[1],l=e[2],h=e[3],u=e[6],d=e[7],f=e[11];return e[1]=i,e[2]=n,e[3]=s,e[4]=c,e[6]=a,e[7]=o,e[8]=l,e[9]=u,e[11]=r,e[12]=h,e[13]=d,e[14]=f,e}return t[0]=e[0],t[1]=i,t[2]=n,t[3]=s,t[4]=e[1],t[5]=e[5],t[6]=a,t[7]=o,t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=r,t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15],t}function li(e,t,i){i||(i=e);var r=t[0],n=t[1],o=t[2],s=t[3];return i[0]=e[0]*r+e[4]*n+e[8]*o+e[12]*s,i[1]=e[1]*r+e[5]*n+e[9]*o+e[13]*s,i[2]=e[2]*r+e[6]*n+e[10]*o+e[14]*s,i[3]=e[3]*r+e[7]*n+e[11]*o+e[15]*s,i}function hi(e,t,i){i||(i=e);var r=e[0],n=e[1],o=e[2],s=e[3],a=e[4],c=e[5],l=e[6],h=e[7],u=e[8],d=e[9],f=e[10],v=e[11],p=e[12],y=e[13],m=e[14],g=e[15],b=t[0],w=t[1],P=t[2],E=t[3],T=t[4],_=t[5],I=t[6],x=t[7],S=t[8],M=t[9],O=t[10],R=t[11],j=t[12],D=t[13],A=t[14],C=t[15];return i[0]=b*r+w*a+P*u+E*p,i[1]=b*n+w*c+P*d+E*y,i[2]=b*o+w*l+P*f+E*m,i[3]=b*s+w*h+P*v+E*g,i[4]=T*r+_*a+I*u+x*p,i[5]=T*n+_*c+I*d+x*y,i[6]=T*o+_*l+I*f+x*m,i[7]=T*s+_*h+I*v+x*g,i[8]=S*r+M*a+O*u+R*p,i[9]=S*n+M*c+O*d+R*y,i[10]=S*o+M*l+O*f+R*m,i[11]=S*s+M*h+O*v+R*g,i[12]=j*r+D*a+A*u+C*p,i[13]=j*n+D*c+A*d+C*y,i[14]=j*o+D*l+A*f+C*m,i[15]=j*s+D*h+A*v+C*g,i}function ui(e,t,i){void 0===i&&(i=lt(9));var r=e[0],n=e[3],o=e[6],s=e[1],a=e[4],c=e[7],l=e[2],h=e[5],u=e[8],d=t[0],f=t[3],v=t[6],p=t[1],y=t[4],m=t[7],g=t[2],b=t[5],w=t[8];return i[0]=r*d+n*p+o*g,i[3]=r*f+n*y+o*b,i[6]=r*v+n*m+o*w,i[1]=s*d+a*p+c*g,i[4]=s*f+a*y+c*b,i[7]=s*v+a*m+c*w,i[2]=l*d+h*p+u*g,i[5]=l*f+h*y+u*b,i[8]=l*v+h*m+u*w,i}function di(e,t,i){i||(i=t);var r=t[0],n=t[1],o=t[2];return i[0]=e[0]*r+e[4]*n+e[8]*o+e[12],i[1]=e[1]*r+e[5]*n+e[9]*o+e[13],i[2]=e[2]*r+e[6]*n+e[10]*o+e[14],i}function fi(e,t,i){return i[0]=e[0]*t[0]+e[4]*t[1]+e[8]*t[2]+e[12]*t[3],i[1]=e[1]*t[0]+e[5]*t[1]+e[9]*t[2]+e[13]*t[3],i[2]=e[2]*t[0]+e[6]*t[1]+e[10]*t[2]+e[14]*t[3],i[3]=e[3]*t[0]+e[7]*t[1]+e[11]*t[2]+e[15]*t[3],i}function vi(e,t,i){var r;i||(i=t);var n,o,s,a=t.length,c=e[0],l=e[1],h=e[2],u=e[3],d=e[4],f=e[5],v=e[6],p=e[7],y=e[8],m=e[9],g=e[10],b=e[11],w=e[12],P=e[13],E=e[14],T=e[15];for(r=0;r<a;r+=3)i[r+0]=c*(n=t[r+0])+d*(o=t[r+1])+y*(s=t[r+2])+w,i[r+1]=l*n+f*o+m*s+P,i[r+2]=h*n+v*o+g*s+E,i[r+3]=u*n+p*o+b*s+T;return i}function pi(e,t,i){var r=t[0],n=t[1],o=t[2];return(i=i||wt())[0]=e[0]*r+e[4]*n+e[8]*o,i[1]=e[1]*r+e[5]*n+e[9]*o,i[2]=e[2]*r+e[6]*n+e[10]*o,i}function yi(e,t,i){var r=t[0],n=t[1],o=t[2],s=t[3];return(i=i||Pt())[0]=e[0]*r+e[4]*n+e[8]*o+e[12]*s,i[1]=e[1]*r+e[5]*n+e[9]*o+e[13]*s,i[2]=e[2]*r+e[6]*n+e[10]*o+e[14]*s,i[3]=e[3]*r+e[7]*n+e[11]*o+e[15]*s,i}function mi(e,t){void 0===t&&(t=ri());var i=e[0],r=e[1],n=e[2];return t[0]*=i,t[4]*=r,t[8]*=n,t[1]*=i,t[5]*=r,t[9]*=n,t[2]*=i,t[6]*=r,t[10]*=n,t[3]*=i,t[7]*=r,t[11]*=n,t}function gi(e,t){return void 0===t&&(t=ri()),t[0]=e[0],t[5]=e[1],t[10]=e[2],t}function bi(e,t){return void 0===t&&(t=ni()),t[0]=e[0],t[4]=e[1],t}var wi,Pi=(wi=lt(3),function(e,t,i,r){return wi[0]=e,wi[1]=t,wi[2]=i,gi(wi,r)});function Ei(e,t,i,r){return void 0===r&&(r=Zt()),ki(t,r),mi(i,r),_i(e,r),r}var Ti=function(){var e=wt(),t=Zt();return function(i,r,n,o){e[0]=i[0],e[1]=i[1],e[2]=i[2];var s=Ut(e);e[0]=i[4],e[1]=i[5],e[2]=i[6];var a=Ut(e);e[8]=i[8],e[9]=i[9],e[10]=i[10];var c=Ut(e);Ri(i)<0&&(s=-s),r[0]=i[12],r[1]=i[13],r[2]=i[14],t.set(i);var l=1/s,h=1/a,u=1/c;t[0]*=l,t[1]*=l,t[2]*=l,t[4]*=h,t[5]*=h,t[6]*=h,t[8]*=u,t[9]*=u,t[10]*=u,Bi(t,n),o[0]=s,o[1]=a,o[2]=c}}();function _i(e,t){return void 0===t&&(t=ri()),Ii(e[0],e[1],e[2],t)}function Ii(e,t,i,r){void 0===r&&(r=ri());var n=r[3];r[0]+=n*e,r[1]+=n*t,r[2]+=n*i;var o=r[7];r[4]+=o*e,r[5]+=o*t,r[6]+=o*i;var s=r[11];r[8]+=s*e,r[9]+=s*t,r[10]+=s*i;var a=r[15];return r[12]+=a*e,r[13]+=a*t,r[14]+=a*i,r}function xi(e,t,i){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=t[0],i[13]=t[1],i[14]=t[2],i[15]=e[15],i}function Si(e,t){var i=t||ri();return i[12]=e[0],i[13]=e[1],i[14]=e[2],i}function Mi(e,t){var i=t||ni();return i[6]=e[0],i[7]=e[1],i}var Oi=function(){var e=lt(3);return function(t,i,r,n){return e[0]=t,e[1]=i,e[2]=r,Si(e,n)}}();function Ri(e){var t=e[0],i=e[1],r=e[2],n=e[3],o=e[4],s=e[5],a=e[6],c=e[7],l=e[8],h=e[9],u=e[10],d=e[11],f=e[12],v=e[13],p=e[14],y=e[15];return f*h*a*n-l*v*a*n-f*s*u*n+o*v*u*n+l*s*p*n-o*h*p*n-f*h*r*c+l*v*r*c+f*i*u*c-t*v*u*c-l*i*p*c+t*h*p*c+f*s*r*d-o*v*r*d-f*i*a*d+t*v*a*d+o*i*p*d-t*s*p*d-l*s*r*y+o*h*r*y+l*i*a*y-t*h*a*y-o*i*u*y+t*s*u*y}function ji(e,t,i){void 0===i&&(i=wt());var r=e[0],n=e[4],o=e[8],s=e[1],a=e[5],c=e[9],l=e[2],h=e[6],u=e[10];return"XYZ"===t?(i[1]=Math.asin(ct(o,-1,1)),Math.abs(o)<.99999?(i[0]=Math.atan2(-c,u),i[2]=Math.atan2(-n,r)):(i[0]=Math.atan2(h,a),i[2]=0)):"YXZ"===t?(i[0]=Math.asin(-ct(c,-1,1)),Math.abs(c)<.99999?(i[1]=Math.atan2(o,u),i[2]=Math.atan2(s,a)):(i[1]=Math.atan2(-l,r),i[2]=0)):"ZXY"===t?(i[0]=Math.asin(ct(h,-1,1)),Math.abs(h)<.99999?(i[1]=Math.atan2(-l,u),i[2]=Math.atan2(-n,a)):(i[1]=0,i[2]=Math.atan2(s,r))):"ZYX"===t?(i[1]=Math.asin(-ct(l,-1,1)),Math.abs(l)<.99999?(i[0]=Math.atan2(h,u),i[2]=Math.atan2(s,r)):(i[0]=0,i[2]=Math.atan2(-n,a))):"YZX"===t?(i[2]=Math.asin(ct(s,-1,1)),Math.abs(s)<.99999?(i[0]=Math.atan2(-c,a),i[1]=Math.atan2(-l,r)):(i[0]=0,i[1]=Math.atan2(o,u))):"XZY"===t&&(i[2]=Math.asin(-ct(n,-1,1)),Math.abs(n)<.99999?(i[0]=Math.atan2(h,a),i[1]=Math.atan2(o,r)):(i[0]=Math.atan2(-c,u),i[1]=0)),i}function Di(e,t,i,r,n,o){var s=o||Zt(),a=(e-t)/(i-t);return s[0]=r[0]+a*(n[0]-r[0]),s[1]=r[1]+a*(n[1]-r[1]),s[2]=r[2]+a*(n[2]-r[2]),s[3]=r[3]+a*(n[3]-r[3]),s[4]=r[4]+a*(n[4]-r[4]),s[5]=r[5]+a*(n[5]-r[5]),s[6]=r[6]+a*(n[6]-r[6]),s[7]=r[7]+a*(n[7]-r[7]),s[8]=r[8]+a*(n[8]-r[8]),s[9]=r[9]+a*(n[9]-r[9]),s[10]=r[10]+a*(n[10]-r[10]),s[11]=r[11]+a*(n[11]-r[11]),s[12]=r[12]+a*(n[12]-r[12]),s[13]=r[13]+a*(n[13]-r[13]),s[14]=r[14]+a*(n[14]-r[14]),s[15]=r[15]+a*(n[15]-r[15]),s}function Ai(e){return void 0===e&&(e=Pt()),e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function Ci(e,t,i){void 0===i&&(i=Pt());var r=e[0]*at/2,n=e[1]*at/2,o=e[2]*at/2,s=Math.cos(r),a=Math.cos(n),c=Math.cos(o),l=Math.sin(r),h=Math.sin(n),u=Math.sin(o);return"XYZ"===t?(i[0]=l*a*c+s*h*u,i[1]=s*h*c-l*a*u,i[2]=s*a*u+l*h*c,i[3]=s*a*c-l*h*u):"YXZ"===t?(i[0]=l*a*c+s*h*u,i[1]=s*h*c-l*a*u,i[2]=s*a*u-l*h*c,i[3]=s*a*c+l*h*u):"ZXY"===t?(i[0]=l*a*c-s*h*u,i[1]=s*h*c+l*a*u,i[2]=s*a*u+l*h*c,i[3]=s*a*c-l*h*u):"ZYX"===t?(i[0]=l*a*c-s*h*u,i[1]=s*h*c+l*a*u,i[2]=s*a*u-l*h*c,i[3]=s*a*c+l*h*u):"YZX"===t?(i[0]=l*a*c+s*h*u,i[1]=s*h*c+l*a*u,i[2]=s*a*u-l*h*c,i[3]=s*a*c-l*h*u):"XZY"===t&&(i[0]=l*a*c-s*h*u,i[1]=s*h*c-l*a*u,i[2]=s*a*u+l*h*c,i[3]=s*a*c+l*h*u),i}function Bi(e,t){void 0===t&&(t=Pt());var i,r=e[0],n=e[4],o=e[8],s=e[1],a=e[5],c=e[9],l=e[2],h=e[6],u=e[10],d=r+a+u;return d>0?(i=.5/Math.sqrt(d+1),t[3]=.25/i,t[0]=(h-c)*i,t[1]=(o-l)*i,t[2]=(s-n)*i):r>a&&r>u?(i=2*Math.sqrt(1+r-a-u),t[3]=(h-c)/i,t[0]=.25*i,t[1]=(n+s)/i,t[2]=(o+l)/i):a>u?(i=2*Math.sqrt(1+a-r-u),t[3]=(o-l)/i,t[0]=(n+s)/i,t[1]=.25*i,t[2]=(c+h)/i):(i=2*Math.sqrt(1+u-r-a),t[3]=(s-n)/i,t[0]=(o+l)/i,t[1]=(c+h)/i,t[2]=.25*i),t}function ki(e,t){var i=e[0],r=e[1],n=e[2],o=e[3],s=i+i,a=r+r,c=n+n,l=i*s,h=i*a,u=i*c,d=r*a,f=r*c,v=n*c,p=o*s,y=o*a,m=o*c;return t[0]=1-(d+v),t[4]=h-m,t[8]=u+y,t[1]=h+m,t[5]=1-(l+v),t[9]=f-p,t[2]=u-y,t[6]=f+p,t[10]=1-(l+d),t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Li(e,t){void 0===t&&(t=e);var i=Bt([e[0],e[1],e[2],e[3]]);return t[0]=e[0]/i,t[1]=e[1]/i,t[2]=e[2]/i,t[3]=e[3]/i,t}function Fi(e,t){return void 0===t&&(t=e),t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}var Ui={__proto__:null,dotVec3:gt,createVec2:bt,createVec3:wt,createVec4:Pt,negateVec3:function(e,t){return t||(t=e),t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},negateVec4:function(e,t){return t||(t=e),t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},addVec4:Et,addVec4Scalar:function(e,t,i){return i||(i=e),i[0]=e[0]+t,i[1]=e[1]+t,i[2]=e[2]+t,i[3]=e[3]+t,i},mulVec4Scalar:Tt,mulVec3Scalar:_t,mulVec2Scalar:It,addVec3:xt,addVec3Scalar:function(e,t,i){return i||(i=e),i[0]=e[0]+t,i[1]=e[1]+t,i[2]=e[2]+t,i},subVec4:St,compareVec3:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]},subVec3:Mt,subVec2:Ot,geometricMeanVec2:Rt,subVec4Scalar:function(e,t,i){return i||(i=e),i[0]=e[0]-t,i[1]=e[1]-t,i[2]=e[2]-t,i[3]=e[3]-t,i},subScalarVec4:function(e,t,i){return i||(i=e),i[0]=t-e[0],i[1]=t-e[1],i[2]=t-e[2],i[3]=t-e[3],i},mulVec4:function(e,t,i){return i||(i=e),i[0]=e[0]*t[0],i[1]=e[1]*t[1],i[2]=e[2]*t[2],i[3]=e[3]*t[3],i},divVec3:function(e,t,i){return i||(i=e),i[0]=e[0]/t[0],i[1]=e[1]/t[1],i[2]=e[2]/t[2],i},divVec4:function(e,t,i){return i||(i=e),i[0]=e[0]/t[0],i[1]=e[1]/t[1],i[2]=e[2]/t[2],i[3]=e[3]/t[3],i},divScalarVec3:jt,divVec3Scalar:function(e,t,i){return i||(i=e),i[0]=e[0]/t,i[1]=e[1]/t,i[2]=e[2]/t,i},divVec4Scalar:function(e,t,i){return i||(i=e),i[0]=e[0]/t,i[1]=e[1]/t,i[2]=e[2]/t,i[3]=e[3]/t,i},divScalarVec4:function(e,t,i){return i||(i=t),i[0]=e/t[0],i[1]=e/t[1],i[2]=e/t[2],i[3]=e/t[3],i},dotVec4:Dt,cross3Vec4:function(e,t){var i=e[0],r=e[1],n=e[2],o=t[0],s=t[1],a=t[2];return[r*a-n*s,n*o-i*a,i*s-r*o,0]},cross3Vec3:At,sqLenVec4:Ct,lenVec4:Bt,dotVec2:kt,sqLenVec3:Lt,sqLenVec2:Ft,lenVec3:Ut,distVec3:Gt,lenVec2:Vt,lerpVec3:Ht,distVec2:Xt,rcpVec3:function(e,t){return jt(1,e,t)},normalizeVec4:Wt,normalizeVec3:Yt,normalizeVec2:function(e,t){return It(e,1/Vt(e),t)},angleVec3:function(e,t){var i=gt(e,t)/Math.sqrt(Lt(e)*Lt(t));return i=i<-1?-1:i>1?1:i,Math.acos(i)},vec3FromMat4Scale:Kt,vecToArray:function(e){for(var t=0,i=(e=Array.prototype.slice.call(e)).length;t<i;t++)e[t]=zt(e[t]);return e},triangleNormal:function(e,t,i,r){void 0===r&&(r=wt());var n=t[0]-e[0],o=t[1]-e[1],s=t[2]-e[2],a=i[0]-e[0],c=i[1]-e[1],l=i[2]-e[2],h=o*l-s*c,u=s*a-n*l,d=n*c-o*a,f=Math.sqrt(h*h+u*u+d*d);return 0===f?(r[0]=0,r[1]=0,r[2]=0):(r[0]=h/f,r[1]=u/f,r[2]=d/f),r},createMat3:qt,createMat4:Zt,compareMat4:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]},perspectiveMat4:$t,frustumMat4v:ei,orthoMat4c:ti,frustumMat4:ii,identityMat4:ri,identityMat3:ni,isIdentityMat4:function(e){return 1===e[0]&&0===e[1]&&0===e[2]&&0===e[3]&&0===e[4]&&1===e[5]&&0===e[6]&&0===e[7]&&0===e[8]&&0===e[9]&&1===e[10]&&0===e[11]&&0===e[12]&&0===e[13]&&0===e[14]&&1===e[15]},rotationMat4v:oi,lookAtMat4v:si,inverseMat4:ai,transposeMat4:ci,mulMat4v4:li,mulMat4:hi,mulMat3:ui,transformPoint3:di,transformPoint4:fi,transformPoints3:function(e,t,i){for(var r,n,o,s,a,c=i||[],l=t.length,h=e[0],u=e[1],d=e[2],f=e[3],v=e[4],p=e[5],y=e[6],m=e[7],g=e[8],b=e[9],w=e[10],P=e[11],E=e[12],T=e[13],_=e[14],I=e[15],x=0;x<l;++x)r=(s=t[x])[0],n=s[1],o=s[2],(a=c[x]||(c[x]=[0,0,0]))[0]=h*r+v*n+g*o+E,a[1]=u*r+p*n+b*o+T,a[2]=d*r+y*n+w*o+_,a[3]=f*r+m*n+P*o+I;return c.length=l,c},transformPositions3:vi,transformPositions4:function(e,t,i){var r;i||(i=t);var n,o,s,a=t.length,c=e[0],l=e[1],h=e[2],u=e[3],d=e[4],f=e[5],v=e[6],p=e[7],y=e[8],m=e[9],g=e[10],b=e[11],w=e[12],P=e[13],E=e[14],T=e[15];for(r=0;r<a;r+=4)i[r+0]=c*(n=t[r+0])+d*(o=t[r+1])+y*(s=t[r+2])+w,i[r+1]=l*n+f*o+m*s+P,i[r+2]=h*n+v*o+g*s+E,i[r+3]=u*n+p*o+b*s+T;return i},transformVec3:pi,transformVec4:yi,scaleMat4v:mi,scalingMat4v:gi,scalingMat3v:bi,scalingMat4c:Pi,scaleMat4c:function(e,t,i,r){return r[0]*=e,r[4]*=t,r[8]*=i,r[1]*=e,r[5]*=t,r[9]*=i,r[2]*=e,r[6]*=t,r[10]*=i,r[3]*=e,r[7]*=t,r[11]*=i,r},scalingMat4s:function(e){return Pi(e,e,e)},composeMat4:Ei,decomposeMat4:Ti,translateMat4v:_i,translateMat4c:Ii,setMat4Translation:xi,translationMat4v:Si,translationMat3v:Mi,translationMat4c:Oi,translationMat4s:function(e,t){return Oi(e,e,e,t)},determinantMat4:Ri,mat4ToEuler:ji,lerpMat4:Di,identityQuat:Ai,eulerToQuat:Ci,mat4ToQuat:Bi,vec3PairToQuat:function(e,t,i){void 0===i&&(i=Pt());var r=Math.sqrt(gt(e,e)*gt(t,t)),n=r+gt(e,t);return n<1e-8*r?(n=0,Math.abs(e[0])>Math.abs(e[2])?(i[0]=-e[1],i[1]=e[0],i[2]=0):(i[0]=0,i[1]=-e[2],i[2]=e[1])):At(e,t,i),i[3]=n,Li(i)},angleAxisToQuaternion:function(e,t){void 0===t&&(t=Pt());var i=e[3]/2,r=Math.sin(i);return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=Math.cos(i),t},quatToEuler:function(e,t,i){return void 0===i&&(i=wt()),ki(e,Qt),ji(Qt,t,i),i},mulQuats:function(e,t,i){void 0===i&&(i=Pt());var r=e[0],n=e[1],o=e[2],s=e[3],a=t[0],c=t[1],l=t[2],h=t[3];return i[0]=s*a+r*h+n*l-o*c,i[1]=s*c+n*h+o*a-r*l,i[2]=s*l+o*h+r*c-n*a,i[3]=s*h-r*a-n*c-o*l,i},vec3ApplyQuat:function(e,t,i){void 0===i&&(i=wt());var r=t[0],n=t[1],o=t[2],s=e[0],a=e[1],c=e[2],l=e[3],h=l*r+a*o-c*n,u=l*n+c*r-s*o,d=l*o+s*n-a*r,f=-s*r-a*n-c*o;return i[0]=h*l+f*-s+u*-c-d*-a,i[1]=u*l+f*-a+d*-s-h*-c,i[2]=d*l+f*-c+h*-a-u*-s,i},quatToMat4:function(e,t){t=ri(t);var i=e[0],r=e[1],n=e[2],o=e[3],s=2*i,a=2*r,c=2*n,l=s*o,h=a*o,u=c*o,d=s*i,f=a*i,v=c*i,p=a*r,y=c*r,m=c*n;return t[0]=1-(p+m),t[1]=f+u,t[2]=v-h,t[4]=f-u,t[5]=1-(d+m),t[6]=y+l,t[8]=v+h,t[9]=y-l,t[10]=1-(d+p),t},quatToRotationMat4:ki,normalizeQuat:Li,conjugateQuat:Fi,inverseQuat:function(e,t){return Li(Fi(e,t))},quatToAngleAxis:function(e,t){void 0===t&&(t=Pt());var i=(e=Li(e,ut))[3],r=2*Math.acos(i),n=Math.sqrt(1-i*i);return n<.001?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=e[0]/n,t[1]=e[1]/n,t[2]=e[2]/n),t[3]=r,t},rayTriangleIntersect:function(e,t,i,r,n,o){o=o||wt();var s=Mt(r,i,dt),a=Mt(n,i,ft),c=At(t,a,vt),l=gt(s,c);if(l<1e-6)return null;var h=Mt(e,i,pt),u=gt(h,c);if(u<0||u>l)return null;var d=At(h,s,yt),f=gt(t,d);if(f<0||u+f>l)return null;var v=gt(a,d)/l;return o[0]=e[0]+v*t[0],o[1]=e[1]+v*t[1],o[2]=e[2]+v*t[2],o},transformRay:function(e,t,i,r,n){ut[0]=t[0],ut[1]=t[1],ut[2]=t[2],ut[3]=1,yi(e,ut,mt),r[0]=mt[0],r[1]=mt[1],r[2]=mt[2],ut[0]=i[0],ut[1]=i[1],ut[2]=i[2],pi(e,ut,mt),Yt(mt),n[0]=mt[0],n[1]=mt[1],n[2]=mt[2]}},Ni=/*#__PURE__*/d("items"),Gi=/*#__PURE__*/d("lastUniqueId"),Vi=/*#__PURE__*/function(){function e(e,t){Object.defineProperty(this,Ni,{writable:!0,value:void 0}),Object.defineProperty(this,Gi,{writable:!0,value:void 0}),f(this,Ni)[Ni]=e||[],f(this,Gi)[Gi]=(t||0)+1}var t=e.prototype;return t.addItem=function(){var e;if(2===arguments.length){var t=arguments[0];if(e=arguments[1],f(this,Ni)[Ni][t])throw"ID clash: '"+t+"'";return f(this,Ni)[Ni][t]=e,t}for(e=arguments[0]||{};;){var i=f(this,Gi)[Gi]++;if(!f(this,Ni)[Ni][i])return f(this,Ni)[Ni][i]=e,i}},t.removeItem=function(e){var t=f(this,Ni)[Ni][e];return delete f(this,Ni)[Ni][e],t},e}(),Hi=/*#__PURE__*/function(){function e(){this._head=void 0,this._headLength=void 0,this._tail=void 0,this._index=void 0,this._length=void 0,this._head=[],this._headLength=0,this._tail=[],this._index=0,this._length=0}var t=e.prototype;return t.shift=function(){if(this._index>=this._headLength){var e=this._head;if(e.length=0,this._head=this._tail,this._tail=e,this._index=0,this._headLength=this._head.length,!this._headLength)return}var t=this._head[this._index];return this._index<0?delete this._head[this._index++]:this._head[this._index++]=void 0,this._length--,t},t.push=function(e){return this._length++,this._tail.push(e),this},t.unshift=function(e){return this._head[--this._index]=e,this._length++,this},t.clear=function(){this._head=[],this._headLength=0,this._tail=[],this._index=0,this._length=0},i(e,[{key:"length",get:function(){return this._length}}]),e}(),Xi=/*#__PURE__*/function(){function e(e,t,i){this.isLoading=void 0,this.itemsLoaded=void 0,this.itemsTotal=void 0,this.urlModifier=void 0,this.handlers=void 0,this.onStart=void 0,this.onLoad=void 0,this.onProgress=void 0,this.onError=void 0,this.isLoading=!1,this.itemsLoaded=0,this.itemsTotal=0,this.urlModifier=void 0,this.handlers=[],this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i}var t=e.prototype;return t.itemStart=function(e){this.itemsTotal++,this.isLoading||void 0!==this.onStart&&this.onStart(e,this.itemsLoaded,this.itemsTotal),this.isLoading=!0},t.itemEnd=function(e){this.itemsLoaded++,void 0!==this.onProgress&&this.onProgress(e,this.itemsLoaded,this.itemsTotal),this.itemsLoaded===this.itemsTotal&&(this.isLoading=!1,void 0!==this.onLoad&&this.onLoad())},t.itemError=function(e){void 0!==this.onError&&this.onError(e)},t.resolveURL=function(e){return this.urlModifier?this.urlModifier(e):e},t.setURLModifier=function(e){return this.urlModifier=e,this},t.addHandler=function(e,t){return this.handlers.push(e,t),this},t.removeHandler=function(e){var t=this.handlers.indexOf(e);return-1!==t&&this.handlers.splice(t,2),this},t.getHandler=function(e){for(var t=0,i=this.handlers.length;t<i;t+=2){var r=this.handlers[t],n=this.handlers[t+1];if(r.global&&(r.lastIndex=0),r.test(e))return n}return null},e}(),Wi=new Xi,Yi=/*#__PURE__*/function(){function e(e){this.manager=void 0,this.crossOrigin=void 0,this.withCredentials=void 0,this.path=void 0,this.resourcePath=void 0,this.requestHeader=void 0,this.manager=void 0!==e?e:Wi,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}var t=e.prototype;return t.load=function(e,t,i,r){},t.loadAsync=function(e,t){var i=this;return new Promise(function(r,n){i.load(e,r,t,n)})},t.parse=function(){},t.setCrossOrigin=function(e){return this.crossOrigin=e,this},t.setWithCredentials=function(e){return this.withCredentials=e,this},t.setPath=function(e){return this.path=e,this},t.setResourcePath=function(e){return this.resourcePath=e,this},t.setRequestHeader=function(e){return this.requestHeader=e,this},e}(),Ki=/*#__PURE__*/function(){function e(e){void 0===e&&(e=4),this.pool=void 0,this.queue=void 0,this.workers=void 0,this.workersResolve=void 0,this.workerStatus=void 0,this.workerCreator=void 0,this.pool=e,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}var t=e.prototype;return t._initWorker=function(e){if(!this.workers[e]){var t=this.workerCreator();t.addEventListener("message",this._onMessage.bind(this,e)),this.workers[e]=t}},t._getIdleWorker=function(){for(var e=0;e<this.pool;e++)if(!(this.workerStatus&1<<e))return e;return-1},t._onMessage=function(e,t){var i=this.workersResolve[e];if(i&&i(t),this.queue.length){var r=this.queue.shift(),n=r.msg,o=r.transfer;this.workersResolve[e]=r.resolve,this.workers[e].postMessage(n,o)}else this.workerStatus^=1<<e},t.setWorkerCreator=function(e){this.workerCreator=e},t.setWorkerLimit=function(e){this.pool=e},t.postMessage=function(e,t){var i=this;return new Promise(function(r){var n=i._getIdleWorker();-1!==n?(i._initWorker(n),i.workerStatus|=1<<n,i.workersResolve[n]=r,i.workers[n].postMessage(e,t)):i.queue.push({resolve:r,msg:e,transfer:t})})},t.destroy=function(){this.workers.forEach(function(e){return e.terminate()}),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0},e}(),zi={enabled:!1,files:{},add:function(e,t){},get:function(e){},remove:function(e){},clear:function(){this.files={}}},qi={},Zi=/*#__PURE__*/function(e){function t(t){var i;return(i=e.call(this,t)||this).mimeType=void 0,i.responseType=void 0,i}r(t,e);var i=t.prototype;return i.load=function(e,t,i,r){var n=this;void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var o=zi.get(e);if(void 0!==o)return this.manager.itemStart(e),setTimeout(function(){t&&t(o),n.manager.itemEnd(e)},0),o;if(void 0===qi[e]){qi[e]=[],qi[e].push({onLoad:t,onProgress:i,onError:r});var s=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),a=this.mimeType,c=this.responseType;fetch(s).then(function(t){if(200===t.status||0===t.status){if(0===t.status&&console.warn("FileLoader: HTTP Status 0 received."),"undefined"==typeof ReadableStream||void 0===t.body.getReader)return t;var i=qi[e],r=t.body.getReader(),n=t.headers.get("Content-Length"),o=n?parseInt(n):0,s=0!==o,a=0,c=new ReadableStream({start:function(e){!function t(){r.read().then(function(r){var n=r.value;if(r.done)e.close();else{for(var c=new ProgressEvent("progress",{lengthComputable:s,loaded:a+=n.byteLength,total:o}),l=0,h=i.length;l<h;l++){var u=i[l];u.onProgress&&u.onProgress(c)}e.enqueue(n),t()}})}()}});return new Response(c)}throw new Error('fetch for "'+t.url+'" responded with '+t.status+": "+t.statusText)}).then(function(e){switch(c){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"document":return e.text().then(function(e){return(new DOMParser).parseFromString(e,a)});case"json":return e.json();default:if(void 0===a)return e.text();var t=/charset="?([^;"\s]*)"?/i.exec(a),i=t&&t[1]?t[1].toLowerCase():void 0,r=new TextDecoder(i);return e.arrayBuffer().then(function(e){return r.decode(e)})}}).then(function(t){zi.add(e,t);var i=qi[e];delete qi[e];for(var r=0,n=i.length;r<n;r++){var o=i[r];o.onLoad&&o.onLoad(t)}}).catch(function(t){var i=qi[e];if(void 0===i)throw n.manager.itemError(e),t;delete qi[e];for(var r=0,o=i.length;r<o;r++){var s=i[r];s.onError&&s.onError(t)}n.manager.itemError(e)}).finally(function(){n.manager.itemEnd(e)}),this.manager.itemStart(e)}else qi[e].push({onLoad:t,onProgress:i,onError:r})},i.setResponseType=function(e){return this.responseType=e,this},i.setMimeType=function(e){return this.mimeType=e,this},t}(Yi),Qi=[["0",10],["A",26],["a",26],["_",1],["$",1]].map(function(e){for(var t=[],i=e[0].charCodeAt(0),r=i+e[1],n=i;n<r;++n)t.push(n);return String.fromCharCode.apply(null,t)}).join("");function Ji(e,t){return(t&&4!==t?[0,6]:[0,6,12,18]).map(function(t){return Qi.substr(parseInt(String(e/(1<<t)))%64,1)}).reverse().join("")}function $i(e,t,i){var r=function(e){};t=t||r,i=i||r;var n=e.match(/^data:(.*?)(;base64)?,(.*)$/);if(n){var o=!!n[2],s=n[3];s=window.decodeURIComponent(s),o&&(s=window.atob(s));try{for(var a=new ArrayBuffer(s.length),c=new Uint8Array(a),l=0;l<s.length;l++)c[l]=s.charCodeAt(l);window.setTimeout(function(){t(a)},0)}catch(e){window.setTimeout(function(){i(e)},0)}}else{var h=new XMLHttpRequest;h.open("GET",e,!0),h.responseType="arraybuffer",h.onreadystatechange=function(){4===h.readyState&&(200===h.status?t(h.response):i("loadArrayBuffer error : "+h.response))},h.send(null)}}function er(e){return e&&!e.propertyIsEnumerable("length")&&"object"==typeof e&&"number"==typeof e.length}function tr(e){return"string"==typeof e||e instanceof String}function ir(e){return!isNaN(parseFloat(e))&&isFinite(e)}function rr(e,t){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t}function nr(e){return ir(e)?""+e:"'"+e+"'"}var or=function(){for(var e=[],t=0;t<256;t++)e[t]=(t<16?"0":"")+t.toString(16);return function(){var t=4294967295*Math.random()|0,i=4294967295*Math.random()|0,r=4294967295*Math.random()|0,n=4294967295*Math.random()|0;return e[255&t]+e[t>>8&255]+e[t>>16&255]+e[t>>24&255]+"-"+e[255&i]+e[i>>8&255]+"-"+e[i>>16&15|64]+e[i>>24&255]+"-"+e[63&r|128]+e[r>>8&255]+"-"+e[r>>16&255]+e[r>>24&255]+e[255&n]+e[n>>8&255]+e[n>>16&255]+e[n>>24&255]}}(),sr={__proto__:null,clone:function(e){return JSON.parse(JSON.stringify(e))},b64:Ji,compressGuid:function(e){var t=[0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30].map(function(t){return parseInt(e.substr(t,2),16)});return Ji(t[0],2)+[1,4,7,10,13].map(function(e){return Ji((t[e]<<16)+(t[e+1]<<8)+t[e+2],4)}).join("")},findNodeOfType:function(e,t){var i=[];return function e(r){r.type===t&&i.push(r),(r.children||[]).forEach(function(t){e(t)})}(e),i},timeout:function(e){return new Promise(function(t,i){setTimeout(t,e)})},httpRequest:function(e){return new Promise(function(t,i){var r=new XMLHttpRequest;r.open(e.method||"GET",e.url,!0),r.onload=function(n){console.log(e.url,r.readyState,r.status),4===r.readyState&&(200===r.status?t(r.responseXML):i(r.statusText))},r.send(null)})},loadJSON:function(e,t,i){var r=function(e){};t=t||r,i=i||r;var n=new XMLHttpRequest;n.overrideMimeType("application/json"),n.open("GET",e,!0),n.addEventListener("load",function(e){var r=e.target.response;if(200===this.status){var n;try{n=JSON.parse(r)}catch(e){i("utils.loadJSON(): Failed to parse JSON response - "+e)}t(n)}else if(0===this.status){console.warn("loadFile: HTTP Status 0 received.");try{t(JSON.parse(r))}catch(e){i("utils.loadJSON(): Failed to parse JSON response - "+e)}}else i(e)},!1),n.addEventListener("error",function(e){i(e)},!1),n.send(null)},loadArraybuffer:$i,isArray:er,isString:tr,isNumeric:ir,isID:function(e){return tr(e)||ir(e)},isFunction:function(e){return"function"==typeof e},isObject:function(e){return!!e&&e.constructor==={}.constructor},copy:function(e){return rr(e,{})},apply:rr,apply2:function(e,t){for(var i in e)e.hasOwnProperty(i)&&null!=e[i]&&(t[i]=e[i]);return t},applyIf:function(e,t){for(var i in e)e.hasOwnProperty(i)&&null==t[i]&&(t[i]=e[i]);return t},isEmptyObject:function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0},inQuotes:nr,concat:function(e,t){var i=new e.constructor(e.length+t.length);return i.set(e),i.set(t,e.length),i},createUUID:or,Map:Vi,Queue:Hi,Loader:Yi,DefaultLoadingManager:Wi,LoadingManager:Xi,WorkerPool:Ki,Cache:zi,FileLoader:Zi},ar=Zt(),cr=Zt();function lr(e,t,i){return void 0===i&&(i=e),i[0]=e[0]*t[0]+t[12],i[1]=e[1]*t[5]+t[13],i[2]=e[2]*t[10]+t[14],i}function hr(e,t,i){void 0===i&&(i=new Float32Array(e.length));for(var r=0,n=e.length;r<n;r+=3)i[r+0]=e[r+0]*t[0]+t[12],i[r+1]=e[r+1]*t[5]+t[13],i[r+2]=e[r+2]*t[10]+t[14];return i}var ur=function(){var e=qt(),t=qt();return function(i,r,n){var o,s=new Uint16Array(i.length),a=new Float32Array([65535/(n[0]-r[0]),65535/(n[1]-r[1])]);for(o=0;o<i.length;o+=2)s[o+0]=Math.floor((i[o+0]-r[0])*a[0]),s[o+1]=Math.floor((i[o+1]-r[1])*a[1]);return ni(e),Mi(r,e),ni(t),bi([(n[0]-r[0])/65535,(n[1]-r[1])/65535],t),{quantized:s,decompressMatrix:ui(e,t,ni())}}}();function dr(e,t,i,r){var n=e[t]/(Math.abs(e[t])+Math.abs(e[t+1])+Math.abs(e[t+2])),o=e[t+1]/(Math.abs(e[t])+Math.abs(e[t+1])+Math.abs(e[t+2]));if(e[t+2]<0){var s=(1-Math.abs(o))*(n>=0?1:-1),a=(1-Math.abs(n))*(o>=0?1:-1);n=s,o=a}return new Int8Array([Math[i](127.5*n+(n<0?-1:0)),Math[r](127.5*o+(o<0?-1:0))])}function fr(e,t,i){return e[t]*i[0]+e[t+1]*i[1]+e[t+2]*i[2]}function vr(e,t){void 0===t&&(t=wt());var i=e[0],r=e[1];i=(2*i+1)/255,r=(2*r+1)/255;var n=1-Math.abs(i)-Math.abs(r);n<0&&(i=(1-Math.abs(r))*(i>=0?1:-1),r=(1-Math.abs(i))*(r>=0?1:-1));var o=Math.sqrt(i*i+r*r+n*n);return t[0]=i/o,t[1]=r/o,t[2]=n/o,t}function pr(e,t,i){for(var r=e.length,n=new Uint16Array(r),o=t[0],s=t[1],a=t[2],c=t[3]-o,l=t[4]-s,h=t[5]-a,u=65525,d=u/c,f=u/l,v=u/h,p=function(e){return e>=0?e:0},y=0;y<r;y+=3)n[y+0]=Math.floor(p(e[y+0]-o)*d),n[y+1]=Math.floor(p(e[y+1]-s)*f),n[y+2]=Math.floor(p(e[y+2]-a)*v);return ri(ar),Si(t,ar),ri(cr),gi([c/u,l/u,h/u],cr),hi(ar,cr,i),n}function yr(e,t,i){var r,n,o=e[0]/(Math.abs(e[0])+Math.abs(e[1])+Math.abs(e[2])),s=e[1]/(Math.abs(e[0])+Math.abs(e[1])+Math.abs(e[2]));return e[2]<0&&(r=(1-Math.abs(s))*(o>=0?1:-1),n=(1-Math.abs(o))*(s>=0?1:-1),o=r,s=n),new Int8Array([Math[t](127.5*o+(o<0?-1:0)),Math[i](127.5*s+(s<0?-1:0))])}function mr(e,t,i,r){var n=e[t]/(Math.abs(e[t])+Math.abs(e[t+1])+Math.abs(e[t+2])),o=e[t+1]/(Math.abs(e[t])+Math.abs(e[t+1])+Math.abs(e[t+2]));if(e[t+2]<0){var s=(1-Math.abs(o))*(n>=0?1:-1),a=(1-Math.abs(n))*(o>=0?1:-1);n=s,o=a}return new Int8Array([Math[i](127.5*n+(n<0?-1:0)),Math[r](127.5*o+(o<0?-1:0))])}var gr={__proto__:null,getPositions3MinMax:function(e,t,i){var r,n;for(t=t||new Float64Array(3),i=i||new Float64Array(3),r=0;r<3;r++)t[r]=Number.MAX_VALUE,i[r]=-Number.MAX_VALUE;for(r=0;r<e.length;r+=3)for(n=0;n<3;n++)t[n]=Math.min(t[n],e[r+n]),i[n]=Math.max(i[n],e[r+n]);return{min:t,max:i}},createPositions3DecompressMat4:function(e,t){t=t||Zt();var i=e[3]-e[0],r=e[4]-e[1],n=e[5]-e[2],o=65535;return ri(ar),Si(e,ar),ri(cr),gi([i/o,r/o,n/o],cr),hi(ar,cr,t),t},compressPositions3:function(e,t,i){var r,n=new Uint16Array(e.length),o=new Float32Array([i[0]!==t[0]?65535/(i[0]-t[0]):0,i[1]!==t[1]?65535/(i[1]-t[1]):0,i[2]!==t[2]?65535/(i[2]-t[2]):0]);for(r=0;r<e.length;r+=3)n[r+0]=Math.floor((e[r+0]-t[0])*o[0]),n[r+1]=Math.floor((e[r+1]-t[1])*o[1]),n[r+2]=Math.floor((e[r+2]-t[2])*o[2]);return ri(ar),Si(t,ar),ri(cr),gi([(i[0]-t[0])/65535,(i[1]-t[1])/65535,(i[2]-t[2])/65535],cr),{quantized:n,decompressMatrix:hi(ar,cr,ri())}},compressPoint3:function(e,t,i){void 0===i&&(i=e);var r=new Float32Array([t[3]!==t[0]?65535/(t[3]-t[0]):0,t[4]!==t[1]?65535/(t[4]-t[1]):0,t[5]!==t[2]?65535/(t[5]-t[2]):0]);return i[0]=Math.max(0,Math.min(65535,Math.floor((e[0]-t[0])*r[0]))),i[1]=Math.max(0,Math.min(65535,Math.floor((e[1]-t[1])*r[1]))),i[2]=Math.max(0,Math.min(65535,Math.floor((e[2]-t[2])*r[2]))),i},decompressPoint3:lr,decompressAABB3:function(e,t,i){return void 0===i&&(i=e),i[0]=e[0]*t[0]+t[12],i[1]=e[1]*t[5]+t[13],i[2]=e[2]*t[10]+t[14],i[3]=e[3]*t[0]+t[12],i[4]=e[4]*t[5]+t[13],i[5]=e[5]*t[10]+t[14],i},decompressPositions3:hr,getUVBounds:function(e){var t,i,r=new Float32Array(2),n=new Float32Array(2);for(t=0;t<2;t++)r[t]=Number.MAX_VALUE,n[t]=-Number.MAX_VALUE;for(t=0;t<e.length;t+=2)for(i=0;i<2;i++)r[i]=Math.min(r[i],e[t+i]),n[i]=Math.max(n[i],e[t+i]);return{min:r,max:n}},compressUVs:ur,compressNormals:function(e){for(var t,i,r,n,o=new Int8Array(e.length),s=0;s<e.length;s+=3)i=t=dr(e,s,"floor","floor"),r=n=fr(e,s,vr(t)),(r=fr(e,s,vr(t=dr(e,s,"ceil","floor"))))>n&&(i=t,n=r),(r=fr(e,s,vr(t=dr(e,s,"floor","ceil"))))>n&&(i=t,n=r),(r=fr(e,s,vr(t=dr(e,s,"ceil","ceil"))))>n&&(i=t,n=r),o[s]=i[0],o[s+1]=i[1];return o},decompressUV:function(e,t,i){void 0===i&&(i=new Float32Array(2)),i[0]=e[0]*t[0]+t[6],i[1]=e[1]*t[4]+t[7]},decompressUVs:function(e,t,i){void 0===i&&(i=new Float32Array(e.length));for(var r=0,n=e.length;r<n;r+=3)i[r+0]=e[r+0]*t[0]+t[6],i[r+1]=e[r+1]*t[4]+t[7];return i},decompressNormal:function(e,t){var i=e[0],r=e[1];i=(2*i+1)/255,r=(2*r+1)/255;var n=1-Math.abs(i)-Math.abs(r);n<0&&(i=(1-Math.abs(r))*(i>=0?1:-1),r=(1-Math.abs(i))*(r>=0?1:-1));var o=Math.sqrt(i*i+r*r+n*n);return t[0]=i/o,t[1]=r/o,t[2]=n/o,t},decompressNormals:function(e,t){for(var i=0,r=0,n=e.length;i<n;i+=2){var o=e[i+0],s=e[i+1];o=(2*o+1)/255,s=(2*s+1)/255;var a=1-Math.abs(o)-Math.abs(s);a<0&&(o=(1-Math.abs(s))*(o>=0?1:-1),s=(1-Math.abs(o))*(s>=0?1:-1));var c=Math.sqrt(o*o+s*s+a*a);t[r+0]=o/c,t[r+1]=s/c,t[r+2]=a/c,r+=3}return t},quantizePositions3:pr,transformAndOctEncodeNormals:function(e,t,i,r,n){function o(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}var s,a,c,l,h,u=new Float32Array([0,0,0,0]),d=new Float32Array([0,0,0,0]);for(h=0;h<i;h+=3)u[0]=t[h],u[1]=t[h+1],u[2]=t[h+2],pi(e,u,d),Yt(d,d),a=s=yr(d,"floor","floor"),c=l=o(d,vr(s)),(c=o(d,vr(s=yr(d,"ceil","floor"))))>l&&(a=s,l=c),(c=o(d,vr(s=yr(d,"floor","ceil"))))>l&&(a=s,l=c),(c=o(d,vr(s=yr(d,"ceil","ceil"))))>l&&(a=s,l=c),r[n+h+0]=a[0],r[n+h+1]=a[1],r[n+h+2]=0;return n+i},octEncodeNormals:function(e){for(var t,i,r,n,o=e.length,s=new Int8Array(o),a=0;a<o;a+=3)i=t=mr(e,a,"floor","floor"),r=n=fr(e,a,vr(t)),(r=fr(e,a,vr(t=mr(e,a,"ceil","floor"))))>n&&(i=t,n=r),(r=fr(e,a,vr(t=mr(e,a,"floor","ceil"))))>n&&(i=t,n=r),(r=fr(e,a,vr(t=mr(e,a,"ceil","ceil"))))>n&&(i=t,n=r),s[a+0]=i[0],s[a+1]=i[1],s[a+2]=0;return s},octEncodeVec3:yr,octEncodeNormal:mr},br=wt(),wr=wt(),Pr=Zt();function Er(e){return new Float64Array(e||6)}function Tr(e){return new Int16Array(e||6)}function _r(e){return lt(e||32)}function Ir(e,t){return e[0]<=t[0]&&t[3]<=e[3]&&e[1]<=t[1]&&e[2]<=t[2]}function xr(e,t){return e[0]<=t[0]&&t[3]<=e[3]&&e[1]<=t[1]&&t[4]<=e[4]&&e[2]<=t[2]&&t[5]<=e[5]}var Sr=function(){var e=lt(3),t=lt(3),i=lt(3);return function(r){return e[0]=r[0],e[1]=r[1],e[2]=r[2],t[0]=r[3],t[1]=r[4],t[2]=r[5],Mt(t,e,i),Math.abs(Ut(i))}}(),Mr=function(){var e=lt(3),t=lt(3),i=lt(3);return function(r,n){e[0]=r[0],e[1]=r[1],e[2]=r[2],t[0]=r[3],t[1]=r[4],t[2]=r[5];var o=Mt(t,e,i),s=n[0]-r[0],a=r[3]-n[0],c=n[1]-r[1],l=r[4]-n[1],h=n[2]-r[2],u=r[5]-n[2];return o[0]+=s>a?s:a,o[1]+=c>l?c:l,o[2]+=h>u?h:u,Math.abs(Ut(o))}}();function Or(e,t){return void 0===t&&(t=wt()),t[0]=(e[0]+e[3])/2,t[1]=(e[1]+e[4])/2,t[2]=(e[2]+e[5])/2,t}function Rr(e){return void 0===e&&(e=Er()),e[0]=st,e[1]=st,e[2]=st,e[3]=ot,e[4]=ot,e[5]=ot,e}function jr(e,t){return void 0===e&&(e=Er()),void 0===t&&(t=_r()),t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=1,t[4]=e[3],t[5]=e[1],t[6]=e[2],t[7]=1,t[8]=e[3],t[9]=e[4],t[10]=e[2],t[11]=1,t[12]=e[0],t[13]=e[4],t[14]=e[2],t[15]=1,t[16]=e[0],t[17]=e[1],t[18]=e[5],t[19]=1,t[20]=e[3],t[21]=e[1],t[22]=e[5],t[23]=1,t[24]=e[3],t[25]=e[4],t[26]=e[5],t[27]=1,t[28]=e[0],t[29]=e[4],t[30]=e[5],t[31]=1,t}function Dr(e,t){return e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]>t[2]&&(e[2]=t[2]),e[3]<t[3]&&(e[3]=t[3]),e[4]<t[4]&&(e[4]=t[4]),e[5]<t[5]&&(e[5]=t[5]),e}function Ar(e,t){return e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]>t[2]&&(e[2]=t[2]),e[3]<t[0]&&(e[3]=t[0]),e[4]<t[1]&&(e[4]=t[1]),e[5]<t[2]&&(e[5]=t[2]),e}function Cr(e,t){for(var i,r,n,o=0,s=t.length;o<s;o+=3)r=t[o+1],n=t[o+2],e[0]>(i=t[o])&&(e[0]=i),e[1]>r&&(e[1]=r),e[2]>n&&(e[2]=n),e[3]<i&&(e[3]=i),e[4]<r&&(e[4]=r),e[5]<n&&(e[5]=n);return e}var Br=function(){var e=lt(3);return function(t,i,r){i=i||Er();for(var n,o,s,a=st,c=st,l=st,h=ot,u=ot,d=ot,f=0,v=t.length;f<v;f+=3)r?(e[0]=t[f+0],e[1]=t[f+1],e[2]=t[f+2],lr(e,r,e),n=e[0],o=e[1],s=e[2]):(n=t[f+0],o=t[f+1],s=t[f+2]),n<a&&(a=n),o<c&&(c=o),s<l&&(l=s),n>h&&(h=n),o>u&&(u=o),s>d&&(d=s);return i[0]=a,i[1]=c,i[2]=l,i[3]=h,i[4]=u,i[5]=d,i}}();function kr(e,t){void 0===t&&(t=wt());for(var i=0,r=0,n=0,o=0,s=e.length;o<s;o+=3)i+=e[o+0],r+=e[o+1],n+=e[o+2];var a=e.length/3;return t[0]=i/a,t[1]=r/a,t[2]=n/a,t}var Lr=/*#__PURE__*/function(){function e(){this.testVertex=void 0,this.offset=void 0,this.normal=void 0,this.normal=wt(),this.offset=0,this.testVertex=wt()}return e.prototype.set=function(e,t,i,r){var n=1/Math.sqrt(e*e+t*t+i*i);this.normal[0]=e*n,this.normal[1]=t*n,this.normal[2]=i*n,this.offset=r*n,this.testVertex[0]=this.normal[0]>=0?1:0,this.testVertex[1]=this.normal[1]>=0?1:0,this.testVertex[2]=this.normal[2]>=0?1:0},e}(),Fr=1,Ur=2,Nr=3,Gr=function(){this.planes=void 0,this.planes=[new Lr,new Lr,new Lr,new Lr,new Lr,new Lr]};function Vr(e,t,i){var r=hi(t,e,Pr),n=r[0],o=r[1],s=r[2],a=r[3],c=r[4],l=r[5],h=r[6],u=r[7],d=r[8],f=r[9],v=r[10],p=r[11],y=r[12],m=r[13],g=r[14],b=r[15];return(i=i||new Gr).planes[0].set(a-n,u-c,p-d,b-y),i.planes[1].set(a+n,u+c,p+d,b+y),i.planes[2].set(a-o,u-l,p-f,b-m),i.planes[3].set(a+o,u+l,p+f,b+m),i.planes[4].set(a-s,u-h,p-v,b-g),i.planes[5].set(a+s,u+h,p+v,b+g),i}function Hr(e,t){var i=Fr,r=br,n=wr;r[0]=t[0],r[1]=t[1],r[2]=t[2],n[0]=t[3],n[1]=t[4],n[2]=t[5];for(var o=[r,n],s=0;s<6;++s){var a=e.planes[s];if(a.normal[0]*o[a.testVertex[0]][0]+a.normal[1]*o[a.testVertex[1]][1]+a.normal[2]*o[a.testVertex[2]][2]+a.offset<0)return Nr;a.normal[0]*o[1-a.testVertex[0]][0]+a.normal[1]*o[1-a.testVertex[1]][1]+a.normal[2]*o[1-a.testVertex[2]][2]+a.offset<0&&(i=Ur)}return i}function Xr(e,t){return Ur}var Wr={__proto__:null,createAABB3:Er,createAABB3Int16:Tr,createAABB2:function(e){return lt(e||4)},createOBB3:_r,createOBB2:function(e){return lt(e||16)},createSphere3:function(e,t,i,r){return lt([e,t,i,r])},transformOBB3:function(e,t,i){var r;void 0===i&&(i=t);var n,o,s,a=t.length,c=e[0],l=e[1],h=e[2],u=e[3],d=e[4],f=e[5],v=e[6],p=e[7],y=e[8],m=e[9],g=e[10],b=e[11],w=e[12],P=e[13],E=e[14],T=e[15];for(r=0;r<a;r+=4)i[r+0]=c*(n=t[r+0])+d*(o=t[r+1])+y*(s=t[r+2])+w,i[r+1]=l*n+f*o+m*s+P,i[r+2]=h*n+v*o+g*s+E,i[r+3]=u*n+p*o+b*s+T;return i},containsAABB2:Ir,containsAABB3:xr,getAABB3Diag:Sr,getAABB3DiagPoint:Mr,getAABB3Area:function(e){return(e[3]-e[0])*(e[4]-e[1])*(e[5]-e[2])},getAABB3Center:Or,getAABB2Center:function(e,t){return void 0===t&&(t=bt()),t[0]=(e[2]+e[0])/2,t[1]=(e[3]+e[1])/2,t},collapseAABB3:Rr,collapseAABB3Int16:function(e){return void 0===e&&(e=Tr()),e[0]=65535,e[1]=65535,e[2]=65535,e[3]=-65535,e[4]=-65535,e[5]=-65535,e},AABB3ToOBB3:jr,expandAABB3:Dr,expandAABB2:function(e,t){return e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[3]<t[3]&&(e[3]=t[3]),e[4]<t[4]&&(e[4]=t[4]),e},expandAABB3Point3:Ar,expandAABB2Point2:function(e,t){return e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[3]<t[0]&&(e[3]=t[0]),e[4]<t[1]&&(e[4]=t[1]),e},expandAABB3Points3:Cr,ABB3ToOBB3:function(e,t){return void 0===t&&(t=_r()),t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=1,t[4]=e[3],t[5]=e[1],t[6]=e[2],t[7]=1,t[8]=e[3],t[9]=e[4],t[10]=e[2],t[11]=1,t[12]=e[0],t[13]=e[4],t[14]=e[2],t[15]=1,t[16]=e[0],t[17]=e[1],t[18]=e[5],t[19]=1,t[20]=e[3],t[21]=e[1],t[22]=e[5],t[23]=1,t[24]=e[3],t[25]=e[4],t[26]=e[5],t[27]=1,t[28]=e[0],t[29]=e[4],t[30]=e[5],t[31]=1,t},positions3ToAABB3:Br,OBB3ToAABB3:function(e,t){void 0===t&&(t=Er());for(var i,r,n,o=st,s=st,a=st,c=ot,l=ot,h=ot,u=0,d=e.length;u<d;u+=4)(i=e[u+0])<o&&(o=i),(r=e[u+1])<s&&(s=r),(n=e[u+2])<a&&(a=n),i>c&&(c=i),r>l&&(l=r),n>h&&(h=n);return t[0]=o,t[1]=s,t[2]=a,t[3]=c,t[4]=l,t[5]=h,t},points3ToAABB3:function(e,t){void 0===t&&(t=Er());for(var i,r,n,o=st,s=st,a=st,c=ot,l=ot,h=ot,u=0,d=e.length;u<d;u++)(i=e[u][0])<o&&(o=i),(r=e[u][1])<s&&(s=r),(n=e[u][2])<a&&(a=n),i>c&&(c=i),r>l&&(l=r),n>h&&(h=n);return t[0]=o,t[1]=s,t[2]=a,t[3]=c,t[4]=l,t[5]=h,t},getPositions3Center:kr,FrustumPlane3:Lr,INSIDE:Fr,INTERSECT:Ur,OUTSIDE:Nr,Frustum3:Gr,setFrustum3:Vr,intersectFrustum3AABB3:Hr,intersectAABB3s:Xr,intersectFrustum3Triangles3:function(e,t,i){return!0},intersectFrustum3Triangle3:function(e,t,i,r){return!0},intersectFrustum3Lines3:function(e,t,i){return!0},intersectFrustum3Positions3:function(e,t){return!0},intersectFrustum3Point3:function(e,t){return!0},intersectAABB3Triangles3:function(e,t,i){return!1},intersectAABB3Lines3:function(e,t,i){return!1},intersectAABB3Positions3:function(e,t){for(var i=e[0],r=e[1],n=e[2],o=e[3],s=e[4],a=e[5],c=0,l=t.length;c<l;c+=3){var h=t[c];if(i<=h&&h<=o){var u=t[c+1];if(r<=u&&u<=s){var d=t[c+2];if(n<=d&&d<=a)return!0}}}return!1},containsAABB3Point3:function(e,t){return e[0]<=t[0]&&t[0]<=e[3]&&e[1]<=t[1]&&t[1]<=e[4]&&e[2]<=t[2]&&t[2]<=e[5]},containsAABB2Point2:function(e,t){return e[0]<=t[0]&&t[0]<=e[3]&&e[1]<=t[1]&&t[1]<=e[4]}},Yr=wt(),Kr=new Float32Array(16),zr=new Float64Array(4),qr=new Float64Array(4);function Zr(e,t,i){return void 0===i&&(i=Kr),zr[0]=t[0],zr[1]=t[1],zr[2]=t[2],zr[3]=1,yi(e,zr,qr),xi(e,qr,i),i}function Qr(e,t,i){return void 0===i&&(i=200),t[0]=Math.round(e[0]/i)*i,t[1]=Math.round(e[1]/i)*i,t[2]=Math.round(e[2]/i)*i,t}var Jr={__proto__:null,createRTCViewMat:Zr,worldToRTCPos:function(e,t,i){var r=Float32Array.from([e[0]])[0],n=e[0]-r,o=Float32Array.from([e[1]])[0],s=e[1]-o,a=Float32Array.from([e[2]])[0],c=e[2]-a;t[0]=r,t[1]=o,t[2]=a,i[0]=n,i[1]=s,i[2]=c},worldToRTCCenter:Qr,worldToRTCPositions:function(e,t,i,r){void 0===r&&(r=200);for(var n=kr(e,Yr),o=Math.round(n[0]/r)*r,s=Math.round(n[1]/r)*r,a=Math.round(n[2]/r)*r,c=0,l=e.length;c<l;c+=3)t[c+0]=e[c+0]-o,t[c+1]=e[c+1]-s,t[c+2]=e[c+2]-a;return i[0]=o,i[1]=s,i[2]=a,0!==i[0]||0!==i[1]||0!==i[2]},rtcToWorldPos:function(e,t,i){return i[0]=e[0]+t[0],i[1]=e[1]+t[1],i[2]=e[2]+t[2],i},getPlaneRTCPos:function(e,t,i,r){var n=gt(t,i)+e;return _t(Yt(t,Yr),-n,r),r}},$r={__proto__:null,"tangentQuadraticBzier":function(e,t,i,r){return 2*(1-e)*(i-t)+2*e*(r-i)},"tangentQuadraticBzier3":function(e,t,i,r,n){return-3*t*(1-e)*(1-e)+3*i*(1-e)*(1-e)-6*e*i*(1-e)+6*e*r*(1-e)-3*e*e*r+3*e*e*n},tangentSpline:function(e){return 6*e*e-6*e+(3*e*e-4*e+1)+(-6*e*e+6*e)+(3*e*e-2*e)},catmullRomInterpolate:function(e,t,i,r,n){var o=.5*(i-e),s=.5*(r-t),a=n*n;return(2*t-2*i+o+s)*(n*a)+(-3*t+3*i-2*o-s)*a+o*n+t},b2p0:function(e,t){var i=1-e;return i*i*t},b2p1:function(e,t){return 2*(1-e)*e*t},b2p2:function(e,t){return e*e*t},b2:function(e,t,i,r){return this.b2p0(e,t)+this.b2p1(e,i)+this.b2p2(e,r)},b3p0:function(e,t){var i=1-e;return i*i*i*t},b3p1:function(e,t){var i=1-e;return 3*i*i*e*t},b3p2:function(e,t){return 3*(1-e)*e*e*t},b3p3:function(e,t){return e*e*e*t},b3:function(e,t,i,r,n){return this.b3p0(e,t)+this.b3p1(e,i)+this.b3p2(e,r)+this.b3p3(e,n)}},en=/*#__PURE__*/d("messages"),tn=/*#__PURE__*/d("locales"),rn=/*#__PURE__*/d("locale");function nn(e,t){if(t[e])return t[e];for(var i=e.split("."),r=t,n=0,o=i.length;r&&n<o;n++)r=r[i[n]];return r}function on(e,t){return void 0===t&&(t=[]),e.replace(/\{\{|\}\}|\{(\d+)\}/g,function(e,i){return"{{"===e?"{":"}}"===e?"}":t[i]})}var sn={__proto__:null,LocaleService:/*#__PURE__*/function(){function e(e){void 0===e&&(e={messages:{},locale:""}),this.onUpdated=void 0,Object.defineProperty(this,en,{writable:!0,value:void 0}),Object.defineProperty(this,tn,{writable:!0,value:void 0}),Object.defineProperty(this,rn,{writable:!0,value:"en"}),this.onUpdated=new p(new te.EventDispatcher),this.messages=e.messages,this.locale=e.locale}var t=e.prototype;return t.loadMessages=function(e){for(var t in void 0===e&&(e={}),e)f(this,en)[en][t]=e[t];this.messages=f(this,en)[en]},t.clearMessages=function(){this.messages={}},t.translate=function(e,t){var i=f(this,en)[en][f(this,rn)[rn]];if(!i)return null;var r=nn(e,i);return r?t?on(r,t):r:null},t.translatePlurals=function(e,t,i){var r=f(this,en)[en][f(this,rn)[rn]];if(!r)return null;var n=nn(e,r);return(n=0===(t=parseInt(""+t,10))?n.zero:t>1?n.other:n.one)?(n=on(n,[t]),i&&(n=on(n,i)),n):null},i(e,[{key:"messages",set:function(e){f(this,en)[en]=e||{},f(this,tn)[tn]=Object.keys(f(this,en)[en]),this.onUpdated.dispatch(this,f(this,rn)[rn])}},{key:"locales",get:function(){return f(this,tn)[tn]}},{key:"locale",get:function(){return f(this,rn)[rn]},set:function(e){e=e||"de",f(this,rn)[rn]!==e&&(f(this,rn)[rn]=e,this.onUpdated.dispatch(this,f(this,rn)[rn]))}}]),e}()},an=function(e,t){this.propertySet=void 0,this.name=void 0,this.value=void 0,this.type=void 0,this.valueType=void 0,this.description=void 0,this.propertySet=e,this.name=t.name,this.type=t.type,this.value=t.value,this.valueType=t.valueType,this.description=t.description},cn=function(e,t){if(this.models=void 0,this.id=void 0,this.originalSystemId=void 0,this.name=void 0,this.type=void 0,this.properties=void 0,this.models=[e],this.id=t.id,this.name=t.name,this.type=t.type,this.properties=[],t.properties)for(var i=0,r=t.properties.length;i<r;i++){var n=new an(this,t.properties[i]);this.properties.push(n)}},ln=function(e,t,i,r,n,o){this.data=void 0,this.models=void 0,this.id=void 0,this.name=void 0,this.type=void 0,this.propertySets=void 0,this.relating=void 0,this.related=void 0,this.data=e,this.models=[t],this.id=i,this.name=r,this.type=n,this.propertySets=o||[],this.related={},this.relating={}},hn=function(e,t,i){this.type=void 0,this.relatingObject=void 0,this.relatedObject=void 0,this.type=e,this.relatingObject=t,this.relatedObject=i},un=/*#__PURE__*/d("destroyed"),dn=/*#__PURE__*/d("removeObjectFromModels"),fn=/*#__PURE__*/function(e){function t(t,i,r,n){var o;return o=e.call(this,t)||this,Object.defineProperty(c(o),dn,{value:vn}),o.data=void 0,o.projectId=void 0,o.revisionId=void 0,o.author=void 0,o.createdAt=void 0,o.creatingApplication=void 0,o.schema=void 0,o.propertySets=void 0,o.objects=void 0,o.rootObjects=void 0,o.objectsByType=void 0,o.relationships=void 0,o.typeCounts=void 0,o.onBuilt=void 0,o.built=void 0,Object.defineProperty(c(o),un,{writable:!0,value:void 0}),o.onBuilt=new p(new te.EventDispatcher),o.data=t,o.id=i,o.projectId=r.projectId||"",o.revisionId=r.revisionId||"",o.author=r.author||"",o.createdAt=r.createdAt||"",o.creatingApplication=r.creatingApplication||"",o.schema=r.schema||"",o.propertySets={},o.objects={},o.objectsByType={},o.relationships=[],o.typeCounts={},o.rootObjects={},o.built=!1,f(c(o),un)[un]=!1,o.fromJSON(r),o}r(t,e);var i=t.prototype;return i.fromJSON=function(e){if(this.destroyed)return new he("Failed to add components to DataModel - DataModel already destroyed");if(this.built)throw new he("Failed to add components to DataModel - DataModel already built");if(e.propertySets)for(var t=0,i=e.propertySets.length;t<i;t++)this.createPropertySet(e.propertySets[t]);if(e.objects)for(var r=0,n=e.objects.length;r<n;r++)this.createObject(e.objects[r]);if(e.relationships)for(var o=0,s=e.relationships.length;o<s;o++)this.createRelationship(e.relationships[o])},i.createPropertySet=function(e){if(this.destroyed)return new he("Failed to create PropertySet - DataModel already destroyed");if(this.built)return new he("DataModel already built");if(this.propertySets[e.id])return new he("Failed to create PropertySet - PropertySet with same ID already created in this DataModel. It's OK to have duplicates shared between DataModels, but they must be unique within each DataModel.");var t=this.data.propertySets[e.id];return t?(this.propertySets[e.id]=t,t.models.push(this),t):(t=new cn(this,e),this.propertySets[e.id]=t,this.data.propertySets[e.id]=t,t)},i.createObject=function(e){if(this.destroyed)return new he("Failed to create DataObject - DataModel already destroyed");if(this.built)return new he("Failed to create DataObject - DataModel already built");var t=e.id;if(this.objects[t])return new he("Failed to create DataObject - DataObject with same ID already created in this DataModel. It's OK to have duplicates shared between DataModels, but they must be unique within each DataModel.");var i=e.type,r=this.data.objects[t];if(r)this.objects[t]=r,this.data.objects[t]=r,this.objectsByType[i]||(this.objectsByType[i]={}),this.objectsByType[i][t]=r,this.typeCounts[i]=void 0===this.typeCounts[i]?1:this.typeCounts[i]+1,r.models.push(this);else{var n=[];if(e.propertySetIds)for(var o=0,s=e.propertySetIds.length;o<s;o++){var a=e.propertySetIds[o],c=this.propertySets[a];if(!c)return new he('Failed to create DataObject - PropertySet not found: "'+a+'"');n.push(c)}r=new ln(this.data,this,t,e.name,e.type,n),this.objects[t]=r,this.data.objects[t]=r,this.data.objectsByType[i]||(this.data.objectsByType[i]={}),this.data.objectsByType[i][t]=r,this.data.typeCounts[i]=void 0===this.data.typeCounts[i]?1:this.data.typeCounts[i]+1,r.models.push(this),this.data.onObjectCreated.dispatch(this.data,r)}return r},i.createRelationship=function(e){if(this.destroyed)return new he("Failed to create Relationship - DataModel already destroyed");if(this.built)return new he("Failed to create Relationship - DataModel already built");var t=this.data.objects[e.relatingObjectId];if(!t)return new he("Failed to create Relationship - relating DataObject not found: "+e.relatingObjectId);var i=this.data.objects[e.relatedObjectId];if(!i)return new he("Failed to create Relationship - related DataObject not found: "+e.relatedObjectId);var r=new hn(e.type,t,i);return i.relating[e.type]||(i.relating[e.type]=[]),i.relating[e.type].push(r),t.related[e.type]||(t.related[e.type]=[]),t.related[e.type].push(r),this.relationships.push(r),r},i.build=function(){var e=this;return new Promise(function(t){if(e.destroyed)throw new he("Failed to build DataModel - DataModel already destroyed");if(e.built)throw new he("Failed to build DataModel - DataModel already built");e.built=!0,e.onBuilt.dispatch(e,null),t(e)})},i.getJSON=function(){if(this.destroyed)return new he("DataModel already destroyed");var e={id:this.id,propertySets:[],objects:[],relationships:[]};for(var t in this.propertySets){for(var i,r=this.propertySets[t],n={id:t,name:r.name,properties:[],type:r.type,originalSystemId:r.originalSystemId},o=0,s=r.properties.length;o<s;o++){var a=r.properties[o];n.properties.push({name:a.name,value:a.value,type:a.type,valueType:a.valueType,description:a.description})}null==(i=e.propertySets)||i.push(n)}for(var c in this.objects){var l,h=this.objects[c],u={id:c,type:h.type,name:h.name,propertySetIds:[]};if(h.propertySets)for(var d=0,f=h.propertySets.length;d<f;d++){var v;null==(v=u.propertySetIds)||v.push(h.propertySets[d].id)}null==(l=e.objects)||l.push(u)}for(var p=0,y=this.relationships.length;p<y;p++){var m,g=this.relationships[p];null==(m=e.relationships)||m.push({type:g.type,relatingObjectId:g.relatingObject.id,relatedObjectId:g.relatedObject.id})}return e},i.destroy=function(){if(this.destroyed)return new he("Failed to destroy DataModel - DataModel already destroyed");for(var t in this.objects){var i=this.objects[t];if(i.models.length>1)f(this,dn)[dn](i);else{delete this.data.objects[t];var r=i.type;if(0==--this.data.typeCounts[r])for(var n in delete this.data.typeCounts[r],delete this.data.objectsByType[r],this.data.onObjectDestroyed.dispatch(this.data,i),i.relating)for(var o=i.relating[n],s=0,a=o.length;s<a;s++)for(var c=o[s].relatedObject.relating[n],l=0,h=c.length;l<h;l++)c[0].relatingObject===i&&(c[l]=c[l])}}f(this,un)[un]=!0,this.onBuilt.clear(),e.prototype.destroy.call(this)},t}(ae);function vn(e){for(var t=0,i=e.models.length;t<i;t++)if(e.models[t]===this){e.models=e.models.splice(t,1);break}}var pn=/*#__PURE__*/function(e){function t(){var t;return(t=e.call(this,null,{})||this).models=void 0,t.propertySets=void 0,t.objects=void 0,t.rootObjects=void 0,t.objectsByType=void 0,t.typeCounts=void 0,t.onModelCreated=void 0,t.onModelDestroyed=void 0,t.onObjectCreated=void 0,t.onObjectDestroyed=void 0,t.models={},t.propertySets={},t.objects={},t.rootObjects={},t.objectsByType={},t.typeCounts={},t.onModelCreated=new p(new te.EventDispatcher),t.onModelDestroyed=new p(new te.EventDispatcher),t.onObjectCreated=new p(new te.EventDispatcher),t.onObjectDestroyed=new p(new te.EventDispatcher),t}r(t,e);var i=t.prototype;return i.createModel=function(e,t){var i=this;if(this.destroyed)return new he("Data already destroyed");var r=e.id;if(this.models[r])return new he("DataModel already created in this Data: "+r);var n=new fn(this,r,e,t);return this.models[n.id]=n,n.onDestroyed.one(function(){delete i.models[n.id],i.onModelDestroyed.dispatch(i,n)}),n.onBuilt.one(function(){i.onModelCreated.dispatch(i,n)}),n},i.getObjectIdsByType=function(e){if(this.destroyed)return new he("Data already destroyed");var t=this.objectsByType[e];return t?Object.keys(t):[]},i.searchObjects=function(e){if(this.destroyed)return new he("Data already destroyed");var t=e.includeObjects&&e.includeObjects.length>0?yn(e.includeObjects):null,i=e.excludeObjects&&e.excludeObjects.length>0?yn(e.excludeObjects):null,r=e.includeRelating&&e.includeRelating.length>0?yn(e.includeRelating):null,n=e.excludeRelating&&e.excludeRelating.length>0?yn(e.excludeRelating):null;function o(s,a){if(s){var c=!0;(i&&i[s.type]||t&&!t[s.type])&&(c=!1),0===a&&!1===e.includeStart&&(c=!1),c&&(e.resultObjectIds?e.resultObjectIds.push(s.id):e.resultObjects?e.resultObjects.push(s):e.resultCallback&&e.resultCallback(s));var l=s.related;for(var h in l){var u=l[h];if(u)for(var d=0,f=u.length;d<f;d++){var v=!0;(n&&n[s.type]||r&&!r[s.type])&&(v=!1),v&&o(u[d].relatedObject,a+1)}}}}if(e.startObjectId){var s=this.objects[e.startObjectId];if(!s)return new he('Failed to search DataObjects - starting DataObject not found in Data: "'+e.startObjectId+'"');o(s,0)}else if(e.startObject){if(e.startObject.data!=this)return new he('Failed to search DataObjects - starting DataObject not in same Data: "'+e.startObjectId+'"');o(e.startObject,1)}else for(var a in this.rootObjects)o(this.rootObjects[a],1)},i.clear=function(){if(this.destroyed)return new he("Data already destroyed");for(var e in this.models)this.models[e].destroy()},i.destroy=function(){if(this.destroyed)return new he("Data already destroyed");this.clear(),this.onModelCreated.clear(),this.onModelDestroyed.clear(),e.prototype.destroy.call(this)},t}(ae);function yn(e){for(var t={},i=0,r=e.length;i<r;i++)t[e[i]]=!0;return t}var mn={__proto__:null,Data:pn,DataModel:fn,DataObject:ln,Relationship:hn,Property:an,PropertySet:cn},gn=function(e){this.positionsCompressed=void 0,this.uvsCompressed=void 0,this.colorsCompressed=void 0,this.indices=void 0,this.edgeIndices=void 0,this.positionsCompressed=e.positionsCompressed,this.uvsCompressed=e.uvsCompressed,this.colorsCompressed=e.colorsCompressed,this.indices=e.indices,this.edgeIndices=e.edgeIndices},bn=function(e){this.id=void 0,this.primitive=void 0,this.positionsDecompressMatrix=void 0,this.aabb=void 0,this.uvsDecompressMatrix=void 0,this.geometryBuckets=void 0,this.rendererGeometry=void 0,this.geometryBuckets=[];for(var t=0,i=e.geometryBuckets.length;t<i;t++)this.geometryBuckets[t]=new gn(e.geometryBuckets[t]);this.id=e.id,this.positionsDecompressMatrix=e.positionsDecompressMatrix,this.primitive=e.primitive},wn=/*#__PURE__*/d("positionsDecompressed"),Pn=/*#__PURE__*/d("positionsWorld"),En=/*#__PURE__*/function(){function e(){this.object=void 0,this.mesh=void 0,this.meshIndex=void 0,this.geometry=void 0,this.geometryBucket=void 0,this.geometryBucketIndex=void 0,Object.defineProperty(this,wn,{writable:!0,value:void 0}),Object.defineProperty(this,Pn,{writable:!0,value:void 0}),this.object=null,this.mesh=null,this.meshIndex=0,this.geometry=null,this.geometryBucket=null,this.geometryBucketIndex=0,f(this,wn)[wn]=null,f(this,Pn)[Pn]=null}return e.prototype.reset=function(){f(this,wn)[wn]=null,f(this,Pn)[Pn]=null},i(e,[{key:"totalGeometryBuckets",get:function(){var e=0;if(this.object)for(var t=0,i=this.object.meshes.length;t<i;t++)e+=this.object.meshes[t].geometry.geometryBuckets.length;return e}},{key:"numPrimitives",get:function(){var e=this.geometry.primitive;return this.geometryBucket.indices.length/(e===qe?3:e===ze?2:1)}},{key:"positionsDecompressed",get:function(){return f(this,wn)[wn]||(f(this,wn)[wn]=new Float32Array(this.geometryBucket.positionsCompressed.length),hr(this.geometryBucket.positionsCompressed,this.geometry.positionsDecompressMatrix,f(this,wn)[wn])),f(this,wn)[wn]}},{key:"positionsWorld",get:function(){if(!f(this,Pn)[Pn]){var e=this.positionsDecompressed;f(this,Pn)[Pn]=new Float64Array(e.length),vi(e,this.mesh.matrix,f(this,Pn)[Pn])}return f(this,Pn)[Pn]}},{key:"uvsDecompressed",get:function(){return null}}]),e}(),Tn=new En;function _n(e,t){Tn.reset(),Tn.object=e;for(var i=0,r=e.meshes.length;i<r;i++){var n=e.meshes[i];Tn.mesh=n,Tn.meshIndex=i;var o=n.geometry;Tn.geometry=o;for(var s=0,a=o.geometryBuckets.length;s<a;s++)if(Tn.geometryBucket=o.geometryBuckets[s],Tn.geometryBucketIndex=s,t(Tn))return!0}return!1}var In=/*#__PURE__*/d("aabb"),xn=/*#__PURE__*/d("aabbDirty"),Sn=/*#__PURE__*/function(){function e(e){this.model=void 0,this.id=void 0,this.meshes=void 0,this.layerId=void 0,this.rendererObject=void 0,Object.defineProperty(this,In,{writable:!0,value:void 0}),Object.defineProperty(this,xn,{writable:!0,value:void 0}),this.id=e.id,this.layerId=e.layerId,this.meshes=e.meshes,f(this,In)[In]=Er(),f(this,xn)[xn]=!0,this.rendererObject=null}return e.prototype.setAABBDirty=function(){f(this,xn)[xn]=!0},i(e,[{key:"aabb",get:function(){var e=this;return f(this,xn)[xn]&&(Rr(f(this,In)[In]),_n(this,function(t){return Cr(f(e,In)[In],t.positionsWorld),!1}),f(this,xn)[xn]=!1),f(this,In)[In]}}]),e}(),Mn=function(e,t){this.id=void 0,this.colorTexture=void 0,this.metallicRoughnessTexture=void 0,this.occlusionTexture=void 0,this.emissiveTexture=void 0,this.rendererTextureSet=void 0,this.id=e.id,this.colorTexture=t.colorTexture,this.metallicRoughnessTexture=t.metallicRoughnessTexture,this.occlusionTexture=t.occlusionTexture,this.emissiveTexture=t.emissiveTexture,this.rendererTextureSet=null},On=function(e){this.rendererTexture=void 0,this.id=void 0,this.src=void 0,this.imageData=void 0,this.buffers=void 0,this.image=void 0,this.height=void 0,this.width=void 0,this.compressed=void 0,this.mediaType=void 0,this.magFilter=void 0,this.minFilter=void 0,this.wrapS=void 0,this.wrapT=void 0,this.wrapR=void 0,this.flipY=void 0,this.encoding=void 0,this.preloadColor=void 0,this.channel=void 0,this.id=e.id,this.imageData=e.imageData,this.src=e.src,this.mediaType=e.mediaType,this.minFilter=e.minFilter||pe,this.magFilter=e.magFilter||pe,this.wrapS=e.wrapS||de,this.wrapT=e.wrapT||de,this.wrapR=e.wrapR||de,this.encoding=e.encoding||We,this.preloadColor=Pt(e.preloadColor||[1,1,1,1]),this.channel=0,this.rendererTexture=null},Rn=/*#__PURE__*/d("color"),jn=/*#__PURE__*/d("matrix"),Dn=/*#__PURE__*/d("metallic"),An=/*#__PURE__*/d("roughness"),Cn=/*#__PURE__*/d("opacity"),Bn=/*#__PURE__*/function(){function e(e){this.id=void 0,this.geometry=void 0,this.textureSet=void 0,this.rendererMesh=void 0,this.object=void 0,Object.defineProperty(this,Rn,{writable:!0,value:void 0}),Object.defineProperty(this,jn,{writable:!0,value:void 0}),Object.defineProperty(this,Dn,{writable:!0,value:void 0}),Object.defineProperty(this,An,{writable:!0,value:void 0}),Object.defineProperty(this,Cn,{writable:!0,value:void 0}),this.id=e.id,f(this,jn)[jn]=e.matrix?Zt(e.matrix):ri(),this.geometry=e.geometry,this.textureSet=e.textureSet,this.rendererMesh=null,this.color=e.color||wt([1,1,1]),this.metallic=null!=e.metallic?e.metallic:0,this.roughness=null!=e.roughness?e.roughness:1,this.opacity=null!=e.opacity?e.opacity:1}return i(e,[{key:"color",get:function(){return f(this,Rn)[Rn]},set:function(e){var t=f(this,Rn)[Rn];t||((t=f(this,Rn)[Rn]=new Float32Array(4))[3]=1),e?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=1,t[1]=1,t[2]=1),this.rendererMesh&&this.rendererMesh.setColor(f(this,Rn)[Rn])}},{key:"matrix",get:function(){return f(this,jn)[jn]},set:function(e){e?f(this,jn)[jn].set(e):ri(f(this,jn)[jn]),this.rendererMesh&&this.rendererMesh.setMatrix(f(this,jn)[jn]),this.object&&this.object.setAABBDirty()}},{key:"metallic",get:function(){return f(this,Dn)[Dn]},set:function(e){e=null!=e?e:1,f(this,Dn)[Dn]!==e&&(f(this,Dn)[Dn]=e,this.rendererMesh&&this.rendererMesh.setMetallic(f(this,Dn)[Dn]))}},{key:"roughness",get:function(){return f(this,An)[An]},set:function(e){e=null!=e?e:1,f(this,An)[An]!==e&&(f(this,An)[An]=e,this.rendererMesh&&this.rendererMesh.setRoughness(f(this,An)[An]))}},{key:"opacity",get:function(){return f(this,Cn)[Cn]},set:function(e){e=null!=e?e:1,f(this,Cn)[Cn]!==e&&(f(this,Cn)[Cn]=e)}}]),e}(),kn=[],Ln=[],Fn=[],Un=[],Nn=[],Gn=0,Vn=new Uint16Array(3),Hn=new Uint16Array(3),Xn=new Uint16Array(3),Wn=wt(),Yn=wt(),Kn=wt(),zn=wt(),qn=wt(),Zn=wt(),Qn=wt(),Jn=null;function $n(e,t){for(var i,r=0;r<3;r++)if(0!=(i=Jn[3*e+r]-Jn[3*t+r]))return i;return 0}var eo=null,to=null;function io(e,t){var i,r,n,o,s,a,c=3*e,l=3*t,h=Math.min(i=to[c],r=to[c+1],n=to[c+2]),u=Math.min(o=to[l],s=to[l+1],a=to[l+2]);if(h!=u)return h-u;var d=Math.max(i,r,n),f=Math.max(o,s,a);return d!=f?d-f:0}function ro(e){var t=Zt(),i=Rr();Cr(i,e.positions);var r,n=pr(e.positions,i,t),o=e.primitive!==Ze&&e.primitive!==Qe&&e.primitive!==qe||!e.indices?null:function(e,t,i,r){!function(e,t){var i,r,n,o,s,a,c={},l=Math.pow(10,4),h=0;for(s=0,a=e.length;s<a;s+=3)i=e[s],r=e[s+1],n=e[s+2],void 0===c[o=Math.round(i*l)+"_"+Math.round(r*l)+"_"+Math.round(n*l)]&&(c[o]=h/3,kn[h++]=i,kn[h++]=r,kn[h++]=n),Ln[s/3]=c[o];for(s=0,a=t.length;s<a;s++)Un[s]=Ln[t[s]],Fn[Un[s]]=t[s]}(e,t),function(e,t){Gn=0;for(var i=0,r=e;i<r;i+=3){var n=3*Un[i],o=3*Un[i+1],s=3*Un[i+2];t?(Vn[0]=kn[n],Vn[1]=kn[n+1],Vn[2]=kn[n+2],Hn[0]=kn[o],Hn[1]=kn[o+1],Hn[2]=kn[o+2],Xn[0]=kn[s],Xn[1]=kn[s+1],Xn[2]=kn[s+2],lr(Vn,t,Wn),lr(Hn,t,Yn),lr(Xn,t,Kn)):(Wn[0]=kn[n],Wn[1]=kn[n+1],Wn[2]=kn[n+2],Yn[0]=kn[o],Yn[1]=kn[o+1],Yn[2]=kn[o+2],Kn[0]=kn[s],Kn[1]=kn[s+1],Kn[2]=kn[s+2]),Mt(Kn,Yn,zn),Mt(Wn,Yn,qn),At(zn,qn,Zn),Yt(Zn,Qn);var a=Nn[Gn]||(Nn[Gn]={normal:wt()});a.normal[0]=Qn[0],a.normal[1]=Qn[1],a.normal[2]=Qn[2],Gn++}}(t.length,i);for(var n,o,s,a,c,l,h,u,d=[],f=Math.cos(10*at),v={},p=!1,y=0,m=t.length;y<m;y+=3)for(var g=y/3,b=0;b<3;b++)n=Un[y+b],o=Un[y+(b+1)%3],void 0===v[c=(s=Math.min(n,o))+","+(a=Math.max(n,o))]?v[c]={index1:s,index2:a,face1:g,face2:void 0}:v[c].face2=g;for(c in v)void 0!==(l=v[c]).face2&&gt(Nn[l.face1].normal,Nn[l.face2].normal)>f||(h=Fn[l.index1],u=Fn[l.index2],(!p&&h>65535||u>65535)&&(p=!0),d.push(h),d.push(u));return p?new Uint32Array(d):new Uint16Array(d)}(n,e.indices,t),s=function(e){var t=e.positionsCompressed,i=e.indices,r=e.edgeIndices;!function(e){if(!(null!==eo&&eo.length>=e)){eo=new Uint32Array(e);for(var t=0;t<e;t++)eo[t]=t}}(t.length/3);var n=eo.slice(0,t.length/3),o=eo.slice(0,t.length/3);Jn=t,n.sort($n);var s=0;o[n[0]]=0;for(var a=1,c=n.length;a<c;a++)0!=$n(n[a],n[a-1])&&s++,o[n[a]]=s;var l=new Uint16Array(3*(s+1));l[3*(s=0)+0]=t[3*n[0]+0],l[3*s+1]=t[3*n[0]+1],l[3*s+2]=t[3*n[0]+2];for(var h=1,u=n.length;h<u;h++)0!==$n(n[h],n[h-1])&&(l[3*++s+0]=t[3*n[h]+0],l[3*s+1]=t[3*n[h]+1],l[3*s+2]=t[3*n[h]+2]),o[n[h]]=s;Jn=null;for(var d,f=new Uint32Array(i.length),v=0,p=i.length;v<p;v++)f[v]=o[i[v]];if(r){d=new Uint32Array(r.length);for(var y=0,m=r.length;y<m;y++)d[y]=o[r[y]]}return[l,f,d]}({positionsCompressed:n,uvs:e.uvs,indices:e.indices,edgeIndices:o}),a=function(e,t,i){void 0===i&&(i=!1);var r=e.positionsCompressed||[],n=function(e,t){for(var i=new Int32Array(e.length/3),r=0,n=i.length;r<n;r++)i[r]=r;to=new Int32Array(e.length);for(var o=0,s=e.length;o<s;o++)to[o]=e[o]>>t;i.sort(io);for(var a=new Int32Array(e.length),c=0,l=i.length;c<l;c++)a[3*c+0]=e[3*i[c]+0],a[3*c+1]=e[3*i[c]+1],a[3*c+2]=e[3*i[c]+2];return a}(e.indices||[],t),o=[];function s(e,t){if(e>t){var i=e;e=t,t=i}function r(i,r){return i!=e?e-i:r!=t?t-r:0}for(var n=0,s=(o.length>>1)-1;n<=s;){var a=s+n>>1,c=r(o[2*a],o[2*a+1]);if(c>0)n=a+1;else{if(!(c<0))return a;s=a-1}}return-n-1}var a=new Int32Array(o.length/2);a.fill(0);var c=r.length/3;if(c>8*(1<<t))return[e];var l=new Int32Array(c);l.fill(-1);var h=[];function u(){l.fill(-1);var e={positionsCompressed:[],indices:[],edgeIndices:[],maxNumPositions:(1<<t)-t,numPositions:0,bucketNumber:h.length};return h.push(e),e}for(var d=u(),f=0,v=n.length;f<v;f+=3){var p=0,y=n[f],m=n[f+1],g=n[f+2];if(-1==l[y]&&p++,-1==l[m]&&p++,-1==l[g]&&p++,p+d.numPositions>d.maxNumPositions&&(d=u()),d.bucketNumber>8)return[e];-1==l[y]&&(l[y]=d.numPositions++,d.positionsCompressed.push(r[3*y]),d.positionsCompressed.push(r[3*y+1]),d.positionsCompressed.push(r[3*y+2])),-1==l[m]&&(l[m]=d.numPositions++,d.positionsCompressed.push(r[3*m]),d.positionsCompressed.push(r[3*m+1]),d.positionsCompressed.push(r[3*m+2])),-1==l[g]&&(l[g]=d.numPositions++,d.positionsCompressed.push(r[3*g]),d.positionsCompressed.push(r[3*g+1]),d.positionsCompressed.push(r[3*g+2])),d.indices.push(l[y]),d.indices.push(l[m]),d.indices.push(l[g]);var b=void 0;(b=s(y,m))>=0&&0==a[b]&&(a[b]=1,d.edgeIndices.push(l[o[2*b]]),d.edgeIndices.push(l[o[2*b+1]])),(b=s(y,g))>=0&&0==a[b]&&(a[b]=1,d.edgeIndices.push(l[o[2*b]]),d.edgeIndices.push(l[o[2*b+1]])),(b=s(m,g))>=0&&0==a[b]&&(a[b]=1,d.edgeIndices.push(l[o[2*b]]),d.edgeIndices.push(l[o[2*b+1]]))}var w=t/8,P=2*r.length+(n.length+o.length)*(t/8*2),E=0;return h.forEach(function(e){E+=2*e.positionsCompressed.length+(e.indices.length+e.edgeIndices.length)*w}),E>P?[e]:(i&&function(e,t){var i={};e.forEach(function(e){for(var t=e.indices,r=e.edgeIndices,n=e.positionsCompressed,o=0,s=t.length;o<s;o+=3)i[n[3*t[o]]+"_"+n[3*t[o]+1]+"_"+n[3*t[o]+2]+"/"+n[3*t[o+1]]+"_"+n[3*t[o+1]+1]+"_"+n[3*t[o+1]+2]+"/"+n[3*t[o+2]]+"_"+n[3*t[o+2]+1]+"_"+n[3*t[o+2]+2]]=!0;for(o=0,s=r.length;o<s;o+=2);});for(var r=t.indices,n=t.positionsCompressed,o=0,s=r.length;o<s;o+=3){var a=n[3*r[o]]+"_"+n[3*r[o]+1]+"_"+n[3*r[o]+2]+"/"+n[3*r[o+1]]+"_"+n[3*r[o+1]+1]+"_"+n[3*r[o+1]+2]+"/"+n[3*r[o+2]]+"_"+n[3*r[o+2]+1]+"_"+n[3*r[o+2]+2];if(!(a in i))throw console.log("Not found "+a),"Ohhhh!"}}(h,e),h)}({positionsCompressed:r=s[0],indices:s[1],edgeIndices:s[2]},r.length/3>65536?16:8);return{id:e.id,primitive:e.primitive===Ze&&a.length>1?qe:e.primitive,aabb:i,positionsDecompressMatrix:t,uvsDecompressMatrix:void 0,geometryBuckets:a}}var no=/*#__PURE__*/d("texturesList"),oo=/*#__PURE__*/d("numObjects"),so=/*#__PURE__*/d("meshUsedByObject"),ao=/*#__PURE__*/d("removeUnusedTextures"),co=/*#__PURE__*/function(e){function t(t,i){var r;return r=e.call(this,t,{id:i.id})||this,Object.defineProperty(c(r),ao,{value:lo}),r.scene=void 0,r.layerId=void 0,r.built=void 0,r.edgeThreshold=void 0,r.geometries=void 0,r.textures=void 0,r.textureSets=void 0,r.meshes=void 0,r.objects=void 0,r.aabb=void 0,r.onBuilt=void 0,r.rendererModel=void 0,r.stats=void 0,Object.defineProperty(c(r),no,{writable:!0,value:void 0}),Object.defineProperty(c(r),oo,{writable:!0,value:void 0}),Object.defineProperty(c(r),so,{writable:!0,value:void 0}),r.scene=t,r.onBuilt=new p(new te.EventDispatcher),r.onDestroyed=new p(new te.EventDispatcher),f(c(r),oo)[oo]=0,f(c(r),so)[so]={},r.id=i.id||"default",r.layerId=i.layerId,r.edgeThreshold=10,r.geometries={},r.textures={},f(c(r),no)[no]=[],r.textureSets={},r.meshes={},r.objects={},r.aabb=Er(),r.built=!1,r.rendererModel=null,r.stats={numGeometries:0,numLines:0,numMeshes:0,numObjects:0,numPoints:0,numTextureSets:0,numTextures:0,numTriangles:0,numVertices:0,textureBytes:0},r.fromJSON(i),r}r(t,e);var i=t.prototype;return i.fromJSON=function(e){if(this.destroyed)return new he("Failed to add components to SceneModel - SceneModel already destroyed");if(this.built)return new he("Failed to add components to SceneModel - SceneModel already built");if(e.geometries)for(var t=0,i=e.geometries.length;t<i;t++)this.createGeometry(e.geometries[t]);if(e.textures)for(var r=0,n=e.textures.length;r<n;r++)this.createTexture(e.textures[r]);if(e.textureSets)for(var o=0,s=e.textureSets.length;o<s;o++)this.createTextureSet(e.textureSets[o]);if(e.meshes)for(var a=0,c=e.meshes.length;a<c;a++)this.createMesh(e.meshes[a]);if(e.objects)for(var l=0,h=e.objects.length;l<h;l++)this.createObject(e.objects[l])},i.createTransform=function(e){return this.destroyed?new he("Failed to create Transform in SceneModel - SceneModel already destroyed"):this.built?new he("Failed to create Transform in SceneModel - SceneModel already built"):void 0},i.createTexture=function(e){if(this.destroyed)return new he("Failed to create Texture in SceneModel - SceneModel already destroyed");if(this.built)return new he("Failed to create Texture in SceneModel - SceneModel already built");if(!e.imageData&&!e.src&&!e.buffers)return new he("Failed to create Texture in SceneModel - Parameter expected: textureParams.imageData, textureParams.src or textureParams.buffers");if(this.textures[e.id])return new he("Failed to create Texture in SceneModel - Texture already exists with this ID: "+e.id);e.src&&e.src.split(".").pop(),e.imageData&&(this.stats.textureBytes+=e.imageData.width*e.imageData.height*4);var t=new On(e);return this.textures[e.id]=t,f(this,no)[no].push(t),this.stats.numTextures++,t},i.createTextureSet=function(e){if(this.destroyed)return new he("Failed to create TextureSet in SceneModel - SceneModel already destroyed");if(this.built)return new he("Failed to create TextureSet in SceneModel - SceneModel already built");if(this.textureSets[e.id])return new he("Failed to create TextureSet in SceneModel - TextureSet already exists with this ID: "+e.id);var t,i,r,n,o;if(null!=e.colorTextureId){if(!(t=this.textures[e.colorTextureId]))return new he("Failed to create TextureSet in SceneModel - Texture not found: "+e.colorTextureId+" - ensure that you create it first with createTexture()");t.channel=0}if(null!=e.metallicRoughnessTextureId){if(!(i=this.textures[e.metallicRoughnessTextureId]))return new he("Failed to create TextureSet in SceneModel - Texture not found: "+e.metallicRoughnessTextureId+" - ensure that you create it first with createTexture()");i.channel=1}if(null!=e.normalsTextureId){if(!(r=this.textures[e.normalsTextureId]))return new he("Failed to create TextureSet in SceneModel - Texture not found: "+e.normalsTextureId+" - ensure that you create it first with createTexture()");r.channel=2}if(null!=e.emissiveTextureId){if(!(n=this.textures[e.emissiveTextureId]))return new he("Failed to create TextureSet in SceneModel - Texture not found: "+e.emissiveTextureId+" - ensure that you create it first with createTexture()");n.channel=3}if(null!=e.occlusionTextureId){if(!(o=this.textures[e.occlusionTextureId]))return new he("Failed to create TextureSet in SceneModel - Texture not found: "+e.occlusionTextureId+" - ensure that you create it first with createTexture()");o.channel=4}var s=new Mn(e,{emissiveTexture:n,occlusionTexture:o,metallicRoughnessTexture:i,colorTexture:t});return this.textureSets[e.id]=s,this.stats.numTextureSets++,s},i.createGeometry=function(e){if(this.destroyed)return new he("Failed to create Geometry in SceneModel - SceneModel already destroyed");if(this.built)return new he("Failed to create Geometry in SceneModel - SceneModel already built");if(!e)return new he("Failed to create Geometry in SceneModel - Parameters expected: geometryParams");if(null==e.id)return new he("Failed to create Geometry in SceneModel - Parameter expected: geometryParams.id");var t=e.id;if(this.geometries[t])return new he("Failed to create Geometry in SceneModel - Geometry with this ID already created: "+t);var i=e.primitive;if(i!==Ke&&i!==ze&&i!==qe&&i!==Ze&&i!==Qe)return new he("Failed to create Geometry in SceneModel - Unsupported value for geometryParams.primitive: '"+i+"' - supported values are PointsPrimitive, LinesPrimitive, TrianglesPrimitive, SolidPrimitive and SurfacePrimitive");if(!e.positions)return new he("Failed to create Geometry in SceneModel - Param expected: geometryParams.positions");if(!e.indices&&i!==Ke)return new he("Failed to create Geometry in SceneModel - Param expected: geometryParams.indices (required for primitive type)");if(e.uvs&&e.uvs.length/2!=e.positions.length/3)return new he("Failed to create Geometry in SceneModel - mismatch between given quantities of vertex positions and UVs");if(e.indices)for(var r=e.positions.length/3,n=0,o=e.indices.length;n<o;n++){var s=e.indices[n];if(s<0||s>=r)return new he("Failed to create Geometry in SceneModel - indices out of range of vertex positions");if(e.uvs&&(s<0||s>=e.uvs.length/2))return new he("Failed to create Geometry in SceneModel - indices out of range of vertex UVs")}var a=new bn(ro(e));return this.geometries[t]=a,this.stats.numGeometries++,e.indices?a.primitive===qe?this.stats.numTriangles+=e.indices.length/3:a.primitive===ze&&(this.stats.numLines+=e.indices.length/2):a.primitive===Ke&&(this.stats.numPoints+=e.positions.length/3),this.stats.numVertices+=e.positions.length/3,a},i.createGeometryCompressed=function(e){if(this.destroyed)return new he("Failed to add compressed Geometry to SceneModel - SceneModel already destroyed");if(this.built)return new he("Failed to add compressed Geometry to SceneModel - SceneModel already built");if(!e)return new he("Failed to add compressed Geometry to SceneModel - Parameters expected: geometryCompressedParams");var t=e.id;if(this.geometries[t])return new he("Failed to add compressed Geometry to SceneModel - Geometry with this ID already created: "+t);var i=e.primitive;if(i!==Ke&&i!==ze&&i!==qe&&i!==Ze&&i!==Qe)return new he("Failed to add compressed Geometry to SceneModel - Unsupported value for geometryCompressedParams.primitive: '"+i+"' - supported values are PointsPrimitive, LinesPrimitive, TrianglesPrimitive, SolidPrimitive and SurfacePrimitive");var r=new bn(e);return this.geometries[t]=r,this.stats.numGeometries++,r},i.createMesh=function(e){if(this.destroyed)return new he("Failed to create Mesh in SceneModel - SceneModel already destroyed");if(this.built)return new he("Failed to create Mesh in SceneModel - SceneModel already built");if(this.meshes[e.id])return new he("Failed to create Mesh in SceneModel - Mesh already exists with this ID: "+e.id);var t=this.geometries[e.geometryId];if(!t)return new he("Failed to create Mesh in SceneModel - Geometry not found: "+e.geometryId);var i=e.textureSetId?this.textureSets[e.textureSetId]:void 0;if(e.textureSetId&&!i)return new he("Failed to create Mesh in SceneModel - TextureSet not found: "+e.textureSetId);var r=new Bn({id:e.id,geometry:t,textureSet:i,matrix:e.matrix,color:e.color,opacity:e.opacity,roughness:e.roughness,metallic:e.metallic});return this.meshes[e.id]=r,this.stats.numMeshes++,r},i.createObject=function(e){if(this.destroyed)return new he("Failed to create SceneObject - SceneModel already destroyed");if(this.built)return new he("Failed to create SceneObject SceneModel already built");if(0===e.meshIds.length)return new he("Failed to create SceneObject - no meshes specified");if(this.scene.objects[e.id])return new he("Failed to create SceneObject - SceneObject already exists in Scene: "+e.id);for(var t=e.meshIds,i=[],r=0,n=t.length;r<n;r++){var o=t[r],s=this.meshes[o];if(!s)return new he("Failed to create SceneObject - Mesh not found: "+o);if(f(this,so)[so][o])return new he("Failed to create SceneObject - Mesh "+o+" already belongs to another SceneObject");i.push(s),f(this,so)[so][s.id]=!0}for(var a=new Sn({id:e.id,layerId:e.layerId||this.layerId,model:this,meshes:i}),c=0,l=i.length;c<l;c++)i[c].object=a;return f(this,oo)[oo]++,this.objects[e.id]=a,this.stats.numObjects++,a},i.build=function(){var e=this;return new Promise(function(t){if(e.destroyed)throw new he("Failed to build SceneModel - SceneModel already destroyed");if(e.built)throw new he("Failed to build SceneModel - SceneModel already built");f(e,ao)[ao](),e.built=!0,e.onBuilt.dispatch(e,null),t(e)})},t}(ae);function lo(){}var ho=/*#__PURE__*/d("onModelBuilts"),uo=/*#__PURE__*/d("onModelDestroys"),fo=/*#__PURE__*/d("center"),vo=/*#__PURE__*/d("aabbDirty"),po=/*#__PURE__*/d("aabb"),yo=/*#__PURE__*/d("registerObjects"),mo=/*#__PURE__*/d("deregisterObjects"),go=/*#__PURE__*/function(e){function t(){var t;return t=e.call(this,null,{})||this,Object.defineProperty(c(t),mo,{value:wo}),Object.defineProperty(c(t),yo,{value:bo}),t.models=void 0,t.objects=void 0,t.onModelCreated=void 0,t.onModelDestroyed=void 0,Object.defineProperty(c(t),ho,{writable:!0,value:void 0}),Object.defineProperty(c(t),uo,{writable:!0,value:void 0}),Object.defineProperty(c(t),fo,{writable:!0,value:void 0}),Object.defineProperty(c(t),vo,{writable:!0,value:void 0}),Object.defineProperty(c(t),po,{writable:!0,value:void 0}),f(c(t),po)[po]=Er(),f(c(t),vo)[vo]=!0,t.models={},t.objects={},f(c(t),ho)[ho]={},f(c(t),uo)[uo]={},t.onModelCreated=new p(new te.EventDispatcher),t.onModelDestroyed=new p(new te.EventDispatcher),t}r(t,e);var n=t.prototype;return n.createModel=function(e){var t=this;if(this.destroyed)return new he("Scene already destroyed");var i=e.id;if(this.models[i])return new he("SceneModel already created in this Scene: "+i);var r=new co(this,e);return this.models[i]=r,r.onDestroyed.one(function(){delete t.models[r.id],f(t,mo)[mo](r),t.onModelDestroyed.dispatch(t,r)}),r.onBuilt.one(function(){f(t,yo)[yo](r),t.onModelCreated.dispatch(t,r)}),r},n.setAABBDirty=function(){f(this,vo)[vo]||(f(this,vo)[vo]=!0)},n.clear=function(){if(this.destroyed)return new he("Scene already destroyed");for(var e in this.models)this.models[e].destroy()},n.destroy=function(){this.clear(),this.onModelCreated.clear(),this.onModelDestroyed.clear(),e.prototype.destroy.call(this)},i(t,[{key:"center",get:function(){if(f(this,vo)[vo]){var e=this.aabb;f(this,fo)[fo][0]=(e[0]+e[3])/2,f(this,fo)[fo][1]=(e[1]+e[4])/2,f(this,fo)[fo][2]=(e[2]+e[5])/2}return f(this,fo)[fo]}},{key:"aabb",get:function(){if(f(this,vo)[vo]){var e,t=st,i=st,r=st,n=ot,o=ot,s=ot,a=this.objects,c=!1;for(var l in a)a.hasOwnProperty(l)&&((e=a[l].aabb)[0]<t&&(t=e[0]),e[1]<i&&(i=e[1]),e[2]<r&&(r=e[2]),e[3]>n&&(n=e[3]),e[4]>o&&(o=e[4]),e[5]>s&&(s=e[5]),c=!0);c||(t=-100,i=-100,r=-100,n=100,o=100,s=100),f(this,po)[po][0]=t,f(this,po)[po][1]=i,f(this,po)[po][2]=r,f(this,po)[po][3]=n,f(this,po)[po][4]=o,f(this,po)[po][5]=s,f(this,vo)[vo]=!1}return f(this,po)[po]}}]),t}(ae);function bo(e){var t=e.objects;for(var i in t){var r=t[i];this.objects[r.id]=r}f(this,vo)[vo]=!0}function wo(e){var t=e.objects;for(var i in t)delete this.objects[t[i].id];f(this,vo)[vo]=!0}var Po={__proto__:null,Scene:go,SceneModel:co,SceneObject:Sn,Texture:On,TextureSet:Mn,Geometry:bn,GeometryBucket:gn,Mesh:Bn,compressGeometryParams:ro,getSceneObjectGeometry:_n},Eo=new Float32Array(2),To=/*#__PURE__*/d("insertItem"),_o=/*#__PURE__*/function(){function e(e){Object.defineProperty(this,To,{value:Io}),this.root=void 0,this.maxDepth=void 0,this.maxDepth=(null==e?void 0:e.maxDepth)||10,this.root={aabb:e.aabb.slice()}}return e.prototype.insertItem=function(e,t){f(this,To)[To](this.root,{item:e},t,1)},e}();function Io(e,t,i,r){if(r>=this.maxDepth)return e.items=e.items||[],void e.items.push(t);if(e.left&&Ir(e.left.aabb,i))f(this,To)[To](e.left,t,i,r+1);else if(e.right&&Ir(e.right.aabb,i))f(this,To)[To](e.right,t,i,r+1);else{var n=e.aabb;Eo[0]=n[2]-n[0],Eo[1]=n[3]-n[1];var o=0;if(Eo[1]>Eo[o]&&(o=1),!e.left){var s=n.slice();if(s[o+2]=(n[o]+n[o+2])/2,e.left={aabb:s},Ir(s,i))return void f(this,To)[To](e.left,t,i,r+1)}if(!e.right){var a=n.slice();if(a[o]=(n[o]+n[o+2])/2,e.right={aabb:a},Ir(a,i))return void f(this,To)[To](e.right,t,i,r+1)}e.items=e.items||[],e.items.push(t)}}var xo={__proto__:null,KdVertex2:function(){this.sceneObject=void 0,this.worldPos=void 0,this.canvasPos=void 0},KdTree2:_o,createKdTree2FromSceneObjectVerts:function(e){var t=new _o({aabb:e.canvasBoundary}),i=Zt(e.viewMatrix),r=Zt(e.projMatrix),n=Vr(i,r),o=e.canvasBoundary,s=e.sceneObjects;if(s)for(var a=0,c=s.length;a<c;a++)l(s[a]);function l(e,t){void 0===t&&(t=Ur),t!==Fr&&(t=Hr(n,e.aabb)),t!==Nr&&_n(e,function(t){for(var i=t.positionsWorld,r=0,n=i.length;r<n;r+=3){var o=Pt();o[0]=i[r],o[1]=i[r+1],o[2]=i[r+2],o[3]=1,h(e,o)}return!1})}function h(e,n){var s=Pt(),a=Pt(),c=new Uint16Array(2);fi(i,n,s),fi(r,s,a),c[0]=Math.floor((1+a[0]/a[3])*o[2]/2),c[1]=Math.floor((1-a[1]/a[3])*o[3]/2),t.insertItem({sceneObject:e,worldPos:n,canvasPos:c},[c[0],c[1],c[0],c[1]])}return t},searchKdTree2ForNearestNeighbor:function(e){return[]}},So=new Float32Array(3),Mo=/*#__PURE__*/d("root"),Oo=/*#__PURE__*/d("maxDepth"),Ro=/*#__PURE__*/d("numNodes"),jo=/*#__PURE__*/d("numObjects"),Do=/*#__PURE__*/d("insertItem"),Ao=/*#__PURE__*/function(){function e(e){Object.defineProperty(this,Do,{value:Co}),Object.defineProperty(this,Mo,{writable:!0,value:void 0}),Object.defineProperty(this,Oo,{writable:!0,value:void 0}),Object.defineProperty(this,Ro,{writable:!0,value:void 0}),Object.defineProperty(this,jo,{writable:!0,value:void 0}),f(this,Oo)[Oo]=(null==e?void 0:e.maxDepth)||10,f(this,Mo)[Mo]={index:0,aabb:e.aabb.slice()},f(this,Ro)[Ro]=0}return e.prototype.insertItem=function(e,t){f(this,Do)[Do](f(this,Mo)[Mo],{index:f(this,jo)[jo]++,item:e},t,1)},i(e,[{key:"root",get:function(){return f(this,Mo)[Mo]}}]),e}();function Co(e,t,i,r){if(r>=f(this,Oo)[Oo])return e.items=e.items||[],e.items.push(t),void Dr(e.aabb,i);if(e.left&&xr(e.left.aabb,i))f(this,Do)[Do](e.left,t,i,r+1);else if(e.right&&xr(e.right.aabb,i))f(this,Do)[Do](e.right,t,i,r+1);else{var n=e.aabb;So[0]=n[3]-n[0],So[1]=n[4]-n[1],So[2]=n[5]-n[2];var o=0;if(So[1]>So[o]&&(o=1),So[2]>So[o]&&(o=2),!e.left){var s=n.slice();if(s[o+3]=(n[o]+n[o+3])/2,e.left={index:f(this,Ro)[Ro]++,aabb:s},xr(s,i))return void f(this,Do)[Do](e.left,t,i,r+1)}if(!e.right){var a=n.slice();if(a[o]=(n[o]+n[o+3])/2,e.right={index:f(this,Ro)[Ro]++,aabb:a},xr(a,i))return void f(this,Do)[Do](e.right,t,i,r+1)}e.items=e.items||[],e.items.push(t),Dr(e.aabb,i)}}var Bo=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}return r(t,e),t}(Ao),ko=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}return r(t,e),t}(Ao),Lo=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}return r(t,e),t}(Ao),Fo=new Int16Array(6);function Uo(e,t,i){var r=e[3*t+1],n=e[3*t+2],o=Fo;o[0]=o[3]=e[3*t],o[1]=o[4]=r,o[2]=o[5]=n,i.insertItem({a:t},o)}function No(e,t,i,r){var n=e[3*t],o=e[3*t+1],s=e[3*t+2],a=e[3*i],c=e[3*i+1],l=e[3*i+2],h=Fo;h[0]=Math.min(n,a),h[1]=Math.min(o,c),h[2]=Math.min(s,l),h[3]=Math.max(n,a),h[4]=Math.max(o,c),h[5]=Math.max(s,l),r.insertItem({a:t,b:i},h)}function Go(e,t,i,r,n){var o=e[3*t],s=e[3*t+1],a=e[3*t+2],c=e[3*i],l=e[3*i+1],h=e[3*i+2],u=e[3*r],d=e[3*r+1],f=e[3*r+2],v=Fo;v[0]=Math.min(o,c,u),v[1]=Math.min(s,l,d),v[2]=Math.min(a,h,f),v[3]=Math.max(o,c,u),v[4]=Math.max(s,l,d),v[5]=Math.max(a,h,f),n.insertItem({a:t,b:i,c:r},v)}var Vo,Ho,Xo={__proto__:null,PrimsKdTree3:Lo,SceneObjectsKdTree3:Bo,KdTree3:Ao,createSceneObjectsKdTree3:function(e){for(var t=Rr(),i=0,r=e.length;i<r;i++)Dr(t,e[i].aabb);for(var n=new Bo({aabb:t}),o=0,s=e.length;o<s;o++){var a=e[o];n.insertItem(a,a.aabb)}return n},SceneObjectsPrimsKdTree3:ko,createSceneObjectPrimsKdTree3:function(e){var t=new Int16Array(6);function i(e,i,r,n,o){var s=r[3*n+1],a=r[3*n+2],c=t;c[0]=c[3]=r[3*n],c[1]=c[4]=s,c[2]=c[5]=a,o.insertItem({sceneObject:e,geometryBucket:i,prim:{a:n}},c)}function r(e,i,r,n,o,s){var a=r[3*n],c=r[3*n+1],l=r[3*n+2],h=r[3*o],u=r[3*o+1],d=r[3*o+2],f=t;f[0]=Math.min(a,h),f[1]=Math.min(c,u),f[2]=Math.min(l,d),f[3]=Math.max(a,h),f[4]=Math.max(c,u),f[5]=Math.max(l,d),s.insertItem({sceneObject:e,geometryBucket:i,prim:{a:n,b:o}},f)}function n(e,i,r,n,o,s,a){var c=r[3*n],l=r[3*n+1],h=r[3*n+2],u=r[3*o],d=r[3*o+1],f=r[3*o+2],v=r[3*s],p=r[3*s+1],y=r[3*s+2],m=t;m[0]=Math.min(c,u,v),m[1]=Math.min(l,d,p),m[2]=Math.min(h,f,y),m[3]=Math.max(c,u,v),m[4]=Math.max(l,d,p),m[5]=Math.max(h,f,y),a.insertItem({sceneObject:e,geometryBucket:i,prim:{a:n,b:o,c:s}},m)}for(var o=Rr(),s=0,a=e.length;s<a;s++)Dr(o,e[s].aabb);for(var c=new ko({aabb:o}),l=function(){var t=e[h];_n(t,function(e){var o=e.geometryBucket,s=e.positionsWorld,a=o.indices;switch(e.geometry.primitive){case Ke:for(var l=0,h=s.length/3;l<h;l++)i(t,o,s,l,c);break;case qe:if(a)for(var u=0,d=a.length;u<d;u+=3)n(t,o,s,a[u],a[u+1],a[u+2],c);break;case ze:if(a)for(var f=0,v=a.length;f<v;f+=2)r(t,o,s,a[f],a[f+1],c)}return!0})},h=0,u=e.length;h<u;h++)l();return c},createPrimsKdTree3:function(e,t,i){var r=new Lo({aabb:Cr(Tr(),t)});switch(e){case Ke:for(var n=0,o=t.length/3;n<o;n++)Uo(t,n,r);break;case qe:if(i)for(var s=0,a=i.length;s<a;s+=3)Go(t,i[s],i[s+1],i[s+2],r);break;case ze:if(i)for(var c=0,l=i.length;c<l;c+=2)No(t,i[c],i[c+1],r)}return r},searchKdTree3WithAABB:function(e){var t=[];return function e(i,r){if(r!==Nr&&(r=Xr())!==Nr){var n=i.items;if(n&&n.length>0)for(var o=0,s=n.length;o<s;o++)t.push(n[o].item);i.left&&e(i.left,r),i.right&&e(i.right,r)}}(e.kdTree.root,Ur),t},searchKdTree3WithFrustum:function(e){var t=e.frustum,i=[];return function e(r,n){if(n!==Nr&&(n=Hr(t,r.aabb))!==Nr){var o=r.items;if(o&&o.length>0)for(var s=0,a=o.length;s<a;s++)i.push(o[s].item);r.left&&e(r.left,n),r.right&&e(r.right,n)}}(e.kdTree.root,Ur),i},searchKdTree3WithRay:function(e){var t=[];return function e(i,r){if(r!==Nr&&(r=0)!==Nr){var n=i.items;if(n&&n.length>0)for(var o=0,s=n.length;o<s;o++)t.push(n[o].item);i.left&&e(i.left,r),i.right&&e(i.right,r)}}(e.kdTree.root,Ur),t}},Wo=1001,Yo=((Vo={})[1e3]="BasicEntity",Vo[1001]="BasicAggregation",Vo),Ko={__proto__:null,BasicEntity:1e3,BasicAggregation:Wo,typeNames:Yo,typeCodes:{BasicEntity:1e3,BasicAggregation:Wo}},zo=2023,qo=2026,Zo=((Ho={})[2e3]="Bridge",Ho[2001]="BridgePart",Ho[2002]="BridgeInstallation",Ho[2003]="BridgeConstructiveElement",Ho[2004]="BridgeRoom",Ho[2005]="BridgeFurniture",Ho[2006]="Building",Ho[2007]="BuildingPart",Ho[2008]="BuildingInstallation",Ho[2009]="BuildingConstructiveElement",Ho[2010]="BuildingFurniture",Ho[2011]="BuildingStorey",Ho[2012]="BuildingRoom",Ho[2013]="BuildingUnit",Ho[2014]="CityFurniture",Ho[2015]="CityObjectGroup",Ho[2016]="LandUse",Ho[2017]="OtherConstruction",Ho[2018]="PlantCover",Ho[2019]="SolitaryVegetationObject",Ho[2020]="TINRelief",Ho[2021]="TransportationSquare",Ho[2022]="Railway",Ho[zo]="Road",Ho[2024]="Tunnel",Ho[2025]="TunnelPart",Ho[2026]="TunnelInstallation",Ho[2027]="TunnelInstallation",Ho[2028]="TunnelHollowSpace",Ho[2029]="TunnelFurniture",Ho[2030]="WaterBody",Ho[2031]="Waterway",Ho),Qo={Bridge:2e3,BridgePart:2001,BridgeInstallation:2002,BridgeConstructiveElement:2003,BridgeRoom:2004,BridgeFurniture:2005,Building:2006,BuildingPart:2007,BuildingInstallation:2008,BuildingConstructiveElement:2009,BuildingFurniture:2010,BuildingStorey:2011,BuildingRoom:2012,BuildingUnit:2013,CityFurniture:2014,CityObjectGroup:2015,LandUse:2016,OtherConstruction:2017,PlantCover:2018,SolitaryVegetationObject:2019,TINRelief:2020,TransportationSquare:2021,Railway:2022,Road:zo,Tunnel:2024,TunnelPart:2025,TunnelInstallation:qo,TunnelConstructiveElement:qo,TunnelHollowSpace:2028,TunnelFurniture:2029,WaterBody:2030,Waterway:2031},Jo={__proto__:null,BasicAggregation:2001,Bridge:2e3,BridgePart:2001,BridgeInstallation:2002,BridgeConstructiveElement:2003,BridgeRoom:2004,BridgeFurniture:2005,Building:2006,BuildingPart:2007,BuildingInstallation:2008,BuildingConstructiveElement:2009,BuildingFurniture:2010,BuildingStorey:2011,BuildingRoom:2012,BuildingUnit:2013,CityFurniture:2014,CityObjectGroup:2015,LandUse:2016,OtherConstruction:2017,PlantCover:2018,SolitaryVegetationObject:2019,TINRelief:2020,TransportationSquare:2021,Railway:2022,Road:zo,Tunnel:2024,TunnelPart:2025,TunnelInstallation:qo,TunnelConstructiveElement:2027,TunnelHollowSpace:2028,TunnelFurniture:2029,WaterBody:2030,Waterway:2031,typeNames:Zo,typeCodes:Qo},$o={__proto__:null,IfcActionRequest:1e3,IfcActor:1001,IfcActorRole:1002,IfcActuator:1003,IfcActuatorType:1004,IfcAddress:1005,IfcAdvancedBrep:1006,IfcAdvancedBrepWithVoids:1007,IfcAdvancedFace:1008,IfcAirTerminal:1009,IfcAirTerminalBox:1010,IfcAirTerminalBoxType:1011,IfcAirTerminalType:1012,IfcAirToAirHeatRecovery:1013,IfcAirToAirHeatRecoveryType:1014,IfcAlarm:1015,IfcAlarmType:1016,IfcAnnotation:1017,IfcAnnotationFillArea:1018,IfcApplication:1019,IfcAppliedValue:1020,IfcApproval:1021,IfcApprovalRelationship:1022,IfcArbitraryClosedProfileDef:1023,IfcArbitraryOpenProfileDef:1024,IfcArbitraryProfileDefWithVoids:1025,IfcAsset:1026,IfcAsymmetricIShapeProfileDef:1027,IfcAudioVisualAppliance:1028,IfcAudioVisualApplianceType:1029,IfcAxis1Placement:1030,IfcAxis2Placement2D:1031,IfcAxis2Placement3D:1032,IfcBeam:1033,IfcBeamStandardCase:1034,IfcBeamType:1035,IfcBlobTexture:1036,IfcBlock:1037,IfcBoiler:1038,IfcBoilerType:1039,IfcBooleanClippingResult:1040,IfcBooleanResult:1041,IfcBoundaryCondition:1042,IfcBoundaryCurve:1043,IfcBoundaryEdgeCondition:1044,IfcBoundaryFaceCondition:1045,IfcBoundaryNodeCondition:1046,IfcBoundaryNodeConditionWarping:1047,IfcBoundedCurve:1048,IfcBoundedSurface:1049,IfcBoundingBox:1050,IfcBoxedHalfSpace:1051,IfcBSplineCurve:1052,IfcBSplineCurveWithKnots:1053,IfcBSplineSurface:1054,IfcBSplineSurfaceWithKnots:1055,IfcBuilding:1056,IfcBuildingElementPart:1057,IfcBuildingElementPartType:1058,IfcBuildingElementProxy:1059,IfcBuildingElementProxyType:1060,IfcBuildingStorey:1061,IfcBuildingSystem:1062,IfcBurner:1063,IfcBurnerType:1064,IfcCableCarrierFitting:1065,IfcCableCarrierFittingType:1066,IfcCableCarrierSegment:1067,IfcCableCarrierSegmentType:1068,IfcCableFitting:1069,IfcCableFittingType:1070,IfcCableSegment:1071,IfcCableSegmentType:1072,IfcCartesianPoint:1073,IfcCartesianPointList:1074,IfcCartesianPointList2D:1075,IfcCartesianPointList3D:1076,IfcCartesianTransformationOperator:1077,IfcCartesianTransformationOperator2D:1078,IfcCartesianTransformationOperator2DnonUniform:1079,IfcCartesianTransformationOperator3D:1080,IfcCartesianTransformationOperator3DnonUniform:1081,IfcCenterLineProfileDef:1082,IfcChiller:1083,IfcChillerType:1084,IfcChimney:1085,IfcChimneyType:1086,IfcCircle:1087,IfcCircleHollowProfileDef:1088,IfcCircleProfileDef:1089,IfcCivilElement:1090,IfcCivilElementType:1091,IfcClassification:1092,IfcClassificationReference:1093,IfcClosedShell:1094,IfcCoil:1095,IfcCoilType:1096,IfcColourRgb:1097,IfcColourRgbList:1098,IfcColourSpecification:1099,IfcColumn:1100,IfcColumnStandardCase:1101,IfcColumnType:1102,IfcCommunicationsAppliance:1103,IfcCommunicationsApplianceType:1104,IfcComplexProperty:1105,IfcComplexPropertyTemplate:1106,IfcCompositeCurve:1107,IfcCompositeCurveOnSurface:1108,IfcCompositeCurveSegment:1109,IfcCompositeProfileDef:1110,IfcCompressor:1111,IfcCompressorType:1112,IfcCondenser:1113,IfcCondenserType:1114,IfcConic:1115,IfcConnectedFaceSet:1116,IfcConnectionCurveGeometry:1117,IfcConnectionGeometry:1118,IfcConnectionPointEccentricity:1119,IfcConnectionPointGeometry:1120,IfcConnectionSurfaceGeometry:1121,IfcConnectionVolumeGeometry:1122,IfcConstraint:1123,IfcConstructionEquipmentResource:1124,IfcConstructionEquipmentResourceType:1125,IfcConstructionMaterialResource:1126,IfcConstructionMaterialResourceType:1127,IfcConstructionProductResource:1128,IfcConstructionProductResourceType:1129,IfcConstructionResource:1130,IfcConstructionResourceType:1131,IfcContext:1132,IfcContextDependentUnit:1133,IfcControl:1134,IfcController:1135,IfcControllerType:1136,IfcConversionBasedUnit:1137,IfcConversionBasedUnitWithOffset:1138,IfcCooledBeam:1139,IfcCooledBeamType:1140,IfcCoolingTower:1141,IfcCoolingTowerType:1142,IfcCoordinateOperation:1143,IfcCoordinateReferenceSystem:1144,IfcCostItem:1145,IfcCostSchedule:1146,IfcCostValue:1147,IfcCovering:1148,IfcCoveringType:1149,IfcCrewResource:1150,IfcCrewResourceType:1151,IfcCsgPrimitive3D:1152,IfcCsgSolid:1153,IfcCShapeProfileDef:1154,IfcCurrencyRelationship:1155,IfcCurtainWall:1156,IfcCurtainWallType:1157,IfcCurve:1158,IfcCurveBoundedPlane:1159,IfcCurveBoundedSurface:1160,IfcCurveStyle:1161,IfcCurveStyleFont:1162,IfcCurveStyleFontAndScaling:1163,IfcCurveStyleFontPattern:1164,IfcCylindricalSurface:1165,IfcDamper:1166,IfcDamperType:1167,IfcDerivedProfileDef:1168,IfcDerivedUnit:1169,IfcDerivedUnitElement:1170,IfcDimensionalExponents:1171,IfcDirection:1172,IfcDiscreteAccessory:1173,IfcDiscreteAccessoryType:1174,IfcDistributionChamberElement:1175,IfcDistributionChamberElementType:1176,IfcDistributionCircuit:1177,IfcDistributionControlElement:1178,IfcDistributionControlElementType:1179,IfcDistributionElement:1180,IfcDistributionElementType:1181,IfcDistributionFlowElement:1182,IfcDistributionFlowElementType:1183,IfcDistributionPort:1184,IfcDistributionSystem:1185,IfcDocumentInformation:1186,IfcDocumentInformationRelationship:1187,IfcDocumentReference:1188,IfcDoor:1189,IfcDoorLiningProperties:1190,IfcDoorPanelProperties:1191,IfcDoorStandardCase:1192,IfcDoorStyle:1193,IfcDoorType:1194,IfcDraughtingPreDefinedColour:1195,IfcDraughtingPreDefinedCurveFont:1196,IfcDuctFitting:1197,IfcDuctFittingType:1198,IfcDuctSegment:1199,IfcDuctSegmentType:1200,IfcDuctSilencer:1201,IfcDuctSilencerType:1202,IfcEdge:1203,IfcEdgeCurve:1204,IfcEdgeLoop:1205,IfcElectricAppliance:1206,IfcElectricApplianceType:1207,IfcElectricDistributionBoard:1208,IfcElectricDistributionBoardType:1209,IfcElectricFlowStorageDevice:1210,IfcElectricFlowStorageDeviceType:1211,IfcElectricGenerator:1212,IfcElectricGeneratorType:1213,IfcElectricMotor:1214,IfcElectricMotorType:1215,IfcElectricTimeControl:1216,IfcElectricTimeControlType:1217,IfcElement:1218,IfcElementarySurface:1219,IfcElementAssembly:1220,IfcElementAssemblyType:1221,IfcElementComponent:1222,IfcElementComponentType:1223,IfcElementQuantity:1224,IfcElementType:1225,IfcEllipse:1226,IfcEllipseProfileDef:1227,IfcEnergyConversionDevice:1228,IfcEnergyConversionDeviceType:1229,IfcEngine:1230,IfcEngineType:1231,IfcEvaporativeCooler:1232,IfcEvaporativeCoolerType:1233,IfcEvaporator:1234,IfcEvaporatorType:1235,IfcEvent:1236,IfcEventTime:1237,IfcEventType:1238,IfcExtendedProperties:1239,IfcExternalInformation:1240,IfcExternallyDefinedHatchStyle:1241,IfcExternallyDefinedSurfaceStyle:1242,IfcExternallyDefinedTextFont:1243,IfcExternalReference:1244,IfcExternalReferenceRelationship:1245,IfcExternalSpatialElement:1246,IfcExternalSpatialStructureElement:1247,IfcExtrudedAreaSolid:1248,IfcExtrudedAreaSolidTapered:1249,IfcFace:1250,IfcFaceBasedSurfaceModel:1251,IfcFaceBound:1252,IfcFaceOuterBound:1253,IfcFaceSurface:1254,IfcFacetedBrep:1255,IfcFacetedBrepWithVoids:1256,IfcFailureConnectionCondition:1257,IfcFan:1258,IfcFanType:1259,IfcFastener:1260,IfcFastenerType:1261,IfcFeatureElement:1262,IfcFeatureElementAddition:1263,IfcFeatureElementSubtraction:1264,IfcFillAreaStyle:1265,IfcFillAreaStyleHatching:1266,IfcFillAreaStyleTiles:1267,IfcFilter:1268,IfcFilterType:1269,IfcFireSuppressionTerminal:1270,IfcFireSuppressionTerminalType:1271,IfcFixedReferenceSweptAreaSolid:1272,IfcFlowController:1273,IfcFlowControllerType:1274,IfcFlowFitting:1275,IfcFlowFittingType:1276,IfcFlowInstrument:1277,IfcFlowInstrumentType:1278,IfcFlowMeter:1279,IfcFlowMeterType:1280,IfcFlowMovingDevice:1281,IfcFlowMovingDeviceType:1282,IfcFlowSegment:1283,IfcFlowSegmentType:1284,IfcFlowStorageDevice:1285,IfcFlowStorageDeviceType:1286,IfcFlowTerminal:1287,IfcFlowTerminalType:1288,IfcFlowTreatmentDevice:1289,IfcFlowTreatmentDeviceType:1290,IfcFooting:1291,IfcFootingType:1292,IfcFurnishingElement:1293,IfcFurnishingElementType:1294,IfcFurniture:1295,IfcFurnitureType:1296,IfcGeographicElement:1297,IfcGeographicElementType:1298,IfcGeometricCurveSet:1299,IfcGeometricRepresentationContext:1300,IfcGeometricRepresentationItem:1301,IfcGeometricRepresentationSubContext:1302,IfcGeometricSet:1303,IfcGrid:1304,IfcGridAxis:1305,IfcGridPlacement:1306,IfcGroup:1307,IfcHalfSpaceSolid:1308,IfcHeatExchanger:1309,IfcHeatExchangerType:1310,IfcHumidifier:1311,IfcHumidifierType:1312,IfcImageTexture:1313,IfcIndexedColourMap:1314,IfcIndexedPolyCurve:1315,IfcIndexedPolygonalFace:1316,IfcIndexedPolygonalFaceWithVoids:1317,IfcIndexedTextureMap:1318,IfcIndexedTriangleTextureMap:1319,IfcInterceptor:1320,IfcInterceptorType:1321,IfcIntersectionCurve:1322,IfcInventory:1323,IfcIrregularTimeSeries:1324,IfcIrregularTimeSeriesValue:1325,IfcIShapeProfileDef:1326,IfcJunctionBox:1327,IfcJunctionBoxType:1328,IfcLaborResource:1329,IfcLaborResourceType:1330,IfcLagTime:1331,IfcLamp:1332,IfcLampType:1333,IfcLibraryInformation:1334,IfcLibraryReference:1335,IfcLightDistributionData:1336,IfcLightFixture:1337,IfcLightFixtureType:1338,IfcLightIntensityDistribution:1339,IfcLightSource:1340,IfcLightSourceAmbient:1341,IfcLightSourceDirectional:1342,IfcLightSourceGoniometric:1343,IfcLightSourcePositional:1344,IfcLightSourceSpot:1345,IfcLine:1346,IfcLocalPlacement:1347,IfcLoop:1348,IfcLShapeProfileDef:1349,IfcManifoldSolidBrep:1350,IfcMapConversion:1351,IfcMappedItem:1352,IfcMaterial:1353,IfcMaterialClassificationRelationship:1354,IfcMaterialConstituent:1355,IfcMaterialConstituentSet:1356,IfcMaterialDefinition:1357,IfcMaterialDefinitionRepresentation:1358,IfcMaterialLayer:1359,IfcMaterialLayerSet:1360,IfcMaterialLayerSetUsage:1361,IfcMaterialLayerWithOffsets:1362,IfcMaterialList:1363,IfcMaterialProfile:1364,IfcMaterialProfileSet:1365,IfcMaterialProfileSetUsage:1366,IfcMaterialProfileSetUsageTapering:1367,IfcMaterialProfileWithOffsets:1368,IfcMaterialProperties:1369,IfcMaterialRelationship:1370,IfcMaterialUsageDefinition:1371,IfcMeasureWithUnit:1372,IfcMechanicalFastener:1373,IfcMechanicalFastenerType:1374,IfcMedicalDevice:1375,IfcMedicalDeviceType:1376,IfcMember:1377,IfcMemberStandardCase:1378,IfcMemberType:1379,IfcMetric:1380,IfcMirroredProfileDef:1381,IfcMonetaryUnit:1382,IfcMotorConnection:1383,IfcMotorConnectionType:1384,IfcNamedUnit:1385,IfcObject:1386,IfcObjectDefinition:1387,IfcObjective:1388,IfcObjectPlacement:1389,IfcOccupant:1390,IfcOffsetCurve2D:1391,IfcOffsetCurve3D:1392,IfcOpeningElement:1393,IfcOpeningStandardCase:1394,IfcOpenShell:1395,IfcOrganization:1396,IfcOrganizationRelationship:1397,IfcOrientedEdge:1398,IfcOuterBoundaryCurve:1399,IfcOutlet:1400,IfcOutletType:1401,IfcOwnerHistory:1402,IfcParameterizedProfileDef:1403,IfcPath:1404,IfcPcurve:1405,IfcPerformanceHistory:1406,IfcPermeableCoveringProperties:1407,IfcPermit:1408,IfcPerson:1409,IfcPersonAndOrganization:1410,IfcPhysicalComplexQuantity:1411,IfcPhysicalQuantity:1412,IfcPhysicalSimpleQuantity:1413,IfcPile:1414,IfcPileType:1415,IfcPipeFitting:1416,IfcPipeFittingType:1417,IfcPipeSegment:1418,IfcPipeSegmentType:1419,IfcPixelTexture:1420,IfcPlacement:1421,IfcPlanarBox:1422,IfcPlanarExtent:1423,IfcPlane:1424,IfcPlate:1425,IfcPlateStandardCase:1426,IfcPlateType:1427,IfcPoint:1428,IfcPointOnCurve:1429,IfcPointOnSurface:1430,IfcPolygonalBoundedHalfSpace:1431,IfcPolygonalFaceSet:1432,IfcPolyline:1433,IfcPolyLoop:1434,IfcPort:1435,IfcPostalAddress:1436,IfcPreDefinedColour:1437,IfcPreDefinedCurveFont:1438,IfcPreDefinedItem:1439,IfcPreDefinedProperties:1440,IfcPreDefinedPropertySet:1441,IfcPreDefinedTextFont:1442,IfcPresentationItem:1443,IfcPresentationLayerAssignment:1444,IfcPresentationLayerWithStyle:1445,IfcPresentationStyle:1446,IfcPresentationStyleAssignment:1447,IfcProcedure:1448,IfcProcedureType:1449,IfcProcess:1450,IfcProduct:1451,IfcProductDefinitionShape:1452,IfcProductRepresentation:1453,IfcProfileDef:1454,IfcProfileProperties:1455,IfcProject:1456,IfcProjectedCRS:1457,IfcProjectionElement:1458,IfcProjectLibrary:1459,IfcProjectOrder:1460,IfcProperty:1461,IfcPropertyAbstraction:1462,IfcPropertyBoundedValue:1463,IfcPropertyDefinition:1464,IfcPropertyDependencyRelationship:1465,IfcPropertyEnumeratedValue:1466,IfcPropertyEnumeration:1467,IfcPropertyListValue:1468,IfcPropertyReferenceValue:1469,IfcPropertySet:1470,IfcPropertySetDefinition:1471,IfcPropertySetTemplate:1472,IfcPropertySingleValue:1473,IfcPropertyTableValue:1474,IfcPropertyTemplate:1475,IfcPropertyTemplateDefinition:1476,IfcProtectiveDevice:1477,IfcProtectiveDeviceTrippingUnit:1478,IfcProtectiveDeviceTrippingUnitType:1479,IfcProtectiveDeviceType:1480,IfcProxy:1481,IfcPump:1482,IfcPumpType:1483,IfcQuantityArea:1484,IfcQuantityCount:1485,IfcQuantityLength:1486,IfcQuantitySet:1487,IfcQuantityTime:1488,IfcQuantityVolume:1489,IfcQuantityWeight:1490,IfcRailing:1491,IfcRailingType:1492,IfcRamp:1493,IfcRampFlight:1494,IfcRampFlightType:1495,IfcRampType:1496,IfcRationalBSplineCurveWithKnots:1497,IfcRationalBSplineSurfaceWithKnots:1498,IfcRectangleHollowProfileDef:1499,IfcRectangleProfileDef:1500,IfcRectangularPyramid:1501,IfcRectangularTrimmedSurface:1502,IfcRecurrencePattern:1503,IfcReference:1504,IfcRegularTimeSeries:1505,IfcReinforcementBarProperties:1506,IfcReinforcementDefinitionProperties:1507,IfcReinforcingBar:1508,IfcReinforcingBarType:1509,IfcReinforcingElement:1510,IfcReinforcingElementType:1511,IfcReinforcingMesh:1512,IfcReinforcingMeshType:1513,IfcRelAggregates:1514,IfcRelAssigns:1515,IfcRelAssignsToActor:1516,IfcRelAssignsToControl:1517,IfcRelAssignsToGroup:1518,IfcRelAssignsToGroupByFactor:1519,IfcRelAssignsToProcess:1520,IfcRelAssignsToProduct:1521,IfcRelAssignsToResource:1522,IfcRelAssociates:1523,IfcRelAssociatesApproval:1524,IfcRelAssociatesClassification:1525,IfcRelAssociatesConstraint:1526,IfcRelAssociatesDocument:1527,IfcRelAssociatesLibrary:1528,IfcRelAssociatesMaterial:1529,IfcRelationship:1530,IfcRelConnects:1531,IfcRelConnectsElements:1532,IfcRelConnectsPathElements:1533,IfcRelConnectsPorts:1534,IfcRelConnectsPortToElement:1535,IfcRelConnectsStructuralActivity:1536,IfcRelConnectsStructuralMember:1537,IfcRelConnectsWithEccentricity:1538,IfcRelConnectsWithRealizingElements:1539,IfcRelContainedInSpatialStructure:1540,IfcRelCoversBldgElements:1541,IfcRelCoversSpaces:1542,IfcRelDeclares:1543,IfcRelDecomposes:1544,IfcRelDefines:1545,IfcRelDefinesByObject:1546,IfcRelDefinesByProperties:1547,IfcRelDefinesByTemplate:1548,IfcRelDefinesByType:1549,IfcRelFillsElement:1550,IfcRelFlowControlElements:1551,IfcRelInterferesElements:1552,IfcRelNests:1553,IfcRelProjectsElement:1554,IfcRelReferencedInSpatialStructure:1555,IfcRelSequence:1556,IfcRelServicesBuildings:1557,IfcRelSpaceBoundary:1558,IfcRelSpaceBoundary1stLevel:1559,IfcRelSpaceBoundary2ndLevel:1560,IfcRelVoidsElement:1561,IfcReparametrisedCompositeCurveSegment:1562,IfcRepresentation:1563,IfcRepresentationContext:1564,IfcRepresentationItem:1565,IfcRepresentationMap:1566,IfcResource:1567,IfcResourceApprovalRelationship:1568,IfcResourceConstraintRelationship:1569,IfcResourceLevelRelationship:1570,IfcResourceTime:1571,IfcRevolvedAreaSolid:1572,IfcRevolvedAreaSolidTapered:1573,IfcRightCircularCone:1574,IfcRightCircularCylinder:1575,IfcRoof:1576,IfcRoofType:1577,IfcRoot:1578,IfcRoundedRectangleProfileDef:1579,IfcSanitaryTerminal:1580,IfcSanitaryTerminalType:1581,IfcSchedulingTime:1582,IfcSeamCurve:1583,IfcSectionedSpine:1584,IfcSectionProperties:1585,IfcSectionReinforcementProperties:1586,IfcSensor:1587,IfcSensorType:1588,IfcShadingDevice:1589,IfcShadingDeviceType:1590,IfcShapeAspect:1591,IfcShapeModel:1592,IfcShapeRepresentation:1593,IfcShellBasedSurfaceModel:1594,IfcSimpleProperty:1595,IfcSimplePropertyTemplate:1596,IfcSite:1597,IfcSIUnit:1598,IfcSlab:1599,IfcSlabElementedCase:1600,IfcSlabStandardCase:1601,IfcSlabType:1602,IfcSlippageConnectionCondition:1603,IfcSolarDevice:1604,IfcSolarDeviceType:1605,IfcSolidModel:1606,IfcSpace:1607,IfcSpaceHeater:1608,IfcSpaceHeaterType:1609,IfcSpaceType:1610,IfcSpatialElement:1611,IfcSpatialElementType:1612,IfcSpatialStructureElement:1613,IfcSpatialStructureElementType:1614,IfcSpatialZone:1615,IfcSpatialZoneType:1616,IfcSphere:1617,IfcSphericalSurface:1618,IfcStackTerminal:1619,IfcStackTerminalType:1620,IfcStair:1621,IfcStairFlight:1622,IfcStairFlightType:1623,IfcStairType:1624,IfcStructuralAction:1625,IfcStructuralActivity:1626,IfcStructuralAnalysisModel:1627,IfcStructuralConnection:1628,IfcStructuralConnectionCondition:1629,IfcStructuralCurveAction:1630,IfcStructuralCurveConnection:1631,IfcStructuralCurveMember:1632,IfcStructuralCurveMemberVarying:1633,IfcStructuralCurveReaction:1634,IfcStructuralItem:1635,IfcStructuralLinearAction:1636,IfcStructuralLoad:1637,IfcStructuralLoadCase:1638,IfcStructuralLoadConfiguration:1639,IfcStructuralLoadGroup:1640,IfcStructuralLoadLinearForce:1641,IfcStructuralLoadOrResult:1642,IfcStructuralLoadPlanarForce:1643,IfcStructuralLoadSingleDisplacement:1644,IfcStructuralLoadSingleDisplacementDistortion:1645,IfcStructuralLoadSingleForce:1646,IfcStructuralLoadSingleForceWarping:1647,IfcStructuralLoadStatic:1648,IfcStructuralLoadTemperature:1649,IfcStructuralMember:1650,IfcStructuralPlanarAction:1651,IfcStructuralPointAction:1652,IfcStructuralPointConnection:1653,IfcStructuralPointReaction:1654,IfcStructuralReaction:1655,IfcStructuralResultGroup:1656,IfcStructuralSurfaceAction:1657,IfcStructuralSurfaceConnection:1658,IfcStructuralSurfaceMember:1659,IfcStructuralSurfaceMemberVarying:1660,IfcStructuralSurfaceReaction:1661,IfcStyledItem:1662,IfcStyledRepresentation:1663,IfcStyleModel:1664,IfcSubContractResource:1665,IfcSubContractResourceType:1666,IfcSubedge:1667,IfcSurface:1668,IfcSurfaceCurve:1669,IfcSurfaceCurveSweptAreaSolid:1670,IfcSurfaceFeature:1671,IfcSurfaceOfLinearExtrusion:1672,IfcSurfaceOfRevolution:1673,IfcSurfaceReinforcementArea:1674,IfcSurfaceStyle:1675,IfcSurfaceStyleLighting:1676,IfcSurfaceStyleRefraction:1677,IfcSurfaceStyleRendering:1678,IfcSurfaceStyleShading:1679,IfcSurfaceStyleWithTextures:1680,IfcSurfaceTexture:1681,IfcSweptAreaSolid:1682,IfcSweptDiskSolid:1683,IfcSweptDiskSolidPolygonal:1684,IfcSweptSurface:1685,IfcSwitchingDevice:1686,IfcSwitchingDeviceType:1687,IfcSystem:1688,IfcSystemFurnitureElement:1689,IfcSystemFurnitureElementType:1690,IfcTable:1691,IfcTableColumn:1692,IfcTableRow:1693,IfcTank:1694,IfcTankType:1695,IfcTask:1696,IfcTaskTime:1697,IfcTaskTimeRecurring:1698,IfcTaskType:1699,IfcTelecomAddress:1700,IfcTendon:1701,IfcTendonAnchor:1702,IfcTendonAnchorType:1703,IfcTendonType:1704,IfcTessellatedFaceSet:1705,IfcTessellatedItem:1706,IfcTextLiteral:1707,IfcTextLiteralWithExtent:1708,IfcTextStyle:1709,IfcTextStyleFontModel:1710,IfcTextStyleForDefinedFont:1711,IfcTextStyleTextModel:1712,IfcTextureCoordinate:1713,IfcTextureCoordinateGenerator:1714,IfcTextureMap:1715,IfcTextureVertex:1716,IfcTextureVertexList:1717,IfcTimePeriod:1718,IfcTimeSeries:1719,IfcTimeSeriesValue:1720,IfcTopologicalRepresentationItem:1721,IfcTopologyRepresentation:1722,IfcToroidalSurface:1723,IfcTransformer:1724,IfcTransformerType:1725,IfcTransportElement:1726,IfcTransportElementType:1727,IfcTrapeziumProfileDef:1728,IfcTriangulatedFaceSet:1729,IfcTrimmedCurve:1730,IfcTShapeProfileDef:1731,IfcTubeBundle:1732,IfcTubeBundleType:1733,IfcTypeObject:1734,IfcTypeProcess:1735,IfcTypeProduct:1736,IfcTypeResource:1737,IfcUnitaryControlElement:1738,IfcUnitaryControlElementType:1739,IfcUnitaryEquipment:1740,IfcUnitaryEquipmentType:1741,IfcUnitAssignment:1742,IfcUShapeProfileDef:1743,IfcValve:1744,IfcValveType:1745,IfcVector:1746,IfcVertex:1747,IfcVertexLoop:1748,IfcVertexPoint:1749,IfcVibrationIsolator:1750,IfcVibrationIsolatorType:1751,IfcVirtualElement:1752,IfcVirtualGridIntersection:1753,IfcVoidingFeature:1754,IfcWall:1755,IfcWallElementedCase:1756,IfcWallStandardCase:1757,IfcWallType:1758,IfcWasteTerminal:1759,IfcWasteTerminalType:1760,IfcWindow:1761,IfcWindowLiningProperties:1762,IfcWindowPanelProperties:1763,IfcWindowStandardCase:1764,IfcWindowStyle:1765,IfcWindowType:1766,IfcWorkCalendar:1767,IfcWorkControl:1768,IfcWorkPlan:1769,IfcWorkSchedule:1770,IfcWorkTime:1771,IfcZone:1772,IfcZShapeProfileDef:1773,typeNames:{},typeCodes:{}};function es(e,t,i){i=i||2;var r,n,o,s,a,c,l,h=t&&t.length,u=h?t[0]*i:e.length,d=ts(e,0,u,i,!0),f=[];if(!d||d.next===d.prev)return f;if(h&&(d=function(e,t,i,r){var n,o,s,a=[];for(n=0,o=t.length;n<o;n++)(s=ts(e,t[n]*r,n<o-1?t[n+1]*r:e.length,r,!1))===s.next&&(s.steiner=!0),a.push(ds(s));for(a.sort(cs),n=0;n<a.length;n++)ls(a[n],i),i=is(i,i.next);return i}(e,t,d,i)),e.length>80*i){r=o=e[0],n=s=e[1];for(var v=i;v<u;v+=i)(a=e[v])<r&&(r=a),(c=e[v+1])<n&&(n=c),a>o&&(o=a),c>s&&(s=c);l=0!==(l=Math.max(o-r,s-n))?1/l:0}return rs(d,f,i,r,n,l),f}function ts(e,t,i,r,n){var o,s;if(n===Is(e,t,i,r)>0)for(o=t;o<i;o+=r)s=Es(o,e[o],e[o+1],s);else for(o=i-r;o>=t;o-=r)s=Es(o,e[o],e[o+1],s);return s&&ys(s,s.next)&&(Ts(s),s=s.next),s}function is(e,t){if(!e)return e;t||(t=e);var i,r=e;do{if(i=!1,r.steiner||!ys(r,r.next)&&0!==ps(r.prev,r,r.next))r=r.next;else{if(Ts(r),(r=t=r.prev)===r.next)break;i=!0}}while(i||r!==t);return t}function rs(e,t,i,r,n,o,s){if(e){!s&&o&&function(e,t,i,r){var n=e;do{null===n.z&&(n.z=us(n.x,n.y,t,i,r)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==e);n.prevZ.nextZ=null,n.prevZ=null,function(e){var t,i,r,n,o,s,a,c,l=1;do{for(i=e,e=null,o=null,s=0;i;){for(s++,r=i,a=0,t=0;t<l&&(a++,r=r.nextZ);t++);for(c=l;a>0||c>0&&r;)0!==a&&(0===c||!r||i.z<=r.z)?(n=i,i=i.nextZ,a--):(n=r,r=r.nextZ,c--),o?o.nextZ=n:e=n,n.prevZ=o,o=n;i=r}o.nextZ=null,l*=2}while(s>1)}(n)}(e,r,n,o);for(var a,c,l=e;e.prev!==e.next;)if(a=e.prev,c=e.next,o?os(e,r,n,o):ns(e))t.push(a.i/i),t.push(e.i/i),t.push(c.i/i),Ts(e),e=c.next,l=c.next;else if((e=c)===l){s?1===s?rs(e=ss(is(e),t,i),t,i,r,n,o,2):2===s&&as(e,t,i,r,n,o):rs(is(e),t,i,r,n,o,1);break}}}function ns(e){var t=e.prev,i=e,r=e.next;if(ps(t,i,r)>=0)return!1;for(var n=e.next.next;n!==e.prev;){if(fs(t.x,t.y,i.x,i.y,r.x,r.y,n.x,n.y)&&ps(n.prev,n,n.next)>=0)return!1;n=n.next}return!0}function os(e,t,i,r){var n=e.prev,o=e,s=e.next;if(ps(n,o,s)>=0)return!1;for(var a=n.x>o.x?n.x>s.x?n.x:s.x:o.x>s.x?o.x:s.x,c=n.y>o.y?n.y>s.y?n.y:s.y:o.y>s.y?o.y:s.y,l=us(n.x<o.x?n.x<s.x?n.x:s.x:o.x<s.x?o.x:s.x,n.y<o.y?n.y<s.y?n.y:s.y:o.y<s.y?o.y:s.y,t,i,r),h=us(a,c,t,i,r),u=e.prevZ,d=e.nextZ;u&&u.z>=l&&d&&d.z<=h;){if(u!==e.prev&&u!==e.next&&fs(n.x,n.y,o.x,o.y,s.x,s.y,u.x,u.y)&&ps(u.prev,u,u.next)>=0)return!1;if(u=u.prevZ,d!==e.prev&&d!==e.next&&fs(n.x,n.y,o.x,o.y,s.x,s.y,d.x,d.y)&&ps(d.prev,d,d.next)>=0)return!1;d=d.nextZ}for(;u&&u.z>=l;){if(u!==e.prev&&u!==e.next&&fs(n.x,n.y,o.x,o.y,s.x,s.y,u.x,u.y)&&ps(u.prev,u,u.next)>=0)return!1;u=u.prevZ}for(;d&&d.z<=h;){if(d!==e.prev&&d!==e.next&&fs(n.x,n.y,o.x,o.y,s.x,s.y,d.x,d.y)&&ps(d.prev,d,d.next)>=0)return!1;d=d.nextZ}return!0}function ss(e,t,i){var r=e;do{var n=r.prev,o=r.next.next;!ys(n,o)&&ms(n,r,r.next,o)&&ws(n,o)&&ws(o,n)&&(t.push(n.i/i),t.push(r.i/i),t.push(o.i/i),Ts(r),Ts(r.next),r=e=o),r=r.next}while(r!==e);return is(r)}function as(e,t,i,r,n,o){var s=e;do{for(var a=s.next.next;a!==s.prev;){if(s.i!==a.i&&vs(s,a)){var c=Ps(s,a);return s=is(s,s.next),c=is(c,c.next),rs(s,t,i,r,n,o),void rs(c,t,i,r,n,o)}a=a.next}s=s.next}while(s!==e)}function cs(e,t){return e.x-t.x}function ls(e,t){if(t=function(e,t){var i,r=t,n=e.x,o=e.y,s=-Infinity;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var a=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(a<=n&&a>s){if(s=a,a===n){if(o===r.y)return r;if(o===r.next.y)return r.next}i=r.x<r.next.x?r:r.next}}r=r.next}while(r!==t);if(!i)return null;if(n===s)return i;var c,l=i,h=i.x,u=i.y,d=Infinity;r=i;do{n>=r.x&&r.x>=h&&n!==r.x&&fs(o<u?n:s,o,h,u,o<u?s:n,o,r.x,r.y)&&(c=Math.abs(o-r.y)/(n-r.x),ws(r,e)&&(c<d||c===d&&(r.x>i.x||r.x===i.x&&hs(i,r)))&&(i=r,d=c)),r=r.next}while(r!==l);return i}(e,t),t){var i=Ps(t,e);is(t,t.next),is(i,i.next)}}function hs(e,t){return ps(e.prev,e,t.prev)<0&&ps(t.next,e,e.next)<0}function us(e,t,i,r,n){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*n)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*n)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function ds(e){var t=e,i=e;do{(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next}while(t!==e);return i}function fs(e,t,i,r,n,o,s,a){return(n-s)*(t-a)-(e-s)*(o-a)>=0&&(e-s)*(r-a)-(i-s)*(t-a)>=0&&(i-s)*(o-a)-(n-s)*(r-a)>=0}function vs(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&ms(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}(e,t)&&(ws(e,t)&&ws(t,e)&&function(e,t){var i=e,r=!1,n=(e.x+t.x)/2,o=(e.y+t.y)/2;do{i.y>o!=i.next.y>o&&i.next.y!==i.y&&n<(i.next.x-i.x)*(o-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next}while(i!==e);return r}(e,t)&&(ps(e.prev,e,t.prev)||ps(e,t.prev,t))||ys(e,t)&&ps(e.prev,e,e.next)>0&&ps(t.prev,t,t.next)>0)}function ps(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function ys(e,t){return e.x===t.x&&e.y===t.y}function ms(e,t,i,r){var n=bs(ps(e,t,i)),o=bs(ps(e,t,r)),s=bs(ps(i,r,e)),a=bs(ps(i,r,t));return n!==o&&s!==a||!(0!==n||!gs(e,i,t))||!(0!==o||!gs(e,r,t))||!(0!==s||!gs(i,e,r))||!(0!==a||!gs(i,t,r))}function gs(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function bs(e){return e>0?1:e<0?-1:0}function ws(e,t){return ps(e.prev,e,e.next)<0?ps(e,t,e.next)>=0&&ps(e,e.prev,t)>=0:ps(e,t,e.prev)<0||ps(e,e.next,t)<0}function Ps(e,t){var i=new _s(e.i,e.x,e.y),r=new _s(t.i,t.x,t.y),n=e.next,o=t.prev;return e.next=t,t.prev=e,i.next=n,n.prev=i,r.next=i,i.prev=r,o.next=r,r.prev=o,r}function Es(e,t,i,r){var n=new _s(e,t,i);return r?(n.next=r.next,n.prev=r,r.next.prev=n,r.next=n):(n.prev=n,n.next=n),n}function Ts(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function _s(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Is(e,t,i,r){for(var n=0,o=t,s=i-r;o<i;o+=r)n+=(e[s]-e[o])*(e[o+1]+e[s+1]),s=o;return n}es.deviation=function(e,t,i,r){var n=t&&t.length,o=Math.abs(Is(e,0,n?t[0]*i:e.length,i));if(n)for(var s=0,a=t.length;s<a;s++)o-=Math.abs(Is(e,t[s]*i,s<a-1?t[s+1]*i:e.length,i));var c=0;for(s=0;s<r.length;s+=3){var l=r[s]*i,h=r[s+1]*i,u=r[s+2]*i;c+=Math.abs((e[l]-e[u])*(e[h+1]-e[l+1])-(e[l]-e[h])*(e[u+1]-e[l+1]))}return 0===o&&0===c?0:Math.abs((c-o)/o)},es.flatten=function(e){for(var t=e[0][0].length,i={vertices:[],holes:[],dimensions:t},r=0,n=0;n<e.length;n++){for(var o=0;o<e[n].length;o++)for(var s=0;s<t;s++)i.vertices.push(e[n][o][s]);n>0&&i.holes.push(r+=e[n-1].length)}return i};var xs=bt(),Ss=wt(),Ms=wt(),Os=wt();function Rs(e,t,i){for(var r=[],n=t.scale||wt([1,1,1]),o=t.translate||wt([0,0,0]),s=0,a=0;s<e.length;s++,a+=3){var c=e[s][0]*n[0]+o[0],l=e[s][1]*n[1]+o[1],h=e[s][2]*n[2]+o[2];r.push(i?[c,h,l]:[c,l,h])}return r}function js(e,t,i){if(e.dataModel&&e.dataModel.createObject({id:i,name:t.type+" : "+i,type:0|Qo[t.type],parent:t.parents?t.parents[0]:null}),e.sceneModel){if(!(t.geometry&&t.geometry.length>0))return;for(var r=[],n=0,o=t.geometry.length;n<o;n++){var s=t.geometry[n],a=void 0,c=void 0,l=e.fileData.appearance;if(l){var h=l.materials;if(h){var u=s.material;if(u){var d=Object.keys(u);if(d.length>0){var f=u[d[0]];if(void 0!==f.value)a=h[f.value];else{var v=f.values;if(v){c=[];for(var p=0,y=v.length;p<y;p++)c.push(h[v[n]])}}}}}}c?As(e,s,c,r):Bs(e,s,a,r)}r.length>0&&e.sceneModel.createObject({id:i,meshIds:r})}}function Ds(e,t,i){t.parents&&e.dataModel.createRelationship({relatingObjectId:t.parents[0],relatedObjectId:i,type:Wo})}function As(e,t,i,r){switch(t.type){case"MultiPoint":case"MultiLineString":break;case"MultiSurface":case"CompositeSurface":Cs(e,i,t.boundaries,r);break;case"Solid":for(var n=t.boundaries,o=0;o<n.length;o++)Cs(e,i,n[o],r);break;case"MultiSolid":case"CompositeSolid":for(var s=t.boundaries,a=0;a<s.length;a++)for(var c=0;c<s[a].length;c++)Cs(e,i,s[a][c],r)}}function Cs(e,t,i,r){for(var n=e.vertices,o=e.sceneModel,s=0;s<i.length;s++){for(var a=i[s],c=t[s]||{diffuseColor:[.8,.8,.8],transparency:1},l=[],h=[],u=[],d={positions:[],indices:[]},f=0;f<a.length;f++){l.length>0&&h.push(l.length);var v=Ls(e,a[f],u,d);l.push.apply(l,v)}if(3===l.length)d.indices.push(l[0]),d.indices.push(l[1]),d.indices.push(l[2]);else if(l.length>3){for(var p=[],y=0;y<l.length;y++)p.push({x:n[u[l[y]]][0],y:n[u[l[y]]][1],z:n[u[l[y]]][2]});for(var m=Fs(p,wt()),g=[],b=0;b<p.length;b++)Us(p[b],m,xs),g.unshift(xs[0]),g.unshift(xs[1]);for(var w=es(g,h,2),P=0;P<w.length;P+=3)d.indices.unshift(l[w[P]]),d.indices.unshift(l[w[P+1]]),d.indices.unshift(l[w[P+2]])}var E=""+e.nextId++;o.createGeometry({id:E,primitive:qe,positions:d.positions,indices:d.indices});var T=""+e.nextId++;o.createMesh({id:T,geometryId:E,color:c&&c.diffuseColor?c.diffuseColor:[.8,.8,.8],opacity:c&&void 0!==c.transparency?1-c.transparency:1}),r.push(T)}}function Bs(e,t,i,r){var n=e.sceneModel,o=[],s={positions:[],indices:[]};switch(t.type){case"MultiPoint":case"MultiLineString":break;case"MultiSurface":case"CompositeSurface":ks(e,t.boundaries,o,s);break;case"Solid":for(var a=t.boundaries,c=0;c<a.length;c++)ks(e,a[c],o,s);break;case"MultiSolid":case"CompositeSolid":for(var l=t.boundaries,h=0;h<l.length;h++)for(var u=0;u<l[h].length;u++)ks(e,l[h][u],o,s)}if(s.positions.length>0&&s.indices.length>0){var d=""+e.nextId++;n.createGeometry({id:d,primitive:qe,positions:s.positions,indices:s.indices});var f=""+e.nextId++;n.createMesh({id:f,geometryId:d,color:i&&i.diffuseColor?i.diffuseColor:[.8,.8,.8],opacity:1}),r.push(f)}}function ks(e,t,i,r){for(var n=e.vertices,o=0;o<t.length;o++){for(var s=[],a=[],c=0;c<t[o].length;c++){s.length>0&&a.push(s.length);var l=Ls(e,t[o][c],i,r);s.push.apply(s,l)}if(3===s.length)r.indices.push(s[0]),r.indices.push(s[1]),r.indices.push(s[2]);else if(s.length>3){for(var h=[],u=0;u<s.length;u++)h.push({x:n[i[s[u]]][0],y:n[i[s[u]]][1],z:n[i[s[u]]][2]});for(var d=Fs(h,wt()),f=[],v=0;v<h.length;v++)Us(h[v],d,xs),f.unshift(xs[0]),f.unshift(xs[1]);for(var p=es(f,a,2),y=0;y<p.length;y+=3)r.indices.unshift(s[p[y]]),r.indices.unshift(s[p[y+1]]),r.indices.unshift(s[p[y+2]])}}}function Ls(e,t,i,r){for(var n=e.vertices,o=[],s=0,a=t.length;s<a;s++){var c=t[s];if(i.includes(c)){var l=i.indexOf(c);o.push(l)}else r.positions.push(n[c][0]),r.positions.push(n[c][1]),r.positions.push(n[c][2]),o.push(i.length),i.push(c)}return o}function Fs(e,t){for(var i=0;i<e.length;i++){var r=i+1;r===e.length&&(r=0),t[0]+=(e[i].y-e[r].y)*(e[i].z+e[r].z),t[1]+=(e[i].z-e[r].z)*(e[i].x+e[r].x),t[2]+=(e[i].x-e[r].x)*(e[i].y+e[r].y)}return Yt(t)}function Us(e,t,i){var r=Ss,n=Ms,o=Os;r[0]=e.x,r[1]=e.y,r[2]=e.z,n[0]=t.x,n[1]=t.y,n[2]=t.z,o[0]=1.1,o[1]=1.1,o[2]=1.1,Ut(Mt(o,n))<.01&&(o[0]+=1,o[1]+=2,o[2]+=3);var s=_t(n,gt(o,n),wt());o[0]-=s[0],o[1]-=s[1],o[2]-=s[2],Yt(o);var a=At(n,o,wt()),c=gt(r,o),l=gt(r,a);i[0]=c,i[1]=l}var Ns,Gs={__proto__:null,loadCityJSON:function(e,t){if(void 0===t&&(t={rotateX:!1}),e.sceneModel){if(e.sceneModel.destroyed)return Promise.reject(new he("SceneModel already destroyed"));if(e.sceneModel.built)return Promise.reject(new he("SceneModel already built"))}if(e.dataModel){if(e.dataModel.destroyed)return Promise.reject(new he("DataModel already destroyed"));if(e.dataModel.built)return Promise.reject(new he("DataModel already built"))}var i=e.fileData;return function(e){var t=e.fileData.CityObjects;for(var i in t)js(e,t[i],i);if(e.dataModel)for(var r in t)Ds(e,t[r],r)}({fileData:i,vertices:i.transform&&e.sceneModel?Rs(i.vertices,i.transform,t.rotateX):i.vertices,sceneModel:e.sceneModel,dataModel:e.dataModel,nextId:0}),Promise.resolve()}},Vs={__proto__:null,loadDotBIM:function(e,t){return void 0===t&&(t={}),new Promise(function(i,r){if(e.sceneModel.destroyed)throw new he("SceneModel already destroyed");if(e.sceneModel.built)throw new he("SceneModel already built");if(e.dataModel){if(e.dataModel.destroyed)throw new he("DataModel already destroyed");if(e.dataModel.built)throw new he("DataModel already built")}!function(e){for(var t=e.fileData,i=t.meshes,r=0,n=i.length;r<n;r++){var o=i[r],s=e.sceneModel.createGeometry({id:o.mesh_id,primitive:qe,positions:o.coordinates,indices:o.indices});s instanceof he&&e.error("[SceneModel.createGeometry]: "+s.message)}for(var a=t.elements,c=0,l=a.length;c<l;c++){var h=a[c],u=""+h.guid;if(e.sceneModel){var d=u+"-mesh-"+c,f=e.sceneModel.createMesh({id:d,geometryId:h.mesh_id,baseColor:h.color});if(f instanceof he){e.error("[SceneModel.createMesh]: "+f.message);continue}var v=e.sceneModel.createObject({id:u,meshIds:[d]});if(v instanceof he){e.error("[SceneModel.createObject]: "+v.message);continue}}if(e.dataModel&&!e.dataModel.objects[h.guid]){var p=e.dataModel.createObject({id:u,type:h.type});p instanceof he&&e.error("[SceneModel.createObject]: "+p.message)}}}({fileData:e.fileData,sceneModel:e.sceneModel,dataModel:e.dataModel,nextId:0,error:t.error||function(e){}}),i()})}},Hs=/*#__PURE__*/d("rendererViewObject"),Xs=/*#__PURE__*/d("state"),Ws=/*#__PURE__*/function(){function e(e,t,i){this.id=void 0,this.layer=void 0,this.sceneObject=void 0,Object.defineProperty(this,Hs,{writable:!0,value:void 0}),Object.defineProperty(this,Xs,{writable:!0,value:void 0}),this.id=t.id,this.layer=e,this.sceneObject=t,f(this,Hs)[Hs]=i,f(this,Xs)[Xs]={visible:!0,culled:!1,pickable:!0,clippable:!0,collidable:!0,xrayed:!1,selected:!1,highlighted:!1,edges:!1,colorize:new Float32Array(4),colorized:!1,opacityUpdated:!1},f(this,Hs)[Hs].setVisible(this.layer.view.viewIndex,f(this,Xs)[Xs].visible),this.layer.objectVisibilityUpdated(this,f(this,Xs)[Xs].visible,!0)}return e.prototype._destroy=function(){f(this,Xs)[Xs].visible&&this.layer.objectVisibilityUpdated(this,!1,!1),f(this,Xs)[Xs].xrayed&&this.layer.objectXRayedUpdated(this,!1),f(this,Xs)[Xs].selected&&this.layer.objectSelectedUpdated(this,!1),f(this,Xs)[Xs].highlighted&&this.layer.objectHighlightedUpdated(this,!1),f(this,Xs)[Xs].colorized&&this.layer.objectColorizeUpdated(this,!1),f(this,Xs)[Xs].opacityUpdated&&this.layer.objectOpacityUpdated(this,!1),this.layer.redraw()},i(e,[{key:"aabb",get:function(){return this.sceneObject.aabb}},{key:"visible",get:function(){return f(this,Xs)[Xs].visible},set:function(e){e!==f(this,Xs)[Xs].visible&&(f(this,Xs)[Xs].visible=e,f(this,Hs)[Hs].setVisible(this.layer.view.viewIndex,e),this.layer.objectVisibilityUpdated(this,e,!0),this.layer.redraw())}},{key:"xrayed",get:function(){return f(this,Xs)[Xs].xrayed},set:function(e){f(this,Xs)[Xs].xrayed!==e&&(f(this,Xs)[Xs].xrayed=e,f(this,Hs)[Hs].setXRayed(this.layer.view.viewIndex,e),this.layer.objectXRayedUpdated(this,e),this.layer.redraw())}},{key:"edges",get:function(){return f(this,Xs)[Xs].edges},set:function(e){f(this,Xs)[Xs].edges!==e&&(f(this,Xs)[Xs].edges=e,f(this,Hs)[Hs].setEdges(this.layer.view.viewIndex,e),this.layer.redraw())}},{key:"highlighted",get:function(){return f(this,Xs)[Xs].highlighted},set:function(e){e!==f(this,Xs)[Xs].highlighted&&(f(this,Xs)[Xs].highlighted=e,f(this,Hs)[Hs].setHighlighted(this.layer.view.viewIndex,e),this.layer.objectHighlightedUpdated(this,e),this.layer.redraw())}},{key:"selected",get:function(){return f(this,Xs)[Xs].selected},set:function(e){e!==f(this,Xs)[Xs].selected&&(f(this,Xs)[Xs].selected=e,f(this,Hs)[Hs].setSelected(this.layer.view.viewIndex,e),this.layer.objectSelectedUpdated(this,e),this.layer.redraw())}},{key:"culled",get:function(){return f(this,Xs)[Xs].culled},set:function(e){e!==f(this,Xs)[Xs].culled&&(f(this,Xs)[Xs].culled=e,this.layer.redraw())}},{key:"clippable",get:function(){return f(this,Xs)[Xs].clippable},set:function(e){e!==f(this,Xs)[Xs].clippable&&(f(this,Xs)[Xs].clippable=e,this.layer.redraw())}},{key:"collidable",get:function(){return f(this,Xs)[Xs].collidable},set:function(e){e!==f(this,Xs)[Xs].collidable&&(f(this,Xs)[Xs].collidable=e)}},{key:"pickable",get:function(){return f(this,Xs)[Xs].pickable},set:function(e){f(this,Xs)[Xs].pickable!==e&&(f(this,Xs)[Xs].pickable=e)}},{key:"colorize",get:function(){return f(this,Xs)[Xs].colorize},set:function(e){var t=f(this,Xs)[Xs].colorize;e?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=1,t[1]=1,t[2]=1),f(this,Xs)[Xs].colorized=!!e,this.layer.objectColorizeUpdated(this,f(this,Xs)[Xs].colorized),this.layer.redraw()}},{key:"opacity",get:function(){return f(this,Xs)[Xs].colorize[3]},set:function(e){var t=f(this,Xs)[Xs].colorize;f(this,Xs)[Xs].opacityUpdated=null!=e,t[3]=f(this,Xs)[Xs].opacityUpdated?e:1,this.layer.objectOpacityUpdated(this,f(this,Xs)[Xs].opacityUpdated),this.layer.redraw()}}]),e}(),Ys=/*#__PURE__*/d("state"),Ks=/*#__PURE__*/function(e){function t(t,i){var r;return void 0===i&&(i={}),(r=e.call(this,t,i)||this).view=void 0,r.onPos=void 0,r.onDir=void 0,r.onActive=void 0,Object.defineProperty(c(r),Ys,{writable:!0,value:void 0}),r.view=t,f(c(r),Ys)[Ys]={active:!1!==i.active,pos:new Float64Array(i.pos||[0,0,0]),dir:new Float32Array(i.pos||[0,0,-1]),dist:0},r.onPos=new p(new te.EventDispatcher),r.onDir=new p(new te.EventDispatcher),r.onActive=new p(new te.EventDispatcher),r}r(t,e);var n=t.prototype;return n.flipDir=function(){var e=f(this,Ys)[Ys].dir;e[0]*=-1,e[1]*=-1,e[2]*=-1,f(this,Ys)[Ys].dist=-gt(f(this,Ys)[Ys].pos,f(this,Ys)[Ys].dir),this.onDir.dispatch(this,f(this,Ys)[Ys].dir),this.view.redraw()},n.destroy=function(){this.onPos.clear(),this.onDir.clear(),e.prototype.destroy.call(this)},i(t,[{key:"active",get:function(){return f(this,Ys)[Ys].active},set:function(e){f(this,Ys)[Ys].active!==e&&(f(this,Ys)[Ys].active=e,this.view.redraw(),this.onActive.dispatch(this,f(this,Ys)[Ys].active))}},{key:"pos",get:function(){return f(this,Ys)[Ys].pos},set:function(e){f(this,Ys)[Ys].pos.set(e),f(this,Ys)[Ys].dist=-gt(f(this,Ys)[Ys].pos,f(this,Ys)[Ys].dir),this.onPos.dispatch(this,f(this,Ys)[Ys].pos)}},{key:"dir",get:function(){return f(this,Ys)[Ys].dir},set:function(e){f(this,Ys)[Ys].dir.set(e),f(this,Ys)[Ys].dist=-gt(f(this,Ys)[Ys].pos,f(this,Ys)[Ys].dir),this.view.redraw(),this.onDir.dispatch(this,f(this,Ys)[Ys].dir)}},{key:"dist",get:function(){return f(this,Ys)[Ys].dist}}]),t}(ae),zs=((Ns={})[4e5]={abbrev:"m"},Ns[400001]={abbrev:"cm"},Ns[400002]={abbrev:"mm"},Ns[400003]={abbrev:"yd"},Ns[400004]={abbrev:"ft"},Ns[400005]={abbrev:"in"},Ns),qs=/*#__PURE__*/d("units"),Zs=/*#__PURE__*/d("scale"),Qs=/*#__PURE__*/d("origin"),Js=/*#__PURE__*/function(e){function t(t,i){var r;return void 0===i&&(i={units:$e,scale:1,origin:[1,1,1]}),r=e.call(this,t,i)||this,Object.defineProperty(c(r),qs,{writable:!0,value:void 0}),Object.defineProperty(c(r),Zs,{writable:!0,value:void 0}),Object.defineProperty(c(r),Qs,{writable:!0,value:void 0}),r.onUnits=void 0,r.onScale=void 0,r.onOrigin=void 0,r.onUnits=new p(new te.EventDispatcher),r.onScale=new p(new te.EventDispatcher),r.onOrigin=new p(new te.EventDispatcher),f(c(r),qs)[qs]=$e,f(c(r),Zs)[Zs]=1,f(c(r),Qs)[Qs]=wt([0,0,0]),r.units=i.units,r.scale=i.scale,r.origin=i.origin,r}r(t,e);var n=t.prototype;return n.worldToRealPos=function(e,t){return void 0===t&&(t=wt()),t[0]=f(this,Qs)[Qs][0]+f(this,Zs)[Zs]*e[0],t[1]=f(this,Qs)[Qs][1]+f(this,Zs)[Zs]*e[1],t[2]=f(this,Qs)[Qs][2]+f(this,Zs)[Zs]*e[2],t},n.realToWorldPos=function(e,t){return void 0===t&&(t=wt()),t[0]=(e[0]-f(this,Qs)[Qs][0])/f(this,Zs)[Zs],t[1]=(e[1]-f(this,Qs)[Qs][1])/f(this,Zs)[Zs],t[2]=(e[2]-f(this,Qs)[Qs][2])/f(this,Zs)[Zs],t},n.destroy=function(){e.prototype.destroy.call(this),this.onUnits.clear(),this.onScale.clear(),this.onOrigin.clear()},i(t,[{key:"unitsInfo",get:function(){return zs}},{key:"units",get:function(){return f(this,qs)[qs]},set:function(e){e||(e=$e),zs[e]||(this.error("Unsupported value for 'units': "+e+" defaulting to MetersUnit"),e=$e),f(this,qs)[qs]=e,this.onUnits.dispatch(this,f(this,qs)[qs])}},{key:"scale",get:function(){return f(this,Zs)[Zs]},set:function(e){(e=e||1)<=0?this.error("scale value should be larger than zero"):(f(this,Zs)[Zs]=e,this.onScale.dispatch(this,f(this,Zs)[Zs]))}},{key:"origin",get:function(){return f(this,Qs)[Qs]},set:function(e){if(!e)return f(this,Qs)[Qs][0]=0,f(this,Qs)[Qs][1]=0,void(f(this,Qs)[Qs][2]=0);f(this,Qs)[Qs][0]=e[0],f(this,Qs)[Qs][1]=e[1],f(this,Qs)[Qs][2]=e[2],this.onOrigin.dispatch(this,f(this,Qs)[Qs])}}]),t}(ae),$s=/*#__PURE__*/d("state"),ea=/*#__PURE__*/function(e){function t(t,i){var r;return(r=e.call(this,t,i)||this).view=void 0,Object.defineProperty(c(r),$s,{writable:!0,value:void 0}),r.view=t,f(c(r),$s)[$s]={renderModes:[Je],enabled:!1!==i.enabled,kernelRadius:i.kernelRadius||100,intensity:void 0!==i.intensity?i.intensity:.15,bias:void 0!==i.bias?i.bias:.5,scale:void 0!==i.scale?i.scale:1,minResolution:void 0!==i.minResolution?i.minResolution:0,numSamples:void 0!==i.numSamples?i.numSamples:10,blur:!!i.blur,blendCutoff:void 0!==i.blendCutff?i.blendCutoff:.3,blendFactor:void 0!==i.blendFactor?i.blendFactor:1},r}return r(t,e),t.prototype.destroy=function(){e.prototype.destroy.call(this)},i(t,[{key:"renderModes",get:function(){return f(this,$s)[$s].renderModes},set:function(e){f(this,$s)[$s].renderModes=e,this.view.redraw()}},{key:"supported",get:function(){return this.view.viewer.renderer.getSAOSupported()}},{key:"enabled",get:function(){return f(this,$s)[$s].enabled},set:function(e){e=!!e,f(this,$s)[$s].enabled!==e&&(f(this,$s)[$s].enabled=e,this.view.redraw())}},{key:"possible",get:function(){if(!this.supported)return!1;if(!f(this,$s)[$s].enabled)return!1;var e=this.view.camera.projectionType;return e!==rt&&e!==it}},{key:"kernelRadius",get:function(){return f(this,$s)[$s].kernelRadius},set:function(e){null==e&&(e=100),f(this,$s)[$s].kernelRadius!==e&&(f(this,$s)[$s].kernelRadius=e,this.view.redraw())}},{key:"intensity",get:function(){return f(this,$s)[$s].intensity},set:function(e){null==e&&(e=.15),f(this,$s)[$s].intensity!==e&&(f(this,$s)[$s].intensity=e,this.view.redraw())}},{key:"bias",get:function(){return f(this,$s)[$s].bias},set:function(e){null==e&&(e=.5),f(this,$s)[$s].bias!==e&&(f(this,$s)[$s].bias=e,this.view.redraw())}},{key:"scale",get:function(){return f(this,$s)[$s].scale},set:function(e){null==e&&(e=1),f(this,$s)[$s].scale!==e&&(f(this,$s)[$s].scale=e,this.view.redraw())}},{key:"minResolution",get:function(){return f(this,$s)[$s].minResolution},set:function(e){null==e&&(e=0),f(this,$s)[$s].minResolution!==e&&(f(this,$s)[$s].minResolution=e,this.view.redraw())}},{key:"numSamples",get:function(){return f(this,$s)[$s].numSamples},set:function(e){null==e&&(e=10),f(this,$s)[$s].numSamples!==e&&(f(this,$s)[$s].numSamples=e,this.view.redraw())}},{key:"blur",get:function(){return f(this,$s)[$s].blur},set:function(e){e=!1!==e,f(this,$s)[$s].blur!==e&&(f(this,$s)[$s].blur=e,this.view.redraw())}},{key:"blendCutoff",get:function(){return f(this,$s)[$s].blendCutoff},set:function(e){null==e&&(e=.3),f(this,$s)[$s].blendCutoff!==e&&(f(this,$s)[$s].blendCutoff=e,this.view.redraw())}},{key:"blendFactor",get:function(){return f(this,$s)[$s].blendFactor},set:function(e){null==e&&(e=1),f(this,$s)[$s].blendFactor!==e&&(f(this,$s)[$s].blendFactor=e,this.view.redraw())}}]),t}(ae),ta=/*#__PURE__*/d("state"),ia=/*#__PURE__*/function(e){function t(t,i){var r;return void 0===i&&(i={lineWidth:1}),(r=e.call(this,t,i)||this).view=void 0,Object.defineProperty(c(r),ta,{writable:!0,value:void 0}),r.view=t,f(c(r),ta)[ta]={lineWidth:null!=i.lineWidth?i.lineWidth:1},r}return r(t,e),i(t,[{key:"lineWidth",get:function(){return f(this,ta)[ta].lineWidth},set:function(e){f(this,ta)[ta].lineWidth=e||1,this.view.redraw()}}]),t}(ae),ra=/*#__PURE__*/d("numObjects"),na=/*#__PURE__*/d("objectIds"),oa=/*#__PURE__*/d("numVisibleObjects"),sa=/*#__PURE__*/d("visibleObjectIds"),aa=/*#__PURE__*/d("numXRayedObjects"),ca=/*#__PURE__*/d("xrayedObjectIds"),la=/*#__PURE__*/d("numHighlightedObjects"),ha=/*#__PURE__*/d("highlightedObjectIds"),ua=/*#__PURE__*/d("numSelectedObjects"),da=/*#__PURE__*/d("selectedObjectIds"),fa=/*#__PURE__*/d("numColorizedObjects"),va=/*#__PURE__*/d("colorizedObjectIds"),pa=/*#__PURE__*/d("numOpacityObjects"),ya=/*#__PURE__*/d("opacityObjectIds"),ma=/*#__PURE__*/d("qualityRender"),ga=/*#__PURE__*/d("initViewObjects"),ba=/*#__PURE__*/d("createViewObjects"),wa=/*#__PURE__*/d("destroyViewObjects"),Pa=/*#__PURE__*/function(e){function t(t){var i;return i=e.call(this,t.view,t)||this,Object.defineProperty(c(i),wa,{value:_a}),Object.defineProperty(c(i),ba,{value:Ta}),Object.defineProperty(c(i),ga,{value:Ea}),i.objects=void 0,i.visibleObjects=void 0,i.xrayedObjects=void 0,i.highlightedObjects=void 0,i.selectedObjects=void 0,i.colorizedObjects=void 0,i.opacityObjects=void 0,i.autoDestroy=void 0,i.onObjectVisibility=void 0,Object.defineProperty(c(i),ra,{writable:!0,value:void 0}),Object.defineProperty(c(i),na,{writable:!0,value:void 0}),Object.defineProperty(c(i),oa,{writable:!0,value:void 0}),Object.defineProperty(c(i),sa,{writable:!0,value:void 0}),Object.defineProperty(c(i),aa,{writable:!0,value:void 0}),Object.defineProperty(c(i),ca,{writable:!0,value:void 0}),Object.defineProperty(c(i),la,{writable:!0,value:void 0}),Object.defineProperty(c(i),ha,{writable:!0,value:void 0}),Object.defineProperty(c(i),ua,{writable:!0,value:void 0}),Object.defineProperty(c(i),da,{writable:!0,value:void 0}),Object.defineProperty(c(i),fa,{writable:!0,value:void 0}),Object.defineProperty(c(i),va,{writable:!0,value:void 0}),Object.defineProperty(c(i),pa,{writable:!0,value:void 0}),Object.defineProperty(c(i),ya,{writable:!0,value:void 0}),Object.defineProperty(c(i),ma,{writable:!0,value:void 0}),i.gammaOutput=void 0,i.id=t.id,i.viewer=t.viewer,i.view=t.view,i.objects={},i.visibleObjects={},i.xrayedObjects={},i.highlightedObjects={},i.selectedObjects={},i.colorizedObjects={},i.opacityObjects={},i.autoDestroy=!1!==t.autoDestroy,f(c(i),ra)[ra]=0,f(c(i),oa)[oa]=0,f(c(i),aa)[aa]=0,f(c(i),la)[la]=0,f(c(i),ua)[ua]=0,f(c(i),fa)[fa]=0,f(c(i),pa)[pa]=0,f(c(i),ma)[ma]=!!t.qualityRender,i.onObjectVisibility=new p(new te.EventDispatcher),f(c(i),ga)[ga](),i}r(t,e);var n=t.prototype;return n.registerViewObject=function(e){this.objects[e.id]=e,f(this,ra)[ra]++,f(this,na)[na]=null},n.deregisterViewObject=function(e){delete this.objects[e.id],delete this.visibleObjects[e.id],delete this.xrayedObjects[e.id],delete this.highlightedObjects[e.id],delete this.selectedObjects[e.id],delete this.colorizedObjects[e.id],delete this.opacityObjects[e.id],f(this,ra)[ra]--,f(this,na)[na]=null},n.redraw=function(){this.viewer.renderer.setImageDirty(this.view.viewIndex)},n.objectVisibilityUpdated=function(e,t,i){void 0===i&&(i=!0),t?(this.visibleObjects[e.id]=e,f(this,oa)[oa]++):(delete this.visibleObjects[e.id],f(this,oa)[oa]--),f(this,sa)[sa]=null,i&&this.onObjectVisibility.dispatch(this,e),this.view.objectVisibilityUpdated(e,t,i)},n.objectXRayedUpdated=function(e,t){t?(this.xrayedObjects[e.id]=e,f(this,aa)[aa]++):(delete this.xrayedObjects[e.id],f(this,aa)[aa]--),f(this,ca)[ca]=null,this.view.objectXRayedUpdated(e,t)},n.objectHighlightedUpdated=function(e,t){t?(this.highlightedObjects[e.id]=e,f(this,la)[la]++):(delete this.highlightedObjects[e.id],f(this,la)[la]--),f(this,ha)[ha]=null,this.view.objectHighlightedUpdated(e,t)},n.objectSelectedUpdated=function(e,t){t?(this.selectedObjects[e.id]=e,f(this,ua)[ua]++):(delete this.selectedObjects[e.id],f(this,ua)[ua]--),f(this,da)[da]=null,this.view.objectSelectedUpdated(e,t)},n.objectColorizeUpdated=function(e,t){t?(this.colorizedObjects[e.id]=e,f(this,fa)[fa]++):(delete this.colorizedObjects[e.id],f(this,fa)[fa]--),f(this,va)[va]=null,this.view.objectColorizeUpdated(e,t)},n.objectOpacityUpdated=function(e,t){t?(this.opacityObjects[e.id]=e,f(this,pa)[pa]++):(delete this.opacityObjects[e.id],f(this,pa)[pa]--),f(this,ya)[ya]=null,this.view.objectOpacityUpdated(e,t)},n.setObjectsVisible=function(e,t){return this.withObjects(e,function(e){var i=e.visible!==t;return e.visible=t,i})},n.setObjectsCollidable=function(e,t){return this.withObjects(e,function(e){var i=e.collidable!==t;return e.collidable=t,i})},n.setObjectsCulled=function(e,t){return this.withObjects(e,function(e){var i=e.culled!==t;return e.culled=t,i})},n.setObjectsSelected=function(e,t){return this.withObjects(e,function(e){var i=e.selected!==t;return e.selected=t,i})},n.setObjectsHighlighted=function(e,t){return this.withObjects(e,function(e){var i=e.highlighted!==t;return e.highlighted=t,i})},n.setObjectsXRayed=function(e,t){return this.withObjects(e,function(e){var i=e.xrayed!==t;return i&&(e.xrayed=t),i})},n.setObjectsColorized=function(e,t){return this.withObjects(e,function(e){e.colorize=t})},n.setObjectsOpacity=function(e,t){return this.withObjects(e,function(e){var i=e.opacity!==t;return i&&(e.opacity=t),i})},n.setObjectsPickable=function(e,t){return this.withObjects(e,function(e){var i=e.pickable!==t;return i&&(e.pickable=t),i})},n.setObjectsClippable=function(e,t){return this.withObjects(e,function(e){var i=e.clippable!==t;return i&&(e.clippable=t),i})},n.withObjects=function(e,t){for(var i=!1,r=0,n=e.length;r<n;r++){var o=this.objects[e[r]];o&&(i=t(o)||i)}return i},n.destroy=function(){e.prototype.destroy.call(this)},i(t,[{key:"gammaFactor",get:function(){return 1}},{key:"qualityRender",get:function(){return f(this,ma)[ma]},set:function(e){f(this,ma)[ma]!==e&&(f(this,ma)[ma]=e,this.redraw())}},{key:"numObjects",get:function(){return f(this,ra)[ra]}},{key:"objectIds",get:function(){return f(this,na)[na]||(f(this,na)[na]=Object.keys(this.objects)),f(this,na)[na]}},{key:"numVisibleObjects",get:function(){return f(this,oa)[oa]}},{key:"visibleObjectIds",get:function(){return f(this,sa)[sa]||(f(this,sa)[sa]=Object.keys(this.visibleObjects)),f(this,sa)[sa]}},{key:"numXRayedObjects",get:function(){return f(this,aa)[aa]}},{key:"xrayedObjectIds",get:function(){return f(this,ca)[ca]||(f(this,ca)[ca]=Object.keys(this.xrayedObjects)),f(this,ca)[ca]}},{key:"numHighlightedObjects",get:function(){return f(this,la)[la]}},{key:"highlightedObjectIds",get:function(){return f(this,ha)[ha]||(f(this,ha)[ha]=Object.keys(this.highlightedObjects)),f(this,ha)[ha]}},{key:"numSelectedObjects",get:function(){return f(this,ua)[ua]}},{key:"selectedObjectIds",get:function(){return f(this,da)[da]||(f(this,da)[da]=Object.keys(this.selectedObjects)),f(this,da)[da]}},{key:"numColorizedObjects",get:function(){return f(this,fa)[fa]}},{key:"colorizedObjectIds",get:function(){return f(this,va)[va]||(f(this,va)[va]=Object.keys(this.colorizedObjects)),f(this,va)[va]}},{key:"opacityObjectIds",get:function(){return f(this,ya)[ya]||(f(this,ya)[ya]=Object.keys(this.opacityObjects)),f(this,ya)[ya]}},{key:"numOpacityObjects",get:function(){return f(this,pa)[pa]}}]),t}(ae);function Ea(){var e=this,t=this.viewer.scene.models;for(var i in t){var r=t[i];f(this,ba)[ba](r)}this.viewer.scene.onModelCreated.subscribe(function(t,i){f(e,ba)[ba](i)}),this.viewer.scene.onModelDestroyed.subscribe(function(t,i){f(e,wa)[wa](i)})}function Ta(e){var t=e.objects;for(var i in t){var r=this.viewer.renderer.rendererViewObjects[i];if(r.layerId==this.id){var n=new Ws(this,t[i],r);this.objects[n.id]=n,f(this,ra)[ra]++,f(this,na)[na]=null}}}function _a(e){var t=e.objects;for(var i in t)this.objects[t[i].id]._destroy(),f(this,ra)[ra]--,f(this,na)[na]=null}var Ia=/*#__PURE__*/d("state"),xa=/*#__PURE__*/function(e){function t(t,i){var r;return void 0===i&&(i={}),(r=e.call(this,t,i)||this).view=void 0,Object.defineProperty(c(r),Ia,{writable:!0,value:void 0}),r.view=t,f(c(r),Ia)[Ia]={fill:!!i.fill,fillColor:new Float32Array(i.fillColor||[.4,.4,.4]),fillAlpha:null!=i.fillAlpha?i.fillAlpha:.2,edges:!1!==i.edges,edgeColor:new Float32Array(i.edgeColor||[.2,.2,.2]),edgeAlpha:null!=i.edgeAlpha?i.edgeAlpha:.5,edgeWidth:null!=i.edgeWidth?i.edgeWidth:1,backfaces:!!i.backfaces},r}return r(t,e),t.prototype.destroy=function(){e.prototype.destroy.call(this)},i(t,[{key:"fill",get:function(){return f(this,Ia)[Ia].fill},set:function(e){f(this,Ia)[Ia].fill!==e&&(f(this,Ia)[Ia].fill=e,this.view.redraw())}},{key:"fillColor",get:function(){return f(this,Ia)[Ia].fillColor},set:function(e){var t=f(this,Ia)[Ia].fillColor;t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]||(t[0]=.4,t[1]=.4,t[2]=.4,this.view.redraw())}},{key:"fillAlpha",get:function(){return f(this,Ia)[Ia].fillAlpha},set:function(e){f(this,Ia)[Ia].fillAlpha!==e&&(f(this,Ia)[Ia].fillAlpha=e,this.view.redraw())}},{key:"edges",get:function(){return f(this,Ia)[Ia].edges},set:function(e){f(this,Ia)[Ia].edges!==e&&(f(this,Ia)[Ia].edges=e,this.view.redraw())}},{key:"edgeColor",get:function(){return f(this,Ia)[Ia].edgeColor},set:function(e){var t=f(this,Ia)[Ia].edgeColor;t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]||(t[0]=.2,t[1]=.2,t[2]=.2,this.view.redraw())}},{key:"edgeAlpha",get:function(){return f(this,Ia)[Ia].edgeAlpha},set:function(e){f(this,Ia)[Ia].edgeAlpha!==e&&(f(this,Ia)[Ia].edgeAlpha=e,this.view.redraw())}},{key:"edgeWidth",get:function(){return f(this,Ia)[Ia].edgeWidth},set:function(e){f(this,Ia)[Ia].edgeWidth=e,this.view.redraw()}},{key:"backfaces",get:function(){return f(this,Ia)[Ia].backfaces},set:function(e){f(this,Ia)[Ia].backfaces!==e&&(f(this,Ia)[Ia].backfaces=e,this.view.redraw())}},{key:"hash",get:function(){return""}}]),t}(ae),Sa=/*#__PURE__*/d("state"),Ma=/*#__PURE__*/function(e){function t(t,i){var r;return void 0===i&&(i={}),(r=e.call(this,t,i)||this).view=void 0,Object.defineProperty(c(r),Sa,{writable:!0,value:void 0}),r.view=t,f(c(r),Sa)[Sa]={renderModes:i.renderModes||[Je],edges:!1!==i.edges,edgeColor:new Float32Array(i.edgeColor||[.2,.2,.2]),edgeAlpha:null!=i.edgeAlpha?i.edgeAlpha:.5,edgeWidth:null!=i.edgeWidth?i.edgeWidth:1},r}return r(t,e),t.prototype.destroy=function(){e.prototype.destroy.call(this)},i(t,[{key:"renderModes",get:function(){return f(this,Sa)[Sa].renderModes},set:function(e){f(this,Sa)[Sa].renderModes=e,this.view.redraw()}},{key:"edges",get:function(){return f(this,Sa)[Sa].edges},set:function(e){f(this,Sa)[Sa].edges!==e&&(f(this,Sa)[Sa].edges=e,this.view.redraw())}},{key:"edgeColor",get:function(){return f(this,Sa)[Sa].edgeColor},set:function(e){var t=f(this,Sa)[Sa].edgeColor;e&&t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]||(t[0]=.2,t[1]=.2,t[2]=.2,this.view.redraw())}},{key:"edgeAlpha",get:function(){return f(this,Sa)[Sa].edgeAlpha},set:function(e){f(this,Sa)[Sa].edgeAlpha!==e&&(f(this,Sa)[Sa].edgeAlpha=e,this.view.redraw())}},{key:"edgeWidth",get:function(){return f(this,Sa)[Sa].edgeWidth},set:function(e){f(this,Sa)[Sa].edgeWidth!==e&&(f(this,Sa)[Sa].edgeWidth=e,this.view.redraw())}}]),t}(ae),Oa=/*#__PURE__*/d("state"),Ra=/*#__PURE__*/function(e){function t(t,i){var r;return void 0===i&&(i={}),(r=e.call(this,t,i)||this).view=void 0,Object.defineProperty(c(r),Oa,{writable:!0,value:void 0}),r.view=t,f(c(r),Oa)[Oa]={pointSize:null!=i.pointSize?i.pointSize:1,roundPoints:!1!==i.roundPoints,perspectivePoints:!1!==i.perspectivePoints,minPerspectivePointSize:null!=i.minPerspectivePointSize?i.minPerspectivePointSize:1,maxPerspectivePointSize:null!=i.maxPerspectivePointSize?i.maxPerspectivePointSize:6,filterIntensity:!!i.filterIntensity,minIntensity:null!=i.minIntensity?i.minIntensity:0,maxIntensity:null!=i.maxIntensity?i.maxIntensity:1},r}return r(t,e),t.prototype.destroy=function(){e.prototype.destroy.call(this)},i(t,[{key:"pointSize",get:function(){return f(this,Oa)[Oa].pointSize},set:function(e){f(this,Oa)[Oa].pointSize=e,this.view.redraw()}},{key:"roundPoints",get:function(){return f(this,Oa)[Oa].roundPoints},set:function(e){f(this,Oa)[Oa].roundPoints!==e&&(f(this,Oa)[Oa].roundPoints=e,this.view.rebuild())}},{key:"perspectivePoints",get:function(){return f(this,Oa)[Oa].perspectivePoints},set:function(e){f(this,Oa)[Oa].perspectivePoints!==e&&(f(this,Oa)[Oa].perspectivePoints=e,this.view.rebuild())}},{key:"minPerspectivePointSize",get:function(){return f(this,Oa)[Oa].minPerspectivePointSize},set:function(e){f(this,Oa)[Oa].minPerspectivePointSize!==e&&(f(this,Oa)[Oa].minPerspectivePointSize=e,this.view.rebuild())}},{key:"maxPerspectivePointSize",get:function(){return f(this,Oa)[Oa].maxPerspectivePointSize},set:function(e){f(this,Oa)[Oa].maxPerspectivePointSize!==e&&(f(this,Oa)[Oa].maxPerspectivePointSize=e,this.view.rebuild())}},{key:"filterIntensity",get:function(){return f(this,Oa)[Oa].filterIntensity},set:function(e){f(this,Oa)[Oa].filterIntensity!==e&&(f(this,Oa)[Oa].filterIntensity=e,this.view.rebuild())}},{key:"minIntensity",get:function(){return f(this,Oa)[Oa].minIntensity},set:function(e){f(this,Oa)[Oa].minIntensity!==e&&(f(this,Oa)[Oa].minIntensity=e,this.view.redraw())}},{key:"maxIntensity",get:function(){return f(this,Oa)[Oa].maxIntensity},set:function(e){f(this,Oa)[Oa].maxIntensity!==e&&(f(this,Oa)[Oa].maxIntensity=e,this.view.redraw())}},{key:"hash",get:function(){var e=f(this,Oa)[Oa];return e.pointSize+";\n        "+e.roundPoints+";\n        "+e.perspectivePoints+";\n        "+e.minPerspectivePointSize+";\n        "+e.maxPerspectivePointSize+";\n        "+e.filterIntensity}}]),t}(ae),ja=/*#__PURE__*/d("state"),Da=/*#__PURE__*/d("inverseMatrixDirty"),Aa=/*#__PURE__*/d("transposedProjMatrixDirty"),Ca=/*#__PURE__*/d("onViewBoundary"),Ba=/*#__PURE__*/function(e){function t(t,i){var r;return void 0===i&&(i={}),(r=e.call(this,t,i)||this).camera=void 0,r.onProjMatrix=void 0,Object.defineProperty(c(r),ja,{writable:!0,value:void 0}),Object.defineProperty(c(r),Da,{writable:!0,value:void 0}),Object.defineProperty(c(r),Aa,{writable:!0,value:void 0}),Object.defineProperty(c(r),Ca,{writable:!0,value:void 0}),r.camera=t,f(c(r),ja)[ja]={near:i.near||.1,far:i.far||2e3,fov:i.fov||60,fovAxis:i.fovAxis||"min",projMatrix:Zt(),inverseProjMatrix:Zt(),transposedProjMatrix:Zt()},f(c(r),Da)[Da]=!0,f(c(r),Aa)[Aa]=!0,f(c(r),Ca)[Ca]=r.camera.view.onBoundary.subscribe(function(){r.setDirty()}),r.onProjMatrix=new p(new te.EventDispatcher),r}r(t,e);var n=t.prototype;return n.clean=function(){var e=this.camera.view.boundary,t=e[2]/e[3],i=f(this,ja)[ja].fovAxis,r=f(this,ja)[ja].fov;("x"===i||"min"===i&&t<1||"max"===i&&t>1)&&(r/=t),$t((r=Math.min(r,120))*(Math.PI/180),t,f(this,ja)[ja].near,f(this,ja)[ja].far,f(this,ja)[ja].projMatrix),f(this,Da)[Da]=!0,f(this,Aa)[Aa]=!0,this.camera.view.redraw(),this.onProjMatrix.dispatch(this,f(this,ja)[ja].projMatrix)},n.unproject=function(e,t,i,r,n){var o=this.camera.view.canvasElement,s=o.offsetWidth/2,a=o.offsetHeight/2;return i[0]=(e[0]-s)/s,i[1]=(e[1]-a)/a,i[2]=t,i[3]=1,li(this.inverseProjMatrix,i,r),_t(r,1/r[3]),r[3]=1,r[1]*=-1,li(this.camera.inverseViewMatrix,r,n),n},n.destroy=function(){e.prototype.destroy.call(this),this.camera.view.onBoundary.unsubscribe(f(this,Ca)[Ca]),this.onProjMatrix.clear()},i(t,[{key:"fov",get:function(){return f(this,ja)[ja].fov},set:function(e){e!==f(this,ja)[ja].fov&&(f(this,ja)[ja].fov=e,this.setDirty())}},{key:"fovAxis",get:function(){return f(this,ja)[ja].fovAxis},set:function(e){e=e||"min",f(this,ja)[ja].fovAxis!==e&&("x"!==e&&"y"!==e&&"min"!==e&&(this.error("Unsupported value for 'fovAxis': "+e+" - defaulting to 'min'"),e="min"),f(this,ja)[ja].fovAxis=e,this.setDirty())}},{key:"near",get:function(){return f(this,ja)[ja].near},set:function(e){f(this,ja)[ja].near!==e&&(f(this,ja)[ja].near=e,this.setDirty())}},{key:"far",get:function(){return f(this,ja)[ja].far},set:function(e){f(this,ja)[ja].far!==e&&(f(this,ja)[ja].far=e,this.setDirty())}},{key:"projMatrix",get:function(){return this.dirty&&this.cleanIfDirty(),f(this,ja)[ja].projMatrix}},{key:"inverseProjMatrix",get:function(){return this.dirty&&this.cleanIfDirty(),f(this,Da)[Da]&&(ai(f(this,ja)[ja].projMatrix,f(this,ja)[ja].inverseProjMatrix),f(this,Da)[Da]=!1),f(this,ja)[ja].inverseProjMatrix}},{key:"transposedProjMatrix",get:function(){return this.dirty&&this.cleanIfDirty(),f(this,Aa)[Aa]&&(ci(f(this,ja)[ja].projMatrix,f(this,ja)[ja].transposedProjMatrix),f(this,Aa)[Aa]=!1),f(this,ja)[ja].transposedProjMatrix}}]),t}(ae);Ba.type=et;var ka=/*#__PURE__*/d("state"),La=/*#__PURE__*/d("inverseMatrixDirty"),Fa=/*#__PURE__*/d("transposedProjMatrixDirty"),Ua=/*#__PURE__*/d("onViewBoundary"),Na=/*#__PURE__*/function(e){function t(t,i){var r;return void 0===i&&(i={}),(r=e.call(this,t,i)||this).camera=void 0,r.onProjMatrix=void 0,Object.defineProperty(c(r),ka,{writable:!0,value:void 0}),Object.defineProperty(c(r),La,{writable:!0,value:void 0}),Object.defineProperty(c(r),Fa,{writable:!0,value:void 0}),Object.defineProperty(c(r),Ua,{writable:!0,value:void 0}),r.camera=t,f(c(r),ka)[ka]={near:i.near||.1,far:i.far||2e3,scale:i.scale||1,projMatrix:Zt(),inverseProjMatrix:Zt(),transposedProjMatrix:Zt()},r.onProjMatrix=new p(new te.EventDispatcher),f(c(r),La)[La]=!0,f(c(r),Fa)[Fa]=!0,f(c(r),Ua)[Ua]=r.camera.view.onBoundary.subscribe(function(){r.setDirty()}),r}r(t,e);var n=t.prototype;return n.clean=function(){var e,t,i,r,n=this.camera.view,o=.5*f(this,ka)[ka].scale,s=n.boundary,a=s[2],c=s[3],l=a/c;a>c?(e=-o,t=o,i=o/l,r=-o/l):(e=-o*l,t=o*l,i=o,r=-o),ti(e,t,r,i,f(this,ka)[ka].near,f(this,ka)[ka].far,f(this,ka)[ka].projMatrix),f(this,La)[La]=!0,f(this,Fa)[Fa]=!0,this.camera.view.redraw(),this.onProjMatrix.dispatch(this,f(this,ka)[ka].projMatrix)},n.unproject=function(e,t,i,r,n){var o=this.camera.view.canvasElement,s=o.offsetWidth/2,a=o.offsetHeight/2;return i[0]=(e[0]-s)/s,i[1]=(e[1]-a)/a,i[2]=t,i[3]=1,li(this.inverseProjMatrix,i,r),_t(r,1/r[3]),r[3]=1,r[1]*=-1,li(this.camera.inverseViewMatrix,r,n),n},n.destroy=function(){e.prototype.destroy.call(this),this.camera.view.onBoundary.unsubscribe(f(this,Ua)[Ua]),this.onProjMatrix.clear()},i(t,[{key:"scale",get:function(){return f(this,ka)[ka].scale},set:function(e){e<=0&&(e=.01),f(this,ka)[ka].scale=e,this.setDirty()}},{key:"near",get:function(){return f(this,ka)[ka].near},set:function(e){f(this,ka)[ka].near!==e&&(f(this,ka)[ka].near=e,this.setDirty())}},{key:"far",get:function(){return f(this,ka)[ka].far},set:function(e){f(this,ka)[ka].far!==e&&(f(this,ka)[ka].far=e,this.setDirty())}},{key:"projMatrix",get:function(){return this.dirty&&this.cleanIfDirty(),f(this,ka)[ka].projMatrix}},{key:"inverseProjMatrix",get:function(){return this.dirty&&this.cleanIfDirty(),f(this,La)[La]&&(ai(f(this,ka)[ka].projMatrix,f(this,ka)[ka].inverseProjMatrix),f(this,La)[La]=!1),f(this,ka)[ka].inverseProjMatrix}},{key:"transposedProjMatrix",get:function(){return this.dirty&&this.cleanIfDirty(),f(this,Fa)[Fa]&&(ci(f(this,ka)[ka].projMatrix,f(this,ka)[ka].transposedProjMatrix),f(this,Fa)[Fa]=!1),f(this,ka)[ka].transposedProjMatrix}}]),t}(ae);Na.type=tt;var Ga=/*#__PURE__*/d("state"),Va=/*#__PURE__*/d("inverseMatrixDirty"),Ha=/*#__PURE__*/d("transposedProjMatrixDirty"),Xa=/*#__PURE__*/function(e){function t(t,i){var r;return void 0===i&&(i={}),(r=e.call(this,t,i)||this).camera=void 0,r.onProjMatrix=void 0,Object.defineProperty(c(r),Ga,{writable:!0,value:void 0}),Object.defineProperty(c(r),Va,{writable:!0,value:void 0}),Object.defineProperty(c(r),Ha,{writable:!0,value:void 0}),r.camera=t,f(c(r),Ga)[Ga]={projMatrix:Zt(),inverseProjMatrix:Zt(),transposedProjMatrix:Zt(),near:.1,far:1e4,left:null!=i.left?i.left:-1,right:null!=i.right?i.right:1,bottom:null!=i.bottom?i.bottom:-1,top:null!=i.top?i.top:1},r.onProjMatrix=new p(new te.EventDispatcher),f(c(r),Va)[Va]=!0,f(c(r),Ha)[Ha]=!0,r}r(t,e);var n=t.prototype;return n.clean=function(){ii(f(this,Ga)[Ga].left,f(this,Ga)[Ga].right,f(this,Ga)[Ga].bottom,f(this,Ga)[Ga].top,f(this,Ga)[Ga].near,f(this,Ga)[Ga].far,f(this,Ga)[Ga].projMatrix),f(this,Va)[Va]=!0,f(this,Ha)[Ha]=!0,this.camera.view.redraw(),this.onProjMatrix.dispatch(this,f(this,Ga)[Ga].projMatrix)},n.unproject=function(e,t,i,r,n){var o=this.camera.view.canvasElement,s=o.offsetWidth/2,a=o.offsetHeight/2;return i[0]=(e[0]-s)/s,i[1]=(e[1]-a)/a,i[2]=t,i[3]=1,li(this.inverseProjMatrix,i,r),_t(r,1/r[3]),r[3]=1,r[1]*=-1,li(this.camera.inverseViewMatrix,r,n),n},n.destroy=function(){e.prototype.destroy.call(this),this.onProjMatrix.clear()},i(t,[{key:"left",get:function(){return f(this,Ga)[Ga].left},set:function(e){f(this,Ga)[Ga].left=e,this.setDirty()}},{key:"right",get:function(){return f(this,Ga)[Ga].right},set:function(e){f(this,Ga)[Ga].right=e,this.setDirty()}},{key:"top",get:function(){return f(this,Ga)[Ga].top},set:function(e){f(this,Ga)[Ga].top=e,this.setDirty()}},{key:"bottom",get:function(){return f(this,Ga)[Ga].bottom},set:function(e){f(this,Ga)[Ga].bottom=e,this.setDirty()}},{key:"near",get:function(){return f(this,Ga)[Ga].near},set:function(e){f(this,Ga)[Ga].near=e,this.setDirty()}},{key:"far",get:function(){return f(this,Ga)[Ga].far},set:function(e){f(this,Ga)[Ga].far=e,this.setDirty()}},{key:"projMatrix",get:function(){return this.dirty&&this.cleanIfDirty(),f(this,Ga)[Ga].projMatrix}},{key:"inverseProjMatrix",get:function(){return this.dirty&&this.cleanIfDirty(),f(this,Va)[Va]&&(ai(f(this,Ga)[Ga].projMatrix,f(this,Ga)[Ga].inverseProjMatrix),f(this,Va)[Va]=!1),f(this,Ga)[Ga].inverseProjMatrix}},{key:"transposedProjMatrix",get:function(){return this.dirty&&this.cleanIfDirty(),f(this,Ha)[Ha]&&(ci(f(this,Ga)[Ga].projMatrix,f(this,Ga)[Ga].transposedProjMatrix),f(this,Ha)[Ha]=!1),f(this,Ga)[Ga].transposedProjMatrix}}]),t}(ae);Xa.type=it;var Wa=/*#__PURE__*/d("state"),Ya=/*#__PURE__*/d("inverseProjMatrixDirty"),Ka=/*#__PURE__*/d("transposedProjMatrixDirty"),za=/*#__PURE__*/function(e){function t(t,i){var r;return void 0===i&&(i={}),(r=e.call(this,t,i)||this).camera=void 0,r.onProjMatrix=void 0,Object.defineProperty(c(r),Wa,{writable:!0,value:void 0}),Object.defineProperty(c(r),Ya,{writable:!0,value:void 0}),Object.defineProperty(c(r),Ka,{writable:!0,value:void 0}),r.camera=t,f(c(r),Wa)[Wa]={projMatrix:Zt(i.projMatrix||ri()),inverseProjMatrix:Zt(),transposedProjMatrix:Zt()},r.onProjMatrix=new p(new te.EventDispatcher),f(c(r),Ya)[Ya]=!0,f(c(r),Ka)[Ka]=!1,r}r(t,e);var n=t.prototype;return n.unproject=function(e,t,i,r,n){var o=this.camera.view.canvasElement,s=o.offsetWidth/2,a=o.offsetHeight/2;return i[0]=(e[0]-s)/s,i[1]=(e[1]-a)/a,i[2]=t,i[3]=1,li(this.inverseProjMatrix,i,r),_t(r,1/r[3]),r[3]=1,r[1]*=-1,li(this.camera.inverseViewMatrix,r,n),n},n.destroy=function(){e.prototype.destroy.call(this),this.onProjMatrix.clear()},i(t,[{key:"projMatrix",get:function(){return f(this,Wa)[Wa].projMatrix},set:function(e){f(this,Wa)[Wa].projMatrix.set(e),f(this,Ya)[Ya]=!0,f(this,Ka)[Ka]=!0,this.setDirty(),this.camera.view.redraw(),this.onProjMatrix.dispatch(this,f(this,Wa)[Wa].projMatrix)}},{key:"inverseProjMatrix",get:function(){return this.dirty&&this.cleanIfDirty(),f(this,Ya)[Ya]&&(ai(f(this,Wa)[Wa].projMatrix,f(this,Wa)[Wa].inverseProjMatrix),f(this,Ya)[Ya]=!1),f(this,Wa)[Wa].inverseProjMatrix}},{key:"transposedProjMatrix",get:function(){return this.dirty&&this.cleanIfDirty(),f(this,Ka)[Ka]&&(ci(f(this,Wa)[Wa].projMatrix,f(this,Wa)[Wa].transposedProjMatrix),f(this,Ka)[Ka]=!1),f(this,Wa)[Wa].transposedProjMatrix}}]),t}(ae);za.type=rt;var qa=wt(),Za=wt(),Qa=wt(),Ja=wt(),$a=wt(),ec=wt(),tc=Zt(),ic=Zt(),rc=wt(),nc=wt(),oc=wt(),sc=wt(),ac=/*#__PURE__*/d("state"),cc=/*#__PURE__*/d("frustum"),lc=/*#__PURE__*/d("activeProjection"),hc=/*#__PURE__*/function(e){function t(t,i){var r;return void 0===i&&(i={}),(r=e.call(this,t,i)||this).view=void 0,r.perspectiveProjection=void 0,r.orthoProjection=void 0,r.frustumProjection=void 0,r.customProjection=void 0,r.onProjectionType=void 0,r.onViewMatrix=void 0,r.onProjMatrix=void 0,r.onWorldAxis=void 0,r.onFrustum=void 0,Object.defineProperty(c(r),ac,{writable:!0,value:void 0}),Object.defineProperty(c(r),cc,{writable:!0,value:void 0}),Object.defineProperty(c(r),lc,{writable:!0,value:void 0}),r.onProjectionType=new p(new te.EventDispatcher),r.onViewMatrix=new p(new te.EventDispatcher),r.onProjMatrix=new p(new te.EventDispatcher),r.onWorldAxis=new p(new te.EventDispatcher),r.onFrustum=new p(new te.EventDispatcher),r.view=t,f(c(r),ac)[ac]={eye:wt(i.eye||[0,0,10]),look:wt(i.look||[0,0,0]),up:wt(i.up||[0,1,0]),worldUp:wt([0,1,0]),worldRight:wt([1,0,0]),worldForward:wt([0,0,-1]),worldAxis:new Float32Array(i.worldAxis||[1,0,0,0,1,0,0,0,1]),gimbalLock:!1!==i.gimbalLock,constrainPitch:!0===i.constrainPitch,projectionType:i.projectionType||et,deviceMatrix:i.deviceMatrix?Zt(i.deviceMatrix):ri(),hasDeviceMatrix:!!i.deviceMatrix,viewMatrix:Zt(),viewNormalMatrix:Zt(),inverseViewMatrix:Zt()},f(c(r),cc)[cc]=new Gr,r.perspectiveProjection=new Ba(c(r)),r.orthoProjection=new Na(c(r)),r.frustumProjection=new Xa(c(r)),r.customProjection=new za(c(r)),f(c(r),lc)[lc]=r.perspectiveProjection,r.perspectiveProjection.onProjMatrix.subscribe(function(){f(c(r),ac)[ac].projectionType===et&&r.onProjMatrix.dispatch(c(r),r.perspectiveProjection.projMatrix)}),r.orthoProjection.onProjMatrix.subscribe(function(){f(c(r),ac)[ac].projectionType===tt&&r.onProjMatrix.dispatch(c(r),r.orthoProjection.projMatrix)}),r.frustumProjection.onProjMatrix.subscribe(function(){f(c(r),ac)[ac].projectionType===it&&r.onProjMatrix.dispatch(c(r),r.frustumProjection.projMatrix)}),r.customProjection.onProjMatrix.subscribe(function(){f(c(r),ac)[ac].projectionType===rt&&r.onProjMatrix.dispatch(c(r),r.customProjection.projMatrix)}),r}r(t,e);var n=t.prototype;return n.clean=function(){var e,t=f(this,ac)[ac];this.projectionType===tt?(Mt(f(this,ac)[ac].eye,f(this,ac)[ac].look,rc),Yt(rc,nc),_t(nc,1e3,oc),xt(f(this,ac)[ac].look,oc,sc),e=sc):e=f(this,ac)[ac].eye,t.hasDeviceMatrix?(si(e,f(this,ac)[ac].look,f(this,ac)[ac].up,ic),hi(t.deviceMatrix,ic,t.viewMatrix)):si(e,f(this,ac)[ac].look,f(this,ac)[ac].up,t.viewMatrix),ai(f(this,ac)[ac].viewMatrix,f(this,ac)[ac].inverseViewMatrix),ci(f(this,ac)[ac].inverseViewMatrix,f(this,ac)[ac].viewNormalMatrix),this.view.redraw(),Vr(f(this,ac)[ac].viewMatrix,f(this,lc)[lc].projMatrix,f(this,cc)[cc]),this.onViewMatrix.dispatch(this,f(this,ac)[ac].viewMatrix),this.onFrustum.dispatch(this,f(this,cc)[cc])},n.orbitYaw=function(e){var t=Mt(f(this,ac)[ac].eye,f(this,ac)[ac].look,qa);oi(.0174532925*e,f(this,ac)[ac].gimbalLock?f(this,ac)[ac].worldUp:f(this,ac)[ac].up,tc),t=di(tc,t,Za),this.eye=xt(f(this,ac)[ac].look,t,Qa),this.up=di(tc,f(this,ac)[ac].up,Ja)},n.orbitPitch=function(e){if(!(f(this,ac)[ac].constrainPitch&&(e=gt(f(this,ac)[ac].up,f(this,ac)[ac].worldUp)/at)<1)){var t=Mt(f(this,ac)[ac].eye,f(this,ac)[ac].look,qa);oi(.0174532925*e,At(Yt(t,Za),Yt(f(this,ac)[ac].up,Qa)),tc),t=di(tc,t,Ja),this.up=di(tc,f(this,ac)[ac].up,$a),this.eye=xt(t,f(this,ac)[ac].look,ec)}},n.yaw=function(e){var t=Mt(f(this,ac)[ac].look,f(this,ac)[ac].eye,qa);oi(.0174532925*e,f(this,ac)[ac].gimbalLock?f(this,ac)[ac].worldUp:f(this,ac)[ac].up,tc),t=di(tc,t,Za),this.look=xt(t,f(this,ac)[ac].eye,Qa),f(this,ac)[ac].gimbalLock&&(this.up=di(tc,f(this,ac)[ac].up,Ja))},n.pitch=function(e){if(!(f(this,ac)[ac].constrainPitch&&(e=gt(f(this,ac)[ac].up,f(this,ac)[ac].worldUp)/at)<1)){var t=Mt(f(this,ac)[ac].look,f(this,ac)[ac].eye,qa);oi(.0174532925*e,At(Yt(t,Za),Yt(f(this,ac)[ac].up,Qa)),tc),this.up=di(tc,f(this,ac)[ac].up,ec),t=di(tc,t,Ja),this.look=xt(t,f(this,ac)[ac].eye,$a)}},n.pan=function(e){var t,i=Mt(f(this,ac)[ac].eye,f(this,ac)[ac].look,qa),r=[0,0,0];0!==e[0]&&(t=_t(At(Yt(i,[]),Yt(f(this,ac)[ac].up,Za)),e[0]),r[0]+=t[0],r[1]+=t[1],r[2]+=t[2]),0!==e[1]&&(t=_t(Yt(f(this,ac)[ac].up,Qa),e[1]),r[0]+=t[0],r[1]+=t[1],r[2]+=t[2]),0!==e[2]&&(t=_t(Yt(i,Ja),e[2]),r[0]+=t[0],r[1]+=t[1],r[2]+=t[2]),this.eye=xt(f(this,ac)[ac].eye,r,$a),this.look=xt(f(this,ac)[ac].look,r,ec)},n.zoom=function(e){var t=Mt(f(this,ac)[ac].eye,f(this,ac)[ac].look,qa),i=Math.abs(Ut(t)),r=Math.abs(i+e);if(!(r<.5)){var n=Yt(t,Qa);this.eye=xt(f(this,ac)[ac].look,_t(n,r),Ja)}},n.destroy=function(){e.prototype.destroy.call(this),this.onProjectionType.clear(),this.onViewMatrix.clear(),this.onProjMatrix.clear(),this.onWorldAxis.clear()},i(t,[{key:"project",get:function(){return f(this,lc)[lc]}},{key:"eye",get:function(){return f(this,ac)[ac].eye},set:function(e){f(this,ac)[ac].eye.set(e),this.setDirty()}},{key:"look",get:function(){return f(this,ac)[ac].look},set:function(e){f(this,ac)[ac].look.set(e),this.setDirty()}},{key:"up",get:function(){return f(this,ac)[ac].up},set:function(e){f(this,ac)[ac].up.set(e),this.setDirty()}},{key:"worldUp",get:function(){return f(this,ac)[ac].worldUp}},{key:"worldRight",get:function(){return f(this,ac)[ac].worldRight}},{key:"worldForward",get:function(){return f(this,ac)[ac].worldForward}},{key:"constrainPitch",get:function(){return f(this,ac)[ac].constrainPitch},set:function(e){f(this,ac)[ac].constrainPitch=e}},{key:"gimbalLock",get:function(){return f(this,ac)[ac].gimbalLock},set:function(e){f(this,ac)[ac].gimbalLock=e}},{key:"worldAxis",get:function(){return f(this,ac)[ac].worldAxis},set:function(e){var t=f(this,ac)[ac];t.worldAxis.set(e),t.worldRight[0]=t.worldAxis[0],t.worldRight[1]=t.worldAxis[1],t.worldRight[2]=t.worldAxis[2],t.worldUp[0]=t.worldAxis[3],t.worldUp[1]=t.worldAxis[4],t.worldUp[2]=t.worldAxis[5],t.worldForward[0]=t.worldAxis[6],t.worldForward[1]=t.worldAxis[7],t.worldForward[2]=t.worldAxis[8],this.onWorldAxis.dispatch(this,t.worldAxis)}},{key:"deviceMatrix",get:function(){return f(this,ac)[ac].deviceMatrix},set:function(e){f(this,ac)[ac].deviceMatrix.set(e||[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),f(this,ac)[ac].hasDeviceMatrix=!!e,this.setDirty()}},{key:"xUp",get:function(){return f(this,ac)[ac].worldUp[0]>f(this,ac)[ac].worldUp[1]&&f(this,ac)[ac].worldUp[0]>f(this,ac)[ac].worldUp[2]}},{key:"yUp",get:function(){return f(this,ac)[ac].worldUp[1]>f(this,ac)[ac].worldUp[0]&&f(this,ac)[ac].worldUp[1]>f(this,ac)[ac].worldUp[2]}},{key:"zUp",get:function(){return f(this,ac)[ac].worldUp[2]>f(this,ac)[ac].worldUp[0]&&f(this,ac)[ac].worldUp[2]>f(this,ac)[ac].worldUp[1]}},{key:"eyeLookDist",get:function(){return Ut(Mt(f(this,ac)[ac].look,f(this,ac)[ac].eye,qa))}},{key:"viewMatrix",get:function(){return this.dirty&&this.cleanIfDirty(),f(this,ac)[ac].viewMatrix}},{key:"inverseViewMatrix",get:function(){return this.dirty&&this.cleanIfDirty(),f(this,ac)[ac].inverseViewMatrix}},{key:"projMatrix",get:function(){return f(this,lc)[lc].projMatrix}},{key:"frustum",get:function(){return this.dirty&&this.cleanIfDirty(),f(this,cc)[cc]}},{key:"projectionType",get:function(){return f(this,ac)[ac].projectionType},set:function(e){e=e||et,f(this,ac)[ac].projectionType!==e&&(e===et?f(this,lc)[lc]=this.perspectiveProjection:e===tt?f(this,lc)[lc]=this.orthoProjection:e===it?f(this,lc)[lc]=this.frustumProjection:e===rt?f(this,lc)[lc]=this.customProjection:(this.error("Unsupported value for 'projection': "+e+" defaulting to PerspectiveProjectionType"),f(this,lc)[lc]=this.perspectiveProjection,e=et),f(this,lc)[lc].clean(),f(this,ac)[ac].projectionType=e,this.clean(),this.onProjectionType.dispatch(this,f(this,ac)[ac].projectionType),this.onProjMatrix.dispatch(this,f(this,lc)[lc].projMatrix))}}]),t}(ae),uc={viewerId:"",time:0,startTime:0,prevTime:0,deltaTime:0},dc=/*#__PURE__*/d("viewersRenderInfo"),fc=/*#__PURE__*/d("viewerIDMap"),vc=/*#__PURE__*/d("taskQueue"),pc=/*#__PURE__*/d("taskBudget"),yc=/*#__PURE__*/d("lastTime"),mc=/*#__PURE__*/d("elapsedTime"),gc=/*#__PURE__*/d("runTasks"),bc=/*#__PURE__*/d("runTasksUntil"),wc=/*#__PURE__*/d("fireTickEvents"),Pc=/*#__PURE__*/d("renderViewers");function Ec(e){f(this,bc)[bc](e+f(this,pc)[pc]),this.getNumTasks(),f(this,pc)}function Tc(e){void 0===e&&(e=-1);for(var t=(new Date).getTime(),i=0;f(this,vc)[vc].length>0&&(e<0||t<e);){var r=f(this,vc)[vc].shift(),n=f(this,vc)[vc].shift();n?r.call(n):r(),t=(new Date).getTime(),i++}return i}function _c(e){for(var t in uc.time=e,xc.viewers)if(this.viewers.hasOwnProperty(t)){var i=this.viewers[t];uc.viewerId=t,uc.startTime=i.startTime,uc.deltaTime=null!=uc.prevTime?uc.time-uc.prevTime:0,i.onTick.dispatch(i,uc)}uc.prevTime=e}function Ic(){for(var e in this.viewers)if(this.viewers.hasOwnProperty(e)){var t=this.viewers[e],i=f(this,dc)[dc][e];i||(i=f(this,dc)[dc][e]={}),t.render({})}}var xc=new(/*#__PURE__*/function(){function e(){var e=this;Object.defineProperty(this,Pc,{value:Ic}),Object.defineProperty(this,wc,{value:_c}),Object.defineProperty(this,bc,{value:Tc}),Object.defineProperty(this,gc,{value:Ec}),this.viewers=void 0,Object.defineProperty(this,dc,{writable:!0,value:{}}),Object.defineProperty(this,fc,{writable:!0,value:new Vi}),Object.defineProperty(this,vc,{writable:!0,value:new Hi}),Object.defineProperty(this,pc,{writable:!0,value:10}),Object.defineProperty(this,yc,{writable:!0,value:0}),Object.defineProperty(this,mc,{writable:!0,value:0}),this.viewers={},requestAnimationFrame(function t(){var i=Date.now();f(e,yc)[yc]>0&&(f(e,mc)[mc]=i-f(e,yc)[yc]),f(e,gc)[gc](i),f(e,wc)[wc](i),f(e,Pc)[Pc](),f(e,yc)[yc]=i,requestAnimationFrame(t)})}var t=e.prototype;return t.registerViewer=function(e){if(e.id){if(this.viewers[e.id])return void console.error("[ERROR] Viewer "+nr(e.id)+" already exists")}else e.id=f(this,fc)[fc].addItem({});this.viewers[e.id]=e,f(this,dc)[dc][e.id]={}},t.deregisterViewer=function(e){this.viewers[e.id]&&(f(this,fc)[fc].removeItem(e.id),delete this.viewers[e.id],delete f(this,dc)[dc][e.id])},t.scheduleTask=function(e,t){f(this,vc)[vc].push(e),f(this,vc)[vc].push(t)},t.getNumTasks=function(){return f(this,vc)[vc].length},e}()),Sc=wt(),Mc=wt(),Oc=wt(),Rc=wt(),jc=wt(),Dc=/*#__PURE__*/d("duration"),Ac=/*#__PURE__*/d("look1"),Cc=/*#__PURE__*/d("eye1"),Bc=/*#__PURE__*/d("up1"),kc=/*#__PURE__*/d("look2"),Lc=/*#__PURE__*/d("eye2"),Fc=/*#__PURE__*/d("up2"),Uc=/*#__PURE__*/d("orthoScale1"),Nc=/*#__PURE__*/d("orthoScale2"),Gc=/*#__PURE__*/d("fit"),Vc=/*#__PURE__*/d("trail"),Hc=/*#__PURE__*/d("flying"),Xc=/*#__PURE__*/d("flyEyeLookUp"),Wc=/*#__PURE__*/d("flyingEye"),Yc=/*#__PURE__*/d("flyingLook"),Kc=/*#__PURE__*/d("callback"),zc=/*#__PURE__*/d("callbackScope"),qc=/*#__PURE__*/d("time1"),Zc=/*#__PURE__*/d("time2"),Qc=/*#__PURE__*/d("flyingEyeLookUp"),Jc=/*#__PURE__*/d("fitFOV"),$c=/*#__PURE__*/d("projection2"),el=/*#__PURE__*/d("projMatrix1"),tl=/*#__PURE__*/d("projMatrix2"),il=/*#__PURE__*/d("jumpTo"),rl=/*#__PURE__*/d("update"),nl=/*#__PURE__*/d("ease"),ol=/*#__PURE__*/d("easeInCubic"),sl=/*#__PURE__*/d("easeOutExpo"),al=/*#__PURE__*/function(e){function t(t,i){var r;return r=e.call(this,t,i)||this,Object.defineProperty(c(r),rl,{value:ll}),Object.defineProperty(c(r),il,{value:cl}),r.view=void 0,r.camera=void 0,Object.defineProperty(c(r),Dc,{writable:!0,value:void 0}),Object.defineProperty(c(r),Ac,{writable:!0,value:void 0}),Object.defineProperty(c(r),Cc,{writable:!0,value:void 0}),Object.defineProperty(c(r),Bc,{writable:!0,value:void 0}),Object.defineProperty(c(r),kc,{writable:!0,value:void 0}),Object.defineProperty(c(r),Lc,{writable:!0,value:void 0}),Object.defineProperty(c(r),Fc,{writable:!0,value:void 0}),Object.defineProperty(c(r),Uc,{writable:!0,value:void 0}),Object.defineProperty(c(r),Nc,{writable:!0,value:void 0}),Object.defineProperty(c(r),Gc,{writable:!0,value:void 0}),Object.defineProperty(c(r),Vc,{writable:!0,value:void 0}),Object.defineProperty(c(r),Hc,{writable:!0,value:void 0}),Object.defineProperty(c(r),Xc,{writable:!0,value:void 0}),Object.defineProperty(c(r),Wc,{writable:!0,value:void 0}),Object.defineProperty(c(r),Yc,{writable:!0,value:void 0}),Object.defineProperty(c(r),Kc,{writable:!0,value:void 0}),Object.defineProperty(c(r),zc,{writable:!0,value:void 0}),Object.defineProperty(c(r),qc,{writable:!0,value:void 0}),Object.defineProperty(c(r),Zc,{writable:!0,value:void 0}),r.easing=void 0,Object.defineProperty(c(r),Qc,{writable:!0,value:void 0}),Object.defineProperty(c(r),Jc,{writable:!0,value:void 0}),Object.defineProperty(c(r),$c,{writable:!0,value:void 0}),Object.defineProperty(c(r),el,{writable:!0,value:void 0}),Object.defineProperty(c(r),tl,{writable:!0,value:void 0}),r.onStarted=void 0,r.onStopped=void 0,r.onCancelled=void 0,r.view=t,r.camera=t.camera,f(c(r),Ac)[Ac]=wt(),f(c(r),Cc)[Cc]=wt(),f(c(r),Bc)[Bc]=wt(),f(c(r),kc)[kc]=wt(),f(c(r),Lc)[Lc]=wt(),f(c(r),Fc)[Fc]=wt(),f(c(r),Uc)[Uc]=1,f(c(r),Nc)[Nc]=1,f(c(r),Hc)[Hc]=!1,f(c(r),Xc)[Xc]=!1,f(c(r),Wc)[Wc]=!1,f(c(r),Yc)[Yc]=!1,f(c(r),Kc)[Kc]=null,f(c(r),zc)[zc]=null,f(c(r),qc)[qc]=null,f(c(r),Zc)[Zc]=null,r.easing=!0,f(c(r),Vc)[Vc]=!1,f(c(r),Gc)[Gc]=!0,f(c(r),Dc)[Dc]=500,r.onStarted=new p(new te.EventDispatcher),r.onStopped=new p(new te.EventDispatcher),r.onCancelled=new p(new te.EventDispatcher),r}r(t,e);var n=t.prototype;return n.flyTo=function(e,t){void 0===e&&(e={}),f(this,Hc)[Hc]&&this.stop(),f(this,Hc)[Hc]=!1,f(this,Wc)[Wc]=!1,f(this,Yc)[Yc]=!1,f(this,Qc)[Qc]=!1,f(this,Kc)[Kc]=t;var i,r,n,o,s=this.camera,a=!!e.projection&&e.projection!==s.projectionType;f(this,Cc)[Cc][0]=s.eye[0],f(this,Cc)[Cc][1]=s.eye[1],f(this,Cc)[Cc][2]=s.eye[2],f(this,Ac)[Ac][0]=s.look[0],f(this,Ac)[Ac][1]=s.look[1],f(this,Ac)[Ac][2]=s.look[2],f(this,Bc)[Bc][0]=s.up[0],f(this,Bc)[Bc][1]=s.up[1],f(this,Bc)[Bc][2]=s.up[2],f(this,Uc)[Uc]=s.orthoProjection.scale,f(this,Nc)[Nc]=e.orthoScale||f(this,Uc)[Uc],e.aabb?i=e.aabb:e.eye&&e.look||e.up?(r=e.eye,n=e.look,o=e.up):e.eye?r=e.eye:e.look?n=e.look:a||(i=this.view.aabb);var c=e.poi;if(i){if(i[3]<i[0]||i[4]<i[1]||i[5]<i[2])return;if(i[3]===i[0]&&i[4]===i[1]&&i[5]===i[2])return;var l=Or(i=i.slice());f(this,kc)[kc]=c||l;var h=Yt(Mt(f(this,Cc)[Cc],f(this,Ac)[Ac],Sc)),u=c?Mr(i,c):Sr(i),d=e.fitFOV||f(this,Jc)[Jc],v=Math.abs(u/Math.tan(d*at));f(this,Nc)[Nc]=1.1*u,f(this,Lc)[Lc][0]=f(this,kc)[kc][0]+h[0]*v,f(this,Lc)[Lc][1]=f(this,kc)[kc][1]+h[1]*v,f(this,Lc)[Lc][2]=f(this,kc)[kc][2]+h[2]*v,f(this,Fc)[Fc][0]=f(this,Bc)[Bc][0],f(this,Fc)[Fc][1]=f(this,Bc)[Bc][1],f(this,Fc)[Fc][2]=f(this,Bc)[Bc][2],f(this,Qc)[Qc]=!0}else(r||n||o)&&(f(this,Qc)[Qc]=!!r&&!!n&&!!o,f(this,Wc)[Wc]=!!r&&!n,f(this,Yc)[Yc]=!!n&&!r,r&&(f(this,Lc)[Lc][0]=r[0],f(this,Lc)[Lc][1]=r[1],f(this,Lc)[Lc][2]=r[2]),n&&(f(this,kc)[kc][0]=n[0],f(this,kc)[kc][1]=n[1],f(this,kc)[kc][2]=n[2]),o&&(f(this,Fc)[Fc][0]=o[0],f(this,Fc)[Fc][1]=o[1],f(this,Fc)[Fc][2]=o[2]));a?(e.projection===tt&&s.projectionType!==tt&&(f(this,$c)[$c]=tt,f(this,el)[el]=s.projMatrix.slice(),f(this,tl)[tl]=s.orthoProjection.projMatrix.slice(),s.projectionType=rt),e.projection===et&&s.projectionType!==et&&(f(this,$c)[$c]=et,f(this,el)[el]=s.projMatrix.slice(),f(this,tl)[tl]=s.perspectiveProjection.projMatrix.slice(),s.projectionType=rt)):f(this,$c)[$c]=null,this.onStarted.dispatch(this,null),f(this,qc)[qc]=Date.now(),f(this,Zc)[Zc]=f(this,qc)[qc]+(e.duration?1e3*e.duration:f(this,Dc)[Dc]),f(this,Hc)[Hc]=!0,xc.scheduleTask(f(this,rl)[rl],this)},n.jumpTo=function(e){f(this,il)[il](e)},n.stop=function(){if(f(this,Hc)[Hc]){f(this,Hc)[Hc]=!1,f(this,qc)[qc]=null,f(this,Zc)[Zc]=null,f(this,$c)[$c]&&(this.camera.projectionType=f(this,$c)[$c]);var e=f(this,Kc)[Kc];e&&(f(this,Kc)[Kc]=null,e()),this.onStopped.dispatch(this,null)}},n.cancel=function(){f(this,Hc)[Hc]&&(f(this,Hc)[Hc]=!1,f(this,qc)[qc]=null,f(this,Zc)[Zc]=null,f(this,Kc)[Kc]&&(f(this,Kc)[Kc]=null),this.onCancelled.dispatch(this,null))},n.destroy=function(){this.stop(),e.prototype.destroy.call(this),this.onStarted.clear(),this.onStopped.clear(),this.onCancelled.clear()},i(t,[{key:"duration",get:function(){return f(this,Dc)[Dc]/1e3},set:function(e){f(this,Dc)[Dc]=e?1e3*e:500,this.stop()}},{key:"fit",get:function(){return f(this,Gc)[Gc]},set:function(e){f(this,Gc)[Gc]=e}},{key:"fitFOV",get:function(){return f(this,Jc)[Jc]},set:function(e){f(this,Jc)[Jc]=e}},{key:"trail",get:function(){return f(this,Vc)[Vc]},set:function(e){f(this,Vc)[Vc]=e}}]),t}(ae);function cl(e){f(this,Hc)[Hc]&&this.stop();var t,i,r,n,o=this.camera;e.aabb?t=e.aabb:e.eye||e.look||e.up?(i=e.eye,r=e.look,n=e.up):t=this.view.aabb;var s=e.poi;if(t){if(t[3]<=t[0]||t[4]<=t[1]||t[5]<=t[2])return;var a,c=s?Mr(t,s):Sr(t);r=s||Or(t,r),f(this,Vc)[Vc]?Mt(o.look,r,jc):Mt(o.eye,o.look,jc),Yt(jc),a=(void 0!==e.fit?e.fit:f(this,Gc)[Gc])?Math.abs(c/Math.tan((e.fitFOV||f(this,Jc)[Jc])*at)):Ut(Mt(o.eye,o.look,Sc)),_t(jc,a),o.eye=xt(r,jc,Sc),o.look=r,this.camera.orthoProjection.scale=1.1*c}else(i||r||n)&&(i&&(o.eye=i),r&&(o.look=r),n&&(o.up=n));e.projection&&(o.projectionType=e.projection)}function ll(){if(f(this,Hc)[Hc]){var e=(Date.now()-f(this,qc)[qc])/(f(this,Zc)[Zc]-f(this,qc)[qc]),t=e>=1;e>1&&(e=1);var i=this.easing?f(al,nl)[nl](e,0,1,1):e,r=this.camera;if(f(this,Wc)[Wc]||f(this,Yc)[Yc]?f(this,Wc)[Wc]?(Mt(r.eye,r.look,jc),r.eye=Ht(i,0,1,f(this,Cc)[Cc],f(this,Lc)[Lc],Oc),r.look=Mt(Oc,jc,Mc)):f(this,Yc)[Yc]&&(r.look=Ht(i,0,1,f(this,Ac)[Ac],f(this,kc)[kc],Mc),r.up=Ht(i,0,1,f(this,Bc)[Bc],f(this,Fc)[Fc],Rc)):f(this,Qc)[Qc]&&(r.eye=Ht(i,0,1,f(this,Cc)[Cc],f(this,Lc)[Lc],Oc),r.look=Ht(i,0,1,f(this,Ac)[Ac],f(this,kc)[kc],Mc),r.up=Ht(i,0,1,f(this,Bc)[Bc],f(this,Fc)[Fc],Rc)),f(this,$c)[$c]){var n=f(this,$c)[$c]===tt?f(al,sl)[sl](e,0,1,1):f(al,ol)[ol](e,0,1,1);r.customProjection.projMatrix=Di(n,0,1,f(this,el)[el],f(this,tl)[tl])}else r.orthoProjection.scale=f(this,Uc)[Uc]+e*(f(this,Nc)[Nc]-f(this,Uc)[Uc]);if(t)return r.orthoProjection.scale=f(this,Nc)[Nc],void this.stop();xc.scheduleTask(f(this,rl)[rl],this)}}Object.defineProperty(al,sl,{value:function(e,t,i,r){return i*(1-Math.pow(2,-10*e/r))+t}}),Object.defineProperty(al,ol,{value:function(e,t,i,r){return i*(e/=r)*e*e+t}}),Object.defineProperty(al,nl,{value:function(e,t,i,r){return-i*(e/=r)*(e-2)+t}});var hl=/*#__PURE__*/d("onTick"),ul=/*#__PURE__*/d("backgroundColor"),dl=/*#__PURE__*/d("backgroundColorFromAmbientLight"),fl=/*#__PURE__*/d("resolutionScale"),vl=/*#__PURE__*/d("numObjects"),pl=/*#__PURE__*/d("objectIds"),yl=/*#__PURE__*/d("numVisibleObjects"),ml=/*#__PURE__*/d("visibleObjectIds"),gl=/*#__PURE__*/d("numXRayedObjects"),bl=/*#__PURE__*/d("xrayedObjectIds"),wl=/*#__PURE__*/d("numHighlightedObjects"),Pl=/*#__PURE__*/d("highlightedObjectIds"),El=/*#__PURE__*/d("numSelectedObjects"),Tl=/*#__PURE__*/d("selectedObjectIds"),_l=/*#__PURE__*/d("numColorizedObjects"),Il=/*#__PURE__*/d("colorizedObjectIds"),xl=/*#__PURE__*/d("numOpacityObjects"),Sl=/*#__PURE__*/d("opacityObjectIds"),Ml=/*#__PURE__*/d("qualityRender"),Ol=/*#__PURE__*/d("lightsHash"),Rl=/*#__PURE__*/d("sectionPlanesHash"),jl=/*#__PURE__*/d("createViewObjects"),Dl=/*#__PURE__*/d("registerSectionPlane"),Al=/*#__PURE__*/d("deregisterSectionPlane"),Cl=/*#__PURE__*/d("destroyViewObjects"),Bl=/*#__PURE__*/function(e){function t(t){var i;i=e.call(this,null,t)||this,Object.defineProperty(c(i),Cl,{value:Ul}),Object.defineProperty(c(i),Al,{value:Fl}),Object.defineProperty(c(i),Dl,{value:Ll}),Object.defineProperty(c(i),jl,{value:kl}),i.viewIndex=void 0,i.camera=void 0,i.canvasElement=void 0,i.transparent=void 0,i.boundary=void 0,i.logarithmicDepthBufferEnabled=void 0,i.sao=void 0,i.cameraFlight=void 0,i.metrics=void 0,i.xrayMaterial=void 0,i.highlightMaterial=void 0,i.selectedMaterial=void 0,i.edgeMaterial=void 0,i.pointsMaterial=void 0,i.linesMaterial=void 0,i.objects=void 0,i.visibleObjects=void 0,i.xrayedObjects=void 0,i.highlightedObjects=void 0,i.selectedObjects=void 0,i.colorizedObjects=void 0,i.opacityObjects=void 0,i.sectionPlanes=void 0,i.sectionPlanesList=[],i.lights=void 0,i.lightsList=[],i.gammaOutput=void 0,i.layers=void 0,i.autoLayers=void 0,i.onBoundary=void 0,i.onObjectVisibility=void 0,i.onObjectXRayed=void 0,i.onLayerCreated=void 0,i.onLayerDestroyed=void 0,i.onSectionPlaneCreated=void 0,i.onSectionPlaneDestroyed=void 0,Object.defineProperty(c(i),hl,{writable:!0,value:void 0}),Object.defineProperty(c(i),ul,{writable:!0,value:void 0}),Object.defineProperty(c(i),dl,{writable:!0,value:void 0}),Object.defineProperty(c(i),fl,{writable:!0,value:void 0}),Object.defineProperty(c(i),vl,{writable:!0,value:void 0}),Object.defineProperty(c(i),pl,{writable:!0,value:void 0}),Object.defineProperty(c(i),yl,{writable:!0,value:void 0}),Object.defineProperty(c(i),ml,{writable:!0,value:void 0}),Object.defineProperty(c(i),gl,{writable:!0,value:void 0}),Object.defineProperty(c(i),bl,{writable:!0,value:void 0}),Object.defineProperty(c(i),wl,{writable:!0,value:void 0}),Object.defineProperty(c(i),Pl,{writable:!0,value:void 0}),Object.defineProperty(c(i),El,{writable:!0,value:void 0}),Object.defineProperty(c(i),Tl,{writable:!0,value:void 0}),Object.defineProperty(c(i),_l,{writable:!0,value:void 0}),Object.defineProperty(c(i),Il,{writable:!0,value:void 0}),Object.defineProperty(c(i),xl,{writable:!0,value:void 0}),Object.defineProperty(c(i),Sl,{writable:!0,value:void 0}),Object.defineProperty(c(i),Ml,{writable:!0,value:void 0}),Object.defineProperty(c(i),Ol,{writable:!0,value:null}),Object.defineProperty(c(i),Rl,{writable:!0,value:null}),i.viewer=t.viewer;var r=t.canvasElement||document.getElementById(t.canvasId);if(!(r instanceof HTMLCanvasElement))throw"Mandatory View config expected: valid canvasId or canvasElement";i.canvasElement=r,i.viewIndex=0,i.objects={},i.visibleObjects={},i.xrayedObjects={},i.highlightedObjects={},i.selectedObjects={},i.colorizedObjects={},i.opacityObjects={},i.sectionPlanes={},i.sectionPlanesList=[],i.lights={},i.lightsList=[],i.layers={},f(c(i),vl)[vl]=0,f(c(i),pl)[pl]=null,f(c(i),yl)[yl]=0,f(c(i),ml)[ml]=null,f(c(i),gl)[gl]=0,f(c(i),bl)[bl]=null,f(c(i),wl)[wl]=0,f(c(i),Pl)[Pl]=null,f(c(i),El)[El]=0,f(c(i),Tl)[Tl]=null,f(c(i),_l)[_l]=0,f(c(i),Il)[Il]=null,f(c(i),xl)[xl]=0,f(c(i),Sl)[Sl]=null,f(c(i),Ml)[Ml]=!!t.qualityRender,i.gammaOutput=!0,f(c(i),Rl)[Rl]=null,f(c(i),Ol)[Ol]=null,i.onBoundary=new p(new te.EventDispatcher),f(c(i),fl)[fl]=1,f(c(i),ul)[ul]=wt([t.backgroundColor?t.backgroundColor[0]:1,t.backgroundColor?t.backgroundColor[1]:1,t.backgroundColor?t.backgroundColor[2]:1]),f(c(i),dl)[dl]=!!t.backgroundColorFromAmbientLight,i.transparent=!!t.transparent,i.canvasElement.width=i.canvasElement.clientWidth,i.canvasElement.height=i.canvasElement.clientHeight,i.boundary=[i.canvasElement.offsetLeft,i.canvasElement.offsetTop,i.canvasElement.clientWidth,i.canvasElement.clientHeight];var n=0,o=0,s=0,a=0,l=0,h=0,u=null,d=null;return f(c(i),hl)[hl]=i.viewer.onTick.subscribe(function(){var e=i.canvasElement,t=f(c(i),fl)[fl]!==d,r=window.innerWidth!==n||window.innerHeight!==o,v=e.clientWidth!==s||e.clientHeight!==a,p=e.offsetLeft!==l||e.offsetTop!==h,y=e.parentElement;if(t||r||v||p||y!==u){if(t||v||p){var m=e.clientWidth,g=e.clientHeight;(t||v)&&(e.width=Math.round(e.clientWidth*f(c(i),fl)[fl]),e.height=Math.round(e.clientHeight*f(c(i),fl)[fl]));var b=i.boundary;b[0]=e.offsetLeft,b[1]=e.offsetTop,b[2]=m,b[3]=g,t&&!v||i.onBoundary.dispatch(c(i),b),s=m,a=g}t&&(d=f(c(i),fl)[fl]),r&&(n=window.innerWidth,o=window.innerHeight),p&&(l=e.offsetLeft,h=e.offsetTop),u=y}}),i.camera=new hc(c(i)),i.sao=new ea(c(i),{}),i.cameraFlight=new al(c(i),{duration:.5}),i.metrics=new Js(c(i),{units:t.units,scale:t.scale,origin:t.origin}),i.xrayMaterial=new xa(c(i),{fill:!0,fillColor:[.9,.7,.6],fillAlpha:.4,edges:!0,edgeColor:[.5,.4,.4],edgeAlpha:1,edgeWidth:1}),i.highlightMaterial=new xa(c(i),{fill:!0,fillColor:[1,1,0],fillAlpha:.5,edges:!0,edgeColor:[.5,.4,.4],edgeAlpha:1,edgeWidth:1}),i.selectedMaterial=new xa(c(i),{fill:!0,fillColor:[0,1,0],fillAlpha:.5,edges:!0,edgeColor:[.4,.5,.4],edgeAlpha:1,edgeWidth:1}),i.edgeMaterial=new Ma(c(i),{edgeColor:[0,0,0],edgeAlpha:1,edgeWidth:1,edges:!0,renderModes:[Je]}),i.pointsMaterial=new Ra(c(i),{pointSize:1,roundPoints:!0,perspectivePoints:!0,minPerspectivePointSize:1,maxPerspectivePointSize:6,filterIntensity:!1,minIntensity:0,maxIntensity:1}),i.linesMaterial=new ia(c(i),{lineWidth:1}),i.lights={},f(c(i),Ml)[Ml]=!!t.qualityRender,i.autoLayers=!1!==t.autoLayers,i.logarithmicDepthBufferEnabled=!!t.logarithmicDepthBufferEnabled,i.onObjectVisibility=new p(new te.EventDispatcher),i.onObjectXRayed=new p(new te.EventDispatcher),i.onLayerCreated=new p(new te.EventDispatcher),i.onLayerDestroyed=new p(new te.EventDispatcher),i.onSectionPlaneCreated=new p(new te.EventDispatcher),i.onSectionPlaneDestroyed=new p(new te.EventDispatcher),i}r(t,e);var n=t.prototype;return n.initViewObjects=function(){var e=this;for(var t in this.viewer.scene.models)f(this,jl)[jl](this.viewer.scene.models[t]);this.viewer.scene.onModelCreated.subscribe(function(t,i){f(e,jl)[jl](i)}),this.viewer.scene.onModelDestroyed.subscribe(function(t,i){f(e,Cl)[Cl](i)})},n.registerViewObject=function(e){this.objects[e.id]=e,f(this,vl)[vl]++,f(this,pl)[pl]=null},n.deregisterViewObject=function(e){delete this.objects[e.id],delete this.visibleObjects[e.id],delete this.xrayedObjects[e.id],delete this.highlightedObjects[e.id],delete this.selectedObjects[e.id],delete this.colorizedObjects[e.id],delete this.opacityObjects[e.id],f(this,vl)[vl]--,f(this,pl)[pl]=null},n.objectVisibilityUpdated=function(e,t,i){void 0===i&&(i=!0),t?(this.visibleObjects[e.id]=e,f(this,yl)[yl]++):(delete this.visibleObjects[e.id],f(this,yl)[yl]--),f(this,ml)[ml]=null,i&&this.onObjectVisibility.dispatch(this,e)},n.objectXRayedUpdated=function(e,t,i){void 0===i&&(i=!0),t?(this.xrayedObjects[e.id]=e,f(this,gl)[gl]++):(delete this.xrayedObjects[e.id],f(this,gl)[gl]--),f(this,bl)[bl]=null,i&&this.onObjectXRayed.dispatch(this,e)},n.objectHighlightedUpdated=function(e,t){t?(this.highlightedObjects[e.id]=e,f(this,wl)[wl]++):(delete this.highlightedObjects[e.id],f(this,wl)[wl]--),f(this,Pl)[Pl]=null},n.objectSelectedUpdated=function(e,t){t?(this.selectedObjects[e.id]=e,f(this,El)[El]++):(delete this.selectedObjects[e.id],f(this,El)[El]--),f(this,Tl)[Tl]=null},n.objectColorizeUpdated=function(e,t){t?(this.colorizedObjects[e.id]=e,f(this,_l)[_l]++):(delete this.colorizedObjects[e.id],f(this,_l)[_l]--),f(this,Il)[Il]=null},n.objectOpacityUpdated=function(e,t){t?(this.opacityObjects[e.id]=e,f(this,xl)[xl]++):(delete this.opacityObjects[e.id],f(this,xl)[xl]--),f(this,Sl)[Sl]=null},n.createSectionPlane=function(e){var t=this,i=e.id||or();this.sectionPlanes[i]&&(this.error('SectionPlane with ID "'+i+'" already exists - will randomly-generate ID'),i=or());var r=new Ks(this,e);return f(this,Dl)[Dl](r),r.onDestroyed.one(function(){f(t,Al)[Al](r)}),r},n.clearSectionPlanes=function(){for(var e=Object.keys(this.sectionPlanes),t=0,i=e.length;t<i;t++)this.sectionPlanes[e[t]].destroy();this.sectionPlanesList.length=0,f(this,Rl)[Rl]=null},n.getSectionPlanesHash=function(){if(f(this,Rl)[Rl])return f(this,Rl)[Rl];if(0===this.sectionPlanesList.length)return f(this,Rl)[Rl]=";";for(var e=[],t=0,i=this.sectionPlanesList.length;t<i;t++)e.push("cp");return e.push(";"),f(this,Rl)[Rl]=e.join(""),f(this,Rl)[Rl]},n.registerLight=function(e){this.lightsList.push(e),this.lights[e.id]=e,f(this,Ol)[Ol]=null,this.rebuild()},n.deregisterLight=function(e){for(var t=0,i=this.lightsList.length;t<i;t++)if(this.lightsList[t].id===e.id)return this.lightsList.splice(t,1),f(this,Ol)[Ol]=null,delete this.lights[e.id],void this.rebuild()},n.clearLights=function(){for(var e=Object.keys(this.lights),t=0,i=e.length;t<i;t++)this.lights[e[t]].destroy()},n.getLightsHash=function(){if(f(this,Ol)[Ol])return f(this,Ol)[Ol];if(0===this.lightsList.length)return f(this,Ol)[Ol]=";";for(var e=[],t=this.lightsList,i=0,r=t.length;i<r;i++){var n=t[i];e.push("/"),e.push(n.type),e.push("world"===n.space?"w":"v"),n.castsShadow&&e.push("sh")}return e.push(";"),f(this,Ol)[Ol]=e.join(""),f(this,Ol)[Ol]},n.rebuild=function(){this.viewer.renderer.needsRebuild(this.viewIndex)},n.redraw=function(){this.viewer.renderer.setImageDirty(this.viewIndex)},n.getAmbientColorAndIntensity=function(){return[0,0,0,1]},n.setObjectsVisible=function(e,t){return this.withObjects(e,function(e){var i=e.visible!==t;return e.visible=t,i})},n.setObjectsCollidable=function(e,t){return this.withObjects(e,function(e){var i=e.collidable!==t;return e.collidable=t,i})},n.setObjectsCulled=function(e,t){return this.withObjects(e,function(e){var i=e.culled!==t;return e.culled=t,i})},n.setObjectsSelected=function(e,t){return this.withObjects(e,function(e){var i=e.selected!==t;return e.selected=t,i})},n.setObjectsHighlighted=function(e,t){return this.withObjects(e,function(e){var i=e.highlighted!==t;return e.highlighted=t,i})},n.setObjectsXRayed=function(e,t){return this.withObjects(e,function(e){var i=e.xrayed!==t;return i&&(e.xrayed=t),i})},n.setObjectsColorized=function(e,t){return this.withObjects(e,function(e){e.colorize=t})},n.setObjectsOpacity=function(e,t){return this.withObjects(e,function(e){var i=e.opacity!==t;return i&&(e.opacity=t),i})},n.setObjectsPickable=function(e,t){return this.withObjects(e,function(e){var i=e.pickable!==t;return i&&(e.pickable=t),i})},n.setObjectsClippable=function(e,t){return this.withObjects(e,function(e){var i=e.clippable!==t;return i&&(e.clippable=t),i})},n.withObjects=function(e,t){for(var i=!1,r=0,n=e.length;r<n;r++){var o=this.objects[e[r]];o&&(i=t(o)||i)}return i},n.createLayer=function(e){var t=this,i=this.layers[e.id];return i||(i=new Pa({id:e.id,view:this,viewer:this.viewer}),this.layers[e.id]=i,this.onLayerCreated.dispatch(this,i),i.onDestroyed.one(function(){delete t.layers[i.id],t.onLayerDestroyed.dispatch(t,i)})),i.autoDestroy=!1,i},n.destroy=function(){this.viewer.onTick.unsubscribe(f(this,hl)[hl]),e.prototype.destroy.call(this),this.onObjectVisibility.clear(),this.onObjectXRayed.clear(),this.onLayerCreated.clear(),this.onLayerDestroyed.clear(),this.onSectionPlaneCreated.clear(),this.onSectionPlaneDestroyed.clear()},i(t,[{key:"aabb",get:function(){return this.viewer.scene.aabb}},{key:"backgroundColor",get:function(){return f(this,ul)[ul]},set:function(e){e?(f(this,ul)[ul][0]=e[0],f(this,ul)[ul][1]=e[1],f(this,ul)[ul][2]=e[2]):(f(this,ul)[ul][0]=1,f(this,ul)[ul][1]=1,f(this,ul)[ul][2]=1),this.redraw()}},{key:"backgroundColorFromAmbientLight",get:function(){return f(this,dl)[dl]},set:function(e){f(this,dl)[dl]=!1!==e}},{key:"resolutionScale",get:function(){return f(this,fl)[fl]},set:function(e){if((e=e||1)!==f(this,fl)[fl]){f(this,fl)[fl]=e;var t=this.canvasElement;t.width=Math.round(t.clientWidth*f(this,fl)[fl]),t.height=Math.round(t.clientHeight*f(this,fl)[fl]),this.redraw()}}},{key:"gammaFactor",get:function(){return 1}},{key:"qualityRender",get:function(){return f(this,Ml)[Ml]},set:function(e){f(this,Ml)[Ml]!==e&&(f(this,Ml)[Ml]=e,this.redraw())}},{key:"numObjects",get:function(){return f(this,vl)[vl]}},{key:"objectIds",get:function(){return f(this,pl)[pl]||(f(this,pl)[pl]=Object.keys(this.objects)),f(this,pl)[pl]}},{key:"numVisibleObjects",get:function(){return f(this,yl)[yl]}},{key:"visibleObjectIds",get:function(){return f(this,ml)[ml]||(f(this,ml)[ml]=Object.keys(this.visibleObjects)),f(this,ml)[ml]}},{key:"numXRayedObjects",get:function(){return f(this,gl)[gl]}},{key:"xrayedObjectIds",get:function(){return f(this,bl)[bl]||(f(this,bl)[bl]=Object.keys(this.xrayedObjects)),f(this,bl)[bl]}},{key:"numHighlightedObjects",get:function(){return f(this,wl)[wl]}},{key:"highlightedObjectIds",get:function(){return f(this,Pl)[Pl]||(f(this,Pl)[Pl]=Object.keys(this.highlightedObjects)),f(this,Pl)[Pl]}},{key:"numSelectedObjects",get:function(){return f(this,El)[El]}},{key:"selectedObjectIds",get:function(){return f(this,Tl)[Tl]||(f(this,Tl)[Tl]=Object.keys(this.selectedObjects)),f(this,Tl)[Tl]}},{key:"numColorizedObjects",get:function(){return f(this,_l)[_l]}},{key:"colorizedObjectIds",get:function(){return f(this,Il)[Il]||(f(this,Il)[Il]=Object.keys(this.colorizedObjects)),f(this,Il)[Il]}},{key:"opacityObjectIds",get:function(){return f(this,Sl)[Sl]||(f(this,Sl)[Sl]=Object.keys(this.opacityObjects)),f(this,Sl)[Sl]}},{key:"numOpacityObjects",get:function(){return f(this,xl)[xl]}}]),t}(ae);function kl(e){var t=this,i=e.objects,r=this.viewer.renderer.rendererViewObjects,n=function(){var e=i[o],n=r[o],s="default",a=t.layers[s];if(!a){if(!t.autoLayers)return"continue";a=new Pa({id:s,view:t,viewer:t.viewer}),t.layers[s]=a,a.onDestroyed.one(function(){delete t.layers[a.id],t.onLayerDestroyed.dispatch(t,a)}),t.onLayerCreated.dispatch(t,a)}var c=new Ws(a,e,n);a.registerViewObject(c),t.registerViewObject(c)};for(var o in i)n()}function Ll(e){this.sectionPlanesList.push(e),this.sectionPlanes[e.id]=e,f(this,Rl)[Rl]=null,this.rebuild(),this.onSectionPlaneCreated.dispatch(this,e)}function Fl(e){for(var t=0,i=this.sectionPlanesList.length;t<i;t++)if(this.sectionPlanesList[t].id===e.id)return this.sectionPlanesList.splice(t,1),f(this,Rl)[Rl]=null,delete this.sectionPlanes[e.id],this.rebuild(),void this.onSectionPlaneDestroyed.dispatch(this,e)}function Ul(e){var t=e.objects;for(var i in t){var r=this.layers.default,n=this.objects[t[i].id];this.deregisterViewObject(n),r&&(r.deregisterViewObject(n),r.autoDestroy&&0===r.numObjects&&r.destroy())}}var Nl=/*#__PURE__*/d("prefixMessageWithID"),Gl=/*#__PURE__*/d("registerView"),Vl=/*#__PURE__*/d("deregisterView"),Hl=/*#__PURE__*/function(e){function t(t){var i;return i=e.call(this,null,{})||this,Object.defineProperty(c(i),Vl,{value:Yl}),Object.defineProperty(c(i),Gl,{value:Wl}),Object.defineProperty(c(i),Nl,{value:Xl}),i.capabilities=void 0,i.onTick=void 0,i.onViewCreated=void 0,i.onViewDestroyed=void 0,i.scene=void 0,i.views=void 0,i.viewList=void 0,i.numViews=void 0,i.startTime=(new Date).getTime(),i.renderer=void 0,i.onTick=new p(new te.EventDispatcher),i.onViewCreated=new p(new te.EventDispatcher),i.onViewDestroyed=new p(new te.EventDispatcher),i.id=t.id||or(),i.viewList=[],i.numViews=0,i.views={},i.destroyed=!1,i.capabilities={maxViews:0,astcSupported:!1,etc1Supported:!1,etc2Supported:!1,dxtSupported:!1,bptcSupported:!1,pvrtcSupported:!1},i.scene=t.scene||new go,i.renderer=t.renderer,i.renderer.getCapabilities(i.capabilities),i.renderer.attachViewer(c(i)),xc.registerViewer(c(i)),i}r(t,e);var i=t.prototype;return i.createView=function(e){var t=this;if(this.viewList.length>=this.capabilities.maxViews)return new he("Attempted to create too many Views with View.createView() - maximum of "+this.capabilities.maxViews+" is allowed");var i=e.id||or();if(this.views[i])return new he('View with ID "'+i+'" already exists');if(!((e.canvasElement||document.getElementById(e.canvasId))instanceof HTMLCanvasElement))return new he("Mandatory View config expected: valid canvasId or canvasElement");var r=new Bl(rr({viewId:i,viewer:this},e));for(var n in f(this,Gl)[Gl](r),r.viewIndex=this.renderer.attachView(r),r.onDestroyed.one(function(){f(t,Vl)[Vl](r),t.renderer.detachView(r.viewIndex),t.onViewDestroyed.dispatch(t,r)}),this.scene.onModelCreated.subscribe(function(e,i){t.renderer.attachSceneModel(i)}),this.scene.onModelDestroyed.subscribe(function(e,i){t.renderer.detachSceneModel(i)}),this.scene.models)this.renderer.attachSceneModel(this.scene.models[n]);return r.initViewObjects(),this.onViewCreated.dispatch(this,r),this.log("View created: "+r.viewId),r},i.redraw=function(){for(var e in this.views)this.views[e].redraw()},i.log=function(e){e="[LOG] "+f(this,Nl)[Nl](e),window.console.log(e)},i.warn=function(e){e="[WARN] "+f(this,Nl)[Nl](e),window.console.warn(e)},i.error=function(e){e="[ERROR] "+f(this,Nl)[Nl](e),window.console.error(e)},i.destroy=function(){if(!this.destroyed){for(var e in xc.deregisterViewer(this),this.views)this.views[e].destroy();this.onTick.clear(),this.onViewCreated.clear(),this.onViewDestroyed.clear()}},i.render=function(e){for(var t=0;t<this.viewList.length;t++)this.renderer.render(t,{force:!0})},t}(ae);function Xl(e){return" ["+this.constructor.name+' "'+nr(this.id)+'"]: '+e}function Wl(e){if(!this.views[e.id]){this.views[e.id]=e;for(var t=0;;t++)if(!this.viewList[t])return this.viewList[t]=e,this.numViews++,void(e.viewIndex=t)}}function Yl(e){this.views[e.id]&&(delete this.views[e.id],delete this.viewList[e.viewIndex],this.numViews--)}var Kl=/*#__PURE__*/d("state"),zl=/*#__PURE__*/function(e){function t(t,i){var r;return void 0===i&&(i={}),(r=e.call(this,t,i)||this).view=void 0,Object.defineProperty(c(r),Kl,{writable:!0,value:void 0}),r.view=t,f(c(r),Kl)[Kl]={type:"ambient",color:new Float32Array(i.color||[.7,.7,.7]),intensity:null!=i.intensity?i.intensity:1},r.view.registerLight(c(r)),r}return r(t,e),t.prototype.destroy=function(){e.prototype.destroy.call(this),this.view.deregisterLight(this)},i(t,[{key:"color",get:function(){return f(this,Kl)[Kl].color},set:function(e){f(this,Kl)[Kl].color.set(e),this.view.redraw()}},{key:"intensity",get:function(){return f(this,Kl)[Kl].intensity},set:function(e){f(this,Kl)[Kl].intensity=void 0!==e?e:1,this.view.redraw()}}]),t}(ae),ql=/*#__PURE__*/d("state"),Zl=/*#__PURE__*/function(e){function t(t,i){var r;return void 0===i&&(i={}),(r=e.call(this,t,i)||this).view=void 0,Object.defineProperty(c(r),ql,{writable:!0,value:void 0}),r.view=t,f(c(r),ql)[ql]={type:"dir",dir:new Float32Array(i.dir||[1,1,1]),color:new Float32Array(i.color||[.7,.7,.8]),intensity:null!=i.intensity?i.intensity:1,space:i.space||"view"},r.view.registerLight(c(r)),r}return r(t,e),t.prototype.destroy=function(){e.prototype.destroy.call(this),this.view.deregisterLight(this),this.view.redraw()},i(t,[{key:"dir",get:function(){return f(this,ql)[ql].dir},set:function(e){f(this,ql)[ql].dir.set(e),this.view.redraw()}},{key:"color",get:function(){return f(this,ql)[ql].color},set:function(e){f(this,ql)[ql].color.set(e),this.view.redraw()}},{key:"intensity",get:function(){return f(this,ql)[ql].intensity},set:function(e){f(this,ql)[ql].intensity=e,this.view.redraw()}}]),t}(ae),Ql=/*#__PURE__*/d("state"),Jl=/*#__PURE__*/function(e){function t(t,i){var r;return void 0===i&&(i={}),(r=e.call(this,t,i)||this).view=void 0,Object.defineProperty(c(r),Ql,{writable:!0,value:void 0}),r.view=t,f(c(r),Ql)[Ql]={type:"point",pos:new Float64Array(i.pos||[1,1,1]),color:new Float32Array(i.color||[.7,.7,.8]),intensity:1,attenuation:new Float32Array([i.constantAttenuation,i.linearAttenuation,i.quadraticAttenuation]),space:i.space||"view"},r.view.registerLight(c(r)),r}return r(t,e),t.prototype.destroy=function(){e.prototype.destroy.call(this),this.view.deregisterLight(this),this.view.redraw()},i(t,[{key:"pos",get:function(){return f(this,Ql)[Ql].pos},set:function(e){f(this,Ql)[Ql].pos.set(e||[1,1,1]),this.view.redraw()}},{key:"color",get:function(){return f(this,Ql)[Ql].color},set:function(e){f(this,Ql)[Ql].color.set(e||[.7,.7,.8]),this.view.redraw()}},{key:"intensity",get:function(){return f(this,Ql)[Ql].intensity},set:function(e){e!==f(this,Ql)[Ql].intensity&&(f(this,Ql)[Ql].intensity=e,this.view.redraw())}},{key:"constantAttenuation",get:function(){return f(this,Ql)[Ql].attenuation[0]},set:function(e){f(this,Ql)[Ql].attenuation[0]=e,this.view.redraw()}},{key:"linearAttenuation",get:function(){return f(this,Ql)[Ql].attenuation[1]},set:function(e){f(this,Ql)[Ql].attenuation[1]=e,this.view.redraw()}},{key:"quadraticAttenuation",get:function(){return f(this,Ql)[Ql].attenuation[2]},set:function(e){f(this,Ql)[Ql].attenuation[2]=e,this.view.redraw()}}]),t}(ae),$l=/*#__PURE__*/d("viewObject"),eh=/*#__PURE__*/d("gotCanvasPos"),th=/*#__PURE__*/d("gotOrigin"),ih=/*#__PURE__*/d("gotDirection"),rh=/*#__PURE__*/d("gotIndices"),nh=/*#__PURE__*/d("gotLocalPos"),oh=/*#__PURE__*/d("gotWorldPos"),sh=/*#__PURE__*/d("gotViewPos"),ah=/*#__PURE__*/d("gotWorldNormal"),ch=/*#__PURE__*/d("gotUV"),lh=/*#__PURE__*/d("canvasPos"),hh=/*#__PURE__*/d("origin"),uh=/*#__PURE__*/d("direction"),dh=/*#__PURE__*/d("indices"),fh=/*#__PURE__*/d("localPos"),vh=/*#__PURE__*/d("worldPos"),ph=/*#__PURE__*/d("viewPos"),yh=/*#__PURE__*/d("worldNormal"),mh=/*#__PURE__*/d("uv"),gh={__proto__:null,Viewer:Hl,Camera:hc,FrustumProjection:Xa,OrthoProjection:Na,PerspectiveProjection:Ba,CustomProjection:za,CameraFlightAnimation:al,AmbientLight:zl,DirLight:Zl,PointLight:Jl,EmphasisMaterial:xa,EdgeMaterial:Ma,PointsMaterial:Ra,Metrics:Js,View:Bl,ViewLayer:Pa,ViewObject:Ws,SectionPlane:Ks,SAO:ea,PickResult:/*#__PURE__*/function(){function e(){Object.defineProperty(this,$l,{writable:!0,value:void 0}),Object.defineProperty(this,eh,{writable:!0,value:void 0}),Object.defineProperty(this,th,{writable:!0,value:void 0}),Object.defineProperty(this,ih,{writable:!0,value:void 0}),Object.defineProperty(this,rh,{writable:!0,value:void 0}),Object.defineProperty(this,nh,{writable:!0,value:void 0}),Object.defineProperty(this,oh,{writable:!0,value:void 0}),Object.defineProperty(this,sh,{writable:!0,value:void 0}),Object.defineProperty(this,ah,{writable:!0,value:void 0}),Object.defineProperty(this,ch,{writable:!0,value:void 0}),Object.defineProperty(this,lh,{writable:!0,value:void 0}),Object.defineProperty(this,hh,{writable:!0,value:void 0}),Object.defineProperty(this,uh,{writable:!0,value:void 0}),Object.defineProperty(this,dh,{writable:!0,value:void 0}),Object.defineProperty(this,fh,{writable:!0,value:void 0}),Object.defineProperty(this,vh,{writable:!0,value:void 0}),Object.defineProperty(this,ph,{writable:!0,value:void 0}),Object.defineProperty(this,yh,{writable:!0,value:void 0}),Object.defineProperty(this,mh,{writable:!0,value:void 0}),f(this,$l)[$l]=null,f(this,lh)[lh]=new Int16Array([0,0]),f(this,hh)[hh]=new Float64Array([0,0,0]),f(this,uh)[uh]=new Float64Array([0,0,0]),f(this,dh)[dh]=new Int32Array(3),f(this,fh)[fh]=new Float64Array([0,0,0]),f(this,vh)[vh]=new Float64Array([0,0,0]),f(this,ph)[ph]=new Float64Array([0,0,0]),f(this,yh)[yh]=new Float64Array([0,0,0]),f(this,mh)[mh]=new Float64Array([0,0]),f(this,th)[th]=!1,f(this,ih)[ih]=!1,f(this,rh)[rh]=!1,f(this,eh)[eh]=!1,f(this,nh)[nh]=!1,f(this,oh)[oh]=!1,f(this,sh)[sh]=!1,f(this,ah)[ah]=!1,f(this,ch)[ch]=!1,this.reset()}return e.prototype.reset=function(){f(this,$l)[$l]=null,f(this,eh)[eh]=!1,f(this,th)[th]=!1,f(this,ih)[ih]=!1,f(this,rh)[rh]=!1,f(this,nh)[nh]=!1,f(this,oh)[oh]=!1,f(this,sh)[sh]=!1,f(this,ah)[ah]=!1,f(this,ch)[ch]=!1},i(e,[{key:"viewObject",get:function(){return f(this,$l)[$l]},set:function(e){f(this,$l)[$l]=e}},{key:"canvasPos",get:function(){return f(this,eh)[eh]?f(this,lh)[lh]:void 0},set:function(e){e?(f(this,lh)[lh][0]=e[0],f(this,lh)[lh][1]=e[1],f(this,eh)[eh]=!0):f(this,eh)[eh]=!1}},{key:"origin",get:function(){return f(this,th)[th]?f(this,hh)[hh]:null},set:function(e){e?(f(this,hh)[hh][0]=e[0],f(this,hh)[hh][1]=e[1],f(this,hh)[hh][2]=e[2],f(this,th)[th]=!0):f(this,th)[th]=!1}},{key:"direction",get:function(){return f(this,ih)[ih]?f(this,uh)[uh]:null},set:function(e){e?(f(this,uh)[uh][0]=e[0],f(this,uh)[uh][1]=e[1],f(this,uh)[uh][2]=e[2],f(this,ih)[ih]=!0):f(this,ih)[ih]=!1}},{key:"indices",get:function(){return f(this,$l)[$l]&&f(this,rh)[rh]?f(this,dh)[dh]:null},set:function(e){e?(f(this,dh)[dh][0]=e[0],f(this,dh)[dh][1]=e[1],f(this,dh)[dh][2]=e[2],f(this,rh)[rh]=!0):f(this,rh)[rh]=!1}},{key:"localPos",get:function(){return f(this,$l)[$l]&&f(this,nh)[nh]?f(this,fh)[fh]:null},set:function(e){e?(f(this,fh)[fh][0]=e[0],f(this,fh)[fh][1]=e[1],f(this,fh)[fh][2]=e[2],f(this,nh)[nh]=!0):f(this,nh)[nh]=!1}},{key:"worldPos",get:function(){return f(this,$l)[$l]&&f(this,oh)[oh]?f(this,vh)[vh]:null},set:function(e){e?(f(this,vh)[vh][0]=e[0],f(this,vh)[vh][1]=e[1],f(this,vh)[vh][2]=e[2],f(this,oh)[oh]=!0):f(this,oh)[oh]=!1}},{key:"viewPos",get:function(){return f(this,$l)[$l]&&f(this,sh)[sh]?f(this,ph)[ph]:null},set:function(e){e?(f(this,ph)[ph][0]=e[0],f(this,ph)[ph][1]=e[1],f(this,ph)[ph][2]=e[2],f(this,sh)[sh]=!0):f(this,sh)[sh]=!1}},{key:"worldNormal",get:function(){return f(this,$l)[$l]&&f(this,ah)[ah]?f(this,yh)[yh]:null},set:function(e){e?(f(this,yh)[yh][0]=e[0],f(this,yh)[yh][1]=e[1],f(this,yh)[yh][2]=e[2],f(this,ah)[ah]=!0):f(this,ah)[ah]=!1}},{key:"uv",get:function(){return f(this,$l)[$l]&&f(this,ch)[ch]?f(this,mh)[mh]:null},set:function(e){e?(f(this,mh)[mh][0]=e[0],f(this,mh)[mh][1]=e[1],f(this,ch)[ch]=!0):f(this,ch)[ch]=!1}}]),e}()},bh=0,wh={ETC1S:0,UASTC_4x4:1},Ph={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16},Eh={RGBAFormat:ge,RGBA_ASTC_4x4_Format:Re,RGBA_BPTC_Format:Xe,RGBA_ETC2_EAC_Format:Oe,RGBA_PVRTC_4BPPV1_Format:Ie,RGBA_S3TC_DXT5_Format:Ee,RGB_ETC1_Format:Se,RGB_ETC2_Format:Me,RGB_PVRTC_4BPPV1_Format:Te,RGB_S3TC_DXT1_Format:be},Th=/*#__PURE__*/d("transcoderPath"),_h=/*#__PURE__*/d("transcoderBinary"),Ih=/*#__PURE__*/d("transcoderPending"),xh=/*#__PURE__*/d("workerPool"),Sh=/*#__PURE__*/d("workerSourceURL"),Mh=/*#__PURE__*/d("workerConfig"),Oh=/*#__PURE__*/d("supportedFileTypes"),Rh=/*#__PURE__*/d("withCredentials"),jh=/*#__PURE__*/d("initTranscoder"),Dh=/*#__PURE__*/function(){function e(e){Object.defineProperty(this,jh,{value:Ah}),Object.defineProperty(this,Th,{writable:!0,value:void 0}),Object.defineProperty(this,_h,{writable:!0,value:void 0}),Object.defineProperty(this,Ih,{writable:!0,value:void 0}),Object.defineProperty(this,xh,{writable:!0,value:void 0}),Object.defineProperty(this,Sh,{writable:!0,value:void 0}),Object.defineProperty(this,Mh,{writable:!0,value:void 0}),Object.defineProperty(this,Oh,{writable:!0,value:void 0}),Object.defineProperty(this,Rh,{writable:!0,value:void 0}),f(this,Th)[Th]=e.transcoderPath||"https://cdn.jsdelivr.net/npm/@xeokit/sdk/dist/basis/",f(this,_h)[_h]=null,f(this,Ih)[Ih]=null,f(this,xh)[xh]=new Ki,f(this,Sh)[Sh]="",e.workerLimit&&f(this,xh)[xh].setWorkerLimit(e.workerLimit),f(this,Mh)[Mh]=null,f(this,Rh)[Rh]=!1,f(this,Oh)[Oh]=["xkt2"]}var t=e.prototype;return t.init=function(e){f(this,Mh)[Mh]={astcSupported:e.astcSupported,etc1Supported:e.etc1Supported,etc2Supported:e.etc2Supported,dxtSupported:e.dxtSupported,bptcSupported:e.bptcSupported,pvrtcSupported:e.pvrtcSupported}},t.transcode=function(e,t){var i=this;return void 0===t&&(t={}),new Promise(function(r,n){var o=t;f(i,jh)[jh]().then(function(){return f(i,xh)[xh].postMessage({type:"transcode",buffers:e,taskConfig:o},e)}).then(function(e){var t=e.data,i=t.mipmaps,o=t.format,s=t.dfdTransferFn,a=t.dfdFlags;if("error"===t.type)return n(t.error);r({mipmaps:i,props:{format:o,minFilter:1===i.length?ve:ye,magFilter:1===i.length?ve:ye,encoding:2===s?Ye:We,premultiplyAlpha:!!(1&a)}})})})},t.destroy=function(){URL.revokeObjectURL(f(this,Sh)[Sh]),f(this,xh)[xh].destroy(),bh--},e}();function Ah(){var e=this;if(!f(this,Ih)[Ih]){var t=new Zi;t.setPath(f(this,Th)[Th]),t.setWithCredentials(f(this,Rh)[Rh]);var i=t.loadAsync("basis_transcoder.js"),r=new Zi;r.setPath(f(this,Th)[Th]),r.setResponseType("arraybuffer"),r.setWithCredentials(f(this,Rh)[Rh]);var n=r.loadAsync("basis_transcoder.wasm");f(this,Ih)[Ih]=Promise.all([i,n]).then(function(t){var i=t[0],r=t[1],n=Ch.toString(),o=["/* constants */","let _EngineFormat = "+JSON.stringify(Eh),"let _TranscoderFormat = "+JSON.stringify(Ph),"let _BasisFormat = "+JSON.stringify(wh),"/* basis_transcoder.js */",i,"/* worker */",n.substring(n.indexOf("{")+1,n.lastIndexOf("}"))].join("\n");f(e,Sh)[Sh]=URL.createObjectURL(new Blob([o])),f(e,_h)[_h]=r,f(e,xh)[xh].setWorkerCreator(function(){var t=new Worker(f(e,Sh)[Sh]),i=f(e,_h)[_h].slice(0);return t.postMessage({type:"init",config:f(e,Mh)[Mh],transcoderBinary:i},[i]),t})}),bh>0&&console.warn("KTX2TextureTranscoder: Multiple active KTX2TextureTranscoder may cause performance issues. Use a single KTX2TextureTranscoder instance, or call .dispose() on old instances."),bh++}return f(this,Ih)[Ih]}var Ch=function(){var e,t,i,r=_EngineFormat,n=_TranscoderFormat,o=_BasisFormat;self.addEventListener("message",function(s){var h,u=s.data;switch(u.type){case"init":e=u.config,h=u.transcoderBinary,t=new Promise(function(e){i={wasmBinary:h,onRuntimeInitialized:e},BASIS(i)}).then(function(){i.initializeBasis(),void 0===i.KTX2File&&console.warn("KTX2TextureTranscoder: Please update Basis Universal transcoder.")});break;case"transcode":t.then(function(){try{for(var t=function(t){var s=new i.KTX2File(new Uint8Array(t));function h(){s.close(),s.delete()}if(!s.isValid())throw h(),new Error("KTX2TextureTranscoder: Invalid or unsupported .ktx2 file");var u=s.isUASTC()?o.UASTC_4x4:o.ETC1S,d=s.getWidth(),f=s.getHeight(),v=s.getLevels(),p=s.getHasAlpha(),y=s.getDFDTransferFunc(),m=s.getDFDFlags(),g=function(t,i,s,h){for(var u=t===o.ETC1S?a:c,d=0;d<u.length;d++){var f=u[d];if(e[f.if]&&f.basisFormat.includes(t)&&!(h&&f.transcoderFormat.length<2)&&(!f.needsPowerOfTwo||l(i)&&l(s)))return{transcoderFormat:f.transcoderFormat[h?1:0],engineFormat:f.engineFormat[h?1:0]}}return console.warn("KTX2TextureTranscoder: No suitable compressed texture format found. Decoding to RGBA32."),{transcoderFormat:n.RGBA32,engineFormat:r.RGBAFormat}}(u,d,f,p),b=g.transcoderFormat,w=g.engineFormat;if(!d||!f||!v)throw h(),new Error("KTX2TextureTranscoder: Invalid texture");if(!s.startTranscoding())throw h(),new Error("KTX2TextureTranscoder: .startTranscoding failed");for(var P=[],E=0;E<v;E++){var T=s.getImageLevelInfo(E,0,0),_=T.origWidth,I=T.origHeight,x=new Uint8Array(s.getImageTranscodedSizeInBytes(E,0,0,b));if(!s.transcodeImage(x,E,0,0,b,0,-1,-1))throw h(),new Error("KTX2TextureTranscoder: .transcodeImage failed.");P.push({data:x,width:_,height:I})}return h(),{width:d,height:f,hasAlpha:p,mipmaps:P,format:w,dfdTransferFn:y,dfdFlags:m}}(u.buffers[0]),s=t.width,h=t.height,d=t.hasAlpha,f=t.mipmaps,v=t.format,p=t.dfdTransferFn,y=t.dfdFlags,m=[],g=0;g<f.length;++g)m.push(f[g].data.buffer);self.postMessage({type:"transcode",id:u.id,width:s,height:h,hasAlpha:d,mipmaps:f,format:v,dfdTransferFn:p,dfdFlags:y},m)}catch(e){console.error("[BasisWorker]: "+e),self.postMessage({type:"error",id:u.id,error:e.message})}})}});var s=[{if:"astcSupported",basisFormat:[o.UASTC_4x4],transcoderFormat:[n.ASTC_4x4,n.ASTC_4x4],engineFormat:[r.RGBA_ASTC_4x4_Format,r.RGBA_ASTC_4x4_Format],priorityETC1S:Infinity,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[o.ETC1S,o.UASTC_4x4],transcoderFormat:[n.BC7_M5,n.BC7_M5],engineFormat:[r.RGBA_BPTC_Format,r.RGBA_BPTC_Format],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[o.ETC1S,o.UASTC_4x4],transcoderFormat:[n.BC1,n.BC3],engineFormat:[r.RGB_S3TC_DXT1_Format,r.RGBA_S3TC_DXT5_Format],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[o.ETC1S,o.UASTC_4x4],transcoderFormat:[n.ETC1,n.ETC2],engineFormat:[r.RGB_ETC2_Format,r.RGBA_ETC2_EAC_Format],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[o.ETC1S,o.UASTC_4x4],transcoderFormat:[n.ETC1],engineFormat:[r.RGB_ETC1_Format],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[o.ETC1S,o.UASTC_4x4],transcoderFormat:[n.PVRTC1_4_RGB,n.PVRTC1_4_RGBA],engineFormat:[r.RGB_PVRTC_4BPPV1_Format,r.RGBA_PVRTC_4BPPV1_Format],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0}],a=s.sort(function(e,t){return e.priorityETC1S-t.priorityETC1S}),c=s.sort(function(e,t){return e.priorityUASTC-t.priorityUASTC});function l(e){return e<=2||0==(e&e-1)&&0!==e}},Bh={__proto__:null,KTX2TextureTranscoder:Dh},kh=/*#__PURE__*/function(){function e(e,t){this.gl=void 0,this.location=void 0,this.gl=e,this.location=t}return e.prototype.bindArrayBuffer=function(e){e&&(e.bind(),this.gl.enableVertexAttribArray(this.location),this.gl.vertexAttribPointer(this.location,e.itemSize,e.itemType,e.normalized,e.stride,e.offset))},e}(),Lh=/*#__PURE__*/d("onDestroyed"),Fh=/*#__PURE__*/function(){function e(e){void 0===e&&(e={}),this.gl=void 0,this.texture=void 0,this.textureWidth=void 0,this.textureHeight=void 0,this.textureData=void 0,Object.defineProperty(this,Lh,{writable:!0,value:void 0}),this.gl=e.gl,this.texture=e.texture,this.textureWidth=e.textureWidth,this.textureHeight=e.textureHeight,this.textureData=e.textureData,f(this,Lh)[Lh]=e.onDestroyed}var t=e.prototype;return t.bindTexture=function(e,t,i){this.gl&&t.bindTexture(this,i)},t.bind=function(e){return!(!this.gl||!this.texture||(this.gl.activeTexture(this.gl["TEXTURE"+e]),this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture),0))},t.disableFiltering=function(){this.gl&&(this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.NEAREST),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.NEAREST),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE))},t.unbind=function(e){},t.destroy=function(){this.gl&&this.texture&&(this.gl.deleteTexture(this.texture),this.texture=null,f(this,Lh)[Lh]&&f(this,Lh)[Lh]())},e}(),Uh=/*#__PURE__*/function(){function e(e,t,i){if(this.errors=void 0,this.allocated=void 0,this.compiled=void 0,this.handle=void 0,this.allocated=!1,this.compiled=!1,this.handle=e.createShader(t),this.handle){if(this.allocated=!0,e.shaderSource(this.handle,i),e.compileShader(this.handle),this.compiled=e.getShaderParameter(this.handle,e.COMPILE_STATUS),!this.compiled&&!e.isContextLost()){for(var r=i.split("\n"),n=[],o=0;o<r.length;o++)n.push(o+1+": "+r[o]+"\n");this.errors=[],this.errors.push(""),this.errors.push(e.getShaderInfoLog(this.handle)||""),this.errors=this.errors.concat(n.join(""))}}else this.errors=["Failed to allocate"]}return e.prototype.destroy=function(){},e}(),Nh=/*#__PURE__*/function(){function e(e,t){this.location=void 0,this.gl=void 0,this.gl=e,this.location=t}return e.prototype.bindTexture=function(e,t){return!!e.bind(t)&&(this.gl.uniform1i(this.location,t),!0)},e}(),Gh=new Vi({},""),Vh=/*#__PURE__*/function(){function e(e,t){if(this.id=void 0,this.vertexShader=void 0,this.fragmentShader=void 0,this.attributes=void 0,this.samplers=void 0,this.uniforms=void 0,this.errors=void 0,this.validated=void 0,this.linked=void 0,this.compiled=void 0,this.allocated=void 0,this.gl=void 0,this.source=void 0,this.handle=void 0,this.id=Gh.addItem({}),this.source=t,this.gl=e,this.allocated=!1,this.compiled=!1,this.linked=!1,this.validated=!1,this.errors=[],this.uniforms={},this.samplers={},this.attributes={},this.vertexShader=new Uh(e,e.VERTEX_SHADER,this.source.vertex),this.fragmentShader=new Uh(e,e.FRAGMENT_SHADER,this.source.fragment),!this.vertexShader.allocated)return this.errors=["Vertex shader failed to allocate"].concat(this.vertexShader.errors),void Hh(this.errors);if(!this.fragmentShader.allocated)return this.errors=["Fragment shader failed to allocate"].concat(this.fragmentShader.errors),void Hh(this.errors);if(this.allocated=!0,!this.vertexShader.compiled)return this.errors=["Vertex shader failed to compile"].concat(this.vertexShader.errors),void Hh(this.errors);if(!this.fragmentShader.compiled)return this.errors=["Fragment shader failed to compile"].concat(this.fragmentShader.errors),void Hh(this.errors);if(this.compiled=!0,this.handle=e.createProgram(),this.handle){if(e.attachShader(this.handle,this.vertexShader.handle),e.attachShader(this.handle,this.fragmentShader.handle),e.linkProgram(this.handle),this.linked=e.getProgramParameter(this.handle,e.LINK_STATUS),this.validated=!0,!this.linked||!this.validated)return this.errors=[],this.errors.push(""),this.errors.push(e.getProgramInfoLog(this.handle)),this.errors.push("\nVertex shader:\n"),this.errors=this.errors.concat(this.source.vertex),this.errors.push("\nFragment shader:\n"),this.errors=this.errors.concat(this.source.fragment),void Hh(this.errors);for(var i=e.getProgramParameter(this.handle,e.ACTIVE_UNIFORMS),r=0;r<i;++r){var n=e.getActiveUniform(this.handle,r);if(n){var o=n.name;"\0"===o[o.length-1]&&(o=o.substr(0,o.length-1));var s=e.getUniformLocation(this.handle,o);n.type===e.SAMPLER_2D||n.type===e.SAMPLER_CUBE||35682===n.type?this.samplers[o]=new Nh(e,s):this.uniforms[o]=s}}for(var a=e.getProgramParameter(this.handle,e.ACTIVE_ATTRIBUTES),c=0;c<a;c++){var l=e.getActiveAttrib(this.handle,c);if(l){var h=e.getAttribLocation(this.handle,l.name);this.attributes[l.name]=new kh(e,h)}}this.allocated=!0}else this.errors=["Failed to allocate program"]}var t=e.prototype;return t.bind=function(){this.allocated&&this.gl.useProgram(this.handle)},t.getLocation=function(e){return this.uniforms[e]},t.getAttribute=function(e){return this.attributes[e]},t.getSampler=function(e){return this.samplers[e]},t.bindTexture=function(e,t,i){if(!this.allocated)return!1;var r=this.samplers[e];return!!r&&r.bindTexture(t,i)},t.destroy=function(){this.allocated&&(Gh.removeItem(this.id),this.gl.deleteProgram(this.handle),this.gl.deleteShader(this.vertexShader.handle),this.gl.deleteShader(this.fragmentShader.handle),this.attributes={},this.uniforms={},this.samplers={},this.allocated=!1)},e}();function Hh(e){console.error(e.join("\n"))}function Xh(e,t){if(void 0===e._cachedExtensions&&(e._cachedExtensions={}),void 0!==e._cachedExtensions[t])return e._cachedExtensions[t];var i;switch(t){case"WEBGL_depth_texture":i=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=e.getExtension(t)}return e._cachedExtensions[t]=i,i}function Wh(e,t,i){var r,n=t;if(n===me)return e.UNSIGNED_BYTE;if(1017===n)return e.UNSIGNED_SHORT_4_4_4_4;if(1018===n)return e.UNSIGNED_SHORT_5_5_5_1;if(1010===n)return e.BYTE;if(1011===n)return e.SHORT;if(1012===n)return e.UNSIGNED_SHORT;if(1013===n)return e.INT;if(1014===n)return e.UNSIGNED_INT;if(1015===n)return e.FLOAT;if(1016===n)return e.HALF_FLOAT;if(1021===n)return e.ALPHA;if(n===ge)return e.RGBA;if(1024===n)return e.LUMINANCE;if(1025===n)return e.LUMINANCE_ALPHA;if(1026===n)return e.DEPTH_COMPONENT;if(1027===n)return e.DEPTH_STENCIL;if(1028===n)return e.RED;if(1022===n)return e.RGBA;if(1029===n)return e.RED_INTEGER;if(1030===n)return e.RG;if(1031===n)return e.RG_INTEGER;if(1033===n)return e.RGBA_INTEGER;if(n===be||n===we||n===Pe||n===Ee)if(i===Ye){var o=Xh(e,"WEBGL_compressed_texture_s3tc_srgb");if(null===o)return null;if(n===be)return o.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(n===we)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(n===Pe)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(n===Ee)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(null===(r=Xh(e,"WEBGL_compressed_texture_s3tc")))return null;if(n===be)return r.COMPRESSED_RGB_S3TC_DXT1_EXT;if(n===we)return r.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(n===Pe)return r.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(n===Ee)return r.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(n===Te||n===_e||n===Ie||n===xe){var s=Xh(e,"WEBGL_compressed_texture_pvrtc");if(null===s)return null;if(n===Te)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(n===_e)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(n===Ie)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(n===xe)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(n===Se){var a=Xh(e,"WEBGL_compressed_texture_etc1");return null!==a?a.COMPRESSED_RGB_ETC1_WEBGL:null}if(n===Me||n===Oe){var c=Xh(e,"WEBGL_compressed_texture_etc");if(null===c)return null;if(n===Me)return i===Ye?c.COMPRESSED_SRGB8_ETC2:c.COMPRESSED_RGB8_ETC2;if(n===Oe)return i===Ye?c.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:c.COMPRESSED_RGBA8_ETC2_EAC}if(n===Re||n===je||n===De||n===Ae||n===Ce||n===Be||n===ke||n===Le||n===Fe||n===Ue||n===Ne||n===Ge||n===Ve||n===He){var l=Xh(e,"WEBGL_compressed_texture_astc");if(null===l)return null;if(n===Re)return i===Ye?l.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:l.COMPRESSED_RGBA_ASTC_4x4_KHR;if(n===je)return i===Ye?l.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:l.COMPRESSED_RGBA_ASTC_5x4_KHR;if(n===De)return i===Ye?l.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:l.COMPRESSED_RGBA_ASTC_5x5_KHR;if(n===Ae)return i===Ye?l.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:l.COMPRESSED_RGBA_ASTC_6x5_KHR;if(n===Ce)return i===Ye?l.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:l.COMPRESSED_RGBA_ASTC_6x6_KHR;if(n===Be)return i===Ye?l.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:l.COMPRESSED_RGBA_ASTC_8x5_KHR;if(n===ke)return i===Ye?l.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:l.COMPRESSED_RGBA_ASTC_8x6_KHR;if(n===Le)return i===Ye?l.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:l.COMPRESSED_RGBA_ASTC_8x8_KHR;if(n===Fe)return i===Ye?l.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:l.COMPRESSED_RGBA_ASTC_10x5_KHR;if(n===Ue)return i===Ye?l.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:l.COMPRESSED_RGBA_ASTC_10x6_KHR;if(n===Ne)return i===Ye?l.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:l.COMPRESSED_RGBA_ASTC_10x8_KHR;if(n===Ge)return i===Ye?l.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:l.COMPRESSED_RGBA_ASTC_10x10_KHR;if(n===Ve)return i===Ye?l.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:l.COMPRESSED_RGBA_ASTC_12x10_KHR;if(n===He)return i===Ye?l.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:l.COMPRESSED_RGBA_ASTC_12x12_KHR}if(n===Xe){var h=Xh(e,"EXT_texture_compression_bptc");if(null===h)return null;if(n===Xe)return i===Ye?h.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:h.COMPRESSED_RGBA_BPTC_UNORM_EXT}return 1020===n?e.UNSIGNED_INT_24_8:n===de?e.REPEAT:1001===n?e.CLAMP_TO_EDGE:1004===n||1005===n?e.NEAREST_MIPMAP_LINEAR:n===pe?e.LINEAR_MIPMAP_NEAREST:1008===n?e.LINEAR_MIPMAP_LINEAR:n===fe?e.NEAREST:n===ve?e.LINEAR:null}!function(){var e=document.createElement("canvas");if(!e.getContext)return{saveAsBMP:function(){},saveAsPNG:function(){},saveAsJPEG:function(){}};e.getContext("2d"),window}();var Yh=new Uint8Array([0,0,0,1]),Kh=/*#__PURE__*/function(){function e(e){this.gl=void 0,this.target=void 0,this.format=void 0,this.type=void 0,this.internalFormat=void 0,this.premultiplyAlpha=void 0,this.flipY=void 0,this.unpackAlignment=void 0,this.wrapS=void 0,this.wrapT=void 0,this.wrapR=void 0,this.texture=void 0,this.allocated=void 0,this.minFilter=void 0,this.magFilter=void 0,this.encoding=void 0,this.gl=e.gl,this.target=e.target||e.gl.TEXTURE_2D,this.format=e.format||ge,this.type=e.type||me,this.internalFormat=-1,this.premultiplyAlpha=!!e.premultiplyAlpha,this.flipY=!!e.flipY,this.unpackAlignment=4,this.wrapS=e.wrapS||de,this.wrapT=e.wrapT||de,this.wrapR=e.wrapR||de,this.texture=e.gl.createTexture(),e.preloadColor&&this.setPreloadColor(e.preloadColor),this.allocated=!0}var t=e.prototype;return t.setPreloadColor=function(e){e?(Yh[0]=Math.floor(255*e[0]),Yh[1]=Math.floor(255*e[1]),Yh[2]=Math.floor(255*e[2]),Yh[3]=Math.floor(255*(void 0!==e[3]?e[3]:1))):(Yh[0]=0,Yh[1]=0,Yh[2]=0,Yh[3]=255);var t=this.gl;if(t.bindTexture(this.target,this.texture),this.target===t.TEXTURE_CUBE_MAP)for(var i=[t.TEXTURE_CUBE_MAP_POSITIVE_X,t.TEXTURE_CUBE_MAP_NEGATIVE_X,t.TEXTURE_CUBE_MAP_POSITIVE_Y,t.TEXTURE_CUBE_MAP_NEGATIVE_Y,t.TEXTURE_CUBE_MAP_POSITIVE_Z,t.TEXTURE_CUBE_MAP_NEGATIVE_Z],r=0,n=i.length;r<n;r++)t.texImage2D(i[r],0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,Yh);else t.texImage2D(this.target,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,Yh);t.bindTexture(this.target,null)},t.setTarget=function(e){this.target=e||this.gl.TEXTURE_2D},t.setImage=function(e,t){void 0===t&&(t={});var i=this.gl;void 0!==t.format&&(this.format=t.format),void 0!==t.internalFormat&&(this.internalFormat=t.internalFormat),void 0!==t.encoding&&(this.encoding=t.encoding),void 0!==t.type&&(this.type=t.type),void 0!==t.flipY&&(this.flipY=t.flipY),void 0!==t.premultiplyAlpha&&(this.premultiplyAlpha=t.premultiplyAlpha),void 0!==t.unpackAlignment&&(this.unpackAlignment=t.unpackAlignment),void 0!==t.minFilter&&(this.minFilter=t.minFilter),void 0!==t.magFilter&&(this.magFilter=t.magFilter),void 0!==t.wrapS&&(this.wrapS=t.wrapS),void 0!==t.wrapT&&(this.wrapT=t.wrapT),void 0!==t.wrapR&&(this.wrapR=t.wrapR),i.bindTexture(this.target,this.texture),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,this.flipY),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha),i.pixelStorei(i.UNPACK_ALIGNMENT,this.unpackAlignment),i.pixelStorei(i.UNPACK_COLORSPACE_CONVERSION_WEBGL,i.NONE);var r=Wh(i,this.minFilter);i.texParameteri(this.target,i.TEXTURE_MIN_FILTER,r);var n=Wh(i,this.magFilter);n&&i.texParameteri(this.target,i.TEXTURE_MAG_FILTER,n);var o=Wh(i,this.wrapS);o&&i.texParameteri(this.target,i.TEXTURE_WRAP_S,o);var s=Wh(i,this.wrapT);s&&i.texParameteri(this.target,i.TEXTURE_WRAP_T,s);var a=Wh(i,this.format,this.encoding),c=Wh(i,this.type),l=zh(i,this.internalFormat,a,c,this.encoding,!1);if(this.target===i.TEXTURE_CUBE_MAP){if(er(e))for(var h=e,u=[i.TEXTURE_CUBE_MAP_POSITIVE_X,i.TEXTURE_CUBE_MAP_NEGATIVE_X,i.TEXTURE_CUBE_MAP_POSITIVE_Y,i.TEXTURE_CUBE_MAP_NEGATIVE_Y,i.TEXTURE_CUBE_MAP_POSITIVE_Z,i.TEXTURE_CUBE_MAP_NEGATIVE_Z],d=0,f=u.length;d<f;d++)i.texImage2D(u[d],0,l,a,c,h[d])}else i.texImage2D(i.TEXTURE_2D,0,l,a,c,e);i.bindTexture(this.target,null)},t.setCompressedData=function(e){var t=this.gl,i=e.mipmaps||[],r=i.length,n=e.props;void 0!==n.format&&(this.format=n.format),void 0!==n.internalFormat&&(this.internalFormat=n.internalFormat),void 0!==n.encoding&&(this.encoding=n.encoding),void 0!==n.type&&(this.type=n.type),void 0!==n.flipY&&(this.flipY=n.flipY),void 0!==n.premultiplyAlpha&&(this.premultiplyAlpha=n.premultiplyAlpha),void 0!==n.unpackAlignment&&(this.unpackAlignment=n.unpackAlignment),void 0!==n.minFilter&&(this.minFilter=n.minFilter),void 0!==n.magFilter&&(this.magFilter=n.magFilter),void 0!==n.wrapS&&(this.wrapS=n.wrapS),void 0!==n.wrapT&&(this.wrapT=n.wrapT),void 0!==n.wrapR&&(this.wrapR=n.wrapR),t.activeTexture(t.TEXTURE0+0),t.bindTexture(this.target,this.texture);var o=i.length>1;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,this.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha),t.pixelStorei(t.UNPACK_ALIGNMENT,this.unpackAlignment),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,t.NONE);var s=Wh(t,this.wrapS);s&&t.texParameteri(this.target,t.TEXTURE_WRAP_S,s);var a=Wh(t,this.wrapT);if(a&&t.texParameteri(this.target,t.TEXTURE_WRAP_T,a),this.type===t.TEXTURE_3D||this.type===t.TEXTURE_2D_ARRAY){var c=Wh(t,this.wrapR);c&&t.texParameteri(this.target,t.TEXTURE_WRAP_R,c),t.texParameteri(this.type,t.TEXTURE_WRAP_R,c)}o?(t.texParameteri(this.target,t.TEXTURE_MIN_FILTER,qh(t,this.minFilter)),t.texParameteri(this.target,t.TEXTURE_MAG_FILTER,qh(t,this.magFilter))):(t.texParameteri(this.target,t.TEXTURE_MIN_FILTER,Wh(t,this.minFilter)),t.texParameteri(this.target,t.TEXTURE_MAG_FILTER,Wh(t,this.magFilter)));var l=Wh(t,this.format,this.encoding),h=Wh(t,this.type),u=zh(t,this.internalFormat,l,h,this.encoding,!1);t.texStorage2D(t.TEXTURE_2D,r,u,i[0].width,i[0].height);for(var d=0,f=i.length;d<f;d++){var v=i[d];this.format!==ge?null!==l?t.compressedTexSubImage2D(t.TEXTURE_2D,d,0,0,v.width,v.height,l,v.data):console.warn("Attempt to load unsupported compressed texture format in .setCompressedData()"):t.texSubImage2D(t.TEXTURE_2D,d,0,0,v.width,v.height,l,h,v.data)}t.bindTexture(this.target,null)},t.setProps=function(e){var t=this.gl;t.bindTexture(this.target,this.texture),this._uploadProps(e),t.bindTexture(this.target,null)},t._uploadProps=function(e){var t=this.gl;if(void 0!==e.format&&(this.format=e.format),void 0!==e.internalFormat&&(this.internalFormat=e.internalFormat),void 0!==e.encoding&&(this.encoding=e.encoding),void 0!==e.type&&(this.type=e.type),void 0!==e.minFilter){var i=Wh(t,e.minFilter);i&&(this.minFilter=e.minFilter,t.texParameteri(this.target,t.TEXTURE_MIN_FILTER,i),i!==t.NEAREST_MIPMAP_NEAREST&&i!==t.LINEAR_MIPMAP_NEAREST&&i!==t.NEAREST_MIPMAP_LINEAR&&i!==t.LINEAR_MIPMAP_LINEAR||t.generateMipmap(this.target))}if(void 0!==e.magFilter){var r=Wh(t,e.magFilter);r&&(this.magFilter=e.magFilter,t.texParameteri(this.target,t.TEXTURE_MAG_FILTER,r))}if(void 0!==e.wrapS){var n=Wh(t,e.wrapS);n&&(this.wrapS=e.wrapS,t.texParameteri(this.target,t.TEXTURE_WRAP_S,n))}if(void 0!==e.wrapT){var o=Wh(t,e.wrapT);o&&(this.wrapT=e.wrapT,t.texParameteri(this.target,t.TEXTURE_WRAP_T,o))}},t.bind=function(e){if(!this.allocated)return!1;if(this.texture){var t=this.gl;return t.activeTexture(t["TEXTURE"+e]),t.bindTexture(this.target,this.texture),!0}return!1},t.unbind=function(e){if(this.allocated&&this.texture){var t=this.gl;t.activeTexture(t["TEXTURE"+e]),t.bindTexture(this.target,null)}},t.destroy=function(){this.allocated&&this.texture&&(this.gl.deleteTexture(this.texture),this.texture=null)},e}();function zh(e,t,i,r,n,o){if(void 0===o&&(o=!1),null!==t){if(void 0!==e[t])return e[t];console.warn("Attempt to use non-existing WebGL internal format '"+t+"'")}var s=i;return i===e.RED&&(r===e.FLOAT&&(s=e.R32F),r===e.HALF_FLOAT&&(s=e.R16F),r===e.UNSIGNED_BYTE&&(s=e.R8)),i===e.RG&&(r===e.FLOAT&&(s=e.RG32F),r===e.HALF_FLOAT&&(s=e.RG16F),r===e.UNSIGNED_BYTE&&(s=e.RG8)),i===e.RGBA&&(r===e.FLOAT&&(s=e.RGBA32F),r===e.HALF_FLOAT&&(s=e.RGBA16F),r===e.UNSIGNED_BYTE&&(s=n===Ye&&!1===o?e.SRGB8_ALPHA8:e.RGBA8),r===e.UNSIGNED_SHORT_4_4_4_4&&(s=e.RGBA4),r===e.UNSIGNED_SHORT_5_5_5_1&&(s=e.RGB5_A1)),s!==e.R16F&&s!==e.R32F&&s!==e.RG16F&&s!==e.RG32F&&s!==e.RGBA16F&&s!==e.RGBA32F||Xh(e,"EXT_color_buffer_float"),s}function qh(e,t){return t===fe||1004===t||1005===t?e.NEAREST:e.LINEAR}var Zh={WEBGL:!1,SUPPORTED_EXTENSIONS:{}},Qh=document.createElement("canvas");if(Qh){var Jh=Qh.getContext("webgl2",{antialias:!0});Zh.WEBGL=!!Jh,Zh.WEBGL&&(Zh.ANTIALIAS=Jh.getContextAttributes().antialias,Zh.FS_MAX_FLOAT_PRECISION=Jh.getShaderPrecisionFormat?Jh.getShaderPrecisionFormat(Jh.FRAGMENT_SHADER,Jh.HIGH_FLOAT).precision>0?"highp":Jh.getShaderPrecisionFormat(Jh.FRAGMENT_SHADER,Jh.MEDIUM_FLOAT).precision>0?"mediump":"lowp":"mediump",Zh.DEPTH_BUFFER_BITS=Jh.getParameter(Jh.DEPTH_BITS),Zh.MAX_TEXTURE_SIZE=Jh.getParameter(Jh.MAX_TEXTURE_SIZE),Zh.MAX_CUBE_MAP_SIZE=Jh.getParameter(Jh.MAX_CUBE_MAP_TEXTURE_SIZE),Zh.MAX_RENDERBUFFER_SIZE=Jh.getParameter(Jh.MAX_RENDERBUFFER_SIZE),Zh.MAX_TEXTURE_UNITS=Jh.getParameter(Jh.MAX_COMBINED_TEXTURE_IMAGE_UNITS),Zh.MAX_TEXTURE_IMAGE_UNITS=Jh.getParameter(Jh.MAX_TEXTURE_IMAGE_UNITS),Zh.MAX_VERTEX_ATTRIBS=Jh.getParameter(Jh.MAX_VERTEX_ATTRIBS),Zh.MAX_VERTEX_UNIFORM_VECTORS=Jh.getParameter(Jh.MAX_VERTEX_UNIFORM_VECTORS),Zh.MAX_FRAGMENT_UNIFORM_VECTORS=Jh.getParameter(Jh.MAX_FRAGMENT_UNIFORM_VECTORS),Zh.MAX_VARYING_VECTORS=Jh.getParameter(Jh.MAX_VARYING_VECTORS),Jh.getSupportedExtensions().forEach(function(e){Zh.SUPPORTED_EXTENSIONS[e]=!0}),Zh.depthTexturesSupported=Zh.SUPPORTED_EXTENSIONS.WEBGL_depth_texture)}var $h=/*#__PURE__*/function(){function e(e,t,i){this.viewer=void 0,this.view=void 0,this.gl=void 0,this.viewMatrixDataTexture=void 0,this.pbrEnabled=void 0,this.withSAO=void 0,this.backfaces=void 0,this.frontface=void 0,this.textureUnit=void 0,this.bindTexture=void 0,this.renderPass=void 0,this.shadowViewMatrix=void 0,this.shadowProjMatrix=void 0,this.pickViewMatrix=void 0,this.pickProjMatrix=void 0,this.pickZNear=void 0,this.pickZFar=void 0,this.pickInvisible=void 0,this.lineWidth=void 0,this.lastProgramId=void 0,this.occlusionTexture=void 0,this.viewer=e,this.view=t,this.gl=i,this.reset()}return e.prototype.reset=function(){this.lastProgramId=-1,this.pbrEnabled=!1,this.withSAO=!1,this.backfaces=!1,this.frontface=!0,this.textureUnit=0,this.shadowViewMatrix=null,this.shadowProjMatrix=null,this.pickViewMatrix=null,this.pickProjMatrix=null,this.pickZNear=.01,this.pickZFar=5e3,this.pickInvisible=!1,this.lineWidth=1,this.occlusionTexture=null},i(e,[{key:"nextTextureUnit",get:function(){var e=this.textureUnit;return this.textureUnit=(this.textureUnit+1)%Zh.MAX_TEXTURE_UNITS,e}}]),e}(),eu={NOT_RENDERED:0,COLOR_OPAQUE:1,COLOR_TRANSPARENT:2,SILHOUETTE_HIGHLIGHTED:3,SILHOUETTE_SELECTED:4,SILHOUETTE_XRAYED:5,EDGES_COLOR_OPAQUE:6,EDGES_COLOR_TRANSPARENT:7,EDGES_HIGHLIGHTED:8,EDGES_SELECTED:9,EDGES_XRAYED:10,PICK:11},tu=Pt(),iu=/*#__PURE__*/d("hash"),ru=/*#__PURE__*/d("program"),nu=/*#__PURE__*/d("needRebuild"),ou=/*#__PURE__*/d("uniforms"),su=/*#__PURE__*/d("samplers"),au=/*#__PURE__*/d("build"),cu=/*#__PURE__*/d("buildShader"),lu=/*#__PURE__*/d("getValid"),hu=/*#__PURE__*/d("bind"),uu=/*#__PURE__*/function(){function e(e){Object.defineProperty(this,hu,{value:pu}),Object.defineProperty(this,lu,{value:vu}),Object.defineProperty(this,cu,{value:fu}),Object.defineProperty(this,au,{value:du}),this.errors=void 0,this.renderContext=void 0,Object.defineProperty(this,iu,{writable:!0,value:void 0}),Object.defineProperty(this,ru,{writable:!0,value:void 0}),Object.defineProperty(this,nu,{writable:!0,value:void 0}),Object.defineProperty(this,ou,{writable:!0,value:void 0}),Object.defineProperty(this,su,{writable:!0,value:void 0}),this.renderContext=e,f(this,nu)[nu]=!0,f(this,au)[au]()}var t=e.prototype;return t.needRebuild=function(){f(this,nu)[nu]=!0},t.draw=function(e){if(f(this,ru)[ru]&&!f(this,lu)[lu]()&&(f(this,ru)[ru].destroy(),f(this,ru)[ru]=null),!f(this,ru)[ru]){if(f(this,au)[au](),this.errors)return;this.renderContext.lastProgramId=-1}var t=e.renderState,i=f(this,ru)[ru],r=this.renderContext,n=r.renderPass,o=this.renderContext.gl,s=this.renderContext.view,a=f(this,ou)[ou],c=f(this,su)[su];if(r.lastProgramId!==i.id&&(r.lastProgramId=i.id,f(this,hu)[hu]()),a.renderPass&&o.uniform1i(a.renderPass,n),a.projMatrix&&o.uniformMatrix4fv(a.projMatrix,!1,s.camera.projMatrix),a.worldMatrix&&o.uniformMatrix4fv(a.worldMatrix,!1,e.rendererModel.worldMatrix),a.color)if(n===eu.SILHOUETTE_XRAYED){var l=s.xrayMaterial,h=l.fillColor;o.uniform4f(a.color,h[0],h[1],h[2],l.fillAlpha)}else if(n===eu.SILHOUETTE_HIGHLIGHTED){var u=s.highlightMaterial,d=u.fillColor;o.uniform4f(a.color,d[0],d[1],d[2],u.fillAlpha)}else if(n===eu.SILHOUETTE_SELECTED){var v=s.selectedMaterial,p=v.fillColor;o.uniform4f(a.color,p[0],p[1],p[2],v.fillAlpha)}else o.uniform4fv(a.color,new Float32Array([1,1,1]));c.viewMatrices&&t.dataTextureSet.viewMatrices.bindTexture(i,c.viewMatrices,r.nextTextureUnit),c.positions&&t.dataTextureSet.positions.bindTexture(i,c.positions,r.nextTextureUnit),c.eachMeshMatrices&&t.dataTextureSet.eachMeshMatrices.bindTexture(i,c.eachMeshMatrices,r.nextTextureUnit),c.eachMeshAttributes&&t.dataTextureSet.eachMeshAttributes.bindTexture(i,c.eachMeshAttributes,r.nextTextureUnit),c.eachPrimitiveMesh&&(t.numIndices8Bits>0&&(t.dataTextureSet.eachPrimitiveMesh_8Bits.bindTexture(i,c.eachPrimitiveMesh,r.nextTextureUnit),t.dataTextureSet.indices_8Bits.bindTexture(i,c.indices,r.nextTextureUnit),o.drawArrays(o.TRIANGLES,0,t.numIndices8Bits)),t.numIndices16Bits>0&&(t.dataTextureSet.eachPrimitiveMesh_16Bits.bindTexture(i,c.eachPrimitiveMesh,r.nextTextureUnit),t.dataTextureSet.indices_16Bits.bindTexture(i,c.indices,r.nextTextureUnit),o.drawArrays(o.TRIANGLES,0,t.numIndices16Bits)),t.numIndices32Bits>0&&(t.dataTextureSet.eachPrimitiveMesh_32Bits.bindTexture(i,c.eachPrimitiveMesh,r.nextTextureUnit),t.dataTextureSet.indices_32Bits.bindTexture(i,c.indices,r.nextTextureUnit),o.drawArrays(o.TRIANGLES,0,t.numIndices32Bits))),c.baseColorMap&&c.baseColorMap.bindTexture(t.materialTextureSet.colorTexture.texture2D,r.nextTextureUnit),c.metallicRoughMap&&c.metallicRoughMap.bindTexture(t.materialTextureSet.metallicRoughnessTexture.texture2D,r.nextTextureUnit),c.emissiveMap&&c.emissiveMap.bindTexture(t.materialTextureSet.emissiveTexture.texture2D,r.nextTextureUnit),c.occlusionMap&&c.occlusionMap.bindTexture(t.materialTextureSet.occlusionTexture.texture2D,r.nextTextureUnit)},t.destroy=function(){f(this,ru)[ru]&&f(this,ru)[ru].destroy(),f(this,ru)[ru]=null},i(e,[{key:"vertHeader",get:function(){return"#version 300 es\n                #ifdef GL_FRAGMENT_PRECISION_HIGH\n                precision highp float;\n                precision highp int;\n                precision highp usampler2D;\n                precision highp isampler2D;\n                precision highp sampler2D;\n                #else\n                precision mediump float;\n                precision mediump int;\n                precision mediump usampler2D;\n                precision mediump isampler2D;\n                precision mediump sampler2D;\n                uniform int renderPass;\n                #endif"}},{key:"vertDataTextureDefs",get:function(){return"uniform mediump sampler2D eachMeshMatrices;\n                uniform lowp usampler2D eachMeshAttributes;\n                uniform highp sampler2D eachMeshOffset;\n                uniform mediump usampler2D positions;\n                uniform highp usampler2D indices;\n                uniform mediump usampler2D eachPrimitiveMesh;\n                uniform highp sampler2D cameraMatrices;\n                uniform highp sampler2D sceneModelRendererMatrices;"}},{key:"vertLogDepthBufDefs",get:function(){return this.renderContext.view.logarithmicDepthBufferEnabled?"uniform float logDepthBufFC;\n                    out float fragDepth;\n                    bool isPerspectiveMatrix(mat4 m) {\n                        return (m[2][3] == - 1.0);\n                    }\n                    out float isPerspective;":""}},{key:"vertDataTextureSamples",get:function(){return""}},{key:"vertLogDepthBufOutputs",get:function(){return this.renderContext.view.logarithmicDepthBufferEnabled?"fragDepth = 1.0 + clipPos.w;\n                    isPerspective = float (isPerspectiveMatrix(projMatrix));":""}},{key:"fragmentShader",get:function(){return this.fragHeader+"\n        "+this.fragGammaDefs+"\n        "+this.fragSectionPlaneDefs+"\n        "+this.fragLightDefs+"\n        "+this.fragLogDepthBufDefs+"\n        void main(void) {\n            "+this.fragSectionPlanesSlice+"\n            "+this.fragLighting+"\n            "+this.fragLogDepthBufOutput+"\n        }"}},{key:"fragHeader",get:function(){return"#version 300 es\n        #ifdef GL_FRAGMENT_PRECISION_HIGH\n       precision highp float;\n        precision highp int;\n        #else\n        precision mediump float;\n        precision mediump int;\n        #endif"}},{key:"fragGammaDefs",get:function(){return'uniform float gammaFactor;\n        vec4 linearToLinear( in vec4 value ) {\n            return value;\n        }\n        vec4 sRGBToLinear( in vec4 value ) {\n            return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );\n        }\n        vec4 gammaToLinear( in vec4 value) {\n            return vec4( pow( value.xyz, vec3( gammaFactor ) ), value.w );\n        }\n        vec4 linearToGamma( in vec4 value, in float gammaFactor ) {\n              return vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );");\n        }'}},{key:"fragLightDefs",get:function(){var e=this.renderContext.view,t=[];t.push("uniform vec4 lightAmbient;");for(var i=0,r=e.lightsList.length;i<r;i++){var n=e.lightsList[i];"ambient"!==n.type&&(t.push("uniform vec4 lightColor"+i+";"),"dir"===n.type&&t.push("uniform vec3 lightDir"+i+";"),"point"===n.type&&t.push("uniform vec3 lightPos"+i+";"),"spot"===n.type&&(t.push("uniform vec3 lightPos"+i+";"),t.push("uniform vec3 lightDir"+i+";")))}return t.join("\n")}},{key:"fragLogDepthBufDefs",get:function(){return this.renderContext.view.logarithmicDepthBufferEnabled?"in float isPerspective;\n                    uniform float logDepthBufFC;\n                    in float fragDepth;":""}},{key:"fragLogDepthBufOutput",get:function(){return this.renderContext.view.logarithmicDepthBufferEnabled?"gl_FragDepth = isPerspective == 0.0 ? gl_FragCoord.z : log2( fragDepth ) * logDepthBufFC * 0.5;":""}},{key:"fragLighting",get:function(){var e=[];e.push("vec4 viewPosition  = viewMatrix * worldPosition; "),e.push("vec4 modelNormal = vec4(octDecode(normal.xy), 0.0); "),e.push("vec4 worldNormal = worldNormalMatrix * vec4(dot(modelNormal, modelNormalMatrixCol0), dot(modelNormal, modelNormalMatrixCol1), dot(modelNormal, modelNormalMatrixCol2), 0.0);"),e.push("vec3 viewNormal = normalize(vec4(viewNormalMatrix * worldNormal).xyz);"),e.push("vec3 reflectedColor = vec3(0.0, 0.0, 0.0);"),e.push("vec3 viewLightDir = vec3(0.0, 0.0, -1.0);"),e.push("float lambertian = 1.0;");for(var t=0,i=this.renderContext.view.lightsList.length;t<i;t++){var r=this.renderContext.view.lightsList[t];if("ambient"!==r.type){if("dir"===r.type)e.push("view"===r.space?"viewLightDir = normalize(lightDir"+t+");":"viewLightDir = normalize((viewMatrix * vec4(lightDir"+t+", 0.0)).xyz);");else if("point"===r.type)e.push("view"===r.space?"viewLightDir = -normalize(lightPos"+t+" - viewPosition.xyz);":"viewLightDir = -normalize((viewMatrix * vec4(lightPos"+t+", 0.0)).xyz);");else{if("spot"!==r.type)continue;e.push("view"===r.space?"viewLightDir = normalize(lightDir"+t+");":"viewLightDir = normalize((viewMatrix * vec4(lightDir"+t+", 0.0)).xyz);")}e.push("lambertian = max(dot(-viewNormal, viewLightDir), 0.0);"),e.push("reflectedColor += lambertian * (lightColor"+t+".rgb * lightColor"+t+".a);")}}return e.push("vec3 rgb = (vec3(float(color.r) / 255.0, float(color.g) / 255.0, float(color.b) / 255.0));"),e.push("meshColor =  vec4((lightAmbient.rgb * lightAmbient.a * rgb) + (reflectedColor * rgb), float(color.a) / 255.0);"),e.join("\n")}},{key:"fragSAOOutput",get:function(){return this.renderContext.view.sao.enabled?"float viewportWidth     = uSAOParams[0];\n                    float viewportHeight    = uSAOParams[1];\n                    float blendCutoff       = uSAOParams[2];\n                    float blendFactor       = uSAOParams[3];\n                    vec2 uv                 = vec2(gl_FragCoord.x / viewportWidth, gl_FragCoord.y / viewportHeight);\n                    float ambient           = smoothstep(blendCutoff, 1.0, unpackRGBToFloat(texture(uOcclusionTexture, uv))) * blendFactor;\n                    outColor                = vec4(fragColor.rgb * ambient, 1.0);":"outColor            = fragColor;"}},{key:"fragOutput",get:function(){return"outColor            = fragColor;"}},{key:"fragSectionPlaneDefs",get:function(){var e=[];e.push("in vec4 worldPosition;\n                  in vec4 meshFlags2;");for(var t=0,i=this.renderContext.view.sectionPlanesList.length;t<i;t++)e.push("uniform bool sectionPlaneActive"+t+";\n                      uniform vec3 sectionPlanePos"+t+";\n                      uniform vec3 sectionPlaneDir"+t+";");return e.join("\n")}},{key:"fragLightSourceUniforms",get:function(){var e=[];e.push("uniform vec4 lightAmbient;");for(var t=0,i=this.renderContext.view.lightsList.length;t<i;t++){var r=this.renderContext.view.lightsList[t];r instanceof zl||(e.push("uniform vec4 lightColor"+t+";"),r instanceof Zl&&e.push("uniform vec3 lightDir"+t+";"),r instanceof Jl&&e.push("uniform vec3 lightPos"+t+";"))}return e.join("\n")}},{key:"fragSectionPlanesSlice",get:function(){var e=[];if(this.renderContext.view.sectionPlanesList.length>0){e.push("bool clippable = (float(meshFlags2.x) > 0.0);\n                      if (clippable) {\n                          float dist = 0.0;");for(var t=0,i=this.renderContext.view.sectionPlanesList.length;t<i;t++)e.push("if (sectionPlaneActive"+t+") {\n                              dist += clamp(dot(-sectionPlaneDir"+t+".xyz, worldPosition.xyz - sectionPlanePos"+t+".xyz), 0.0, 1000.0);\n                          }");e.push("if (dist > 0.0) { \n                          discard;\n                      }\n                  }")}return e.join("\n")}},{key:"fragFlatShading",get:function(){var e=[];return e.push(""),e.join("\n")}}]),e}();function du(){var e=this.renderContext.view,t=this.renderContext.gl;if(f(this,ru)[ru]=new Vh(t,f(this,cu)[cu]()),f(this,ru)[ru].errors)this.errors=f(this,ru)[ru].errors;else{var i=f(this,ru)[ru];f(this,ou)[ou]={renderPass:i.getLocation("renderPass"),viewMatrix:i.getLocation("viewMatrix"),projMatrix:i.getLocation("projMatrix"),worldMatrix:i.getLocation("worldMatrix"),sao:i.getLocation("sao"),logDepthBufFC:i.getLocation("logDepthBufFC"),gammaFactor:i.getLocation("gammaFactor"),pointSize:i.getLocation("pointSize"),nearPlaneHeight:i.getLocation("nearPlaneHeight"),pointCloudIntensityRange:i.getLocation("pointCloudIntensityRange"),pickZNear:i.getLocation("pickZNear"),pickZFar:i.getLocation("pickZFar"),pickInvisible:i.getLocation("pickInvisible"),color:i.getLocation("color"),lightAmbient:i.getLocation("lightAmbient"),lights:[],sectionPlanes:[]};for(var r=f(this,ou)[ou],n=e.lightsList,o=0,s=n.length;o<s;o++)switch(n[o].type){case"dir":r.lights.push({color:i.getLocation("lightColor"+o),dir:i.getLocation("lightDir"+o)});break;case"point":r.lights.push({color:i.getLocation("lightColor"+o),pos:i.getLocation("lightPos"+o),attenuation:i.getLocation("lightAttenuation"+o)});break;case"spot":r.lights.push({color:i.getLocation("lightColor"+o),pos:i.getLocation("lightPos"+o),dir:i.getLocation("lightDir"+o),attenuation:i.getLocation("lightAttenuation"+o)})}for(var a=0,c=e.sectionPlanesList.length;a<c;a++)r.sectionPlanes.push({active:i.getLocation("sectionPlaneActive"+a),pos:i.getLocation("sectionPlanePos"+a),dir:i.getLocation("sectionPlaneDir"+a)});f(this,su)[su]={viewMatrices:i.getSampler("viewMatrices"),positions:i.getSampler("positions"),indices:i.getSampler("indices"),edgeIndices:i.getSampler("edgeIndices"),eachMeshAttributes:i.getSampler("eachMeshAttributes"),eachMeshMatrices:i.getSampler("eachMeshMatrices"),eachEdgeOffset:i.getSampler("eachMeshOffset"),eachPrimitiveMesh:i.getSampler("eachMeshTriangleMesh"),eachEdgeMesh:i.getSampler("eachEdgeMesh"),baseColorMap:i.getSampler("baseColorMap"),metallicRoughMap:i.getSampler("metallicRoughMap"),emissiveMap:i.getSampler("emissiveMap"),normalMap:i.getSampler("normalMap"),occlusionMap:i.getSampler("occlusionMap")},f(this,iu)[iu]=this.getHash()}}function fu(){return{vertex:this.buildVertexShader(),fragment:this.buildFragmentShader()}}function vu(){return!f(this,nu)[nu]||(f(this,nu)[nu]=!1,f(this,iu)[iu]===this.getHash())}function pu(){var e=this.renderContext.view,t=this.renderContext.gl,i=f(this,ou)[ou],r=e.camera.project;f(this,ru)[ru].bind(),i.lightAmbient&&t.uniform4fv(i.lightAmbient,e.getAmbientColorAndIntensity());for(var n=0,o=i.lights.length;n<o;n++){var s=i.lights[n],a=e.lightsList[n];s.color&&t.uniform4f(s.color,a.color[0],a.color[1],a.color[2],a.intensity),s.dir&&t.uniform3f(s.dir,a.dir[0],a.dir[1],a.dir[2]),s.pos&&t.uniform3f(s.pos,a.pos[0],a.pos[1],a.pos[2]),s.attenuation&&t.uniform1f(s.attenuation,a.attenuation)}if(i.sao){var c=e.sao;if(c.possible){var l=t.drawingBufferHeight;tu[0]=t.drawingBufferWidth,tu[1]=l,tu[2]=c.blendCutoff,tu[3]=c.blendFactor,t.uniform4fv(i.sao,tu)}}if(i.gammaFactor&&t.uniform1f(i.gammaFactor,e.gammaFactor),i.pointSize&&t.uniform1f(i.pointSize,e.pointsMaterial.pointSize),i.nearPlaneHeight&&t.uniform1f(i.nearPlaneHeight,e.camera.projectionType===tt?1:t.drawingBufferHeight/(2*Math.tan(.5*e.camera.perspectiveProjection.fov*Math.PI/180))),i.pickZNear&&(t.uniform1f(i.pickZNear,this.renderContext.pickZNear),t.uniform1f(i.pickZFar,this.renderContext.pickZFar)),i.pickInvisible&&t.uniform1i(i.pickInvisible,this.renderContext.pickInvisible?1:0),i.logDepthBufFC){var h=2/(Math.log(r.far+1)/Math.LN2);t.uniform1f(i.logDepthBufFC,h)}}var yu,mu=/*#__PURE__*/function(e){function t(t){return e.call(this,t)||this}r(t,e);var i=t.prototype;return i.getHash=function(){return this.renderContext.view.getSectionPlanesHash()+"-"+this.renderContext.view.getLightsHash()},i.buildVertexShader=function(){return this.vertHeader+"   \n        \n                uniform int                 renderPass;   \n            \n                uniform highp   mat4        projMatrix;\n                uniform highp   mat4        worldMatrix;\n                      \n                uniform mediump sampler2D   viewMatrices;\n                           \n                uniform mediump usampler2D  eachPrimitiveMesh;\n                uniform lowp    usampler2D  eachMeshAttributes;\n                \n                uniform mediump sampler2D   eachMeshMatrices;\n                uniform mediump usampler2D  positions;\n                uniform highp   usampler2D  indices;\n                \n                uniform  float  logDepthBufFC;\n                 \n                out vec4        worldPosition;\n                flat out uint   meshFlags2r;                       \n                flat out uvec4  meshColor;\n                out float       fragDepth;\n                \n                bool isPerspectiveMatrix(mat4 m) {\n                    return (m[2][3] == - 1.0);\n                }\n                \n                out float isPerspective;\n                    \n                void main(void) {\n                                   \n                    int triangleIndex      = gl_VertexID / 3;\n                    \n                    int hPackedMeshIdIndex = (triangleIndex >> 3) & 1023;\n                    int vPackedMeshIdIndex = (triangleIndex >> 3) >> 10;\n                    \n                    int meshIndex          = int(texelFetch(eachPrimitiveMesh, ivec2(hPackedMeshIdIndex, vPackedMeshIdIndex), 0).r);                   \n                    uvec4 meshFlags        = texelFetch (eachMeshAttributes, ivec2(2, meshIndex), 0);\n\n                    if (int(meshFlags.x) != renderPass) {\n                        gl_Position = vec4(3.0, 3.0, 3.0, 1.0);\n                        return;\n                    } \n                 \n                    uvec4 meshFlags2 = texelFetch (eachMeshAttributes, ivec2(3, meshIndex), 0);\n\n                    ivec4 packedVertexBase = ivec4(texelFetch (eachMeshAttributes, ivec2(4, meshIndex), 0));\n                    ivec4 packedIndexBaseOffset = ivec4(texelFetch (eachMeshAttributes, ivec2(5, meshIndex), 0));\n                    int indexBaseOffset =   (packedIndexBaseOffset.r << 24) + \n                                            (packedIndexBaseOffset.g << 16) + \n                                            (packedIndexBaseOffset.b << 8) + \n                                            (packedIndexBaseOffset.a);\n\n                    int hIndex = (triangleIndex - indexBaseOffset) & 1023;\n                    int vIndex = (triangleIndex - indexBaseOffset) >> 10;\n\n                    ivec3 vertexIndices = ivec3(texelFetch(indices, ivec2(hIndex, vIndex), 0));\n                    ivec3 uniqueVertexIndexes = vertexIndices + (packedVertexBase.r << 24) + (packedVertexBase.g << 16) + (packedVertexBase.b << 8) + packedVertexBase.a;\n\n                    ivec3 indexPositionH = uniqueVertexIndexes & 1023;\n                    ivec3 indexPositionV = uniqueVertexIndexes >> 10;\n\n                    mat4 positionsDecompressMatrix = mat4 (\n                        texelFetch (eachMeshMatrices, ivec2(0, meshIndex), 0), \n                        texelFetch (eachMeshMatrices, ivec2(1, meshIndex), 0), \n                        texelFetch (eachMeshMatrices, ivec2(2, meshIndex), 0), \n                        texelFetch (eachMeshMatrices, ivec2(3, meshIndex), 0));\n                        \n                    mat4 meshMatrix = mat4 (\n                        texelFetch (eachMeshMatrices, ivec2(4, meshIndex), 0), \n                        texelFetch (eachMeshMatrices, ivec2(5, meshIndex), 0), \n                        texelFetch (eachMeshMatrices, ivec2(6, meshIndex), 0), \n                        texelFetch (eachMeshMatrices, ivec2(7, meshIndex), 0));\n\n                    ivec4 packedViewMatrixIndex = ivec4(texelFetch (eachMeshAttributes, ivec2(7, meshIndex), 0));\n                    int viewMatrixIndex = \n                            (packedViewMatrixIndex.r << 24) + \n                            (packedViewMatrixIndex.g << 16) + \n                            (packedViewMatrixIndex.b << 8) + \n                            (packedViewMatrixIndex.a);\n                   \n                    mat4 viewMatrix = mat4 (\n                        texelFetch (viewMatrices, ivec2(4, viewMatrixIndex), 0), \n                        texelFetch (viewMatrices, ivec2(5, viewMatrixIndex), 0), \n                        texelFetch (viewMatrices, ivec2(6, viewMatrixIndex), 0), \n                        texelFetch (viewMatrices, ivec2(7, viewMatrixIndex), 0));\n\n                    vec3 _positions[3];\n                   \n                    _positions[0] = vec3(texelFetch(positions, ivec2(indexPositionH.r, indexPositionV.r), 0));\n                    _positions[1] = vec3(texelFetch(positions, ivec2(indexPositionH.g, indexPositionV.g), 0));\n                    _positions[2] = vec3(texelFetch(positions, ivec2(indexPositionH.b, indexPositionV.b), 0));\n  \n                    vec3  position       = _positions[gl_VertexID % 3];\n                   \n                    vec4  _worldPosition = worldMatrix * ((meshMatrix * positionsDecompressMatrix) * vec4(position, 1.0)); \n                    vec4  viewPosition   = viewMatrix * _worldPosition;                   \n                    vec4  clipPosition   = projMatrix * viewPosition;\n\n                    meshFlags2r     = meshFlags2.r;                     \n                    meshColor       = texelFetch (eachMeshAttributes, ivec2(0, meshIndex), 0);                          \n                    fragDepth       = 1.0 + clipPosition.w;\n                    isPerspective   = float (isPerspectiveMatrix(projMatrix));\n                    worldPosition   = _worldPosition;                                               \n                    \n                    gl_Position     = clipPosition;\n                }"},i.buildFragmentShader=function(){return this.fragHeader+"                        \n    \n             flat   in uvec4    meshColor;\n                in float        fragDepth;\n                in float        isPerspective;    \n                flat in uint    meshFlags2r;        \n                uniform float   logDepthBufFC;                        \n    \n                "+this.fragSectionPlaneDefs+"                  \n                "+this.fragLightSourceUniforms+'                                                             \n    \n                out vec4 outColor;        \n    \n                void main(void) {         \n                \n                // src.push("float lambertian = 1.0;");\n                // \n                //  vec3 xTangent = dFdx( vViewPosition.xyz );\n                //  vec3 yTangent = dFdy( vViewPosition.xyz );\n                // \n                //  vec3 viewNormal = normalize( cross( xTangent, yTangent ) );        \n    \n                    '+this.fragSectionPlanesSlice+"                                    \n                    "+this.fragFlatShading+"     \n          \n                    outColor = vec4(meshColor);                   \n                    gl_FragDepth = isPerspective == 0.0 ? gl_FragCoord.z : log2( fragDepth ) * logDepthBufFC * 0.5;                        \n                }"},t}(uu),gu=/*#__PURE__*/d("built"),bu=/*#__PURE__*/function(){function e(){this.positions=void 0,this.indices_8Bits=void 0,this.indices_16Bits=void 0,this.indices_32Bits=void 0,this.edgeIndices_8Bits=void 0,this.edgeIndices_16Bits=void 0,this.edgeIndices_32Bits=void 0,this.indices=void 0,this.edgeIndices=void 0,this.eachMeshAttributes=void 0,this.eachMeshMatrices=void 0,this.eachEdgeOffset=void 0,this.eachPrimitiveMesh_8Bits=void 0,this.eachPrimitiveMesh_16Bits=void 0,this.eachPrimitiveMesh_32Bits=void 0,this.eachPrimitiveMesh=void 0,this.eachEdgeMesh_8Bits=void 0,this.eachEdgeMesh_16Bits=void 0,this.eachEdgeMesh_32Bits=void 0,this.eachEdgeMesh=void 0,Object.defineProperty(this,gu,{writable:!0,value:void 0}),this.positions=null,this.indices_8Bits=null,this.indices_16Bits=null,this.indices_32Bits=null,this.edgeIndices_8Bits=null,this.edgeIndices_16Bits=null,this.edgeIndices_32Bits=null,this.eachMeshAttributes=null,this.eachMeshMatrices=null,this.eachPrimitiveMesh_8Bits=null,this.eachPrimitiveMesh_16Bits=null,this.eachPrimitiveMesh_32Bits=null,this.eachEdgeMesh_8Bits=null,this.eachEdgeMesh_16Bits=null,this.eachEdgeMesh_32Bits=null,this.eachEdgeOffset=null,f(this,gu)[gu]=!1}var t=e.prototype;return t.build=function(){this.indices={8:this.indices_8Bits,16:this.indices_16Bits,32:this.indices_32Bits},this.eachPrimitiveMesh={8:this.eachPrimitiveMesh_8Bits,16:this.eachPrimitiveMesh_16Bits,32:this.eachPrimitiveMesh_32Bits},this.edgeIndices={8:this.edgeIndices_8Bits,16:this.edgeIndices_16Bits,32:this.edgeIndices_32Bits},this.eachEdgeMesh={8:this.eachEdgeMesh_8Bits,16:this.eachEdgeMesh_16Bits,32:this.eachEdgeMesh_32Bits},f(this,gu)[gu]=!0},t.destroy=function(){this.positions&&this.positions.destroy(),this.indices_8Bits&&this.indices_8Bits.destroy(),this.indices_16Bits&&this.indices_16Bits.destroy(),this.indices_32Bits&&this.indices_32Bits.destroy(),this.edgeIndices_8Bits&&this.edgeIndices_8Bits.destroy(),this.edgeIndices_16Bits&&this.edgeIndices_16Bits.destroy(),this.edgeIndices_32Bits&&this.edgeIndices_32Bits.destroy(),this.eachMeshMatrices&&this.eachMeshMatrices.destroy(),this.eachMeshAttributes&&this.eachMeshAttributes.destroy(),this.eachEdgeOffset&&this.eachEdgeOffset.destroy(),this.eachPrimitiveMesh_8Bits&&this.eachPrimitiveMesh_8Bits.destroy(),this.eachPrimitiveMesh_16Bits&&this.eachPrimitiveMesh_16Bits.destroy(),this.eachPrimitiveMesh_32Bits&&this.eachPrimitiveMesh_32Bits.destroy(),this.eachEdgeMesh_8Bits&&this.eachEdgeMesh_8Bits.destroy(),this.eachEdgeMesh_16Bits&&this.eachEdgeMesh_16Bits.destroy(),this.eachEdgeMesh_32Bits&&this.eachEdgeMesh_32Bits.destroy()},e}(),wu=/*#__PURE__*/function(){function e(){this.numMeshes=void 0,this.numVisible=void 0,this.numTransparent=void 0,this.numEdges=void 0,this.numXRayed=void 0,this.numSelected=void 0,this.numHighlighted=void 0,this.numClippable=void 0,this.numPickable=void 0,this.numCulled=void 0,this.reset()}return e.prototype.reset=function(){this.numMeshes=0,this.numVisible=0,this.numTransparent=0,this.numEdges=0,this.numXRayed=0,this.numSelected=0,this.numHighlighted=0,this.numClippable=0,this.numPickable=0,this.numCulled=0},e}(),Pu={VISIBLE:1,CULLED:4,PICKABLE:8,CLIPPABLE:16,COLLIDABLE:32,CAST_SHADOW:64,RECEIVE_SHADOW:128,XRAYED:256,HIGHLIGHTED:512,SELECTED:1024,EDGES:2048,BACKFACES:4096,TRANSPARENT:8192};function Eu(e){return function(t){return _u(e,t,[].slice.call(arguments,1))}}function Tu(e,t){return Eu(Mu(e,t).get)}for(var _u=Reflect.apply,Iu=Reflect.construct,xu=Reflect.defineProperty,Su=Reflect.get,Mu=Reflect.getOwnPropertyDescriptor,Ou=Reflect.getPrototypeOf,Ru=Reflect.has,ju=Reflect.ownKeys,Du=Reflect.set,Au=Reflect.setPrototypeOf,Cu=Proxy,Bu=Number,ku=Bu.isFinite,Lu=Bu.isNaN,Fu=Symbol.iterator,Uu=Symbol.species,Nu=Symbol.toStringTag,Gu=Symbol.for,Vu=Object,Hu=Vu.create,Xu=Vu.defineProperty,Wu=Vu.freeze,Yu=Vu.is,Ku=Vu.prototype,zu=Eu(Ku.isPrototypeOf),qu=Vu.hasOwn||Eu(Ku.hasOwnProperty),Zu=Array,Qu=Zu.isArray,Ju=Zu.prototype,$u=Eu(Ju.join),ed=Eu(Ju.push),td=Eu(Ju.toLocaleString),id=Ju[Fu],rd=Eu(id),nd=Math.trunc,od=ArrayBuffer,sd=od.isView,ad=Eu(od.prototype.slice),cd=Tu(od.prototype,"byteLength"),ld="undefined"!=typeof SharedArrayBuffer?SharedArrayBuffer:null,hd=ld&&Tu(ld.prototype,"byteLength"),ud=Ou(Uint8Array),dd=ud.from,fd=ud.prototype,vd=fd[Fu],pd=Eu(fd.keys),yd=Eu(fd.values),md=Eu(fd.entries),gd=Eu(fd.set),bd=Eu(fd.reverse),wd=Eu(fd.fill),Pd=Eu(fd.copyWithin),Ed=Eu(fd.sort),Td=Eu(fd.slice),_d=Eu(fd.subarray),Id=Tu(fd,"buffer"),xd=Tu(fd,"byteOffset"),Sd=Tu(fd,"length"),Md=Tu(fd,Nu),Od=Uint16Array,Rd=function(){return _u(dd,Od,[].slice.call(arguments))},jd=Uint32Array,Dd=Float32Array,Ad=Ou([][Fu]()),Cd=Eu(Ad.next),Bd=Eu(e().mark(function t(){return e().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},t)})().next),kd=Ou(Ad),Ld=TypeError,Fd=RangeError,Ud=Set,Nd=Ud.prototype,Gd=Eu(Nd.add),Vd=Eu(Nd.has),Hd=WeakMap,Xd=Hd.prototype,Wd=Eu(Xd.get),Yd=Eu(Xd.has),Kd=Eu(Xd.set),zd=new od(4),qd=new Dd(zd),Zd=new jd(zd),Qd=new jd(512),Jd=new jd(512),$d=0;$d<256;++$d){var ef=$d-127;ef<-27?(Qd[$d]=0,Qd[256|$d]=32768,Jd[$d]=24,Jd[256|$d]=24):ef<-14?(Qd[$d]=1024>>-ef-14,Qd[256|$d]=1024>>-ef-14|32768,Jd[$d]=-ef-1,Jd[256|$d]=-ef-1):ef<=15?(Qd[$d]=ef+15<<10,Qd[256|$d]=ef+15<<10|32768,Jd[$d]=13,Jd[256|$d]=13):ef<128?(Qd[$d]=31744,Qd[256|$d]=64512,Jd[$d]=24,Jd[256|$d]=24):(Qd[$d]=31744,Qd[256|$d]=64512,Jd[$d]=13,Jd[256|$d]=13)}function tf(e){qd[0]=e;var t=Zd[0],i=t>>23&511;return Qd[i]+((8388607&t)>>Jd[i])}var rf=new jd(2048),nf=new jd(64),of=new jd(64);rf[0]=0;for(var sf=1;sf<1024;++sf){for(var af=sf<<13,cf=0;0==(8388608&af);)cf-=8388608,af<<=1;rf[sf]=(af&=-8388609)|(cf+=947912704)}for(var lf=1024;lf<2048;++lf)rf[lf]=939524096+(lf-1024<<13);nf[0]=0;for(var hf=1;hf<31;++hf)nf[hf]=hf<<23;nf[31]=1199570944,nf[32]=2147483648;for(var uf=33;uf<63;++uf)nf[uf]=2147483648+(uf-32<<23);nf[63]=3347054592,of[0]=0;for(var df=1;df<64;++df)of[df]=32===df?0:1024;function ff(e){var t=e>>10;return Zd[0]=rf[of[t]+(1023&e)]+nf[t],qd[0]}function vf(e){var t;if(e[Fu]===id)return e;var i=rd(e);return Hu(null,((t={next:{value:function(){return Cd(i)}}})[Fu]={value:function(){return this}},t))}var pf=new Hd,yf=Hu(kd,(yu={next:{value:function(){var e=Wd(pf,this);return Bd(e)},writable:!0,configurable:!0}},yu[Nu]={value:"Array Iterator",configurable:!0},yu));function mf(e){var t=Hu(yf);return Kd(pf,t,e),t}function gf(e){return null!==e&&"object"==typeof e||"function"==typeof e}function bf(e){return null!==e&&"object"==typeof e}function wf(e){return void 0!==Md(e)}function Pf(e){var t=Md(e);return"BigInt64Array"===t||"BigUint64Array"===t}function Ef(e){if(null===ld)return!1;try{return hd(e),!0}catch(e){return!1}}function Tf(e){return!!Qu(e)&&(e[Fu]===id||"Array Iterator"===e[Fu]()[Nu])}function _f(e){if("string"!=typeof e)return!1;var t=Bu(e);return e===t+""&&!!ku(t)&&t===nd(t)}var If=Bu.MAX_SAFE_INTEGER;function xf(e){if("bigint"==typeof e)throw Ld("Cannot convert a BigInt value to a number");var t=Bu(e);return Lu(t)||0===t?0:nd(t)}function Sf(e){var t=xf(e);return t<0?0:t<If?t:If}function Mf(e,t){if(!gf(e))throw Ld("This is not an object");var i=e.constructor;if(void 0===i)return t;if(!gf(i))throw Ld("The constructor property value is not an object");var r=i[Uu];return null==r?t:r}function Of(e){if(Ef(e))return!1;try{return ad(e,0,0),!1}catch(e){}return!0}function Rf(e,t){var i=Lu(e),r=Lu(t);if(i&&r)return 0;if(i)return 1;if(r)return-1;if(e<t)return-1;if(e>t)return 1;if(0===e&&0===t){var n=Yu(e,0),o=Yu(t,0);if(!n&&o)return-1;if(n&&!o)return 1}return 0}var jf=Gu("__Float16Array__"),Df=new Hd;function Af(e){return Yd(Df,e)||!sd(e)&&function(e){if(!bf(e))return!1;var t=Ou(e);if(!bf(t))return!1;var i=t.constructor;if(void 0===i)return!1;if(!gf(i))throw Ld("The constructor property value is not an object");return Ru(i,jf)}(e)}function Cf(e){if(!Af(e))throw Ld("This is not a Float16Array object")}function Bf(e,t){var i=Af(e),r=wf(e);if(!i&&!r)throw Ld("Species constructor didn't return TypedArray object");if("number"==typeof t){var n;if(i){var o=kf(e);n=Sd(o)}else n=Sd(e);if(n<t)throw Ld("Derived constructor created TypedArray object which was too small length")}if(Pf(e))throw Ld("Cannot mix BigInt and other types, use explicit conversions")}function kf(e){var t=Wd(Df,e);if(void 0!==t){if(Of(Id(t)))throw Ld("Attempting to access detached ArrayBuffer");return t}var i=e.buffer;if(Of(i))throw Ld("Attempting to access detached ArrayBuffer");var r=Iu(Xf,[i,e.byteOffset,e.length],e.constructor);return Wd(Df,r)}function Lf(e){for(var t=Sd(e),i=[],r=0;r<t;++r)i[r]=ff(e[r]);return i}for(var Ff,Uf=new Ud,Nf=h(ju(fd));!(Ff=Nf()).done;){var Gf=Ff.value;if(Gf!==Nu){var Vf=Mu(fd,Gf);qu(Vf,"get")&&Gd(Uf,Gf)}}var Hf=Wu({get:function(e,t,i){return _f(t)&&qu(e,t)?ff(Su(e,t)):Vd(Uf,t)&&zu(fd,e)?Su(e,t):Su(e,t,i)},set:function(e,t,i,r){return _f(t)&&qu(e,t)?Du(e,t,tf(i)):Du(e,t,i,r)},getOwnPropertyDescriptor:function(e,t){if(_f(t)&&qu(e,t)){var i=Mu(e,t);return i.value=ff(i.value),i}return Mu(e,t)},defineProperty:function(e,t,i){return _f(t)&&qu(e,t)&&qu(i,"value")?(i.value=tf(i.value),xu(e,t,i)):xu(e,t,i)}}),Xf=/*#__PURE__*/function(){function t(e,i,r){var n;if(Af(e))n=Iu(Od,[kf(e)],this instanceof t?this.constructor:void 0);else if(gf(e)&&!function(e){try{return cd(e),!0}catch(e){return!1}}(e)){var o,s;if(wf(e)){o=e,s=Sd(e);var a=Id(e),c=Ef(a)?od:Mf(a,od);if(Of(a))throw Ld("Attempting to access detached ArrayBuffer");if(Pf(e))throw Ld("Cannot mix BigInt and other types, use explicit conversions");var l=new c(2*s);n=Iu(Od,[l],this instanceof t?this.constructor:void 0)}else{var h=e[Fu];if(null!=h&&"function"!=typeof h)throw Ld("@@iterator property is not callable");null!=h?Tf(e)?(o=e,s=e.length):s=(o=[].concat(e)).length:s=Sf((o=e).length),n=Iu(Od,[s],this instanceof t?this.constructor:void 0)}for(var u=0;u<s;++u)n[u]=tf(o[u])}else n=Iu(Od,arguments,this instanceof t?this.constructor:void 0);var d=new Cu(n,Hf);return Kd(Df,d,n),d}t.from=function(e){var i,r,n=this,o=[].slice.call(arguments,1),s=this;if(!Ru(s,jf))throw Ld("This constructor is not a subclass of Float16Array");if(s===t){if(Af(e)&&0===o.length){var a=kf(e),c=new Od(Id(a),xd(a),Sd(a));return new t(Id(Td(c)))}if(0===o.length)return new t(Id(Rd(e,tf)));var l=o[0];return new t(Id(Rd(e,function(e){return tf(_u(l,n,[e].concat(vf([].slice.call(arguments,1)))))},o[1])))}var h,u=e[Fu];if(null!=u&&"function"!=typeof u)throw Ld("@@iterator property is not callable");if(null!=u)Tf(e)?(i=e,r=e.length):!wf(h=e)||h[Fu]!==vd&&"Array Iterator"!==h[Fu]()[Nu]?r=(i=[].concat(e)).length:(i=e,r=Sd(e));else{if(null==e)throw Ld("Cannot convert undefined or null to object");r=Sf((i=Vu(e)).length)}var d=new s(r);if(0===o.length)for(var f=0;f<r;++f)d[f]=i[f];else for(var v=o[0],p=o[1],y=0;y<r;++y)d[y]=_u(v,p,[i[y],y]);return d},t.of=function(){var e=[].slice.call(arguments),i=this;if(!Ru(i,jf))throw Ld("This constructor is not a subclass of Float16Array");var r=e.length;if(i===t){for(var n=new t(r),o=kf(n),s=0;s<r;++s)o[s]=tf(e[s]);return n}for(var a=new i(r),c=0;c<r;++c)a[c]=e[c];return a};var r=t.prototype;return r.keys=function(){Cf(this);var e=kf(this);return pd(e)},r.values=function(){Cf(this);var t=kf(this);return mf(/*#__PURE__*/e().mark(function i(){var r,n,o;return e().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=h(yd(t));case 1:if((n=r()).done){e.next=7;break}return o=n.value,e.next=5,ff(o);case 5:e.next=1;break;case 7:case"end":return e.stop()}},i)})())},r.entries=function(){Cf(this);var t=kf(this);return mf(/*#__PURE__*/e().mark(function i(){var r,n,o,s,a;return e().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=h(md(t));case 1:if((n=r()).done){e.next=7;break}return s=(o=n.value)[0],a=o[1],e.next=5,[s,ff(a)];case 5:e.next=1;break;case 7:case"end":return e.stop()}},i)})())},r.at=function(e){Cf(this);var t=kf(this),i=Sd(t),r=xf(e),n=r>=0?r:i+r;if(!(n<0||n>=i))return ff(t[n])},r.map=function(e){Cf(this);var i=kf(this),r=Sd(i),n=[].slice.call(arguments,1)[0],o=Mf(i,t);if(o===t){for(var s=new t(r),a=kf(s),c=0;c<r;++c){var l=ff(i[c]);a[c]=tf(_u(e,n,[l,c,this]))}return s}var h=new o(r);Bf(h,r);for(var u=0;u<r;++u){var d=ff(i[u]);h[u]=_u(e,n,[d,u,this])}return h},r.filter=function(e){Cf(this);for(var i=kf(this),r=Sd(i),n=[].slice.call(arguments,1)[0],o=[],s=0;s<r;++s){var a=ff(i[s]);_u(e,n,[a,s,this])&&ed(o,a)}var c=new(Mf(i,t))(o);return Bf(c),c},r.reduce=function(e){var t=[].slice.call(arguments,1);Cf(this);var i,r,n=kf(this),o=Sd(n);if(0===o&&0===t.length)throw Ld("Reduce of empty array with no initial value");0===t.length?(i=ff(n[0]),r=1):(i=t[0],r=0);for(var s=r;s<o;++s)i=e(i,ff(n[s]),s,this);return i},r.reduceRight=function(e){var t=[].slice.call(arguments,1);Cf(this);var i,r,n=kf(this),o=Sd(n);if(0===o&&0===t.length)throw Ld("Reduce of empty array with no initial value");0===t.length?(i=ff(n[o-1]),r=o-2):(i=t[0],r=o-1);for(var s=r;s>=0;--s)i=e(i,ff(n[s]),s,this);return i},r.forEach=function(e){Cf(this);for(var t=kf(this),i=Sd(t),r=[].slice.call(arguments,1)[0],n=0;n<i;++n)_u(e,r,[ff(t[n]),n,this])},r.find=function(e){Cf(this);for(var t=kf(this),i=Sd(t),r=[].slice.call(arguments,1)[0],n=0;n<i;++n){var o=ff(t[n]);if(_u(e,r,[o,n,this]))return o}},r.findIndex=function(e){Cf(this);for(var t=kf(this),i=Sd(t),r=[].slice.call(arguments,1)[0],n=0;n<i;++n){var o=ff(t[n]);if(_u(e,r,[o,n,this]))return n}return-1},r.findLast=function(e){Cf(this);for(var t=kf(this),i=Sd(t),r=[].slice.call(arguments,1)[0],n=i-1;n>=0;--n){var o=ff(t[n]);if(_u(e,r,[o,n,this]))return o}},r.findLastIndex=function(e){Cf(this);for(var t=kf(this),i=Sd(t),r=[].slice.call(arguments,1)[0],n=i-1;n>=0;--n){var o=ff(t[n]);if(_u(e,r,[o,n,this]))return n}return-1},r.every=function(e){Cf(this);for(var t=kf(this),i=Sd(t),r=[].slice.call(arguments,1)[0],n=0;n<i;++n)if(!_u(e,r,[ff(t[n]),n,this]))return!1;return!0},r.some=function(e){Cf(this);for(var t=kf(this),i=Sd(t),r=[].slice.call(arguments,1)[0],n=0;n<i;++n)if(_u(e,r,[ff(t[n]),n,this]))return!0;return!1},r.set=function(e){Cf(this);var t=kf(this),i=xf([].slice.call(arguments,1)[0]);if(i<0)throw Fd("Offset is out of bounds");if(null==e)throw Ld("Cannot convert undefined or null to object");if(Pf(e))throw Ld("Cannot mix BigInt and other types, use explicit conversions");if(Af(e))return gd(kf(this),kf(e),i);if(wf(e)&&Of(Id(e)))throw Ld("Attempting to access detached ArrayBuffer");var r=Sd(t),n=Vu(e),o=Sf(n.length);if(i===1/0||o+i>r)throw Fd("Offset is out of bounds");for(var s=0;s<o;++s)t[s+i]=tf(n[s])},r.reverse=function(){Cf(this);var e=kf(this);return bd(e),this},r.fill=function(e){Cf(this);var t=kf(this);return wd.apply(void 0,[t,tf(e)].concat(vf([].slice.call(arguments,1)))),this},r.copyWithin=function(e,t){Cf(this);var i=kf(this);return Pd.apply(void 0,[i,e,t].concat(vf([].slice.call(arguments,2)))),this},r.sort=function(){var e=[].slice.call(arguments);Cf(this);var t=kf(this),i=void 0!==e[0]?e[0]:Rf;return Ed(t,function(e,t){return i(ff(e),ff(t))}),this},r.slice=function(){var e=[].slice.call(arguments);Cf(this);var i=kf(this),r=Mf(i,t);if(r===t){var n=new Od(Id(i),xd(i),Sd(i));return new t(Id(Td.apply(void 0,[n].concat(vf(e)))))}var o,s,a=Sd(i),c=xf(e[0]),l=void 0===e[1]?a:xf(e[1]),h=(s=l===-1/0?0:l<0?a+l>0?a+l:0:a<l?a:l)-(o=c===-1/0?0:c<0?a+c>0?a+c:0:a<c?a:c)>0?s-o:0,u=new r(h);if(Bf(u,h),0===h)return u;if(Of(Id(i)))throw Ld("Attempting to access detached ArrayBuffer");for(var d=0;o<s;)u[d]=ff(i[o]),++o,++d;return u},r.subarray=function(){Cf(this);var e=kf(this),i=Mf(e,t),r=new Od(Id(e),xd(e),Sd(e)),n=_d.apply(void 0,[r].concat(vf([].slice.call(arguments)))),o=new i(Id(n),xd(n),Sd(n));return Bf(o),o},r.indexOf=function(e){Cf(this);var t=kf(this),i=Sd(t),r=xf([].slice.call(arguments,1)[0]);if(r===1/0)return-1;r<0&&(r+=i)<0&&(r=0);for(var n=r;n<i;++n)if(qu(t,n)&&ff(t[n])===e)return n;return-1},r.lastIndexOf=function(e){var t=[].slice.call(arguments,1);Cf(this);var i=kf(this),r=Sd(i),n=t.length>=1?xf(t[0]):r-1;if(n===-1/0)return-1;n>=0?n=n<r-1?n:r-1:n+=r;for(var o=n;o>=0;--o)if(qu(i,o)&&ff(i[o])===e)return o;return-1},r.includes=function(e){Cf(this);var t=kf(this),i=Sd(t),r=xf([].slice.call(arguments,1)[0]);if(r===1/0)return!1;r<0&&(r+=i)<0&&(r=0);for(var n=Lu(e),o=r;o<i;++o){var s=ff(t[o]);if(n&&Lu(s))return!0;if(s===e)return!0}return!1},r.join=function(){Cf(this);var e=Lf(kf(this));return $u.apply(void 0,[e].concat(vf([].slice.call(arguments))))},r.toLocaleString=function(){Cf(this);var e=Lf(kf(this));return td.apply(void 0,[e].concat(vf([].slice.call(arguments))))},i(t,[{key:Nu,get:function(){if(Af(this))return"Float16Array"}}]),t}();Xu(Xf,"BYTES_PER_ELEMENT",{value:2}),Xu(Xf,jf,{}),Au(Xf,ud);var Wf=Xf.prototype;Xu(Wf,"BYTES_PER_ELEMENT",{value:2}),Xu(Wf,Fu,{value:Wf.values,writable:!0,configurable:!0}),Au(Wf,fd);var Yf=new Fh({textureWidth:0,textureHeight:0});function Kf(e){e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)}var zf=function(){this.positionsDecompressMatrices=void 0,this.positionsCompressed=void 0,this.indices_8Bits=void 0,this.indices_16Bits=void 0,this.indices_32Bits=void 0,this.edgeIndices_8Bits=void 0,this.edgeIndices_16Bits=void 0,this.edgeIndices_32Bits=void 0,this.eachPrimitiveMesh_8Bits=void 0,this.eachPrimitiveMesh_16Bits=void 0,this.eachPrimitiveMesh_32Bits=void 0,this.eachEdgeMesh_8Bits=void 0,this.eachEdgeMesh_16Bits=void 0,this.eachEdgeMesh_32Bits=void 0,this.eachMeshVertexPortionBase=void 0,this.eachMeshVertexPortionOffset=void 0,this.eachMeshEdgeIndicesOffset=void 0,this.eachMeshColor=void 0,this.eachMeshPickColor=void 0,this.eachMeshMatrices=void 0,this.eachMeshNormalMatrix=void 0,this.eachMeshPositionsDecompressMatrix=void 0,this.eachMeshFlags1=void 0,this.eachMeshFlags2=void 0,this.eachEdgeOffset=void 0,this.eachMeshParts=void 0,this.positionsDecompressMatrices=[],this.positionsCompressed=[],this.indices_8Bits=[],this.indices_16Bits=[],this.indices_32Bits=[],this.edgeIndices_8Bits=[],this.edgeIndices_16Bits=[],this.edgeIndices_32Bits=[],this.eachMeshVertexPortionBase=[],this.eachMeshVertexPortionOffset=[],this.eachMeshEdgeIndicesOffset=[],this.eachMeshColor=[],this.eachMeshPickColor=[],this.eachMeshMatrices=[],this.eachMeshNormalMatrix=[],this.eachMeshPositionsDecompressMatrix=[],this.eachMeshFlags1=[],this.eachMeshFlags2=[],this.eachPrimitiveMesh_32Bits=[],this.eachPrimitiveMesh_16Bits=[],this.eachPrimitiveMesh_8Bits=[],this.eachEdgeMesh_32Bits=[],this.eachEdgeMesh_16Bits=[],this.eachEdgeMesh_8Bits=[],this.eachEdgeOffset=[],this.eachMeshParts=[]},qf=8,Zf=ri(),Qf=Pt([0,0,0,1]),Jf=Pt([0,0,0,1]),$f=new Uint8Array(4),ev=new Float32Array(3),tv=/*#__PURE__*/d("gl"),iv=/*#__PURE__*/d("view"),rv=/*#__PURE__*/d("dataTextureBuffer"),nv=/*#__PURE__*/d("geometryHandles"),ov=/*#__PURE__*/d("meshPartHandles"),sv=/*#__PURE__*/d("numMeshParts"),av=/*#__PURE__*/d("deferredSetFlagsActive"),cv=/*#__PURE__*/d("deferredSetFlagsDirty"),lv=/*#__PURE__*/d("built"),hv=/*#__PURE__*/d("createGeometryBucket"),uv=/*#__PURE__*/d("createMeshPart"),dv=/*#__PURE__*/d("setMeshFlags"),fv=/*#__PURE__*/d("setMeshFlags2"),vv=/*#__PURE__*/function(){function e(e,t){Object.defineProperty(this,fv,{value:gv}),Object.defineProperty(this,dv,{value:mv}),Object.defineProperty(this,uv,{value:yv}),Object.defineProperty(this,hv,{value:pv}),this.rendererModel=void 0,this.layerIndex=void 0,this.meshCounts=void 0,this.renderState=void 0,Object.defineProperty(this,tv,{writable:!0,value:void 0}),Object.defineProperty(this,iv,{writable:!0,value:void 0}),Object.defineProperty(this,rv,{writable:!0,value:void 0}),Object.defineProperty(this,nv,{writable:!0,value:void 0}),Object.defineProperty(this,ov,{writable:!0,value:void 0}),Object.defineProperty(this,sv,{writable:!0,value:void 0}),Object.defineProperty(this,av,{writable:!0,value:void 0}),Object.defineProperty(this,cv,{writable:!0,value:void 0}),Object.defineProperty(this,lv,{writable:!0,value:void 0}),this.meshCounts=new wu,this.layerIndex=e.layerIndex,this.rendererModel=e.rendererModel,this.renderState={primitive:e.primitive,dataTextureSet:new bu,numIndices8Bits:0,numIndices16Bits:0,numIndices32Bits:0,numEdgeIndices8Bits:0,numEdgeIndices16Bits:0,numEdgeIndices32Bits:0,numVertices:0},f(this,tv)[tv]=e.gl,f(this,iv)[iv]=e.view,f(this,rv)[rv]=new zf,f(this,sv)[sv]=0,f(this,nv)[nv]={},f(this,ov)[ov]=[],f(this,lv)[lv]=!1,this.beginDeferredFlags()}var t=e.prototype;return t.canCreateMesh=function(e){if(f(this,lv)[lv])throw"Already built";var t=this.renderState,i=e.geometryBuckets.length;if(f(this,sv)[sv]+i>4096)return!1;for(var r=0,n=0,o=0;o<i;o++){var s=e.geometryBuckets[o];r+=s.positionsCompressed.length,s.indices&&(n+=s.indices.length)}return t.numVertices+r/(e.primitive===Ke?1:e.primitive==ze?2:3)<=2097152&&n/3+n<=2097152},t.hasGeometry=function(e){return f(this,nv)[nv][e]},t.createGeometryCompressed=function(e){if(f(this,lv)[lv])throw"Already built";for(var t=[],i=0,r=e.geometryBuckets.length;i<r;i++)t.push(f(this,hv)[hv](e.geometryBuckets[i]));f(this,nv)[nv][e.id]={id:e.id,aabb:e.aabb,positionsDecompressMatrix:e.positionsDecompressMatrix,geometryBucketHandles:t}},t.createMesh=function(e){var t=this;if(f(this,lv)[lv])throw new Error("Already built");var i=this.meshCounts.numMeshes;if(!e.geometryId)throw new Error("geometryId expected");var r=f(this,nv)[nv][e.geometryId];if(!r)throw new Error("Geometry not found");r.geometryBucketHandles.forEach(function(i){f(t,uv)[uv](e,r,i)});for(var n=Rr(),o=jr(r.aabb),s=0,a=o.length;s<a;s+=4)Qf[0]=o[s+0],Qf[1]=o[s+1],Qf[2]=o[s+2],e.matrix?(fi(e.matrix,Qf,Jf),Ar(n,Jf)):Ar(n,Jf);return this.meshCounts.numMeshes++,i},t.build=function(){if(f(this,lv)[lv])throw new Error("Already built");var e=f(this,tv)[tv],t=f(this,rv)[rv],i=this.renderState.dataTextureSet;i.positions=function(e,t){var i=1024,r=Math.ceil(t.length/3/i);if(0==r)throw"texture height == 0";var n=new Uint16Array(i*r*3);n.fill(0),n.set(t,0);var o=e.createTexture();return e.bindTexture(e.TEXTURE_2D,o),e.texStorage2D(e.TEXTURE_2D,1,e.RGB16UI,i,r),e.texSubImage2D(e.TEXTURE_2D,0,0,0,i,r,e.RGB_INTEGER,e.UNSIGNED_SHORT,n,0),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(e.TEXTURE_2D,null),new Fh({gl:e,texture:o,textureWidth:i,textureHeight:r})}(e,t.positionsCompressed),i.indices_8Bits=function(e,t){if(0==t.length)return Yf;var i=1024,r=Math.ceil(t.length/3/i);if(0==r)throw"texture height == 0";var n=new Uint8Array(i*r*3);n.fill(0),n.set(t,0);var o=e.createTexture();return o?(e.bindTexture(e.TEXTURE_2D,o),e.texStorage2D(e.TEXTURE_2D,1,e.RGB8UI,i,r),e.texSubImage2D(e.TEXTURE_2D,0,0,0,i,r,e.RGB_INTEGER,e.UNSIGNED_BYTE,n,0),Kf(e),e.bindTexture(e.TEXTURE_2D,null),new Fh({gl:e,texture:o,textureWidth:i,textureHeight:r})):Yf}(e,t.indices_8Bits),i.indices_16Bits=function(e,t){if(0==t.length)return Yf;var i=1024,r=Math.ceil(t.length/3/i);if(0==r)throw"texture height == 0";var n=new Uint16Array(i*r*3);n.fill(0),n.set(t,0);var o=e.createTexture();return o?(e.bindTexture(e.TEXTURE_2D,o),e.texStorage2D(e.TEXTURE_2D,1,e.RGB16UI,i,r),e.texSubImage2D(e.TEXTURE_2D,0,0,0,i,r,e.RGB_INTEGER,e.UNSIGNED_SHORT,n,0),Kf(e),e.bindTexture(e.TEXTURE_2D,null),new Fh({gl:e,texture:o,textureWidth:i,textureHeight:r})):Yf}(e,t.indices_16Bits),i.indices_32Bits=function(e,t){if(0==t.length)return Yf;var i=1024,r=Math.ceil(t.length/3/i);if(0==r)throw"texture height == 0";var n=new Uint32Array(i*r*3);n.fill(0),n.set(t,0);var o=e.createTexture();return o?(e.bindTexture(e.TEXTURE_2D,o),e.texStorage2D(e.TEXTURE_2D,1,e.RGB32UI,i,r),e.texSubImage2D(e.TEXTURE_2D,0,0,0,i,r,e.RGB_INTEGER,e.UNSIGNED_INT,n,0),Kf(e),e.bindTexture(e.TEXTURE_2D,null),new Fh({gl:e,texture:o,textureWidth:i,textureHeight:r})):Yf}(e,t.indices_32Bits),i.edgeIndices_8Bits=function(e,t){if(0==t.length)return Yf;var i=1024,r=Math.ceil(t.length/2/i);if(0==r)throw"texture height == 0";var n=new Uint8Array(i*r*2);n.fill(0),n.set(t,0);var o=e.createTexture();return o?(e.bindTexture(e.TEXTURE_2D,o),e.texStorage2D(e.TEXTURE_2D,1,e.RG8UI,i,r),e.texSubImage2D(e.TEXTURE_2D,0,0,0,i,r,e.RG_INTEGER,e.UNSIGNED_BYTE,n,0),Kf(e),e.bindTexture(e.TEXTURE_2D,null),new Fh({gl:e,texture:o,textureWidth:i,textureHeight:r})):Yf}(e,t.edgeIndices_8Bits),i.edgeIndices_16Bits=function(e,t){if(0==t.length)return Yf;var i=1024,r=Math.ceil(t.length/2/i);if(0==r)throw"texture height == 0";var n=new Uint16Array(i*r*2);n.fill(0),n.set(t,0);var o=e.createTexture();return o?(e.bindTexture(e.TEXTURE_2D,o),e.texStorage2D(e.TEXTURE_2D,1,e.RG16UI,i,r),e.texSubImage2D(e.TEXTURE_2D,0,0,0,i,r,e.RG_INTEGER,e.UNSIGNED_SHORT,n,0),Kf(e),e.bindTexture(e.TEXTURE_2D,null),new Fh({gl:e,texture:o,textureWidth:i,textureHeight:r})):Yf}(e,t.edgeIndices_16Bits),i.edgeIndices_32Bits=function(e,t){if(0==t.length)return Yf;var i=1024,r=Math.ceil(t.length/2/i);if(0==r)throw"texture height == 0";var n=new Uint32Array(i*r*2);n.fill(0),n.set(t,0);var o=e.createTexture();return o?(e.bindTexture(e.TEXTURE_2D,o),e.texStorage2D(e.TEXTURE_2D,1,e.RG32UI,i,r),e.texSubImage2D(e.TEXTURE_2D,0,0,0,i,r,e.RG_INTEGER,e.UNSIGNED_INT,n,0),Kf(e),e.bindTexture(e.TEXTURE_2D,null),new Fh({gl:e,texture:o,textureWidth:i,textureHeight:r})):Yf}(e,t.edgeIndices_32Bits),i.eachMeshAttributes=function(e,t,i,r,n,o){var s=t.length;if(0==s)throw"texture height == 0";for(var a=new Uint8Array(32*s),c=0;c<s;c++)a.set(t[c],28*c+0),a.set(i[c],28*c+4),a.set([0,0,0,0],28*c+8),a.set([0,0,0,0],28*c+12),a.set([r[c]>>24&255,r[c]>>16&255,r[c]>>8&255,255&r[c]],28*c+16),a.set([n[c]>>24&255,n[c]>>16&255,n[c]>>8&255,255&n[c]],28*c+20),a.set([o[c]>>24&255,o[c]>>16&255,o[c]>>8&255,255&o[c]],28*c+24);var l=e.createTexture();return l?(e.bindTexture(e.TEXTURE_2D,l),e.texStorage2D(e.TEXTURE_2D,1,e.RGBA8UI,8,s),e.texSubImage2D(e.TEXTURE_2D,0,0,0,8,s,e.RGBA_INTEGER,e.UNSIGNED_BYTE,a,0),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(e.TEXTURE_2D,null),new Fh({gl:e,texture:l,textureWidth:8,textureHeight:s,textureData:a})):Yf}(e,t.eachMeshColor,t.eachMeshPickColor,t.eachMeshVertexPortionBase,t.eachMeshVertexPortionOffset,t.eachMeshEdgeIndicesOffset),i.eachMeshMatrices=function(e,t,i){var r=t.length;if(0==r)throw"texture height == 0";for(var n=new Xf(48*r),o=0;o<t.length;o++)n.set(t[o],48*o),n.set(i[o],48*o+16);var s=e.createTexture();return s?(e.bindTexture(e.TEXTURE_2D,s),e.texStorage2D(e.TEXTURE_2D,1,e.RGBA16F,12,r),e.texSubImage2D(e.TEXTURE_2D,0,0,0,12,r,e.RGBA,e.HALF_FLOAT,new Uint16Array(n.buffer),0),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(e.TEXTURE_2D,null),new Fh({gl:e,texture:s,textureWidth:12,textureHeight:r})):Yf}(e,t.eachMeshPositionsDecompressMatrix,t.eachMeshMatrices),i.eachEdgeOffset=function(e,t){var i=t.length;if(0==i)throw"texture height == 0";for(var r=new Float32Array(3*i),n=0;n<t.length;n++)r.set(t[n],3*n);var o=e.createTexture();return o?(e.bindTexture(e.TEXTURE_2D,o),e.texStorage2D(e.TEXTURE_2D,1,e.RGB32F,1,i),e.texSubImage2D(e.TEXTURE_2D,0,0,0,1,i,e.RGB,e.FLOAT,r,0),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(e.TEXTURE_2D,null),new Fh({gl:e,texture:o,textureWidth:1,textureHeight:i,textureData:r})):Yf}(e,t.eachEdgeOffset),i.build(),f(this,rv)[rv]=null,f(this,nv)[nv]={},f(this,ov)[ov]=[],f(this,lv)[lv]=!0},t.isEmpty=function(){return 0==this.meshCounts.numMeshes},t.initFlags=function(e,t,i){t&Pu.VISIBLE&&this.meshCounts.numVisible++,t&Pu.HIGHLIGHTED&&this.meshCounts.numHighlighted++,t&Pu.XRAYED&&this.meshCounts.numXRayed++,t&Pu.SELECTED&&this.meshCounts.numSelected++,t&Pu.CLIPPABLE&&this.meshCounts.numClippable++,t&Pu.EDGES&&this.meshCounts.numEdges++,t&Pu.PICKABLE&&this.meshCounts.numPickable++,t&Pu.CULLED&&this.meshCounts.numCulled++,i&&this.meshCounts.numTransparent++,f(this,dv)[dv](e,t,i),f(this,fv)[fv](e,t)},t.beginDeferredFlags=function(){f(this,av)[av]=!0},t.commitDeferredFlags=function(){if(f(this,av)[av]=!1,f(this,cv)[cv]){f(this,cv)[cv]=!1;var e=f(this,tv)[tv],t=this.renderState.dataTextureSet;e.bindTexture(e.TEXTURE_2D,t.eachMeshAttributes.texture),e.texSubImage2D(e.TEXTURE_2D,0,0,0,t.eachMeshAttributes.textureWidth,t.eachMeshAttributes.textureHeight,e.RGBA_INTEGER,e.UNSIGNED_BYTE,t.eachMeshAttributes.textureData),e.bindTexture(e.TEXTURE_2D,t.eachEdgeOffset.texture),e.texSubImage2D(e.TEXTURE_2D,0,0,0,t.eachEdgeOffset.textureWidth,t.eachEdgeOffset.textureHeight,e.RGB,e.FLOAT,t.eachEdgeOffset.textureData)}},t.flushInitFlags=function(){this.commitDeferredFlags()},t.setMeshVisible=function(e,t,i){if(!f(this,lv)[lv])throw"Not built";t&Pu.VISIBLE?this.meshCounts.numVisible++:this.meshCounts.numVisible--,f(this,dv)[dv](e,t,i)},t.setMeshHighlighted=function(e,t,i){if(!f(this,lv)[lv])throw"Not built";t&Pu.HIGHLIGHTED?this.meshCounts.numHighlighted++:this.meshCounts.numHighlighted--,f(this,dv)[dv](e,t,i)},t.setMeshXRayed=function(e,t,i){if(!f(this,lv)[lv])throw"Not built";t&Pu.XRAYED?this.meshCounts.numXRayed++:this.meshCounts.numXRayed--,f(this,dv)[dv](e,t,i)},t.setMeshSelected=function(e,t,i){if(!f(this,lv)[lv])throw"Not built";t&Pu.SELECTED?this.meshCounts.numSelected++:this.meshCounts.numSelected--,f(this,dv)[dv](e,t,i)},t.setMeshEdges=function(e,t,i){if(!f(this,lv)[lv])throw"Not built";t&Pu.EDGES?this.meshCounts.numEdges++:this.meshCounts.numEdges--,f(this,dv)[dv](e,t,i)},t.setMeshClippable=function(e,t){if(!f(this,lv)[lv])throw"Not built";t&Pu.CLIPPABLE?this.meshCounts.numClippable++:this.meshCounts.numClippable--,f(this,fv)[fv](e,t)},t.setMeshCulled=function(e,t,i){if(!f(this,lv)[lv])throw"Not built";t&Pu.CULLED?this.meshCounts.numCulled++:this.meshCounts.numCulled--,f(this,dv)[dv](e,t,i)},t.setMeshCollidable=function(e,t){if(!f(this,lv)[lv])throw"Not built"},t.setMeshPickable=function(e,t,i){if(!f(this,lv)[lv])throw"Not built";t&Pu.PICKABLE?this.meshCounts.numPickable++:this.meshCounts.numPickable--,f(this,dv)[dv](e,t,i)},t.setMeshColor=function(e,t,i){if(!f(this,lv)[lv])throw"Not built";var r=this.renderState.dataTextureSet,n=f(this,tv)[tv];$f[0]=t[0],$f[1]=t[1],$f[2]=t[2],$f[3]=t[3],r.eachMeshAttributes.textureData.set($f,28*e),f(this,av)[av]?f(this,cv)[cv]=!0:(n.bindTexture(n.TEXTURE_2D,r.eachMeshAttributes.texture),n.texSubImage2D(n.TEXTURE_2D,0,0,e,1,1,n.RGBA_INTEGER,n.UNSIGNED_BYTE,$f))},t.setMeshTransparent=function(e,t,i){if(!f(this,lv)[lv])throw"Not built";i?(this.meshCounts.numTransparent++,this.meshCounts.numTransparent++):(this.meshCounts.numTransparent--,this.meshCounts.numTransparent--),f(this,dv)[dv](e,t,i)},t.setMeshOffset=function(e,t){if(!f(this,lv)[lv])throw"Not built";var i=f(this,tv)[tv];ev[0]=t[0],ev[1]=t[1],ev[2]=t[2],f(this,av)[av]?f(this,cv)[cv]=!0:i.texSubImage2D(i.TEXTURE_2D,0,0,e,1,1,i.RGB,i.FLOAT,ev)},t.setMeshMatrix=function(e,t){if(!f(this,lv)[lv])throw"Not built";f(this,tv),f(this,av)[av]&&(f(this,cv)[cv]=!0)},t.setMeshViewMatrixIndex=function(e,t){if(!f(this,lv)[lv])throw"Not built";f(this,tv),f(this,av)[av]&&(f(this,cv)[cv]=!0)},t.destroy=function(){this.renderState.dataTextureSet.destroy()},i(e,[{key:"hash",get:function(){return"layer-"+this.renderState.primitive}}]),e}();function pv(e){var t=this.renderState;if(e.indices){var i=this.renderState.primitive===Ke?1:this.renderState.primitive===ze?2:3,r=Math.ceil(e.indices.length/i/qf)*qf*i,n=new Uint32Array(r);n.fill(0),n.set(e.indices),e.indices=n}if(e.edgeIndices){var o=Math.ceil(e.edgeIndices.length/2/qf)*qf*2,s=new Uint32Array(o);s.fill(0),s.set(e.edgeIndices),e.edgeIndices=s}for(var a,c=f(this,rv)[rv],l=e.positionsCompressed,h=e.indices,u=e.edgeIndices,d=c.positionsCompressed.length/3,v=l.length/3,p=0,y=l.length;p<y;p++)c.positionsCompressed.push(l[p]);var m,g=0;if(h){var b;g=h.length/3,a=(b=v<=256?c.indices_8Bits:v<=65536?c.indices_16Bits:c.indices_32Bits).length/3;for(var w=0,P=h.length;w<P;w++)b.push(h[w])}var E=0;if(u){var T;E=u.length/2,m=(T=v<=256?c.edgeIndices_8Bits:v<=65536?c.edgeIndices_16Bits:c.edgeIndices_32Bits).length/2;for(var _=0,I=u.length;_<I;_++)T.push(u[_])}return t.numVertices+=v,{vertexBase:d,numVertices:v,numTriangles:g,numEdges:E,indicesBase:a,edgeIndicesBase:m}}function yv(e,t,i){var r,n=f(this,rv)[rv],o=this.renderState,s=e.matrix||Zf,a=e.color||[255,255,255],c=n.positionsCompressed.length/3;n.eachMeshPositionsDecompressMatrix.push(t.positionsDecompressMatrix),n.eachMeshMatrices.push(s),n.eachMeshColor.push([a[0],a[1],a[2],255]),n.eachMeshPickColor.push(e.pickColor),r=i.numVertices<=256?o.numIndices8Bits:i.numVertices<=65536?o.numIndices16Bits:o.numIndices32Bits,n.eachMeshVertexPortionBase.push(i.vertexBase),n.eachMeshVertexPortionOffset.push(r/3-i.indicesBase),n.eachMeshEdgeIndicesOffset.push((i.numVertices<=256?o.numEdgeIndices8Bits:i.numVertices<=65536?o.numEdgeIndices16Bits:o.numEdgeIndices32Bits)/2-i.edgeIndicesBase);var l=f(this,ov)[ov].length;if(i.numTriangles>0){var h,u=3*i.numTriangles;i.numVertices<=256?(h=n.eachPrimitiveMesh_8Bits,o.numIndices8Bits+=u):i.numVertices<=65536?(h=n.eachPrimitiveMesh_16Bits,o.numIndices16Bits+=u):(h=n.eachPrimitiveMesh_32Bits,o.numIndices32Bits+=u);for(var d=0;d<i.numTriangles;d+=qf)h.push(l)}if(i.numEdges>0){var v,p=2*i.numEdges;i.numVertices<=256?(v=n.eachEdgeMesh_8Bits,o.numEdgeIndices8Bits+=p):i.numVertices<=65536?(v=n.eachEdgeMesh_16Bits,o.numEdgeIndices16Bits+=p):(v=n.eachEdgeMesh_32Bits,o.numEdgeIndices32Bits+=p);for(var y=0;y<i.numEdges;y+=qf)v.push(l)}return n.eachEdgeOffset.push([0,0,0]),f(this,ov)[ov].push({vertsBase:c,numVerts:i.numTriangles}),f(this,sv)[sv]++,l}function mv(e,t,i){if(!f(this,lv)[lv])throw"Not built";var r,n,o,s=!!(t&Pu.VISIBLE),a=!!(t&Pu.XRAYED),c=!!(t&Pu.HIGHLIGHTED),l=!!(t&Pu.SELECTED),h=!!(t&Pu.CULLED);r=!s||h||a?eu.NOT_RENDERED:i?eu.COLOR_TRANSPARENT:eu.COLOR_OPAQUE,n=!s||h?eu.NOT_RENDERED:l?eu.SILHOUETTE_SELECTED:c?eu.SILHOUETTE_HIGHLIGHTED:a?eu.SILHOUETTE_XRAYED:eu.NOT_RENDERED,o=!s||h?eu.NOT_RENDERED:l?eu.EDGES_SELECTED:c?eu.EDGES_HIGHLIGHTED:a?eu.EDGES_XRAYED:t&Pu.EDGES?i?eu.EDGES_COLOR_TRANSPARENT:eu.EDGES_COLOR_OPAQUE:eu.NOT_RENDERED;var u=s&&!h&&t&Pu.PICKABLE?eu.PICK:eu.NOT_RENDERED,d=this.renderState.dataTextureSet,v=f(this,tv)[tv];if($f[0]=r,$f[1]=n,$f[2]=o,$f[3]=u,f(this,av)[av])return d.eachMeshAttributes.textureData.set($f,28*e+8),void(f(this,cv)[cv]=!0);v.bindTexture(v.TEXTURE_2D,d.eachMeshAttributes.texture),v.texSubImage2D(v.TEXTURE_2D,0,2,e,1,1,v.RGBA_INTEGER,v.UNSIGNED_BYTE,$f)}function gv(e,t){if(!f(this,lv)[lv])throw"Not built";var i=t&Pu.CLIPPABLE?255:0,r=this.renderState.dataTextureSet,n=f(this,tv)[tv];if($f[0]=i,$f[1]=0,$f[2]=1,$f[3]=2,f(this,av)[av])return r.eachMeshAttributes.textureData.set($f,28*e+12),void(f(this,cv)[cv]=!0);n.bindTexture(n.TEXTURE_2D,r.eachMeshAttributes.texture),n.texSubImage2D(n.TEXTURE_2D,0,3,e,1,1,n.RGBA_INTEGER,n.UNSIGNED_BYTE,$f)}var bv=function(){},wv=/*#__PURE__*/function(){function e(e,t){this.texture=void 0,this.texture2D=void 0,this.texture=e,this.texture2D=t}return e.prototype.destroy=function(){this.texture2D&&this.texture2D.destroy()},e}(),Pv=new Uint16Array([0,0,0]),Ev=/*#__PURE__*/d("flags"),Tv=/*#__PURE__*/d("aabb"),_v=/*#__PURE__*/d("offsetAABB"),Iv=/*#__PURE__*/d("offset"),xv=/*#__PURE__*/d("colorizeUpdated"),Sv=/*#__PURE__*/d("opacityUpdated"),Mv=/*#__PURE__*/function(){function e(e){this.id=void 0,this.model=void 0,this.sceneObject=void 0,this.layerId=void 0,this.rendererMeshes=void 0,Object.defineProperty(this,Ev,{writable:!0,value:void 0}),Object.defineProperty(this,Tv,{writable:!0,value:void 0}),Object.defineProperty(this,_v,{writable:!0,value:void 0}),Object.defineProperty(this,Iv,{writable:!0,value:void 0}),Object.defineProperty(this,xv,{writable:!0,value:void 0}),Object.defineProperty(this,Sv,{writable:!0,value:void 0}),this.id=e.id,this.rendererMeshes=e.rendererMeshes||[],f(this,Ev)[Ev]=0,f(this,Tv)[Tv]=e.aabb,f(this,_v)[_v]=Er(e.aabb),f(this,Iv)[Iv]=wt(),f(this,xv)[xv]=!1,f(this,Sv)[Sv]=!1,this.layerId=e.layerId||null;for(var t=0,i=this.rendererMeshes.length;t<i;t++)this.rendererMeshes[t].setSceneObject(this)}var t=e.prototype;return t.setVisible=function(e,t){if(!!(f(this,Ev)[Ev]&Pu.VISIBLE)!==t){f(this,Ev)[Ev]=t?f(this,Ev)[Ev]|Pu.VISIBLE:f(this,Ev)[Ev]&~Pu.VISIBLE;for(var i=0,r=this.rendererMeshes.length;i<r;i++)this.rendererMeshes[i].setVisible(f(this,Ev)[Ev])}},t.setHighlighted=function(e,t){if(!!(f(this,Ev)[Ev]&Pu.HIGHLIGHTED)!==t){f(this,Ev)[Ev]=t?f(this,Ev)[Ev]|Pu.HIGHLIGHTED:f(this,Ev)[Ev]&~Pu.HIGHLIGHTED;for(var i=0,r=this.rendererMeshes.length;i<r;i++)this.rendererMeshes[i].setHighlighted(f(this,Ev)[Ev])}},t.setXRayed=function(e,t){if(!!(f(this,Ev)[Ev]&Pu.XRAYED)!==t){f(this,Ev)[Ev]=t?f(this,Ev)[Ev]|Pu.XRAYED:f(this,Ev)[Ev]&~Pu.XRAYED;for(var i=0,r=this.rendererMeshes.length;i<r;i++)this.rendererMeshes[i].setXRayed(f(this,Ev)[Ev])}},t.setSelected=function(e,t){if(!!(f(this,Ev)[Ev]&Pu.SELECTED)!==t){f(this,Ev)[Ev]=t?f(this,Ev)[Ev]|Pu.SELECTED:f(this,Ev)[Ev]&~Pu.SELECTED;for(var i=0,r=this.rendererMeshes.length;i<r;i++)this.rendererMeshes[i].setSelected(f(this,Ev)[Ev])}},t.setEdges=function(e,t){if(!!(f(this,Ev)[Ev]&Pu.EDGES)!==t){f(this,Ev)[Ev]=t?f(this,Ev)[Ev]|Pu.EDGES:f(this,Ev)[Ev]&~Pu.EDGES;for(var i=0,r=this.rendererMeshes.length;i<r;i++)this.rendererMeshes[i].setEdges(f(this,Ev)[Ev])}},t.setCulled=function(e,t){if(!!(f(this,Ev)[Ev]&Pu.CULLED)!==t){f(this,Ev)[Ev]=t?f(this,Ev)[Ev]|Pu.CULLED:f(this,Ev)[Ev]&~Pu.CULLED;for(var i=0,r=this.rendererMeshes.length;i<r;i++)this.rendererMeshes[i].setCulled(f(this,Ev)[Ev])}},t.setClippable=function(e,t){if(!!(f(this,Ev)[Ev]&Pu.CLIPPABLE)!==t){f(this,Ev)[Ev]=t?f(this,Ev)[Ev]|Pu.CLIPPABLE:f(this,Ev)[Ev]&~Pu.CLIPPABLE;for(var i=0,r=this.rendererMeshes.length;i<r;i++)this.rendererMeshes[i].setClippable(f(this,Ev)[Ev])}},t.setCollidable=function(e,t){if(!!(f(this,Ev)[Ev]&Pu.COLLIDABLE)!==t){f(this,Ev)[Ev]=t?f(this,Ev)[Ev]|Pu.COLLIDABLE:f(this,Ev)[Ev]&~Pu.COLLIDABLE;for(var i=0,r=this.rendererMeshes.length;i<r;i++)this.rendererMeshes[i].setCollidable(f(this,Ev)[Ev])}},t.setPickable=function(e,t){if(!!(f(this,Ev)[Ev]&Pu.PICKABLE)!==t){f(this,Ev)[Ev]=t?f(this,Ev)[Ev]|Pu.PICKABLE:f(this,Ev)[Ev]&~Pu.PICKABLE;for(var i=0,r=this.rendererMeshes.length;i<r;i++)this.rendererMeshes[i].setPickable(f(this,Ev)[Ev])}},t.setColorize=function(e,t){if(t){Pv[0]=Math.floor(255*t[0]),Pv[1]=Math.floor(255*t[1]),Pv[2]=Math.floor(255*t[2]);for(var i=0,r=this.rendererMeshes.length;i<r;i++)this.rendererMeshes[i].setColorize(Pv)}else for(var n=0,o=this.rendererMeshes.length;n<o;n++)this.rendererMeshes[n].setColorize(null)},t.setOpacity=function(e,t){if(0!==this.rendererMeshes.length){var i=this.rendererMeshes[0].colorize[3],r=255;if(null!=t){if(t<0?t=0:t>1&&(t=1),i===(r=Math.floor(255*t)))return}else if(i===(r=255))return;for(var n=0,o=this.rendererMeshes.length;n<o;n++)this.rendererMeshes[n].setOpacity(r,f(this,Ev)[Ev])}},t.setOffset=function(e,t){},t.build=function(){for(var e=0,t=this.rendererMeshes.length;e<t;e++)this.rendererMeshes[e].build(f(this,Ev)[Ev])},t.finalize2=function(){for(var e=0,t=this.rendererMeshes.length;e<t;e++)this.rendererMeshes[e].finalize2()},t.destroy=function(){for(var e=0,t=this.rendererMeshes.length;e<t;e++)this.rendererMeshes[e].destroy()},i(e,[{key:"aabb",get:function(){return f(this,_v)[_v]}}]),e}(),Ov=Zt(),Rv=Zt(),jv=/*#__PURE__*/function(){function e(e){this.id=void 0,this.color=void 0,this.rendererGeometry=void 0,this.rendererTextureSet=void 0,this.matrix=void 0,this.metallic=void 0,this.roughness=void 0,this.opacity=void 0,this.pickId=void 0,this.tileManager=void 0,this.tile=void 0,this.sceneObjectRenderer=void 0,this.aabb=void 0,this.layer=void 0,this.meshIndex=void 0,this.colorize=void 0,this.colorizing=void 0,this.transparent=void 0,this.sceneObjectRenderer=null,this.tileManager=e.tileManager,this.id=e.id,this.pickId=0,this.color=[e.color[0],e.color[1],e.color[2],e.opacity],this.colorize=[e.color[0],e.color[1],e.color[2],e.opacity],this.colorizing=!1,this.transparent=e.opacity<255,this.layer=e.layer,this.matrix=e.matrix,this.metallic=e.metallic,this.roughness=e.roughness,this.opacity=e.opacity,this.aabb=Er(),this.rendererTextureSet=e.rendererTextureSet,this.rendererGeometry=e.rendererGeometry,this.meshIndex=e.meshIndex}var t=e.prototype;return t.delegatePickedEntity=function(){throw new Error("Method not implemented.")},t.setSceneObject=function(e){this.sceneObjectRenderer=e},t.build=function(e){this.layer.initFlags(this.meshIndex,e,this.transparent)},t.finalize2=function(){this.layer.flushInitFlags&&this.layer.flushInitFlags()},t.setVisible=function(e){this.layer.setMeshVisible(this.meshIndex,e,this.transparent)},t.setMatrix=function(e){var t=di(e,[0,0,0]),i=this.tile;this.tile=i?this.tileManager.updateTileCenter(i,t):this.tileManager.getTile(t);var r=!i||i.id!==this.tile.id,n=this.tile.center;this.layer.setMeshMatrix(this.meshIndex,0!==n[0]||0!==n[1]||0!==n[2]?hi(e,Oi(-n[0],-n[1],-n[2],Ov),Rv):e),r&&this.layer.setMeshViewMatrixIndex(this.meshIndex,this.tile.index)},t.setMetallic=function(e){},t.setRoughness=function(e){},t.setColor=function(e){this.color[0]=e[0],this.color[1]=e[1],this.color[2]=e[2],this.colorizing||this.layer.setMeshColor(this.meshIndex,this.color)},t.setColorize=function(e){e?(this.colorize[0]=e[0],this.colorize[1]=e[1],this.colorize[2]=e[2],this.layer.setMeshColor(this.meshIndex,this.colorize,!1),this.colorizing=!0):(this.layer.setMeshColor(this.meshIndex,this.color,!1),this.colorizing=!1)},t.setOpacity=function(e,t){var i=e<255,r=this.transparent!==i;this.color[3]=e,this.colorize[3]=e,this.transparent=i,this.layer.setMeshColor(this.meshIndex,this.colorizing?this.colorize:this.color),r&&this.layer.setMeshTransparent(this.meshIndex,t,i)},t.setHighlighted=function(e){this.layer.setMeshHighlighted(this.meshIndex,e,this.transparent)},t.setXRayed=function(e){this.layer.setMeshXRayed(this.meshIndex,e,this.transparent)},t.setSelected=function(e){this.layer.setMeshSelected(this.meshIndex,e,this.transparent)},t.setEdges=function(e){this.layer.setMeshEdges(this.meshIndex,e,this.transparent)},t.setClippable=function(e){this.layer.setMeshClippable(this.meshIndex,e)},t.setCollidable=function(e){this.layer.setMeshCollidable(this.meshIndex,e)},t.setPickable=function(e){this.layer.setMeshPickable(this.meshIndex,e,this.transparent)},t.setCulled=function(e){this.layer.setMeshCulled(this.meshIndex,e,this.transparent)},t.canPickTriangle=function(){return!1},t.drawPickTriangles=function(e,t){},t.pickTriangleSurface=function(e){},t.canPickWorldPos=function(){return!0},t.drawPickNormals=function(e){},t.destroy=function(){this.tile&&this.tileManager&&this.tileManager.putTile(this.tile)},e}(),Dv=function(e){this.id=void 0,this.colorTexture=void 0,this.metallicRoughnessTexture=void 0,this.emissiveTexture=void 0,this.occlusionTexture=void 0,this.id=e.id,this.colorTexture=e.colorTexture,this.metallicRoughnessTexture=e.metallicRoughnessTexture,this.emissiveTexture=e.emissiveTexture,this.occlusionTexture=e.occlusionTexture};Ai();var Av="defaultTextureSet",Cv=/*#__PURE__*/d("view"),Bv=/*#__PURE__*/d("webglRenderer"),kv=/*#__PURE__*/d("renderContext"),Lv=/*#__PURE__*/d("position"),Fv=/*#__PURE__*/d("rotation"),Uv=/*#__PURE__*/d("quaternion"),Nv=/*#__PURE__*/d("scale"),Gv=/*#__PURE__*/d("worldMatrix"),Vv=/*#__PURE__*/d("viewMatrix"),Hv=/*#__PURE__*/d("colorTextureEnabled"),Xv=/*#__PURE__*/d("backfaces"),Wv=/*#__PURE__*/d("layers"),Yv=/*#__PURE__*/d("numGeometries"),Kv=/*#__PURE__*/d("numTriangles"),zv=/*#__PURE__*/d("numLines"),qv=/*#__PURE__*/d("numPoints"),Zv=/*#__PURE__*/d("numRendererObjects"),Qv=/*#__PURE__*/d("textureTranscoder"),Jv=/*#__PURE__*/d("aabbDirty"),$v=/*#__PURE__*/d("edgeThreshold"),ep=/*#__PURE__*/d("currentLayers"),tp=/*#__PURE__*/d("aabb"),ip=/*#__PURE__*/d("viewMatrixDirty"),rp=/*#__PURE__*/d("worldMatrixNonIdentity"),np=/*#__PURE__*/d("onCameraViewMatrix"),op=/*#__PURE__*/d("layerId"),sp=/*#__PURE__*/d("attachSceneModel"),ap=/*#__PURE__*/d("attachTexture"),cp=/*#__PURE__*/d("attachGeometry"),lp=/*#__PURE__*/d("attachMesh"),hp=/*#__PURE__*/d("getLayer"),up=/*#__PURE__*/d("attachSceneObject"),dp=/*#__PURE__*/d("createDefaultTextureSetRenderer"),fp=/*#__PURE__*/d("rebuildAABB"),vp=/*#__PURE__*/d("detachSceneModel"),pp=/*#__PURE__*/function(e){function t(t){var i;i=e.call(this,t.view)||this,Object.defineProperty(c(i),vp,{value:_p}),Object.defineProperty(c(i),fp,{value:Tp}),Object.defineProperty(c(i),dp,{value:Ep}),Object.defineProperty(c(i),up,{value:Pp}),Object.defineProperty(c(i),hp,{value:wp}),Object.defineProperty(c(i),lp,{value:bp}),Object.defineProperty(c(i),cp,{value:gp}),Object.defineProperty(c(i),ap,{value:mp}),Object.defineProperty(c(i),sp,{value:yp}),i.qualityRender=void 0,i.sceneModel=void 0,i.rendererGeometries=void 0,i.rendererTextures=void 0,i.rendererTextureSets=void 0,i.rendererMeshes=void 0,i.rendererObjects=void 0,i.rendererObjectsList=void 0,i.rendererViewObjects=void 0,i.viewer=void 0,i.layerList=void 0,i.onBuilt=void 0,Object.defineProperty(c(i),Cv,{writable:!0,value:void 0}),Object.defineProperty(c(i),Bv,{writable:!0,value:void 0}),Object.defineProperty(c(i),kv,{writable:!0,value:void 0}),Object.defineProperty(c(i),Lv,{writable:!0,value:void 0}),Object.defineProperty(c(i),Fv,{writable:!0,value:void 0}),Object.defineProperty(c(i),Uv,{writable:!0,value:void 0}),Object.defineProperty(c(i),Nv,{writable:!0,value:void 0}),Object.defineProperty(c(i),Gv,{writable:!0,value:void 0}),Object.defineProperty(c(i),Vv,{writable:!0,value:void 0}),Object.defineProperty(c(i),Hv,{writable:!0,value:void 0}),Object.defineProperty(c(i),Xv,{writable:!0,value:void 0}),Object.defineProperty(c(i),Wv,{writable:!0,value:void 0}),Object.defineProperty(c(i),Yv,{writable:!0,value:void 0}),Object.defineProperty(c(i),Kv,{writable:!0,value:void 0}),Object.defineProperty(c(i),zv,{writable:!0,value:void 0}),Object.defineProperty(c(i),qv,{writable:!0,value:void 0}),Object.defineProperty(c(i),Zv,{writable:!0,value:void 0}),Object.defineProperty(c(i),Qv,{writable:!0,value:void 0}),Object.defineProperty(c(i),Jv,{writable:!0,value:void 0}),Object.defineProperty(c(i),$v,{writable:!0,value:void 0}),Object.defineProperty(c(i),ep,{writable:!0,value:void 0}),Object.defineProperty(c(i),tp,{writable:!0,value:void 0}),Object.defineProperty(c(i),ip,{writable:!0,value:void 0}),Object.defineProperty(c(i),rp,{writable:!0,value:void 0}),Object.defineProperty(c(i),np,{writable:!0,value:void 0}),Object.defineProperty(c(i),op,{writable:!0,value:void 0}),i.id=t.id,i.sceneModel=t.sceneModel,i.viewer=t.view.viewer,f(c(i),Cv)[Cv]=t.view,f(c(i),Bv)[Bv]=t.webglRenderer,f(c(i),kv)[kv]=t.renderContext,f(c(i),Qv)[Qv]=t.textureTranscoder,f(c(i),tp)[tp]=Rr(),f(c(i),Jv)[Jv]=!1,f(c(i),Wv)[Wv]={},i.layerList=[],f(c(i),ep)[ep]={},i.rendererGeometries={},i.rendererTextures={},i.rendererTextureSets={},i.rendererMeshes={},i.rendererObjects={},i.rendererObjectsList=[],i.rendererViewObjects={},f(c(i),Yv)[Yv]=0,f(c(i),Zv)[Zv]=0,f(c(i),Kv)[Kv]=0,f(c(i),zv)[zv]=0,f(c(i),qv)[qv]=0,f(c(i),$v)[$v]=t.edgeThreshold||10,i.built=!1,f(c(i),Lv)[Lv]=wt(t.position||[0,0,0]),f(c(i),Fv)[Fv]=wt(t.rotation||[0,0,0]),f(c(i),Uv)[Uv]=Pt(t.quaternion||[0,0,0,1]),t.rotation&&Ci(f(c(i),Fv)[Fv],"XYZ",f(c(i),Uv)[Uv]),f(c(i),Nv)[Nv]=wt(t.scale||[1,1,1]),f(c(i),Gv)[Gv]=Zt(),Ei(f(c(i),Lv)[Lv],f(c(i),Uv)[Uv],f(c(i),Nv)[Nv],f(c(i),Gv)[Gv]),(t.matrix||t.position||t.rotation||t.scale||t.quaternion)&&(f(c(i),Vv)[Vv]=Zt(),f(c(i),ip)[ip]=!0,f(c(i),rp)[rp]=!0),i.qualityRender=!1!==t.qualityRender,f(c(i),op)[op]=t.layerId,f(c(i),np)[np]=f(c(i),Cv)[Cv].camera.onViewMatrix.subscribe(function(e,t){f(c(i),ip)[ip]=!0}),f(c(i),dp)[dp](),i.onBuilt=new p(new te.EventDispatcher),f(c(i),sp)[sp](t.sceneModel);for(var r=0,n=i.layerList.length;r<n;r++)i.layerList[r].layerIndex=r;return f(c(i),ep)[ep]={},i.built=!0,f(c(i),Bv)[Bv].setImageDirty(),i.onBuilt.dispatch(c(i),null),i}r(t,e);var n=t.prototype;return n.setVisible=function(e,t){for(var i=0,r=this.rendererObjectsList.length;i<r;i++)this.rendererObjectsList[i].setVisible(e,t);f(this,Bv)[Bv].setImageDirty(e)},n.setXRayed=function(e,t){for(var i=0,r=this.rendererObjectsList.length;i<r;i++)this.rendererObjectsList[i].setXRayed(e,t);f(this,Bv)[Bv].setImageDirty(e)},n.setHighlighted=function(e,t){for(var i=0,r=this.rendererObjectsList.length;i<r;i++)this.rendererObjectsList[i].setHighlighted(e,t);f(this,Bv)[Bv].setImageDirty(e)},n.setSelected=function(e,t){for(var i=0,r=this.rendererObjectsList.length;i<r;i++)this.rendererObjectsList[i].setSelected(e,t);f(this,Bv)[Bv].setImageDirty(e)},n.setEdges=function(e,t){for(var i=0,r=this.rendererObjectsList.length;i<r;i++)this.rendererObjectsList[i].setEdges(e,t);f(this,Bv)[Bv].setImageDirty(e)},n.setCulled=function(e,t){for(var i=0,r=this.rendererObjectsList.length;i<r;i++)this.rendererObjectsList[i].setCulled(e,t);f(this,Bv)[Bv].setImageDirty(e)},n.setClippable=function(e,t){for(var i=0,r=this.rendererObjectsList.length;i<r;i++)this.rendererObjectsList[i].setClippable(e,t);f(this,Bv)[Bv].setImageDirty(e)},n.setCollidable=function(e,t){for(var i=0,r=this.rendererObjectsList.length;i<r;i++)this.rendererObjectsList[i].setCollidable(e,t)},n.setPickable=function(e,t){for(var i=0,r=this.rendererObjectsList.length;i<r;i++)this.rendererObjectsList[i].setPickable(e,t)},n.setColorize=function(e,t){for(var i=0,r=this.rendererObjectsList.length;i<r;i++)this.rendererObjectsList[i].setColorize(e,t)},n.setOpacity=function(e,t){for(var i=0,r=this.rendererObjectsList.length;i<r;i++)this.rendererObjectsList[i].setOpacity(e,t)},n.destroy=function(){if(!this.destroyed){for(var t in f(this,vp)[vp](),f(this,Cv)[Cv].camera.onViewMatrix.unsubscribe(f(this,np)[np]),f(this,ep)[ep])f(this,ep)[ep].hasOwnProperty(t)&&f(this,ep)[ep][t].destroy();for(var i=0,r=this.layerList.length;i<r;i++)this.layerList[i].destroy();for(var n in this.rendererObjects)this.rendererObjects[n].destroy();f(this,ep)[ep]={},f(this,Wv)[Wv]={},this.layerList=[],this.rendererGeometries={},this.rendererTextures={},this.rendererTextureSets={},this.rendererMeshes={},this.rendererViewObjects={},this.onBuilt.clear(),e.prototype.destroy.call(this)}},i(t,[{key:"position",get:function(){return f(this,Lv)[Lv]}},{key:"rotation",get:function(){return f(this,Fv)[Fv]}},{key:"quaternion",get:function(){return f(this,Uv)[Uv]}},{key:"scale",get:function(){return f(this,Nv)[Nv]}},{key:"worldMatrix",get:function(){return f(this,Gv)[Gv]}},{key:"viewMatrix",get:function(){return f(this,Vv)[Vv]?(f(this,ip)[ip]&&(hi(f(this,Cv)[Cv].camera.viewMatrix,f(this,Gv)[Gv],f(this,Vv)[Vv]),f(this,ip)[ip]=!1),f(this,Vv)[Vv]):f(this,Cv)[Cv].camera.viewMatrix}},{key:"colorTextureEnabled",get:function(){return f(this,Hv)[Hv]}},{key:"backfaces",get:function(){return f(this,Xv)[Xv]},set:function(e){e=!!e,f(this,Xv)[Xv]=e,f(this,Bv)[Bv].setImageDirty()}},{key:"matrix",get:function(){return f(this,Gv)[Gv]}},{key:"aabb",get:function(){return f(this,Jv)[Jv]&&f(this,fp)[fp](),f(this,tp)[tp]}},{key:"numTriangles",get:function(){return f(this,Kv)[Kv]}},{key:"numLines",get:function(){return f(this,zv)[zv]}},{key:"numPoints",get:function(){return f(this,qv)[qv]}}]),t}(ae);function yp(e){var t=e.textures,i=e.geometries,r=e.meshes,n=e.objects;if(t)for(var o in t)f(this,ap)[ap](t[o]);if(i)for(var s in i)f(this,cp)[cp](i[s]);if(r)for(var a in r)f(this,lp)[lp](r[a]);if(n)for(var c in n)f(this,up)[up](n[c]);for(var l in f(this,ep)[ep])f(this,ep)[ep][l].build();for(var h=0,u=this.rendererObjectsList.length;h<u;h++)this.rendererObjectsList[h].build();for(var d=0,v=this.rendererObjectsList.length;d<v;d++)this.rendererObjectsList[d].finalize2()}function mp(e){var t=this,i=e.id;if(this.rendererTextures[i])throw new he("RendererTexture already created: "+i);var r=new Kh({gl:f(this,kv)[kv].gl});if(e.preloadColor&&r.setPreloadColor(e.preloadColor),e.image){var n=e.image;n.crossOrigin="Anonymous",r.setImage(n,{minFilter:e.minFilter,magFilter:e.magFilter,wrapS:e.wrapS,wrapT:e.wrapT,wrapR:e.wrapR,flipY:e.flipY,encoding:e.encoding})}else if(e.src){var o=e.src.split(".").pop();switch(o){case"jpeg":case"jpg":case"png":case"gif":var s=new Image;s.onload=function(){r.setImage(s,{minFilter:e.minFilter,magFilter:e.magFilter,wrapS:e.wrapS,wrapT:e.wrapT,wrapR:e.wrapR,flipY:e.flipY,encoding:e.encoding})},s.src=e.src;break;default:f(this,Qv)[Qv]?$i(e.src,function(e){e.byteLength?f(t,Qv)[Qv].transcode([e]).then(function(e){r.setCompressedData(e),f(t,Bv)[Bv].setImageDirty()}):t.error("Can't create texture from 'src': file data is zero length")},function(e){t.error("Can't create texture from 'src': "+e)}):this.error("Can't create texture from 'src' - rendererModel needs to be configured with a TextureTranscoder for this file type ('"+o+"')")}}else e.buffers&&(f(this,Qv)[Qv]?f(this,Qv)[Qv].transcode(e.buffers).then(function(e){r.setCompressedData(e),f(t,Bv)[Bv].setImageDirty()}):this.error("Can't create texture from 'buffers' - rendererModel needs to be configured with a TextureTranscoder for this option"));var a=new wv(e,r);e.rendererTexture=a,this.rendererTextures[i]=a}function gp(e){var t=e.id;if(this.rendererGeometries[t])throw new he("RendererGeometry already created: "+t);var i=new bv;this.rendererGeometries[t]=i,e.rendererGeometry=i,f(this,Yv)[Yv]++}function bp(e){var t=this.rendererGeometries[e.geometry.id];if(!t)throw new he("RendererGeometry not found");var i=this.rendererTextureSets[e.textureSet.id];if(!i)throw new he("rendererTextureSet not found");var r=f(this,hp)[hp](e.textureSet?e.textureSet.id:void 0,e.geometry);if(r){var n;r.hasGeometry(e.geometry.id)||r.createGeometryCompressed(e.geometry),f(this,rp)[rp]&&f(this,Gv),n=e.matrix;var o=e.color?new Uint8Array([Math.floor(255*e.color[0]),Math.floor(255*e.color[1]),Math.floor(255*e.color[2])]):[255,255,255],s=null!=e.opacity?Math.floor(255*e.opacity):255,a=null!=e.metallic?Math.floor(255*e.metallic):0,c=null!=e.roughness?Math.floor(255*e.roughness):255,l=new jv({tileManager:f(this,Bv)[Bv].tileManager,id:e.id,layer:r,color:o,opacity:s,matrix:n,metallic:a,roughness:c,rendererTextureSet:i,rendererGeometry:t,meshIndex:0});l.pickId=f(this,Bv)[Bv].attachPickable(l);var h=new Uint8Array([255&l.pickId,l.pickId>>8&255,l.pickId>>16&255,l.pickId>>24&255]);Rr(l.aabb);var u=r.createMesh({id:e.id,geometryId:e.geometry.id,color:o,opacity:s,metallic:a,roughness:c,matrix:n,pickColor:h});f(this,Yv)[Yv]++,Dr(f(this,tp)[tp],l.aabb),l.layer=r,l.meshIndex=u,this.rendererMeshes[e.id]=l}}function wp(e,t){var i,r=(e=e||Av)+"_"+t.primitive,n=f(this,ep)[ep][r];if(n){if(n.canCreateMesh(t))return n;n.build(),delete f(this,ep)[ep][r]}if(!e||(i=this.rendererTextureSets[e]))return n=new vv({gl:f(this,kv)[kv].gl,view:f(this,Cv)[Cv],rendererModel:this,primitive:t.primitive,textureSet:i,layerIndex:0}),f(this,Wv)[Wv][r]=n,this.layerList.push(n),f(this,ep)[ep][r]=n,n;this.error("TextureSet not found: "+e+" - ensure that you create it first with createTextureSet()")}function Pp(e){var t=e.id;void 0===t?t=or():this.rendererObjects[t]&&(this.error("[createObject] rendererModel already has a ViewerObject with this ID: "+t+" - will assign random ID"),t=or());var i=e.meshes;if(void 0===i)throw new he("[createObject] Param expected: meshes");for(var r=[],n=0,o=i.length;n<o;n++)r.push(this.rendererMeshes[i[n].id]);var s=new Mv({id:t,rendererModel:this,rendererMeshes:r,aabb:e.aabb,layerId:f(this,op)[op]});this.rendererObjectsList.push(s),this.rendererObjects[t]=s,this.rendererViewObjects[t]=s,f(this,Zv)[Zv]++}function Ep(){var e=new wv(null,new Kh({gl:f(this,kv)[kv].gl,preloadColor:[1,1,1,1]})),t=new wv(null,new Kh({gl:f(this,kv)[kv].gl,preloadColor:[0,1,1,1]})),i=new wv(null,new Kh({gl:f(this,kv)[kv].gl,preloadColor:[0,0,0,0]})),r=new wv(null,new Kh({gl:f(this,kv)[kv].gl,preloadColor:[0,0,0,1]})),n=new wv(null,new Kh({gl:f(this,kv)[kv].gl,preloadColor:[1,1,1,1]}));this.rendererTextures.defaultColorTexture=e,this.rendererTextures.defaultMetalRoughTexture=t,this.rendererTextures.defaultNormalsTexture=i,this.rendererTextures.defaultEmissiveTexture=r,this.rendererTextures.defaultOcclusionTexture=n,this.rendererTextureSets[Av]=new Dv({id:Av,colorTexture:e,metallicRoughnessTexture:t,emissiveTexture:r,occlusionTexture:n})}function Tp(){Rr(f(this,tp)[tp]);for(var e=0,t=this.rendererObjectsList.length;e<t;e++){var i=this.rendererObjectsList[e];Dr(f(this,tp)[tp],i.aabb)}f(this,Jv)[Jv]=!1}function _p(){var e=this.sceneModel;if(e){var t=e.textures,i=e.geometries,r=e.meshes,n=e.objects;if(t)for(var o in t){var s=t[o];s.rendererTexture&&(s.rendererTexture=null)}if(i)for(var a in i){var c=i[a];c.rendererGeometry&&(c.rendererGeometry=null)}if(r)for(var l in r){var h=r[l];h.rendererMesh&&(h.rendererMesh=null)}if(n)for(var u in n){var d=n[u];d.rendererObject&&(d.rendererObject=null)}this.sceneModel=null}}var Ip=2e3,xp=/*#__PURE__*/d("gl"),Sp=/*#__PURE__*/d("indexesUsed"),Mp=/*#__PURE__*/d("tiles"),Op=/*#__PURE__*/d("dataTexture"),Rp=/*#__PURE__*/d("camera"),jp=/*#__PURE__*/d("lastFreeIndex"),Dp=/*#__PURE__*/d("putFreeTile"),Ap=/*#__PURE__*/d("findFreeTile"),Cp=/*#__PURE__*/function(){function e(e){Object.defineProperty(this,Ap,{value:kp}),Object.defineProperty(this,Dp,{value:Bp}),Object.defineProperty(this,xp,{writable:!0,value:void 0}),Object.defineProperty(this,Sp,{writable:!0,value:void 0}),Object.defineProperty(this,Mp,{writable:!0,value:void 0}),Object.defineProperty(this,Op,{writable:!0,value:void 0}),Object.defineProperty(this,Rp,{writable:!0,value:void 0}),Object.defineProperty(this,jp,{writable:!0,value:void 0}),f(this,Rp)[Rp]=e.camera,f(this,xp)[xp]=e.gl,f(this,Sp)[Sp]=[],f(this,jp)[jp]=0,f(this,Mp)[Mp]={},f(this,Op)[Op]=function(e,t){var i=Ip;if(0==i)throw"texture height == 0";var r=new Xf(48*i),n=e.createTexture();return n?(e.bindTexture(e.TEXTURE_2D,n),e.texStorage2D(e.TEXTURE_2D,1,e.RGBA16F,12,i),e.texSubImage2D(e.TEXTURE_2D,0,0,0,12,i,e.RGBA,e.HALF_FLOAT,new Uint16Array(r.buffer),0),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(e.TEXTURE_2D,null),new Fh({gl:e,texture:n,textureWidth:12,textureHeight:i})):Yf}(f(this,xp)[xp])}var t=e.prototype;return t.getTile=function(e){var t=Qr(e,wt()),i=t[0]+"-"+t[1]+"-"+t[2],r=f(this,Mp)[Mp][i];return r||(r={id:i,index:f(this,Ap)[Ap](),useCount:0,center:wt(),rtcViewMatrix:Zt()},f(this,Mp)[Mp][r.id]=r),r.useCount++,r},t.putTile=function(e){--e.useCount<=0&&(delete f(this,Mp)[Mp][e.id],f(this,Dp)[Dp](e.index))},t.updateTileCenter=function(e,t){var i=Qr(t,wt()),r=i[0]+"-"+i[1]+"-"+i[2];if(r===e.id)return e;this.putTile(e);var n=f(this,Mp)[Mp][r];return n||(n={id:r,index:f(this,Ap)[Ap](),useCount:0,center:wt(),rtcViewMatrix:Zt()},f(this,Mp)[Mp][n.id]=n),n.useCount++,n},t.refreshMatrices=function(){if(f(this,Op)[Op].texture){for(var e=f(this,xp)[xp],t=f(this,Rp)[Rp].viewMatrix,i=Object.keys(f(this,Mp)[Mp]),r=new Float32Array(16*i.length),n=0,o=i.length;n<o;n++){var s=i[n],a=f(this,Mp)[Mp][s];Zr(t,a.center,a.rtcViewMatrix),r.set(a.rtcViewMatrix,16*a.index)}e.bindTexture(e.TEXTURE_2D,f(this,Op)[Op].texture),e.texSubImage2D(e.TEXTURE_2D,0,0,0,1,1,e.RGBA,e.FLOAT,r),e.bindTexture(e.TEXTURE_2D,null)}},e}();function Bp(e){delete f(this,Sp)[Sp][e],f(this,jp)[jp]=e}function kp(){for(var e=f(this,jp)[jp];;e=(e+1)%Ip)if(!f(this,Sp)[Sp][e])return f(this,Sp)[Sp][e]=!0,e}var Lp=navigator.userAgent.match(/(opera|chrome|safari|firefox|msie|mobile)\/?\s*(\.?\d+(\.\d+)*)/i),Fp=Lp&&"safari"===Lp[1].toLowerCase(),Up=/*#__PURE__*/d("sceneModels"),Np=/*#__PURE__*/d("viewer"),Gp=/*#__PURE__*/d("view"),Vp=/*#__PURE__*/d("renderContext"),Hp=/*#__PURE__*/d("canvasTransparent"),Xp=/*#__PURE__*/d("transparentEnabled"),Wp=/*#__PURE__*/d("edgesEnabled"),Yp=/*#__PURE__*/d("imageDirty"),Kp=/*#__PURE__*/d("saoEnabled"),zp=/*#__PURE__*/d("pbrEnabled"),qp=/*#__PURE__*/d("backgroundColor"),Zp=/*#__PURE__*/d("rendererModels"),Qp=/*#__PURE__*/d("layerList"),Jp=/*#__PURE__*/d("layerListDirty"),$p=/*#__PURE__*/d("stateSortDirty"),ey=/*#__PURE__*/d("pickIDs"),ty=/*#__PURE__*/d("saoDepthRenderBuffer"),iy=/*#__PURE__*/d("extensionHandles"),ry=/*#__PURE__*/d("logarithmicDepthBufferEnabled"),ny=/*#__PURE__*/d("alphaDepthMask"),oy=/*#__PURE__*/d("occlusionTester"),sy=/*#__PURE__*/d("textureTranscoder"),ay=/*#__PURE__*/d("layerRenderers"),cy=/*#__PURE__*/d("viewMatrixDirty"),ly=/*#__PURE__*/d("attachRendererViewObjects"),hy=/*#__PURE__*/d("detachRendererViewObjects"),uy=/*#__PURE__*/d("updateLayerList"),dy=/*#__PURE__*/d("buildLayerList"),fy=/*#__PURE__*/d("draw"),vy=/*#__PURE__*/d("activateExtensions"),py=/*#__PURE__*/d("drawSAOBuffers"),yy=/*#__PURE__*/d("drawDepth"),my=/*#__PURE__*/d("drawColor"),gy=/*#__PURE__*/d("drawLayer"),by=/*#__PURE__*/function(){function e(e){Object.defineProperty(this,gy,{value:Oy}),Object.defineProperty(this,my,{value:My}),Object.defineProperty(this,yy,{value:Sy}),Object.defineProperty(this,py,{value:xy}),Object.defineProperty(this,vy,{value:Iy}),Object.defineProperty(this,fy,{value:_y}),Object.defineProperty(this,dy,{value:Ty}),Object.defineProperty(this,uy,{value:Ey}),Object.defineProperty(this,hy,{value:Py}),Object.defineProperty(this,ly,{value:wy}),this.rendererViewObjects=void 0,this.tileManager=void 0,Object.defineProperty(this,Up,{writable:!0,value:void 0}),Object.defineProperty(this,Np,{writable:!0,value:void 0}),Object.defineProperty(this,Gp,{writable:!0,value:void 0}),Object.defineProperty(this,Vp,{writable:!0,value:void 0}),Object.defineProperty(this,Hp,{writable:!0,value:void 0}),Object.defineProperty(this,Xp,{writable:!0,value:void 0}),Object.defineProperty(this,Wp,{writable:!0,value:void 0}),Object.defineProperty(this,Yp,{writable:!0,value:void 0}),Object.defineProperty(this,Kp,{writable:!0,value:void 0}),Object.defineProperty(this,zp,{writable:!0,value:void 0}),Object.defineProperty(this,qp,{writable:!0,value:void 0}),Object.defineProperty(this,Zp,{writable:!0,value:void 0}),Object.defineProperty(this,Qp,{writable:!0,value:void 0}),Object.defineProperty(this,Jp,{writable:!0,value:void 0}),Object.defineProperty(this,$p,{writable:!0,value:void 0}),Object.defineProperty(this,ey,{writable:!0,value:new Vi({})}),Object.defineProperty(this,ty,{writable:!0,value:void 0}),Object.defineProperty(this,iy,{writable:!0,value:void 0}),Object.defineProperty(this,ry,{writable:!0,value:void 0}),Object.defineProperty(this,ny,{writable:!0,value:void 0}),Object.defineProperty(this,oy,{writable:!0,value:void 0}),Object.defineProperty(this,sy,{writable:!0,value:void 0}),Object.defineProperty(this,ay,{writable:!0,value:void 0}),Object.defineProperty(this,cy,{writable:!0,value:void 0}),this.rendererViewObjects={},this.tileManager=null,f(this,Up)[Up]={},f(this,sy)[sy]=e.textureTranscoder||new Dh({}),f(this,Hp)[Hp]=!1,f(this,ny)[ny]=!1,f(this,iy)[iy]={},f(this,ey)[ey]=new Vi({}),f(this,Qp)[Qp]=[],f(this,Jp)[Jp]=!0,f(this,$p)[$p]=!0,f(this,Yp)[Yp]=!0,f(this,Xp)[Xp]=!0,f(this,Wp)[Wp]=!0,f(this,Kp)[Kp]=!0,f(this,zp)[zp]=!0,f(this,qp)[qp]=wt(),f(this,oy)[oy]=null,f(this,ry)[ry]=!1,f(this,Zp)[Zp]={},f(this,cy)[cy]=!0}var t=e.prototype;return t.getCapabilities=function(e){e.maxViews=1;var t,i=document.createElement("canvas");try{t=i.getContext("webgl2")}catch(e){console.error("Failed to get a WebGL context")}t&&(e.astcSupported=!!Xh(t,"WEBGL_compressed_texture_astc"),e.etc1Supported=!0,e.etc2Supported=!!Xh(t,"WEBGL_compressed_texture_etc"),e.dxtSupported=!!Xh(t,"WEBGL_compressed_texture_s3tc"),e.bptcSupported=!!Xh(t,"EXT_texture_compression_bptc"),e.pvrtcSupported=!(!Xh(t,"WEBGL_compressed_texture_pvrtc")&&!Xh(t,"WEBKIT_WEBGL_compressed_texture_pvrtc")))},t.attachViewer=function(e){f(this,Np)[Np]=e,f(this,sy)[sy].init(f(this,Np)[Np].capabilities)},t.attachView=function(e){var t=this;if(f(this,Vp)[Vp])throw"Only one View allowed with WebGLRenderer (see WebViewerCapabilities.maxViews)";f(this,Gp)[Gp]=e;for(var i=["webgl2"],r=e.canvasElement,n={},o=null,s=0;!o&&s<i.length;s++)try{o=r.getContext(i[s],n)}catch(e){}return o?(o&&o.hint(o.FRAGMENT_SHADER_DERIVATIVE_HINT,o.NICEST),f(this,Vp)[Vp]=new $h(f(this,Np)[Np],f(this,Gp)[Gp],o),this.tileManager=new Cp({camera:e.camera,gl:o}),f(this,ay)[ay]={colorTriangles:new mu(f(this,Vp)[Vp])},e.camera.onViewMatrix.sub(function(){f(t,cy)[cy]=!0}),0):(console.error("Failed to get a WebGL2 context"),0)},t.detachView=function(e){},t.attachSceneModel=function(e){var t=this;if(!f(this,Vp)[Vp])throw new he("Must attach a View before you attach a SceneModel");var i=new pp({id:e.id,sceneModel:e,view:f(this,Gp)[Gp],textureTranscoder:f(this,sy)[sy],webglRenderer:this,renderContext:f(this,Vp)[Vp]});f(this,Zp)[Zp][i.id]=i,f(this,ly)[ly](i),f(this,Jp)[Jp]=!0,i.onDestroyed.one(function(e){var i=f(t,Zp)[Zp][e.id];delete f(t,Zp)[Zp][e.id],f(t,hy)[hy](i),f(t,Jp)[Jp]=!0}),e.rendererModel=i},t.detachSceneModel=function(e){if(f(this,Up)[Up][e.id]){var t=f(this,Zp)[Zp][e.id];delete f(this,Zp)[Zp][e.id],f(this,hy)[hy](t),f(this,Jp)[Jp]=!0,e.rendererModel=null}},t.attachPickable=function(e){return f(this,ey)[ey].addItem(e)},t.detachPickable=function(e){f(this,ey)[ey].removeItem(e)},t.setImageDirty=function(e){f(this,Yp)[Yp]=!0},t.setBackgroundColor=function(e,t){f(this,qp)[qp].set(t),f(this,Yp)[Yp]=!0},t.setEdgesEnabled=function(e,t){f(this,Wp)[Wp]=t,f(this,Yp)[Yp]=!0},t.setPBREnabled=function(e,t){f(this,zp)[zp]=t,f(this,Yp)[Yp]=!0},t.getSAOSupported=function(){return Fp&&Zh.SUPPORTED_EXTENSIONS.OES_standard_derivatives},t.setSAOEnabled=function(e,t){f(this,Kp)[Kp]=t,f(this,Yp)[Yp]=!0},t.setTransparentEnabled=function(e,t){f(this,Xp)[Xp]=t,f(this,Yp)[Yp]=!0},t.clear=function(e){var t=f(this,Vp)[Vp].gl;t.viewport(0,0,t.drawingBufferWidth,t.drawingBufferHeight),f(this,Hp)[Hp]?t.clearColor(1,1,1,1):t.clearColor(f(this,qp)[qp][0],f(this,qp)[qp][1],f(this,qp)[qp][2],1),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)},t.needsRebuild=function(e){for(var t in f(this,ay)[ay])f(this,ay)[ay][t].needRebuild()},t.needsRender=function(e){return f(this,Yp)[Yp]||f(this,Jp)[Jp]||f(this,$p)[$p]},t.render=function(e,t){(t=t||{}).force&&(f(this,Yp)[Yp]=!0),f(this,cy)[cy]&&(this.tileManager.refreshMatrices(),f(this,cy)[cy]=!1),f(this,uy)[uy](),f(this,Yp)[Yp]&&(f(this,fy)[fy]({clear:!0}),f(this,Yp)[Yp]=!1)},t.pickSceneObject=function(e,t){return null},e}();function wy(e){var t=e.rendererViewObjects;for(var i in t)this.rendererViewObjects[i]=t[i]}function Py(e){var t=e.rendererViewObjects;for(var i in t)delete this.rendererViewObjects[i]}function Ey(){f(this,Jp)[Jp]&&(f(this,dy)[dy](),f(this,Jp)[Jp]=!1,f(this,$p)[$p]=!0),f(this,$p)[$p]&&(f(this,$p)[$p]=!1,f(this,Yp)[Yp]=!0)}function Ty(){var e=0;for(var t in f(this,Zp)[Zp])for(var i=f(this,Zp)[Zp][t],r=0,n=i.layerList.length;r<n;r++)f(this,Qp)[Qp][e++]=i.layerList[r];f(this,Qp)[Qp].length=e}function _y(e){f(this,vy)[vy](),f(this,Kp)[Kp]&&f(this,Gp)[Gp].sao.possible&&f(this,py)[py](e),f(this,my)[my](e)}function Iy(){Zh.SUPPORTED_EXTENSIONS.OES_element_index_uint&&(f(this,iy)[iy].OES_element_index_uint=f(this,Vp)[Vp].gl.getExtension("OES_element_index_uint")),f(this,ry)[ry]&&Zh.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(f(this,iy)[iy].EXT_frag_depth=f(this,Vp)[Vp].gl.getExtension("EXT_frag_depth")),Zh.SUPPORTED_EXTENSIONS.WEBGL_depth_texture&&(f(this,iy)[iy].WEBGL_depth_texture=f(this,Vp)[Vp].gl.getExtension("WEBGL_depth_texture"))}function xy(e){}function Sy(e){f(this,Vp)[Vp].reset();var t=f(this,Vp)[Vp].gl;t.viewport(0,0,t.drawingBufferWidth,t.drawingBufferHeight),t.clearColor(0,0,0,0),t.enable(t.DEPTH_TEST),t.frontFace(t.CCW),t.enable(t.CULL_FACE),t.depthMask(!0),!1!==e.clear&&t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)}function My(e){var t=f(this,Gp)[Gp],i=f(this,Vp)[Vp],r=i.gl,n=[],o=[],s=[],a=[],c=[],l=[],h=[],u=[],d=[],v=[],p=[],y=[],m=[],g=[],b=[],w=[];i.reset(),i.withSAO=!1,i.pbrEnabled=f(this,zp)[zp]&&!!t.qualityRender,r.viewport(0,0,r.drawingBufferWidth,r.drawingBufferHeight),f(this,Hp)[Hp]?r.clearColor(0,0,0,0):r.clearColor(f(this,qp)[qp][0],f(this,qp)[qp][1],f(this,qp)[qp][2],1),r.enable(r.DEPTH_TEST),r.frontFace(r.CCW),r.enable(r.CULL_FACE),r.depthMask(!0),r.lineWidth(1),i.lineWidth=1;var P=t.sao.possible;f(this,Kp)[Kp]&&P||(i.occlusionTexture=null),!1!==e.clear&&r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT);for(var E=0,T=0,_=0,I=0,x=0,S=0,M=0,O=0,R=0,j=0,D=0,A=0,C=0,B=0,k=0,L=0,F=0,U=f(this,Qp)[Qp].length;F<U;F++){var N=f(this,Qp)[Qp][F],G=N.meshCounts;G.numCulled!==G.numMeshes&&0!==G.numVisible&&(G.numTransparent<G.numMeshes&&(f(this,Kp)[Kp]&&P&&N.rendererModel.qualityRender?n[E++]=N:f(this,gy)[gy](N,eu.COLOR_OPAQUE,N.rendererModel.qualityRender)),f(this,Xp)[Xp]&&G.numTransparent&&(s[_++]=N),G.numXRayed>0&&t.xrayMaterial.fill&&(t.xrayMaterial.fillAlpha<1?h[M++]=N:c[x++]=N),G.numHighlighted>0&&t.highlightMaterial.fill&&(t.highlightMaterial.fillAlpha<1?p[D++]=N:d[R++]=N),G.numSelected>0&&t.selectedMaterial.fill&&(t.selectedMaterial.fillAlpha<1?b[k++]=N:m[C++]=N),f(this,Wp)[Wp]&&f(this,Gp)[Gp].edgeMaterial.edges&&G.numEdges>0&&(G.numTransparent<G.numMeshes&&(o[T++]=N),G.numTransparent>0&&(a[I++]=N),t.selectedMaterial.edgeAlpha<1?w[L++]=N:g[B++]=N,t.xrayMaterial.edgeAlpha<1?u[O++]=N:l[S++]=N,t.highlightMaterial.edgeAlpha<1?y[A++]=N:v[j++]=N))}E>0&&(i.withSAO=!0);for(var V=0;V<T;V++)f(this,gy)[gy](o[V],eu.EDGES_COLOR_OPAQUE);for(var H=0;H<x;H++)f(this,gy)[gy](c[H],eu.SILHOUETTE_XRAYED);for(var X=0;X<S;X++)f(this,gy)[gy](l[X],eu.EDGES_XRAYED);if(M>0||O>0||_>0||I>0){r.enable(r.CULL_FACE),r.enable(r.BLEND),f(this,Hp)[Hp]?(r.blendEquation(r.FUNC_ADD),r.blendFuncSeparate(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA)):(r.blendEquation(r.FUNC_ADD),r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA)),i.backfaces=!1,f(this,ny)[ny]||r.depthMask(!1);for(var W=0;W<O;W++)f(this,gy)[gy](u[W],eu.EDGES_XRAYED);for(var Y=0;Y<M;Y++)f(this,gy)[gy](h[Y],eu.SILHOUETTE_XRAYED);(_>0||I>0)&&r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA);for(var K=0;K<I;K++)f(this,gy)[gy](a[K],eu.EDGES_COLOR_TRANSPARENT);for(var z=0;z<_;z++)f(this,gy)[gy](s[z],eu.COLOR_TRANSPARENT);r.disable(r.BLEND),f(this,ny)[ny]||r.depthMask(!0)}if(R>0||j>0){i.lastProgramId=-1,r.clear(r.DEPTH_BUFFER_BIT);for(var q=0;q<j;q++)f(this,gy)[gy](v[q],eu.EDGES_HIGHLIGHTED);for(var Z=0;Z<R;Z++)f(this,gy)[gy](d[Z],eu.SILHOUETTE_HIGHLIGHTED)}if(D>0||A>0||R>0){i.lastProgramId=-1,r.clear(r.DEPTH_BUFFER_BIT),r.enable(r.CULL_FACE),r.enable(r.BLEND),f(this,Hp)[Hp]?(r.blendEquation(r.FUNC_ADD),r.blendFuncSeparate(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA)):r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA);for(var Q=0;Q<A;Q++)f(this,gy)[gy](y[Q],eu.EDGES_HIGHLIGHTED);for(var J=0;J<D;J++)f(this,gy)[gy](p[J],eu.SILHOUETTE_HIGHLIGHTED);r.disable(r.BLEND)}if(C>0||B>0){i.lastProgramId=-1,r.clear(r.DEPTH_BUFFER_BIT);for(var $=0;$<B;$++)f(this,gy)[gy](g[$],eu.EDGES_SELECTED);for(var ee=0;ee<C;ee++)f(this,gy)[gy](m[ee],eu.SILHOUETTE_SELECTED)}if(k>0||L>0){i.lastProgramId=-1,r.clear(r.DEPTH_BUFFER_BIT),r.enable(r.CULL_FACE),r.enable(r.BLEND),f(this,Hp)[Hp]?(r.blendEquation(r.FUNC_ADD),r.blendFuncSeparate(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA)):r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA);for(var te=0;te<L;te++)f(this,gy)[gy](w[te],eu.EDGES_SELECTED);for(var ie=0;ie<k;ie++)f(this,gy)[gy](b[ie],eu.SILHOUETTE_SELECTED);r.disable(r.BLEND)}for(var re=Zh.MAX_TEXTURE_UNITS,ne=0;ne<re;ne++)r.activeTexture(r.TEXTURE0+ne);r.bindTexture(r.TEXTURE_CUBE_MAP,null),r.bindTexture(r.TEXTURE_2D,null);for(var oe=Zh.MAX_VERTEX_ATTRIBS,se=0;se<oe;se++)r.disableVertexAttribArray(se)}function Oy(e,t,i){switch(void 0===i&&(i=!0),e.renderState.primitive){case qe:case Qe:case Ze:switch(t){case eu.COLOR_OPAQUE:if(e.meshCounts.numTransparent===e.meshCounts.numMeshes||e.meshCounts.numXRayed===e.meshCounts.numMeshes)return;i||f(this,ay)[ay].colorTriangles.draw(e);break;case eu.COLOR_TRANSPARENT:if(0===e.meshCounts.numTransparent)return;i||f(this,ay)[ay].colorTriangles.draw(e)}}}var Ry={__proto__:null,WebGLRenderer:by},jy=Pt(),Dy=Pt(),Ay=wt(),Cy=wt(),By=wt(),ky=Pt(),Ly=Pt(),Fy=Pt(),Uy=/*#__PURE__*/d("unproject"),Ny=/*#__PURE__*/function(){function e(e){Object.defineProperty(this,Uy,{value:Gy}),this.view=void 0,this.view=e.view}var t=e.prototype;return t.dollyToCanvasPos=function(e,t,i){var r=!1,n=this.view.camera;if(e&&(r=Ut(Mt(e,n.eye,Ay))<i),n.projectionType===et){n.orthoProjection.scale=n.orthoProjection.scale-i;var o=_t(Yt(Mt(f(this,Uy)[Uy](t,ky),n.eye,Fy)),-i,[]);if(n.eye=[n.eye[0]-o[0],n.eye[1]-o[1],n.eye[2]-o[2]],n.look=[n.look[0]-o[0],n.look[1]-o[1],n.look[2]-o[2]],e){var s=Ut(Mt(e,n.eye,Ay)),a=_t(Yt(Mt(n.look,n.eye,Cy)),s);n.look=[n.eye[0]+a[0],n.eye[1]+a[1],n.eye[2]+a[2]]}}else if(n.projectionType===tt){var c=f(this,Uy)[Uy](t,ky);n.orthoProjection.scale=n.orthoProjection.scale-i,n.orthoProjection.clean();var l=xt(Mt(f(this,Uy)[Uy](t,Ly),c,Fy),_t(Yt(Mt(n.look,n.eye,Ay)),-i,Cy),By);n.eye=[n.eye[0]-l[0],n.eye[1]-l[1],n.eye[2]-l[2]],n.look=[n.look[0]-l[0],n.look[1]-l[1],n.look[2]-l[2]]}return r},t.destroy=function(){},e}();function Gy(e,t){var i=this.view.camera,r=i.project.transposedProjMatrix,n=r.subarray(8,12),o=r.subarray(12),s=[0,0,-1,1],a=Dt(s,n)/Dt(s,o);return i.project.unproject(e,a,jy,Dy,t),t}var Vy=wt(),Hy=wt(),Xy=wt(),Wy=Pt(),Yy=Pt(),Ky=Pt(),zy=/*#__PURE__*/d("view"),qy=/*#__PURE__*/d("configs"),Zy=/*#__PURE__*/d("pivotWorldPos"),Qy=/*#__PURE__*/d("cameraOffset"),Jy=/*#__PURE__*/d("azimuth"),$y=/*#__PURE__*/d("polar"),em=/*#__PURE__*/d("radius"),tm=/*#__PURE__*/d("pivotPosSet"),im=/*#__PURE__*/d("pivoting"),rm=/*#__PURE__*/d("shown"),nm=/*#__PURE__*/d("pivotViewPos"),om=/*#__PURE__*/d("pivotProjPos"),sm=/*#__PURE__*/d("pivotCanvasPos"),am=/*#__PURE__*/d("cameraDirty"),cm=/*#__PURE__*/d("onViewMatrix"),lm=/*#__PURE__*/d("onProjMatrix"),hm=/*#__PURE__*/d("onTick"),um=/*#__PURE__*/d("hideTimeout"),dm=/*#__PURE__*/d("pivotElement"),fm=/*#__PURE__*/d("cameraLookingDownwards"),vm=/*#__PURE__*/function(){function e(e,t){var i=this;Object.defineProperty(this,fm,{value:pm}),Object.defineProperty(this,zy,{writable:!0,value:void 0}),Object.defineProperty(this,qy,{writable:!0,value:void 0}),Object.defineProperty(this,Zy,{writable:!0,value:void 0}),Object.defineProperty(this,Qy,{writable:!0,value:void 0}),Object.defineProperty(this,Jy,{writable:!0,value:void 0}),Object.defineProperty(this,$y,{writable:!0,value:void 0}),Object.defineProperty(this,em,{writable:!0,value:void 0}),Object.defineProperty(this,tm,{writable:!0,value:void 0}),Object.defineProperty(this,im,{writable:!0,value:void 0}),Object.defineProperty(this,rm,{writable:!0,value:void 0}),Object.defineProperty(this,nm,{writable:!0,value:void 0}),Object.defineProperty(this,om,{writable:!0,value:void 0}),Object.defineProperty(this,sm,{writable:!0,value:void 0}),Object.defineProperty(this,am,{writable:!0,value:void 0}),Object.defineProperty(this,cm,{writable:!0,value:void 0}),Object.defineProperty(this,lm,{writable:!0,value:void 0}),Object.defineProperty(this,hm,{writable:!0,value:void 0}),Object.defineProperty(this,um,{writable:!0,value:void 0}),Object.defineProperty(this,dm,{writable:!0,value:void 0}),f(this,zy)[zy]=e.view,f(this,qy)[qy]=t,f(this,Zy)[Zy]=wt(),f(this,Qy)[Qy]=wt(),f(this,Jy)[Jy]=0,f(this,$y)[$y]=0,f(this,em)[em]=0,f(this,tm)[tm]=!1,f(this,im)[im]=!1,f(this,rm)[rm]=!1,f(this,nm)[nm]=Pt(),f(this,om)[om]=Pt(),f(this,nm)[nm]=bt(),f(this,am)[am]=!0,f(this,cm)[cm]=f(this,zy)[zy].camera.onViewMatrix.subscribe(function(){f(i,am)[am]=!0}),f(this,lm)[lm]=f(this,zy)[zy].camera.onProjMatrix.subscribe(function(){f(i,am)[am]=!0}),f(this,hm)[hm]=f(this,zy)[zy].viewer.onTick.subscribe(function(){i.updatePivotElement()})}var t=e.prototype;return t.updatePivotElement=function(){var e=f(this,zy)[zy].camera,t=f(this,zy)[zy].canvasElement;if(f(this,im)[im]&&f(this,am)[am]){di(e.viewMatrix,this.getPivotPos(),f(this,nm)[nm]),f(this,nm)[nm][3]=1,fi(e.projMatrix,f(this,nm)[nm],f(this,om)[om]);var i=f(this,zy)[zy].boundary,r=i[2],n=i[3];f(this,nm)[nm][0]=Math.floor((1+f(this,om)[om][0]/f(this,om)[om][3])*r/2),f(this,nm)[nm][1]=Math.floor((1-f(this,om)[om][1]/f(this,om)[om][3])*n/2);var o=t.getBoundingClientRect();f(this,dm)[dm]&&(f(this,dm)[dm].style.left=Math.floor(o.left+f(this,nm)[nm][0])-f(this,dm)[dm].clientWidth/2+window.scrollX+"px",f(this,dm)[dm].style.top=Math.floor(o.top+f(this,nm)[nm][1])-f(this,dm)[dm].clientHeight/2+window.scrollY+"px"),f(this,am)[am]=!1}},t.setPivotElement=function(e){f(this,dm)[dm]=e},t.startPivot=function(){if(f(this,fm)[fm]())return f(this,im)[im]=!1,!1;var e=f(this,zy)[zy].camera,t=si(e.eye,e.look,e.worldUp);di(t,this.getPivotPos(),f(this,Qy)[Qy]);var i=this.getPivotPos();f(this,Qy)[Qy][2]+=Gt(e.eye,i);var r=pi(t=ai(t),f(this,Qy)[Qy]),n=wt();if(Mt(e.eye,i,n),xt(n,r),e.zUp){var o=n[1];n[1]=n[2],n[2]=o}f(this,em)[em]=Ut(n),f(this,$y)[$y]=Math.acos(n[1]/f(this,em)[em]),f(this,Jy)[Jy]=Math.atan2(n[0],n[2]),f(this,im)[im]=!0},t.getPivoting=function(){return f(this,im)[im]},t.setPivotPos=function(e){f(this,Zy)[Zy].set(e),f(this,tm)[tm]=!0},t.setCanvasPivotPos=function(e){var t=f(this,zy)[zy].camera,i=Math.abs(Gt(Or(f(this,zy)[zy].aabb),t.eye)),r=t.project.transposedProjMatrix,n=r.subarray(8,12),o=r.subarray(12),s=[0,0,-1,1],a=Dt(s,n)/Dt(s,o),c=Wy;t.project.unproject(e,a,Yy,Ky,c);var l=Yt(Mt(c,t.eye,Vy)),h=xt(t.eye,_t(l,i,Hy),Xy);this.setPivotPos(h)},t.getPivotPos=function(){return f(this,tm)[tm]?f(this,Zy)[Zy]:f(this,zy)[zy].camera.look},t.continuePivot=function(e,t){if(f(this,im)[im]&&(0!==e||0!==t)){var i=f(this,zy)[zy].camera,r=-e,n=-t;1===i.worldUp[2]&&(r=-r),f(this,Jy)[Jy]+=.01*-r,f(this,$y)[$y]+=.01*n,f(this,$y)[$y]=ct(f(this,$y)[$y],.001,Math.PI-.001);var o=[f(this,em)[em]*Math.sin(f(this,$y)[$y])*Math.sin(f(this,Jy)[Jy]),f(this,em)[em]*Math.cos(f(this,$y)[$y]),f(this,em)[em]*Math.sin(f(this,$y)[$y])*Math.cos(f(this,Jy)[Jy])];if(1===i.worldUp[2]){var s=o[1];o[1]=o[2],o[2]=s}var a=Ut(Mt(i.look,i.eye,wt())),c=this.getPivotPos();xt(o,c);var l=si(o,c,i.worldUp),h=pi(l=ai(l),f(this,Qy)[Qy]);l[12]-=h[0],l[13]-=h[1],l[14]-=h[2];var u=[l[8],l[9],l[10]];i.eye=[l[12],l[13],l[14]],Mt(i.eye,_t(u,a),i.look),i.up=[l[4],l[5],l[6]],this.showPivot()}},t.showPivot=function(){var e=this;f(this,rm)[rm]||(null!==f(this,um)[um]&&(window.clearTimeout(f(this,um)[um]),f(this,um)[um]=null),f(this,dm)[dm]&&(this.updatePivotElement(),f(this,dm)[dm].style.visibility="visible",f(this,rm)[rm]=!0,f(this,um)[um]=window.setTimeout(function(){e.hidePivot()},1e3)))},t.hidePivot=function(){f(this,rm)[rm]&&(null!==f(this,um)[um]&&(window.clearTimeout(f(this,um)[um]),f(this,um)[um]=null),f(this,dm)[dm]&&(f(this,dm)[dm].style.visibility="hidden"),f(this,rm)[rm]=!1)},t.endPivot=function(){f(this,im)[im]=!1},t.destroy=function(){f(this,zy)[zy].camera.onViewMatrix.unsubscribe(f(this,cm)[cm]),f(this,zy)[zy].camera.onProjMatrix.unsubscribe(f(this,lm)[lm]),f(this,zy)[zy].viewer.onTick.unsubscribe(f(this,hm)[hm])},e}();function pm(){var e=f(this,zy)[zy].camera;return Lt(At(Yt(Mt(e.look,e.eye,Vy)),e.worldUp,Hy))<=1e-4}var ym=/*#__PURE__*/d("view"),mm=/*#__PURE__*/d("cameraControl"),gm=/*#__PURE__*/d("config"),bm=/*#__PURE__*/d("lastPickedobjectId"),wm=/*#__PURE__*/d("needFireEvents"),Pm=/*#__PURE__*/function(){function e(e,t){this.schedulePickEntity=void 0,this.schedulePickSurface=void 0,this.pickCursorPos=void 0,this.picked=void 0,this.pickedSurface=void 0,this.pickResult=void 0,Object.defineProperty(this,ym,{writable:!0,value:void 0}),Object.defineProperty(this,mm,{writable:!0,value:void 0}),Object.defineProperty(this,gm,{writable:!0,value:void 0}),Object.defineProperty(this,bm,{writable:!0,value:void 0}),Object.defineProperty(this,wm,{writable:!0,value:void 0}),f(this,ym)[ym]=e.view,f(this,mm)[mm]=e,f(this,ym)[ym].canvasElement.oncontextmenu=function(e){e.preventDefault()},f(this,gm)[gm]=t,this.schedulePickEntity=!1,this.schedulePickSurface=!1,this.pickCursorPos=bt(),this.picked=!1,this.pickedSurface=!1,this.pickResult=null,f(this,bm)[bm]=null,f(this,wm)[wm]=!1}var t=e.prototype;return t.update=function(){if(f(this,gm)[gm].pointerEnabled&&(this.schedulePickEntity||this.schedulePickSurface)){this.picked=!1,this.pickedSurface=!1,f(this,wm)[wm]=!1;var e=f(this,mm)[mm].onHoverSurface.count>0;if(this.schedulePickSurface&&this.pickResult&&this.pickResult.worldPos){var t=this.pickResult.canvasPos;if(t[0]===this.pickCursorPos[0]&&t[1]===this.pickCursorPos[1])return this.picked=!0,this.pickedSurface=!0,f(this,wm)[wm]=e,this.schedulePickEntity=!1,void(this.schedulePickSurface=!1)}if(this.schedulePickEntity&&this.pickResult){var i=this.pickResult.canvasPos;if(i[0]===this.pickCursorPos[0]&&i[1]===this.pickCursorPos[1])return this.picked=!0,this.pickedSurface=!1,f(this,wm)[wm]=!1,this.schedulePickEntity=!1,void(this.schedulePickSurface=!1)}this.schedulePickEntity=!1,this.schedulePickSurface=!1}},t.fireEvents=function(){if(f(this,wm)[wm]){if(this.picked&&this.pickResult&&this.pickResult.entity){var e=this.pickResult.entity.id;f(this,bm)[bm]!==e&&(void 0!==f(this,bm)[bm]&&null!==f(this,bm)[bm]&&f(this,mm)[mm].onHoverOut.dispatch(f(this,mm)[mm],{entity:f(this,ym)[ym].objects[f(this,bm)[bm]]}),f(this,mm)[mm].onHoverOut.dispatch(f(this,mm)[mm],this.pickResult),f(this,bm)[bm]=e),f(this,mm)[mm].onHover.dispatch(f(this,mm)[mm],this.pickResult),this.pickResult.worldPos&&(this.pickedSurface=!0,f(this,mm)[mm].onHoverSurface.dispatch(f(this,mm)[mm],this.pickResult))}else void 0!==f(this,bm)[bm]&&null!==f(this,bm)[bm]&&(f(this,mm)[mm].onHoverOut.dispatch(f(this,mm)[mm],{entity:f(this,ym)[ym].objects[f(this,bm)[bm]]}),f(this,bm)[bm]=void 0),f(this,mm)[mm].onHoverOff.dispatch(f(this,mm)[mm],{canvasPos:this.pickCursorPos});this.pickResult=null,f(this,wm)[wm]=!1}},t.destroy=function(){},e}(),Em=bt(),Tm=/*#__PURE__*/d("view"),_m=/*#__PURE__*/d("documentKeyDownHandler"),Im=/*#__PURE__*/d("documentKeyUpHandler"),xm=/*#__PURE__*/d("mouseDownHandler"),Sm=/*#__PURE__*/d("documentMouseMoveHandler"),Mm=/*#__PURE__*/d("canvasMouseMoveHandler"),Om=/*#__PURE__*/d("documentMouseUpHandler"),Rm=/*#__PURE__*/d("mouseUpHandler"),jm=/*#__PURE__*/d("mouseEnterHandler"),Dm=/*#__PURE__*/d("mouseWheelHandler"),Am=/*#__PURE__*/function(){function e(e,t,i,r,n){var o=this;Object.defineProperty(this,Tm,{writable:!0,value:void 0}),Object.defineProperty(this,_m,{writable:!0,value:void 0}),Object.defineProperty(this,Im,{writable:!0,value:void 0}),Object.defineProperty(this,xm,{writable:!0,value:void 0}),Object.defineProperty(this,Sm,{writable:!0,value:void 0}),Object.defineProperty(this,Mm,{writable:!0,value:void 0}),Object.defineProperty(this,Om,{writable:!0,value:void 0}),Object.defineProperty(this,Rm,{writable:!0,value:void 0}),Object.defineProperty(this,jm,{writable:!0,value:void 0}),Object.defineProperty(this,Dm,{writable:!0,value:void 0}),f(this,Tm)[Tm]=e.view;var s,a,c,l=t.pickController,h=0,u=0,d=0,v=0,p=!1,y=new Float64Array(3),m=!0,g=f(this,Tm)[Tm].canvasElement,b=[];function w(e){void 0===e&&(e=!0),g.style.cursor="move",h=r.pointerViewPos[0],u=r.pointerViewPos[1],d=r.pointerViewPos[0],v=r.pointerViewPos[1],e&&(l.pickCursorPos=r.pointerViewPos,l.schedulePickSurface=!0,l.update(),l.picked&&l.pickedSurface&&l.pickResult&&l.pickResult.worldPos?(p=!0,y.set(l.pickResult.worldPos)):p=!1)}document.addEventListener("keydown",f(this,_m)[_m]=function(e){i.active&&i.pointerEnabled&&i.keyboardEnabled&&(b[e.keyCode]=!0)}),document.addEventListener("keyup",f(this,Im)[Im]=function(e){i.active&&i.pointerEnabled&&i.keyboardEnabled&&(b[e.keyCode]=!1)}),g.addEventListener("mousedown",f(this,xm)[xm]=function(e){if(i.active&&i.pointerEnabled)switch(e.which){case 1:b[16]||i.planView?(s=!0,w()):(s=!0,w(!1));break;case 2:a=!0,w();break;case 3:c=!0,i.panRightClick&&w()}}),document.addEventListener("mousemove",f(this,Sm)[Sm]=function(){if(i.active&&i.pointerEnabled&&(s||a||c)){var e=f(o,Tm)[Tm].boundary,t=e[0],l=e[1],d=r.pointerViewPos[0],v=r.pointerViewPos[1];if(b[16]||i.planView||!i.panRightClick&&a||i.panRightClick&&c){var m=d-h,g=v-u,w=f(o,Tm)[Tm].camera;if(w.projectionType===et){var P=Math.abs(p?Ut(Mt(y,f(o,Tm)[Tm].camera.eye,[])):f(o,Tm)[Tm].camera.eyeLookDist)*Math.tan(w.perspectiveProjection.fov/2*Math.PI/180);n.panDeltaX+=1.5*m*P/l,n.panDeltaY+=1.5*g*P/l}else n.panDeltaX+=.5*w.orthoProjection.scale*(m/l),n.panDeltaY+=.5*w.orthoProjection.scale*(g/l)}else!s||a||c||i.planView||(i.firstPerson?(n.rotateDeltaY-=(d-h)/t*i.dragRotationRate/2,n.rotateDeltaX+=(v-u)/l*(i.dragRotationRate/4)):(n.rotateDeltaY-=(d-h)/t*(1.5*i.dragRotationRate),n.rotateDeltaX+=(v-u)/l*(1.5*i.dragRotationRate)));h=d,u=v}}),g.addEventListener("mousemove",f(this,Mm)[Mm]=function(e){i.active&&i.pointerEnabled&&r.mouseover&&(m=!0)}),document.addEventListener("mouseup",f(this,Om)[Om]=function(e){if(i.active&&i.pointerEnabled)switch(e.which){case 1:case 2:case 3:s=!1,a=!1,c=!1}}),g.addEventListener("mouseup",f(this,Rm)[Rm]=function(e){if(i.active&&i.pointerEnabled){if(3===e.which){Cm(e,Em);var r=Em[1];Math.abs(Em[0]-d)<3&&Math.abs(r-v)<3&&t.cameraControl.events.fire("rightClick",{pagePos:[Math.round(e.pageX),Math.round(e.pageY)],canvasPos:Em,event:e},!0)}g.style.removeProperty("cursor")}}),g.addEventListener("mouseenter",f(this,jm)[jm]=function(){});var P=1/60,E=null;g.addEventListener("wheel",f(this,Dm)[Dm]=function(e){if(i.active&&i.pointerEnabled){var t=performance.now()/1e3,o=null!==E?t-E:0;E=t,o>.05&&(o=.05),o<P&&(o=P);var s=Math.max(-1,Math.min(1,40*-e.deltaY));if(0!==s){var a=s/Math.abs(s);n.dollyDelta+=-a*o*i.mouseWheelDollyRate,m&&(r.followPointerDirty=!0,m=!1),e.preventDefault()}}})}var t=e.prototype;return t.reset=function(){},t.destroy=function(){var e=f(this,Tm)[Tm].canvasElement;document.removeEventListener("keydown",f(this,_m)[_m]),document.removeEventListener("keyup",f(this,Im)[Im]),e.removeEventListener("mousedown",f(this,xm)[xm]),document.removeEventListener("mousemove",f(this,Sm)[Sm]),e.removeEventListener("mousemove",f(this,Mm)[Mm]),document.removeEventListener("mouseup",f(this,Om)[Om]),e.removeEventListener("mouseup",f(this,Rm)[Rm]),e.removeEventListener("mouseenter",f(this,jm)[jm]),e.removeEventListener("wheel",f(this,Dm)[Dm])},e}(),Cm=function(e,t){if(e){for(var i=e.target,r=0,n=0;i.offsetParent;)r+=i.offsetLeft,n+=i.offsetTop,i=i.offsetParent;t[0]=e.pageX-r,t[1]=e.pageY-n}else e=window.event,t[0]=e.x,t[1]=e.y;return t},Bm=wt(),km=wt(),Lm=wt(),Fm=wt(),Um=wt(),Nm={eye:new Float64Array(3),look:new Float64Array(3),up:new Float64Array(3),orthoScale:1},Gm=/*#__PURE__*/d("documentKeyDownHandler"),Vm=/*#__PURE__*/function(){function e(e,t,i,r,n){Object.defineProperty(this,Gm,{writable:!0,value:void 0});var o=e.view,s=e.camera,a=t.cameraControl;document.addEventListener("keydown",f(this,Gm)[Gm]=function(e){if(i.active&&i.pointerEnabled&&i.keyboardEnabled&&r.mouseover){var n=a._isKeyDownForAction(a.AXIS_VIEW_RIGHT),c=a._isKeyDownForAction(a.AXIS_VIEW_BACK),l=a._isKeyDownForAction(a.AXIS_VIEW_LEFT),h=a._isKeyDownForAction(a.AXIS_VIEW_FRONT),u=a._isKeyDownForAction(a.AXIS_VIEW_TOP),d=a._isKeyDownForAction(a.AXIS_VIEW_BOTTOM);if(n||c||l||h||u||d){var f=o.aabb,v=Sr(f);Or(f,Bm);var p=Math.abs(v/Math.tan(t.cameraFlight.fitFOV*at));Nm.orthoScale=1.1*v,n?(Nm.eye.set(xt(Bm,_t(s.worldRight,p,km),Um)),Nm.look.set(Bm),Nm.up.set(s.worldUp)):c?(Nm.eye.set(xt(Bm,_t(s.worldForward,p,km),Um)),Nm.look.set(Bm),Nm.up.set(s.worldUp)):l?(Nm.eye.set(xt(Bm,_t(s.worldRight,-p,km),Um)),Nm.look.set(Bm),Nm.up.set(s.worldUp)):h?(Nm.eye.set(xt(Bm,_t(s.worldForward,-p,km),Um)),Nm.look.set(Bm),Nm.up.set(s.worldUp)):u?(Nm.eye.set(xt(Bm,_t(s.worldUp,p,km),Um)),Nm.look.set(Bm),Nm.up.set(Yt(_t(s.worldForward,1,Lm),Fm))):d&&(Nm.eye.set(xt(Bm,_t(s.worldUp,-p,km),Um)),Nm.look.set(Bm),Nm.up.set(Yt(_t(s.worldForward,-1,Lm)))),!i.firstPerson&&i.followPointer&&t.pivotController.setPivotPos(Bm),t.cameraFlight.duration>0?t.cameraFlight.flyTo(Nm,function(){t.pivotController.getPivoting()&&i.followPointer&&t.pivotController.showPivot()}):(t.cameraFlight.jumpTo(Nm),t.pivotController.getPivoting()&&i.followPointer&&t.pivotController.showPivot())}}})}var t=e.prototype;return t.reset=function(){},t.destroy=function(){document.removeEventListener("keydown",f(this,Gm)[Gm])},e}(),Hm=/*#__PURE__*/d("view"),Xm=/*#__PURE__*/d("clicks"),Wm=/*#__PURE__*/d("timeout"),Ym=/*#__PURE__*/d("lastPickedobjectId"),Km=/*#__PURE__*/d("canvasMouseMoveHandler"),zm=/*#__PURE__*/d("canvasMouseDownHandler"),qm=/*#__PURE__*/d("documentMouseUpHandler"),Zm=/*#__PURE__*/d("canvasMouseUpHandler"),Qm=/*#__PURE__*/function(){function e(e,t,i,r,n){var o=this;Object.defineProperty(this,Hm,{writable:!0,value:void 0}),Object.defineProperty(this,Xm,{writable:!0,value:void 0}),Object.defineProperty(this,Wm,{writable:!0,value:void 0}),Object.defineProperty(this,Ym,{writable:!0,value:void 0}),Object.defineProperty(this,Km,{writable:!0,value:void 0}),Object.defineProperty(this,zm,{writable:!0,value:void 0}),Object.defineProperty(this,qm,{writable:!0,value:void 0}),Object.defineProperty(this,Zm,{writable:!0,value:void 0}),f(this,Hm)[Hm]=e.view;var s=t.pickController,a=t.pivotController,c=t.cameraControl;f(this,Xm)[Xm]=0,f(this,Wm)[Wm]=null,f(this,Ym)[Ym]=null;var l=!1,h=!1,u=f(this,Hm)[Hm].canvasElement,d=function(e){var i;e&&e.worldPos&&(i=e.worldPos);var r=e&&e.viewObject?e.viewObject.aabb:f(o,Hm)[Hm].aabb;if(i){var n=f(o,Hm)[Hm].camera;Mt(n.eye,n.look,[]),t.cameraFlight.flyTo({aabb:r})}else t.cameraFlight.flyTo({aabb:r})};u.addEventListener("mousemove",f(this,Km)[Km]=function(e){if(i.active&&i.pointerEnabled&&!l&&!h){var t=c.events.hasSubs("hover"),n=c.events.hasSubs("hoverOut"),a=c.events.hasSubs("hoverOff"),u=c.events.hasSubs("hoverSurface");if(t||n||a||u)if(s.pickCursorPos=r.pointerViewPos,s.schedulePickEntity=!0,s.schedulePickSurface=u,s.update(),s.pickResult){var d=s.pickResult.entity.id;f(o,Ym)[Ym]!==d&&(void 0!==f(o,Ym)[Ym]&&c.events.fire("hoverOut",{entity:f(o,Hm)[Hm].objects[f(o,Ym)[Ym]]},!0),c.events.fire("hoverEnter",s.pickResult,!0),f(o,Ym)[Ym]=d),c.events.fire("hover",s.pickResult,!0),s.pickResult.worldPos&&c.events.fire("hoverSurface",s.pickResult,!0)}else void 0!==f(o,Ym)[Ym]&&(c.events.fire("hoverOut",{entity:f(o,Hm)[Hm].objects[f(o,Ym)[Ym]]},!0),f(o,Ym)[Ym]=void 0),c.events.fire("hoverOff",{canvasPos:s.pickCursorPos},!0)}}),u.addEventListener("mousedown",f(this,zm)[zm]=function(e){if(1===e.which&&(l=!0),3===e.which&&(h=!0),1===e.which&&i.active&&i.pointerEnabled&&(r.mouseDownClientX=e.clientX,r.mouseDownClientY=e.clientY,r.mouseDownCursorX=r.pointerViewPos[0],r.mouseDownCursorY=r.pointerViewPos[1],!i.firstPerson&&i.followPointer&&(s.pickCursorPos=r.pointerViewPos,s.schedulePickSurface=!0,s.update(),1===e.which))){var t=s.pickResult;t&&t.worldPos?(a.setPivotPos(t.worldPos),a.startPivot()):(i.smartPivot?a.setViewPivotPos(r.pointerViewPos):a.setPivotPos(f(o,Hm)[Hm].camera.look),a.startPivot())}}),document.addEventListener("mouseup",f(this,qm)[qm]=function(e){1===e.which&&(l=!1),3===e.which&&(h=!1)}),u.addEventListener("mouseup",f(this,Zm)[Zm]=function(e){if(i.active&&i.pointerEnabled&&1===e.which&&(a.hidePivot(),!(Math.abs(e.clientX-r.mouseDownClientX)>3||Math.abs(e.clientY-r.mouseDownClientY)>3))){var n=c.events.hasSubs("picked"),l=c.events.hasSubs("pickedNothing"),h=c.events.hasSubs("pickedSurface"),u=c.events.hasSubs("doublePicked"),v=c.events.hasSubs("doublePickedSurface"),p=c.events.hasSubs("doublePickedNothing");if(!(i.doublePickFlyTo||u||v||p))return(n||l||h)&&(s.pickCursorPos=r.pointerViewPos,s.schedulePickEntity=!0,s.schedulePickSurface=h,s.update(),s.pickResult?(c.events.fire("picked",s.pickResult,!0),s.pickedSurface&&c.events.fire("pickedSurface",s.pickResult,!0)):c.events.fire("pickedNothing",{canvasPos:r.pointerViewPos},!0)),void(f(o,Xm)[Xm]=0);if(f(o,Xm)[Xm]++,1===f(o,Xm)[Xm])f(o,Wm)[Wm]=setTimeout(function(){s.pickCursorPos=r.pointerViewPos,s.schedulePickEntity=i.doublePickFlyTo,s.schedulePickSurface=h,s.update(),s.pickResult?(c.events.fire("picked",s.pickResult,!0),s.pickedSurface&&(c.events.fire("pickedSurface",s.pickResult,!0),!i.firstPerson&&i.followPointer&&(t.pivotController.setPivotPos(s.pickResult.worldPos),t.pivotController.startPivot()&&t.pivotController.showPivot()))):c.events.fire("pickedNothing",{canvasPos:r.pointerViewPos},!0),f(o,Xm)[Xm]=0},250);else{if(null!==f(o,Wm)[Wm]&&(window.clearTimeout(f(o,Wm)[Wm]),f(o,Wm)[Wm]=null),s.pickCursorPos=r.pointerViewPos,s.schedulePickEntity=i.doublePickFlyTo||u||v,s.schedulePickSurface=s.schedulePickEntity&&v,s.update(),s.pickResult){if(c.events.fire("doublePicked",s.pickResult,!0),s.pickedSurface&&c.onDoublePickedSurface.dispatch(s.pickResult,!0),i.doublePickFlyTo&&(d(s.pickResult),!i.firstPerson&&i.followPointer)){var y=Or(s.pickResult.entity.aabb);t.pivotController.setPivotPos(y),t.pivotController.startPivot()&&t.pivotController.showPivot()}}else if(c.events.fire("doublePickedNothing",{canvasPos:r.pointerViewPos},!0),i.doublePickFlyTo&&(d(),!i.firstPerson&&i.followPointer)){var m=Or(f(o,Hm)[Hm].aabb);t.pivotController.setPivotPos(m),t.pivotController.startPivot()&&t.pivotController.showPivot()}f(o,Xm)[Xm]=0}}},!1)}var t=e.prototype;return t.reset=function(){f(this,Xm)[Xm]=0,f(this,Ym)[Ym]=null,f(this,Wm)[Wm]&&(window.clearTimeout(f(this,Wm)[Wm]),f(this,Wm)[Wm]=null)},t.destroy=function(){var e=f(this,Hm)[Hm].canvasElement;e.removeEventListener("mousemove",f(this,Km)[Km]),e.removeEventListener("mousedown",f(this,zm)[zm]),document.removeEventListener("mouseup",f(this,qm)[qm]),e.removeEventListener("mouseup",f(this,Zm)[Zm]),f(this,Wm)[Wm]&&(window.clearTimeout(f(this,Wm)[Wm]),f(this,Wm)[Wm]=null)},e}(),Jm=/*#__PURE__*/d("view"),$m=/*#__PURE__*/d("documentMouseMoveHandler"),eg=/*#__PURE__*/d("documentKeyDownHandler"),tg=/*#__PURE__*/d("documentKeyUpHandler"),ig=/*#__PURE__*/d("onTick"),rg=/*#__PURE__*/function(){function e(e,t,i,r,n){Object.defineProperty(this,Jm,{writable:!0,value:void 0}),Object.defineProperty(this,$m,{writable:!0,value:void 0}),Object.defineProperty(this,eg,{writable:!0,value:void 0}),Object.defineProperty(this,tg,{writable:!0,value:void 0}),Object.defineProperty(this,ig,{writable:!0,value:void 0}),this.keycodes=void 0,f(this,Jm)[Jm]=e.view;var o=[],s=e.view.canvasElement,a=!0;document.addEventListener("mousemove",f(this,$m)[$m]=function(){a=!0}),document.addEventListener("keydown",f(this,eg)[eg]=function(e){if(i.active&&i.pointerEnabled&&i.keyboardEnabled&&r.mouseover){var t=e.keyCode;o[t]=!0,16===t&&(s.style.cursor="move")}}),document.addEventListener("keyup",f(this,tg)[tg]=function(e){if(i.active&&i.pointerEnabled&&i.keyboardEnabled&&r.mouseover){var t=e.keyCode;o[t]=!1,16===t&&(s.style.cursor=null)}}),f(this,ig)[ig]=e.view.viewer.events.on("tick",function(e){if(i.active&&i.pointerEnabled&&i.keyboardEnabled&&r.mouseover){var s=t.cameraControl,c=e.deltaTime/1e3;if(!i.planView){var l=s._isKeyDownForAction(s.ROTATE_Y_POS,o),h=s._isKeyDownForAction(s.ROTATE_Y_NEG,o),u=s._isKeyDownForAction(s.ROTATE_X_POS,o),d=s._isKeyDownForAction(s.ROTATE_X_NEG,o),f=c*i.keyboardRotationRate;(l||h||u||d)&&(!i.firstPerson&&i.followPointer&&t.pivotController.startPivot(),l?n.rotateDeltaY+=f:h&&(n.rotateDeltaY-=f),u?n.rotateDeltaX+=f:d&&(n.rotateDeltaX-=f),!i.firstPerson&&i.followPointer&&t.pivotController.startPivot())}if(!o[17]&&!o[18]){var v=s._isKeyDownForAction(s.DOLLY_BACKWARDS,o),p=s._isKeyDownForAction(s.DOLLY_FORWARDS,o);if(v||p){var y=c*i.keyboardDollyRate;!i.firstPerson&&i.followPointer&&t.pivotController.startPivot(),p?n.dollyDelta-=y:v&&(n.dollyDelta+=y),a&&(r.followPointerDirty=!0,a=!1)}}var m=s._isKeyDownForAction(s.PAN_FORWARDS,o),g=s._isKeyDownForAction(s.PAN_BACKWARDS,o),b=s._isKeyDownForAction(s.PAN_LEFT,o),w=s._isKeyDownForAction(s.PAN_RIGHT,o),P=s._isKeyDownForAction(s.PAN_UP,o),E=s._isKeyDownForAction(s.PAN_DOWN,o),T=(o[18]?.3:1)*c*i.keyboardPanRate;(m||g||b||w||P||E)&&(!i.firstPerson&&i.followPointer&&t.pivotController.startPivot(),E?n.panDeltaY+=T:P&&(n.panDeltaY+=-T),w?n.panDeltaX+=-T:b&&(n.panDeltaX+=T),g?n.panDeltaZ+=T:m&&(n.panDeltaZ+=-T))}})}var t=e.prototype;return t.reset=function(){},t.destroy=function(){f(this,Jm)[Jm].viewer.onTick.unsubscribe(f(this,ig)[ig]),document.removeEventListener("mousemove",f(this,$m)[$m]),document.removeEventListener("keydown",f(this,eg)[eg]),document.removeEventListener("keyup",f(this,tg)[tg])},e}(),ng=.001,og=wt(),sg=/*#__PURE__*/d("onTick"),ag=/*#__PURE__*/d("view"),cg=/*#__PURE__*/function(){function e(e,t,i,r,n){Object.defineProperty(this,sg,{writable:!0,value:void 0}),Object.defineProperty(this,ag,{writable:!0,value:void 0}),f(this,ag)[ag]=e;var o=e.camera,s=t.pickController,a=t.pivotController,c=t.panController,l=1,h=1,u=null;f(this,sg)[sg]=e.viewer.onTick.subscribe(function(){if(i.active&&i.pointerEnabled){var t="default";if(Math.abs(n.dollyDelta)<ng&&(n.dollyDelta=0),Math.abs(n.rotateDeltaX)<ng&&(n.rotateDeltaX=0),Math.abs(n.rotateDeltaY)<ng&&(n.rotateDeltaY=0),0===n.rotateDeltaX&&0===n.rotateDeltaY||(n.dollyDelta=0),i.followPointer&&--l<=0&&(l=1,0!==n.dollyDelta)){if(0===n.rotateDeltaY&&0===n.rotateDeltaX&&i.followPointer&&r.followPointerDirty&&(s.pickCursorPos=r.pointerViewPos,s.schedulePickSurface=!0,s.update(),s.pickResult&&s.pickResult.worldPos?u=s.pickResult.worldPos:(h=1,u=null),r.followPointerDirty=!1),u){var d=Math.abs(Ut(Mt(u,e.camera.eye,og)));h=d/i.dollyProximityThreshold}h<i.dollyMinSpeed&&(h=i.dollyMinSpeed)}var f=n.dollyDelta*h;if(0===n.rotateDeltaY&&0===n.rotateDeltaX||(!i.firstPerson&&i.followPointer&&a.getPivoting()?(a.continuePivot(n.rotateDeltaY,n.rotateDeltaX),a.showPivot()):(0!==n.rotateDeltaX&&(i.firstPerson?o.pitch(-n.rotateDeltaX):o.orbitPitch(n.rotateDeltaX)),0!==n.rotateDeltaY&&(i.firstPerson?o.yaw(n.rotateDeltaY):o.orbitYaw(n.rotateDeltaY))),n.rotateDeltaX*=i.rotationInertia,n.rotateDeltaY*=i.rotationInertia,t="grabbing"),Math.abs(n.panDeltaX)<ng&&(n.panDeltaX=0),Math.abs(n.panDeltaY)<ng&&(n.panDeltaY=0),Math.abs(n.panDeltaZ)<ng&&(n.panDeltaZ=0),0!==n.panDeltaX||0!==n.panDeltaY||0!==n.panDeltaZ){var v,p,y=wt();if(y[0]=n.panDeltaX,y[1]=n.panDeltaY,y[2]=n.panDeltaZ,i.constrainVertical){o.xUp?(v=o.eye[0],p=o.look[0]):o.yUp?(v=o.eye[1],p=o.look[1]):o.zUp&&(v=o.eye[2],p=o.look[2]),o.pan(y);var m=o.eye,g=o.look;o.xUp?(m[0]=v,g[0]=p):o.yUp?(m[1]=v,g[1]=p):o.zUp&&(m[2]=v,g[2]=p),o.eye=m,o.look=g}else o.pan(y);t="grabbing"}if(n.panDeltaX*=i.panInertia,n.panDeltaY*=i.panInertia,n.panDeltaZ*=i.panInertia,0!==f){var b,w;if(t=f<0?"zoom-in":"zoom-out",i.firstPerson){if(i.constrainVertical&&(o.xUp?(b=o.eye[0],w=o.look[0]):o.yUp?(b=o.eye[1],w=o.look[1]):o.zUp&&(b=o.eye[2],w=o.look[2])),i.followPointer?c.dollyToViewPos(u,r.pointerViewPos,-f)&&(r.followPointerDirty=!0):(o.pan([0,0,f]),o.orthoProjection.scale=o.orthoProjection.scale-f),i.constrainVertical){var P=o.eye,E=o.look;o.xUp?(P[0]=b,E[0]=w):o.yUp?(P[1]=b,E[1]=w):o.zUp&&(P[2]=b,E[2]=w),o.eye=P,o.look=E}}else i.followPointer?c.dollyToViewPos(u,r.pointerViewPos,-f)&&(r.followPointerDirty=!0):(o.orthoProjection.scale=o.orthoProjection.scale+f,o.zoom(f));n.dollyDelta*=i.dollyInertia}s.fireEvents(),document.body.style.cursor=t}})}return e.prototype.destroy=function(){f(this,ag)[ag].viewer.onTick.unsubscribe(f(this,sg)[sg])},e}(),lg=/*#__PURE__*/d("view"),hg=/*#__PURE__*/d("mouseEnterHandler"),ug=/*#__PURE__*/d("mouseMoveHandler"),dg=/*#__PURE__*/d("mouseLeaveHandler"),fg=/*#__PURE__*/d("mouseDownHandler"),vg=/*#__PURE__*/d("mouseUpHandler"),pg=/*#__PURE__*/function(){function e(e,t,i,r,n){Object.defineProperty(this,lg,{writable:!0,value:void 0}),Object.defineProperty(this,hg,{writable:!0,value:void 0}),Object.defineProperty(this,ug,{writable:!0,value:void 0}),Object.defineProperty(this,dg,{writable:!0,value:void 0}),Object.defineProperty(this,fg,{writable:!0,value:void 0}),Object.defineProperty(this,vg,{writable:!0,value:void 0}),f(this,lg)[lg]=e.view;var o=f(this,lg)[lg].canvasElement;o.addEventListener("mouseenter",f(this,hg)[hg]=function(){r.mouseover=!0}),o.addEventListener("mouseleave",f(this,dg)[dg]=function(){r.mouseover=!1,o.style.cursor=null}),document.addEventListener("mousemove",f(this,ug)[ug]=function(e){yg(e,o,r.pointerViewPos)}),o.addEventListener("mousedown",f(this,fg)[fg]=function(e){i.active&&i.pointerEnabled&&(yg(e,o,r.pointerViewPos),r.mouseover=!0)}),o.addEventListener("mouseup",f(this,vg)[vg]=function(e){})}var t=e.prototype;return t.reset=function(){},t.destroy=function(){var e=f(this,lg)[lg].canvasElement;document.removeEventListener("mousemove",f(this,ug)[ug]),e.removeEventListener("mouseenter",f(this,hg)[hg]),e.removeEventListener("mouseleave",f(this,dg)[dg]),e.removeEventListener("mousedown",f(this,fg)[fg]),e.removeEventListener("mouseup",f(this,vg)[vg])},e}();function yg(e,t,i){if(e){var r=t.getBoundingClientRect(),n=r.y;i[0]=e.clientX-r.x,i[1]=e.clientY-n}else e=window.event,i[0]=e.x,i[1]=e.y;return i}var mg=function(e,t){if(e){for(var i=e.target,r=0,n=0;i.offsetParent;)r+=i.offsetLeft,n+=i.offsetTop,i=i.offsetParent;t[0]=e.pageX-r,t[1]=e.pageY-n}else e=window.event,t[0]=e.x,t[1]=e.y;return t},gg=/*#__PURE__*/d("view"),bg=/*#__PURE__*/d("onTick"),wg=/*#__PURE__*/d("canvasTouchStartHandler"),Pg=/*#__PURE__*/d("canvasTouchMoveHandler"),Eg=/*#__PURE__*/function(){function e(e,t,i,r,n){var o=this;Object.defineProperty(this,gg,{writable:!0,value:void 0}),Object.defineProperty(this,bg,{writable:!0,value:void 0}),Object.defineProperty(this,wg,{writable:!0,value:void 0}),Object.defineProperty(this,Pg,{writable:!0,value:void 0}),f(this,gg)[gg]=e.view;var s=t.pickController,a=t.pivotController,c=bt(),l=bt(),h=bt(),u=bt(),d=[],v=f(this,gg)[gg].canvasElement,p=0,y=!1;f(this,bg)[bg]=f(this,gg)[gg].viewer.onTick.subscribe(function(){y=!1}),v.addEventListener("touchstart",f(this,wg)[wg]=function(e){if(i.active&&i.pointerEnabled){e.preventDefault();var t=e.touches,n=e.changedTouches;for(r.touchStartTime=Date.now(),1===t.length&&1===n.length&&(mg(t[0],c),i.followPointer&&(s.pickCursorPos=c,s.schedulePickSurface=!0,s.update(),i.planView||(s.picked&&s.pickedSurface&&s.pickResult&&s.pickResult.worldPos?(a.setPivotPos(s.pickResult.worldPos),!i.firstPerson&&a.startPivot()&&a.showPivot()):(i.smartPivot?a.setCanvasPivotPos(r.pointerCanvasPos):a.setPivotPos(f(o,gg)[gg].camera.look),!i.firstPerson&&a.startPivot()&&a.showPivot()))));d.length<t.length;)d.push(bt());for(var l=0,h=t.length;l<h;++l)mg(t[l],d[l]);p=t.length}}),v.addEventListener("touchmove",f(this,Pg)[Pg]=function(e){if(i.active&&i.pointerEnabled&&(e.stopPropagation(),e.preventDefault(),!y)){y=!0;var t=f(o,gg)[gg].boundary,a=t[0],c=t[1],v=e.touches;if(e.touches.length===p){if(1===p){mg(v[0],l),Ot(l,d[0],u);var m=u[0],g=u[1];if(null!==r.longTouchTimeout&&(Math.abs(m)>i.longTapRadius||Math.abs(g)>i.longTapRadius)&&(clearTimeout(r.longTouchTimeout),r.longTouchTimeout=null),i.planView){var b=f(o,gg)[gg].camera;if(b.projectionType===et){var w=Math.abs(f(o,gg)[gg].camera.eyeLookDist)*Math.tan(b.perspectiveProjection.fov/2*Math.PI/180);n.panDeltaX+=m*w/c*i.touchPanRate,n.panDeltaY+=g*w/c*i.touchPanRate}else n.panDeltaX+=.5*b.orthoProjection.scale*(m/c)*i.touchPanRate,n.panDeltaY+=.5*b.orthoProjection.scale*(g/c)*i.touchPanRate}else n.rotateDeltaY-=m/a*(1*i.dragRotationRate),n.rotateDeltaX+=g/c*(1.5*i.dragRotationRate)}else if(2===p){var P=v[0],E=v[1];mg(P,l),mg(E,h);var T=Rt(d[0],d[1]),_=Rt(l,h),I=bt();Ot(T,_,I);var x=I[0],S=I[1],M=f(o,gg)[gg].camera,O=Xt([P.pageX,P.pageY],[E.pageX,E.pageY]),R=(Xt(d[0],d[1])-O)*i.touchDollyRate;if(n.dollyDelta=R,Math.abs(R)<1)if(M.projectionType===et){var j=s.pickResult?s.pickResult.worldPos:Or(f(o,gg)[gg].aabb),D=Math.abs(Ut(Mt(j,f(o,gg)[gg].camera.eye,[])))*Math.tan(M.perspectiveProjection.fov/2*Math.PI/180);n.panDeltaX-=x*D/c*i.touchPanRate,n.panDeltaY-=S*D/c*i.touchPanRate}else n.panDeltaX-=.5*M.orthoProjection.scale*(x/c)*i.touchPanRate,n.panDeltaY-=.5*M.orthoProjection.scale*(S/c)*i.touchPanRate;r.pointerCanvasPos=_}for(var A=0;A<p;++A)mg(v[A],d[A])}}})}var t=e.prototype;return t.reset=function(){},t.destroy=function(){var e=f(this,gg)[gg].canvasElement;e.removeEventListener("touchstart",f(this,wg)[wg]),e.removeEventListener("touchmove",f(this,Pg)[Pg]),f(this,gg)[gg].viewer.onTick.unsubscribe(f(this,bg)[bg])},e}(),Tg=/*#__PURE__*/d("view"),_g=/*#__PURE__*/function(){function e(e,t,i,r,n){var o=this;Object.defineProperty(this,Tg,{writable:!0,value:void 0}),this._canvasTouchStartHandler=void 0,this._canvasTouchEndHandler=void 0,f(this,Tg)[Tg]=e.view;var s,a=t.pickController,c=t.cameraControl,l=[],h=new Float32Array(2),u=-1,d=-1,v=f(this,Tg)[Tg].canvas.canvas,p=function(e){var i;e&&e.worldPos&&(i=e.worldPos);var r=e&&e.viewObject?e.viewObject.aabb:f(o,Tg)[Tg].viewer.aabb;if(i){var n=f(o,Tg)[Tg].camera;Mt(n.eye,n.look,[]),t.cameraFlight.flyTo({aabb:r})}else t.cameraFlight.flyTo({aabb:r})};v.addEventListener("touchstart",this._canvasTouchStartHandler=function(e){if(i.active&&i.pointerEnabled){null!==r.longTouchTimeout&&(clearTimeout(r.longTouchTimeout),r.longTouchTimeout=null);var n=e.touches,o=e.changedTouches;if(s=Date.now(),1===n.length&&1===o.length){u=s,h[0]=n[0].pageX,h[1]=n[0].pageY;var a=n[0].clientX,d=n[0].clientY,f=n[0].pageX,v=n[0].pageY;r.longTouchTimeout=setTimeout(function(){t.cameraControl.onRightClick.dispatch(c,{pagePos:[Math.round(f),Math.round(v)],canvasPos:[Math.round(a),Math.round(d)],event:e}),r.longTouchTimeout=null},i.longTapTimeout)}else u=-1;for(;l.length<n.length;)l.push(new Float32Array(2));for(var p=0,y=n.length;p<y;++p)l[p][0]=n[p].pageX,l[p][1]=n[p].pageY;l.length=n.length}},{passive:!0}),v.addEventListener("touchend",this._canvasTouchEndHandler=function(e){if(i.active&&i.pointerEnabled){var t=Date.now(),n=e.touches,o=e.changedTouches,s=c.events.hasSubs("pickedSurface");null!==r.longTouchTimeout&&(clearTimeout(r.longTouchTimeout),r.longTouchTimeout=null),0===n.length&&1===o.length&&u>-1&&t-u<150&&(d>-1&&u-d<325?(a.pickCursorPos[0]=Math.round(o[0].clientX),a.pickCursorPos[1]=Math.round(o[0].clientY),a.schedulePickEntity=!0,a.schedulePickSurface=s,a.update(),a.pickResult?(c.onDoublePickedSurface.dispatch(c,a.pickResult),a.pickedSurface&&c.onPickedSurface.dispatch(c,a.pickResult),i.doublePickFlyTo&&p(a.pickResult)):(c.onDoublePickedNothing.dispatch(c,null),i.doublePickFlyTo&&p()),d=-1):Xt(l[0],h)<4&&(a.pickCursorPos[0]=Math.round(o[0].clientX),a.pickCursorPos[1]=Math.round(o[0].clientY),a.schedulePickEntity=!0,a.schedulePickSurface=s,a.update(),a.pickResult?(c.onPicked.dispatch(c,a.pickResult),a.pickedSurface&&c.onPickedSurface.dispatch(c,a.pickResult)):c.onPickedNothing.dispatch(c),d=t),u=-1),l.length=n.length;for(var f=0,v=n.length;f<v;++f)l[f][0]=n[f].pageX,l[f][1]=n[f].pageY;e.stopPropagation()}},{passive:!0})}var t=e.prototype;return t.reset=function(){},t.destroy=function(){var e=f(this,Tg)[Tg].canvas.canvas;e.removeEventListener("touchstart",this._canvasTouchStartHandler),e.removeEventListener("touchend",this._canvasTouchEndHandler)},e}(),Ig=/*#__PURE__*/d("components"),xg=/*#__PURE__*/d("configs"),Sg=/*#__PURE__*/d("states"),Mg=/*#__PURE__*/d("updates"),Og=/*#__PURE__*/d("controllers"),Rg=/*#__PURE__*/d("handlers"),jg=/*#__PURE__*/d("cameraUpdater"),Dg=/*#__PURE__*/d("reset"),Ag=/*#__PURE__*/d("destroyHandlers"),Cg=/*#__PURE__*/d("destroyControllers"),Bg=/*#__PURE__*/function(e){function t(t,i){var r;return r=e.call(this,t,i)||this,Object.defineProperty(c(r),Cg,{value:Fg}),Object.defineProperty(c(r),Ag,{value:Lg}),Object.defineProperty(c(r),Dg,{value:kg}),r.view=void 0,r.canvasElement=void 0,r.camera=void 0,Object.defineProperty(c(r),Ig,{writable:!0,value:void 0}),Object.defineProperty(c(r),xg,{writable:!0,value:void 0}),Object.defineProperty(c(r),Sg,{writable:!0,value:void 0}),Object.defineProperty(c(r),Mg,{writable:!0,value:void 0}),Object.defineProperty(c(r),Og,{writable:!0,value:void 0}),Object.defineProperty(c(r),Rg,{writable:!0,value:void 0}),Object.defineProperty(c(r),jg,{writable:!0,value:void 0}),r.onRightClick=void 0,r.onHover=void 0,r.onHoverSurface=void 0,r.onHoverOff=void 0,r.onHoverEnter=void 0,r.onHoverOut=void 0,r.onPicked=void 0,r.onPickedSurface=void 0,r.onPickedNothing=void 0,r.onDoublePickedSurface=void 0,r.onDoublePickedNothing=void 0,r.view=t,r.camera=t.camera,t.canvasElement.oncontextmenu=function(e){e.preventDefault()},f(c(r),Ig)[Ig]={view:t,camera:r.camera},f(c(r),xg)[xg]={longTapTimeout:600,longTapRadius:5,active:!0,keyboardLayout:"qwerty",navMode:"orbit",planView:!1,firstPerson:!1,followPointer:!0,doublePickFlyTo:!0,panRightClick:!0,showPivot:!1,pointerEnabled:!0,constrainVertical:!1,smartPivot:!1,dragRotationRate:360,keyboardRotationRate:90,rotationInertia:0,keyboardPanRate:1,touchPanRate:1,panInertia:.5,keyboardDollyRate:10,mouseWheelDollyRate:100,touchDollyRate:.2,dollyInertia:0,dollyProximityThreshold:30,dollyMinSpeed:.04,keyboardEnabled:!0,keyMap:{}},f(c(r),Sg)[Sg]={pointerCanvasPos:bt(),mouseover:!1,followPointerDirty:!0,mouseDownClientX:0,mouseDownClientY:0,mouseDownCursorX:0,mouseDownCursorY:0,touchStartTime:null,activeTouches:[],tapStartPos:bt(),tapStartTime:-1,lastTapTime:-1,longTouchTimeout:null,altDown:!1,ctrlDown:!1,keyDown:[],shiftDown:!1},f(c(r),Mg)[Mg]={rotateDeltaX:0,rotateDeltaY:0,panDeltaX:0,panDeltaY:0,panDeltaZ:0,dollyDelta:0},f(c(r),Og)[Og]={cameraControl:c(r),pickController:new Pm(c(r),f(c(r),xg)[xg]),pivotController:new vm(c(r),f(c(r),xg)[xg]),panController:new Ny(c(r)),cameraFlight:new al(r.view,{duration:.5})},f(c(r),Rg)[Rg]=[new pg(f(c(r),Ig)[Ig],f(c(r),Og)[Og],f(c(r),xg)[xg],f(c(r),Sg)[Sg],f(c(r),Mg)[Mg]),new Eg(f(c(r),Ig)[Ig],f(c(r),Og)[Og],f(c(r),xg)[xg],f(c(r),Sg)[Sg],f(c(r),Mg)[Mg]),new Am(f(c(r),Ig)[Ig],f(c(r),Og)[Og],f(c(r),xg)[xg],f(c(r),Sg)[Sg],f(c(r),Mg)[Mg]),new Vm(f(c(r),Ig)[Ig],f(c(r),Og)[Og],f(c(r),xg)[xg],f(c(r),Sg)[Sg],f(c(r),Mg)[Mg]),new Qm(f(c(r),Ig)[Ig],f(c(r),Og)[Og],f(c(r),xg)[xg],f(c(r),Sg)[Sg],f(c(r),Mg)[Mg]),new _g(f(c(r),Ig)[Ig],f(c(r),Og)[Og],f(c(r),xg)[xg],f(c(r),Sg)[Sg],f(c(r),Mg)[Mg]),new rg(f(c(r),Ig)[Ig],f(c(r),Og)[Og],f(c(r),xg)[xg],f(c(r),Sg)[Sg],f(c(r),Mg)[Mg])],f(c(r),jg)[jg]=new cg(c(r),f(c(r),Og)[Og],f(c(r),xg)[xg],f(c(r),Sg)[Sg],f(c(r),Mg)[Mg]),r.onHover=new p(new te.EventDispatcher),r.onHoverOff=new p(new te.EventDispatcher),r.onHoverEnter=new p(new te.EventDispatcher),r.onHoverOut=new p(new te.EventDispatcher),r.navMode=i.navMode,r.constrainVertical=i.constrainVertical,r.keyMap=i.keyMap,r.doublePickFlyTo=i.doublePickFlyTo,r.panRightClick=i.panRightClick,r.active=i.active,r.followPointer=i.followPointer,r.rotationInertia=i.rotationInertia,r.keyboardPanRate=i.keyboardPanRate,r.touchPanRate=i.touchPanRate,r.keyboardRotationRate=i.keyboardRotationRate,r.dragRotationRate=i.dragRotationRate,r.touchDollyRate=i.touchDollyRate,r.dollyInertia=i.dollyInertia,r.dollyProximityThreshold=i.dollyProximityThreshold,r.dollyMinSpeed=i.dollyMinSpeed,r.panInertia=i.panInertia,r.pointerEnabled=!0,r.keyboardDollyRate=i.keyboardDollyRate,r.mouseWheelDollyRate=i.mouseWheelDollyRate,r.keyboardEnabled=i.keyboardEnabled,r}r(t,e);var n=t.prototype;return n._isKeyDownForAction=function(e,t){var i=f(this,xg)[xg].keyMap[e];if(!i)return!1;t||(t=f(this,Sg)[Sg].keyDown);for(var r=0,n=i.length;r<n;r++)if(t[i[r]])return!0;return!1},n.destroy=function(){f(this,Ag)[Ag](),f(this,Cg)[Cg](),f(this,jg)[jg].destroy(),this.onHover.clear(),this.onHoverOff.clear(),this.onHoverEnter.clear(),this.onHoverOut.clear(),e.prototype.destroy.call(this)},i(t,[{key:"keyMap",get:function(){return f(this,xg)[xg].keyMap},set:function(e){if(tr(e=e||"qwerty")){var i={};switch(e){default:this.error("Unsupported value for 'keyMap': "+e+" defaulting to 'qwerty'");case"qwerty":i[t.PAN_LEFT]=[65],i[t.PAN_RIGHT]=[68],i[t.PAN_UP]=[90],i[t.PAN_DOWN]=[88],i[t.PAN_BACKWARDS]=[],i[t.PAN_FORWARDS]=[],i[t.DOLLY_FORWARDS]=[87,107],i[t.DOLLY_BACKWARDS]=[83,109],i[t.ROTATE_X_POS]=[40],i[t.ROTATE_X_NEG]=[38],i[t.ROTATE_Y_POS]=[81,37],i[t.ROTATE_Y_NEG]=[69,39],i[t.AXIS_VIEW_RIGHT]=[49],i[t.AXIS_VIEW_BACK]=[50],i[t.AXIS_VIEW_LEFT]=[51],i[t.AXIS_VIEW_FRONT]=[52],i[t.AXIS_VIEW_TOP]=[53],i[t.AXIS_VIEW_BOTTOM]=[54];break;case"azerty":i[t.PAN_LEFT]=[81],i[t.PAN_RIGHT]=[68],i[t.PAN_UP]=[87],i[t.PAN_DOWN]=[88],i[t.PAN_BACKWARDS]=[],i[t.PAN_FORWARDS]=[],i[t.DOLLY_FORWARDS]=[90,107],i[t.DOLLY_BACKWARDS]=[83,109],i[t.ROTATE_X_POS]=[40],i[t.ROTATE_X_NEG]=[38],i[t.ROTATE_Y_POS]=[65,37],i[t.ROTATE_Y_NEG]=[69,39],i[t.AXIS_VIEW_RIGHT]=[49],i[t.AXIS_VIEW_BACK]=[50],i[t.AXIS_VIEW_LEFT]=[51],i[t.AXIS_VIEW_FRONT]=[52],i[t.AXIS_VIEW_TOP]=[53],i[t.AXIS_VIEW_BOTTOM]=[54]}f(this,xg)[xg].keyMap=i}else{var r=e;f(this,xg)[xg].keyMap=r}}},{key:"pivotElement",set:function(e){f(this,Og)[Og].pivotController.setPivotElement(e)}},{key:"active",get:function(){return f(this,xg)[xg].active},set:function(e){f(this,xg)[xg].active=!1!==e}},{key:"navMode",get:function(){return f(this,xg)[xg].navMode},set:function(e){"firstPerson"!==(e=e||"orbit")&&"orbit"!==e&&"planView"!==e&&(this.error("Unsupported value for navMode: "+e+" - supported values are 'orbit', 'firstPerson' and 'planView' - defaulting to 'orbit'"),e="orbit"),f(this,xg)[xg].firstPerson="firstPerson"===e,f(this,xg)[xg].planView="planView"===e,(f(this,xg)[xg].firstPerson||f(this,xg)[xg].planView)&&(f(this,Og)[Og].pivotController.hidePivot(),f(this,Og)[Og].pivotController.endPivot()),f(this,xg)[xg].navMode=e}},{key:"pointerEnabled",get:function(){return f(this,xg)[xg].pointerEnabled},set:function(e){f(this,Dg)[Dg](),f(this,xg)[xg].pointerEnabled=!!e}},{key:"followPointer",get:function(){return f(this,xg)[xg].followPointer},set:function(e){f(this,xg)[xg].followPointer=!1!==e}},{key:"pivotPos",get:function(){return f(this,Og)[Og].pivotController.getPivotPos()},set:function(e){f(this,Og)[Og].pivotController.setPivotPos(e)}},{key:"dollyToPointer",get:function(){return this.warn("dollyToPointer property is deprecated - replaced with followPointer"),this.followPointer},set:function(e){this.warn("dollyToPointer property is deprecated - replaced with followPointer"),this.followPointer=e}},{key:"panToPointer",get:function(){return this.warn("panToPointer property is deprecated - replaced with followPointer"),!1},set:function(e){this.warn("panToPointer property is deprecated - replaced with followPointer")}},{key:"planView",get:function(){return this.warn("planView property is deprecated - replaced with navMode"),f(this,xg)[xg].planView},set:function(e){f(this,xg)[xg].planView=!!e,f(this,xg)[xg].firstPerson=!1,f(this,xg)[xg].planView&&(f(this,Og)[Og].pivotController.hidePivot(),f(this,Og)[Og].pivotController.endPivot()),this.warn("planView property is deprecated - replaced with navMode")}},{key:"firstPerson",get:function(){return this.warn("firstPerson property is deprecated - replaced with navMode"),f(this,xg)[xg].firstPerson},set:function(e){this.warn("firstPerson property is deprecated - replaced with navMode"),f(this,xg)[xg].firstPerson=!!e,f(this,xg)[xg].planView=!1,f(this,xg)[xg].firstPerson&&(f(this,Og)[Og].pivotController.hidePivot(),f(this,Og)[Og].pivotController.endPivot())}},{key:"constrainVertical",get:function(){return f(this,xg)[xg].constrainVertical},set:function(e){f(this,xg)[xg].constrainVertical=!!e}},{key:"doublePickFlyTo",get:function(){return f(this,xg)[xg].doublePickFlyTo},set:function(e){f(this,xg)[xg].doublePickFlyTo=!1!==e}},{key:"panRightClick",get:function(){return f(this,xg)[xg].panRightClick},set:function(e){f(this,xg)[xg].panRightClick=!1!==e}},{key:"rotationInertia",get:function(){return f(this,xg)[xg].rotationInertia},set:function(e){f(this,xg)[xg].rotationInertia=null!=e?e:0}},{key:"touchPanRate",get:function(){return f(this,xg)[xg].touchPanRate},set:function(e){f(this,xg)[xg].touchPanRate=null!=e?e:1}},{key:"keyboardPanRate",get:function(){return f(this,xg)[xg].keyboardPanRate},set:function(e){f(this,xg)[xg].keyboardPanRate=null!=e?e:5}},{key:"keyboardRotationRate",get:function(){return f(this,xg)[xg].keyboardRotationRate},set:function(e){f(this,xg)[xg].keyboardRotationRate=null!=e?e:90}},{key:"dragRotationRate",get:function(){return f(this,xg)[xg].dragRotationRate},set:function(e){f(this,xg)[xg].dragRotationRate=null!=e?e:360}},{key:"keyboardDollyRate",get:function(){return f(this,xg)[xg].keyboardDollyRate},set:function(e){f(this,xg)[xg].keyboardDollyRate=null!=e?e:15}},{key:"touchDollyRate",get:function(){return f(this,xg)[xg].touchDollyRate},set:function(e){f(this,xg)[xg].touchDollyRate=null!=e?e:.2}},{key:"mouseWheelDollyRate",get:function(){return f(this,xg)[xg].mouseWheelDollyRate},set:function(e){f(this,xg)[xg].mouseWheelDollyRate=null!=e?e:100}},{key:"dollyInertia",get:function(){return f(this,xg)[xg].dollyInertia},set:function(e){f(this,xg)[xg].dollyInertia=null!=e?e:0}},{key:"dollyProximityThreshold",get:function(){return f(this,xg)[xg].dollyProximityThreshold},set:function(e){f(this,xg)[xg].dollyProximityThreshold=null!=e?e:35}},{key:"dollyMinSpeed",get:function(){return f(this,xg)[xg].dollyMinSpeed},set:function(e){f(this,xg)[xg].dollyMinSpeed=null!=e?e:.04}},{key:"panInertia",get:function(){return f(this,xg)[xg].panInertia},set:function(e){f(this,xg)[xg].panInertia=null!=e?e:.5}},{key:"keyboardLayout",get:function(){return f(this,xg)[xg].keyboardLayout},set:function(e){"qwerty"!==(e=e||"qwerty")&&"azerty"!==e&&(this.error("Unsupported value for keyboardLayout - defaulting to 'qwerty'"),e="qwerty"),f(this,xg)[xg].keyboardLayout=e,this.keyMap=f(this,xg)[xg].keyboardLayout}},{key:"smartPivot",get:function(){return f(this,xg)[xg].smartPivot},set:function(e){f(this,xg)[xg].smartPivot=!1!==e}},{key:"keyboardEnabled",get:function(){return f(this,xg)[xg].keyboardEnabled},set:function(e){f(this,xg)[xg].keyboardEnabled=!1!==e}}]),t}(ae);function kg(){for(var e=0,t=f(this,Rg)[Rg].length;e<t;e++){var i=f(this,Rg)[Rg][e];i.reset&&i.reset()}f(this,Mg)[Mg].panDeltaX=0,f(this,Mg)[Mg].panDeltaY=0,f(this,Mg)[Mg].rotateDeltaX=0,f(this,Mg)[Mg].rotateDeltaY=0,f(this,Mg)[Mg].dollyDelta=0}function Lg(){for(var e=0,t=f(this,Rg)[Rg].length;e<t;e++){var i=f(this,Rg)[Rg][e];i.destroy&&i.destroy()}}function Fg(){for(var e in f(this,Og)[Og]){var t=f(this,Og)[Og][e];t.destroy&&t.destroy()}}Bg.PAN_LEFT=0,Bg.PAN_RIGHT=1,Bg.PAN_UP=2,Bg.PAN_DOWN=3,Bg.PAN_FORWARDS=4,Bg.PAN_BACKWARDS=5,Bg.ROTATE_X_POS=6,Bg.ROTATE_X_NEG=7,Bg.ROTATE_Y_POS=8,Bg.ROTATE_Y_NEG=9,Bg.DOLLY_FORWARDS=10,Bg.DOLLY_BACKWARDS=11,Bg.AXIS_VIEW_RIGHT=12,Bg.AXIS_VIEW_BACK=13,Bg.AXIS_VIEW_LEFT=14,Bg.AXIS_VIEW_FRONT=15,Bg.AXIS_VIEW_TOP=16,Bg.AXIS_VIEW_BOTTOM=17;var Ug={__proto__:null,keycodes:{__proto__:null,KEY_BACKSPACE:8,KEY_TAB:9,KEY_ENTER:13,KEY_SHIFT:16,KEY_CTRL:17,KEY_ALT:18,KEY_PAUSE_BREAK:19,KEY_CAPS_LOCK:20,KEY_ESCAPE:27,KEY_PAGE_UP:33,KEY_PAGE_DOWN:34,KEY_END:35,KEY_HOME:36,KEY_LEFT_ARROW:37,KEY_UP_ARROW:38,KEY_RIGHT_ARROW:39,KEY_DOWN_ARROW:40,KEY_INSERT:45,KEY_DELETE:46,KEY_NUM_0:48,KEY_NUM_1:49,KEY_NUM_2:50,KEY_NUM_3:51,KEY_NUM_4:52,KEY_NUM_5:53,KEY_NUM_6:54,KEY_NUM_7:55,KEY_NUM_8:56,KEY_NUM_9:57,KEY_A:65,KEY_B:66,KEY_C:67,KEY_D:68,KEY_E:69,KEY_F:70,KEY_G:71,KEY_H:72,KEY_I:73,KEY_J:74,KEY_K:75,KEY_L:76,KEY_M:77,KEY_N:78,KEY_O:79,KEY_P:80,KEY_Q:81,KEY_R:82,KEY_S:83,KEY_T:84,KEY_U:85,KEY_V:86,KEY_W:87,KEY_X:88,KEY_Y:89,KEY_Z:90,KEY_LEFT_WINDOW:91,KEY_RIGHT_WINDOW:92,KEY_SELECT_KEY:93,KEY_NUMPAD_0:96,KEY_NUMPAD_1:97,KEY_NUMPAD_2:98,KEY_NUMPAD_3:99,KEY_NUMPAD_4:100,KEY_NUMPAD_5:101,KEY_NUMPAD_6:102,KEY_NUMPAD_7:103,KEY_NUMPAD_8:104,KEY_NUMPAD_9:105,KEY_MULTIPLY:106,KEY_ADD:107,KEY_SUBTRACT:109,KEY_DECIMAL_POINT:110,KEY_DIVIDE:111,KEY_F1:112,KEY_F2:113,KEY_F3:114,KEY_F4:115,KEY_F5:116,KEY_F6:117,KEY_F7:118,KEY_F8:119,KEY_F9:120,KEY_F10:121,KEY_F11:122,KEY_F12:123,KEY_NUM_LOCK:144,KEY_SCROLL_LOCK:145,KEY_SEMI_COLON:186,KEY_EQUAL_SIGN:187,KEY_COMMA:188,KEY_DASH:189,KEY_PERIOD:190,KEY_FORWARD_SLASH:191,KEY_GRAVE_ACCENT:192,KEY_OPEN_BRACKET:219,KEY_BACK_SLASH:220,KEY_CLOSE_BRACKET:221,KEY_SINGLE_QUOTE:222,KEY_SPACE:32},CameraControl:Bg},Ng={__proto__:null,loadBCFViewpoint:function(e){},saveBCFViewpoint:function(e){return{}}};export{Ko as basictypes,Ng as bcf,Wr as boundaries,Ug as cameracontrol,Gs as cityjson,Jo as cityjsontypes,gr as compression,nt as constants,ue as core,$r as curves,mn as data,Vs as dotbim,$o as ifctypes,xo as kdtree2,Xo as kdtree3,Bh as ktx2,sn as locale,ht as math,Ui as matrix,Jr as rtc,Po as scene,sr as utils,gh as viewer,Ry as webglrenderer};
//# sourceMappingURL=xeokit-bundle.js.map
