!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e||self).examples={})}(this,function(e){function t(){t=function(){return e};var e={},i=Object.prototype,r=i.hasOwnProperty,n=Object.defineProperty||function(e,t,i){e[t]=i.value},o="function"==typeof Symbol?Symbol:{},s=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function l(e,t,i){return Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,i){return e[t]=i}}function h(e,t,i,r){var o=Object.create((t&&t.prototype instanceof f?t:f).prototype),s=new x(r||[]);return n(o,"_invoke",{value:E(e,i,s)}),o}function u(e,t,i){try{return{type:"normal",arg:e.call(t,i)}}catch(e){return{type:"throw",arg:e}}}e.wrap=h;var d={};function f(){}function v(){}function p(){}var y={};l(y,s,function(){return this});var m=Object.getPrototypeOf,g=m&&m(m(S([])));g&&g!==i&&r.call(g,s)&&(y=g);var b=p.prototype=f.prototype=Object.create(y);function w(e){["next","throw","return"].forEach(function(t){l(e,t,function(e){return this._invoke(t,e)})})}function P(e,t){function i(n,o,s,a){var c=u(e[n],e,o);if("throw"!==c.type){var l=c.arg,h=l.value;return h&&"object"==typeof h&&r.call(h,"__await")?t.resolve(h.__await).then(function(e){i("next",e,s,a)},function(e){i("throw",e,s,a)}):t.resolve(h).then(function(e){l.value=e,s(l)},function(e){return i("throw",e,s,a)})}a(c.arg)}var o;n(this,"_invoke",{value:function(e,r){function n(){return new t(function(t,n){i(e,r,t,n)})}return o=o?o.then(n,n):n()}})}function E(e,t,i){var r="suspendedStart";return function(n,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===n)throw o;return{value:void 0,done:!0}}for(i.method=n,i.arg=o;;){var s=i.delegate;if(s){var a=T(s,i);if(a){if(a===d)continue;return a}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if("suspendedStart"===r)throw r="completed",i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);r="executing";var c=u(e,t,i);if("normal"===c.type){if(r=i.done?"completed":"suspendedYield",c.arg===d)continue;return{value:c.arg,done:i.done}}"throw"===c.type&&(r="completed",i.method="throw",i.arg=c.arg)}}}function T(e,t){var i=t.method,r=e.iterator[i];if(void 0===r)return t.delegate=null,"throw"===i&&e.iterator.return&&(t.method="return",t.arg=void 0,T(e,t),"throw"===t.method)||"return"!==i&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+i+"' method")),d;var n=u(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,d;var o=n.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,d):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,d)}function _(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function I(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function x(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(_,this),this.reset(!0)}function S(e){if(e){var t=e[s];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,n=function t(){for(;++i<e.length;)if(r.call(e,i))return t.value=e[i],t.done=!1,t;return t.value=void 0,t.done=!0,t};return n.next=n}}return{next:M}}function M(){return{value:void 0,done:!0}}return v.prototype=p,n(b,"constructor",{value:p,configurable:!0}),n(p,"constructor",{value:v,configurable:!0}),v.displayName=l(p,c,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,l(e,c,"GeneratorFunction")),e.prototype=Object.create(b),e},e.awrap=function(e){return{__await:e}},w(P.prototype),l(P.prototype,a,function(){return this}),e.AsyncIterator=P,e.async=function(t,i,r,n,o){void 0===o&&(o=Promise);var s=new P(h(t,i,r,n),o);return e.isGeneratorFunction(i)?s:s.next().then(function(e){return e.done?e.value:s.next()})},w(b),l(b,c,"Generator"),l(b,s,function(){return this}),l(b,"toString",function(){return"[object Generator]"}),e.keys=function(e){var t=Object(e),i=[];for(var r in t)i.push(r);return i.reverse(),function e(){for(;i.length;){var r=i.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},e.values=S,x.prototype={constructor:x,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(I),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function i(i,r){return s.type="throw",s.arg=e,t.next=i,r&&(t.method="next",t.arg=void 0),!!r}for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n],s=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var a=r.call(o,"catchLoc"),c=r.call(o,"finallyLoc");if(a&&c){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(a){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(e,t){for(var i=this.tryEntries.length-1;i>=0;--i){var n=this.tryEntries[i];if(n.tryLoc<=this.prev&&r.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var s=o?o.completion:{};return s.type=e,s.arg=t,o?(this.method="next",this.next=o.finallyLoc,d):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),d},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.finallyLoc===e)return this.complete(i.completion,i.afterLoc),I(i),d}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.tryLoc===e){var r=i.completion;if("throw"===r.type){var n=r.arg;I(i)}return n}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,i){return this.delegate={iterator:S(e),resultName:t,nextLoc:i},"next"===this.method&&(this.arg=void 0),d}},e}function i(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,"symbol"==typeof(n=function(e,t){if("object"!=typeof e||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(r.key))?n:String(n),r)}var n}function r(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function n(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,s(e,t)}function o(e){return o=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},o(e)}function s(e,t){return s=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},s(e,t)}function a(e,t,i){return a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}()?Reflect.construct.bind():function(e,t,i){var r=[null];r.push.apply(r,t);var n=new(Function.bind.apply(e,r));return i&&s(n,i.prototype),n},a.apply(null,arguments)}function c(e){var t="function"==typeof Map?new Map:void 0;return c=function(e){if(null===e||-1===Function.toString.call(e).indexOf("[native code]"))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,i)}function i(){return a(e,arguments,o(this).constructor)}return i.prototype=Object.create(e.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),s(i,e)},c(e)}function l(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,r=new Array(t);i<t;i++)r[i]=e[i];return r}function u(e,t){var i="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(i)return(i=i.call(e)).next.bind(i);if(Array.isArray(e)||(i=function(e,t){if(e){if("string"==typeof e)return h(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?h(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){i&&(e=i);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var d=0;function f(e){return"__private_"+d+++"_"+e}function v(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}var p=/*#__PURE__*/f("ievent"),y=/*#__PURE__*/function(){function e(e){Object.defineProperty(this,p,{writable:!0,value:void 0}),v(this,p)[p]=e}var t=e.prototype;return t.subscribe=function(e){return v(this,p)[p].asEvent().subscribe(e)},t.dispatch=function(e,t){v(this,p)[p].dispatch(e,t)},t.sub=function(e){return v(this,p)[p].asEvent().sub(e)},t.unsubscribe=function(e){v(this,p)[p].asEvent().unsubscribe(e)},t.unsub=function(e){v(this,p)[p].asEvent().unsub(e)},t.one=function(e){return v(this,p)[p].asEvent().one(e)},t.has=function(e){return v(this,p)[p].asEvent().has(e)},t.clear=function(){v(this,p)[p].asEvent().clear()},r(e,[{key:"count",get:function(){return v(this,p)[p].count}}]),e}();function m(e){var t={exports:{}};return e(t,t.exports),t.exports}var g=m(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.DispatcherWrapper=void 0,t.DispatcherWrapper=class{constructor(e){this._subscribe=t=>e.subscribe(t),this._unsubscribe=t=>e.unsubscribe(t),this._one=t=>e.one(t),this._has=t=>e.has(t),this._clear=()=>e.clear(),this._count=()=>e.count,this._onSubscriptionChange=()=>e.onSubscriptionChange}get onSubscriptionChange(){return this._onSubscriptionChange()}get count(){return this._count()}subscribe(e){return this._subscribe(e)}sub(e){return this.subscribe(e)}unsubscribe(e){this._unsubscribe(e)}unsub(e){this.unsubscribe(e)}one(e){return this._one(e)}has(e){return this._has(e)}clear(){this._clear()}}}),b=m(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Subscription=void 0,t.Subscription=class{constructor(e,t){this.handler=e,this.isOnce=t,this.isExecuted=!1}execute(e,t,i){if(!this.isOnce||!this.isExecuted){this.isExecuted=!0;var r=this.handler;e?setTimeout(()=>{r.apply(t,i)},1):r.apply(t,i)}}}}),w=m(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.EventManagement=void 0,t.EventManagement=class{constructor(e){this.unsub=e,this.propagationStopped=!1}stopPropagation(){this.propagationStopped=!0}}}),P=m(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.SubscriptionChangeEventDispatcher=t.DispatcherBase=void 0;class i{constructor(){this._subscriptions=new Array}get count(){return this._subscriptions.length}get onSubscriptionChange(){return null==this._onSubscriptionChange&&(this._onSubscriptionChange=new r),this._onSubscriptionChange.asEvent()}subscribe(e){return e&&(this._subscriptions.push(this.createSubscription(e,!1)),this.triggerSubscriptionChange()),()=>{this.unsubscribe(e)}}sub(e){return this.subscribe(e)}one(e){return e&&(this._subscriptions.push(this.createSubscription(e,!0)),this.triggerSubscriptionChange()),()=>{this.unsubscribe(e)}}has(e){return!!e&&this._subscriptions.some(t=>t.handler==e)}unsubscribe(e){if(!e)return;let t=!1;for(let i=0;i<this._subscriptions.length;i++)if(this._subscriptions[i].handler==e){this._subscriptions.splice(i,1),t=!0;break}t&&this.triggerSubscriptionChange()}unsub(e){this.unsubscribe(e)}_dispatch(e,t,i){for(let r of[...this._subscriptions]){let n=new w.EventManagement(()=>this.unsub(r.handler)),o=Array.prototype.slice.call(i);if(o.push(n),r.execute(e,t,o),this.cleanup(r),!e&&n.propagationStopped)return{propagationStopped:!0}}return e?null:{propagationStopped:!1}}createSubscription(e,t){return new b.Subscription(e,t)}cleanup(e){let t=!1;if(e.isOnce&&e.isExecuted){let i=this._subscriptions.indexOf(e);i>-1&&(this._subscriptions.splice(i,1),t=!0)}t&&this.triggerSubscriptionChange()}asEvent(){return null==this._wrap&&(this._wrap=new g.DispatcherWrapper(this)),this._wrap}clear(){0!=this._subscriptions.length&&(this._subscriptions.splice(0,this._subscriptions.length),this.triggerSubscriptionChange())}triggerSubscriptionChange(){null!=this._onSubscriptionChange&&this._onSubscriptionChange.dispatch(this.count)}}t.DispatcherBase=i;class r extends i{dispatch(e){this._dispatch(!1,this,arguments)}}t.SubscriptionChangeEventDispatcher=r}),E=m(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.DispatchError=void 0;class i extends Error{constructor(e){super(e)}}t.DispatchError=i}),T=m(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.EventListBase=void 0,t.EventListBase=class{constructor(){this._events={}}get(e){let t=this._events[e];return t||(t=this.createDispatcher(),this._events[e]=t,t)}remove(e){delete this._events[e]}}}),_=m(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.HandlingBase=void 0,t.HandlingBase=class{constructor(e){this.events=e}one(e,t){this.events.get(e).one(t)}has(e,t){return this.events.get(e).has(t)}subscribe(e,t){this.events.get(e).subscribe(t)}sub(e,t){this.subscribe(e,t)}unsubscribe(e,t){this.events.get(e).unsubscribe(t)}unsub(e,t){this.unsubscribe(e,t)}}}),I=m(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.PromiseSubscription=void 0,t.PromiseSubscription=class{constructor(e,t){this.handler=e,this.isOnce=t,this.isExecuted=!1}async execute(e,t,i){if(!this.isOnce||!this.isExecuted){this.isExecuted=!0;var r=this.handler;if(e)return void setTimeout(()=>{r.apply(t,i)},1);let n=r.apply(t,i);await n}}}}),x=m(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.PromiseDispatcherBase=void 0,t.PromiseDispatcherBase=class extends P.DispatcherBase{_dispatch(e,t,i){throw new E.DispatchError("_dispatch not supported. Use _dispatchAsPromise.")}createSubscription(e,t){return new I.PromiseSubscription(e,t)}async _dispatchAsPromise(e,t,i){for(let r of[...this._subscriptions]){let n=new w.EventManagement(()=>this.unsub(r.handler)),o=Array.prototype.slice.call(i);o.push(n);let s=r;if(await s.execute(e,t,o),this.cleanup(r),!e&&n.propagationStopped)return{propagationStopped:!0}}return e?null:{propagationStopped:!1}}}}),S=m(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.SubscriptionChangeEventDispatcher=t.HandlingBase=t.PromiseDispatcherBase=t.PromiseSubscription=t.DispatchError=t.EventManagement=t.EventListBase=t.DispatcherWrapper=t.DispatcherBase=t.Subscription=void 0,Object.defineProperty(t,"DispatcherBase",{enumerable:!0,get:function(){return P.DispatcherBase}}),Object.defineProperty(t,"SubscriptionChangeEventDispatcher",{enumerable:!0,get:function(){return P.SubscriptionChangeEventDispatcher}}),Object.defineProperty(t,"DispatchError",{enumerable:!0,get:function(){return E.DispatchError}}),Object.defineProperty(t,"DispatcherWrapper",{enumerable:!0,get:function(){return g.DispatcherWrapper}}),Object.defineProperty(t,"EventListBase",{enumerable:!0,get:function(){return T.EventListBase}}),Object.defineProperty(t,"EventManagement",{enumerable:!0,get:function(){return w.EventManagement}}),Object.defineProperty(t,"HandlingBase",{enumerable:!0,get:function(){return _.HandlingBase}}),Object.defineProperty(t,"PromiseDispatcherBase",{enumerable:!0,get:function(){return x.PromiseDispatcherBase}}),Object.defineProperty(t,"PromiseSubscription",{enumerable:!0,get:function(){return I.PromiseSubscription}}),Object.defineProperty(t,"Subscription",{enumerable:!0,get:function(){return b.Subscription}})}),M=m(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.EventDispatcher=void 0,t.EventDispatcher=class extends S.DispatcherBase{constructor(){super()}dispatch(e,t){const i=this._dispatch(!1,this,arguments);if(null==i)throw new S.DispatchError("Got `null` back from dispatch.");return i}dispatchAsync(e,t){this._dispatch(!0,this,arguments)}asEvent(){return super.asEvent()}}}),O=m(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.EventList=void 0,t.EventList=class extends S.EventListBase{constructor(){super()}createDispatcher(){return new M.EventDispatcher}}}),R=m(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.EventHandlingBase=void 0,t.EventHandlingBase=class extends S.HandlingBase{constructor(){super(new O.EventList)}}}),j=m(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.NonUniformEventList=void 0,t.NonUniformEventList=class{constructor(){this._events={}}get(e){if(this._events[e])return this._events[e];const t=this.createDispatcher();return this._events[e]=t,t}remove(e){delete this._events[e]}createDispatcher(){return new M.EventDispatcher}}}),D=m(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.NonUniformEventList=t.EventList=t.EventHandlingBase=t.EventDispatcher=void 0,Object.defineProperty(t,"EventDispatcher",{enumerable:!0,get:function(){return M.EventDispatcher}}),Object.defineProperty(t,"EventHandlingBase",{enumerable:!0,get:function(){return R.EventHandlingBase}}),Object.defineProperty(t,"EventList",{enumerable:!0,get:function(){return O.EventList}}),Object.defineProperty(t,"NonUniformEventList",{enumerable:!0,get:function(){return j.NonUniformEventList}})}),A=m(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.SimpleEventDispatcher=void 0,t.SimpleEventDispatcher=class extends S.DispatcherBase{constructor(){super()}dispatch(e){const t=this._dispatch(!1,this,arguments);if(null==t)throw new S.DispatchError("Got `null` back from dispatch.");return t}dispatchAsync(e){this._dispatch(!0,this,arguments)}asEvent(){return super.asEvent()}}}),C=m(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.SimpleEventList=void 0,t.SimpleEventList=class extends S.EventListBase{constructor(){super()}createDispatcher(){return new A.SimpleEventDispatcher}}}),B=m(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.SimpleEventHandlingBase=void 0,t.SimpleEventHandlingBase=class extends S.HandlingBase{constructor(){super(new C.SimpleEventList)}}}),k=m(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.NonUniformSimpleEventList=void 0,t.NonUniformSimpleEventList=class{constructor(){this._events={}}get(e){if(this._events[e])return this._events[e];const t=this.createDispatcher();return this._events[e]=t,t}remove(e){delete this._events[e]}createDispatcher(){return new A.SimpleEventDispatcher}}}),L=m(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.NonUniformSimpleEventList=t.SimpleEventList=t.SimpleEventHandlingBase=t.SimpleEventDispatcher=void 0,Object.defineProperty(t,"SimpleEventDispatcher",{enumerable:!0,get:function(){return A.SimpleEventDispatcher}}),Object.defineProperty(t,"SimpleEventHandlingBase",{enumerable:!0,get:function(){return B.SimpleEventHandlingBase}}),Object.defineProperty(t,"NonUniformSimpleEventList",{enumerable:!0,get:function(){return k.NonUniformSimpleEventList}}),Object.defineProperty(t,"SimpleEventList",{enumerable:!0,get:function(){return C.SimpleEventList}})}),F=m(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.SignalDispatcher=void 0,t.SignalDispatcher=class extends S.DispatcherBase{dispatch(){const e=this._dispatch(!1,this,arguments);if(null==e)throw new S.DispatchError("Got `null` back from dispatch.");return e}dispatchAsync(){this._dispatch(!0,this,arguments)}asEvent(){return super.asEvent()}}}),U=m(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.SignalList=void 0,t.SignalList=class extends S.EventListBase{constructor(){super()}createDispatcher(){return new F.SignalDispatcher}}}),N=m(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.SignalHandlingBase=void 0,t.SignalHandlingBase=class extends S.HandlingBase{constructor(){super(new U.SignalList)}}}),G=m(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.SignalList=t.SignalHandlingBase=t.SignalDispatcher=void 0,Object.defineProperty(t,"SignalDispatcher",{enumerable:!0,get:function(){return F.SignalDispatcher}}),Object.defineProperty(t,"SignalHandlingBase",{enumerable:!0,get:function(){return N.SignalHandlingBase}}),Object.defineProperty(t,"SignalList",{enumerable:!0,get:function(){return U.SignalList}})}),V=m(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.PromiseEventDispatcher=void 0,t.PromiseEventDispatcher=class extends S.PromiseDispatcherBase{constructor(){super()}async dispatch(e,t){const i=await this._dispatchAsPromise(!1,this,arguments);if(null==i)throw new S.DispatchError("Got `null` back from dispatch.");return i}dispatchAsync(e,t){this._dispatchAsPromise(!0,this,arguments)}asEvent(){return super.asEvent()}}}),H=m(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.PromiseEventList=void 0,t.PromiseEventList=class extends S.EventListBase{constructor(){super()}createDispatcher(){return new V.PromiseEventDispatcher}}}),X=m(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.PromiseEventHandlingBase=void 0,t.PromiseEventHandlingBase=class extends S.HandlingBase{constructor(){super(new H.PromiseEventList)}}}),W=m(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.NonUniformPromiseEventList=void 0,t.NonUniformPromiseEventList=class{constructor(){this._events={}}get(e){if(this._events[e])return this._events[e];const t=this.createDispatcher();return this._events[e]=t,t}remove(e){delete this._events[e]}createDispatcher(){return new V.PromiseEventDispatcher}}}),Y=m(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.NonUniformPromiseEventList=t.PromiseEventList=t.PromiseEventHandlingBase=t.PromiseEventDispatcher=void 0,Object.defineProperty(t,"PromiseEventDispatcher",{enumerable:!0,get:function(){return V.PromiseEventDispatcher}}),Object.defineProperty(t,"PromiseEventHandlingBase",{enumerable:!0,get:function(){return X.PromiseEventHandlingBase}}),Object.defineProperty(t,"PromiseEventList",{enumerable:!0,get:function(){return H.PromiseEventList}}),Object.defineProperty(t,"NonUniformPromiseEventList",{enumerable:!0,get:function(){return W.NonUniformPromiseEventList}})}),K=m(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.PromiseSignalDispatcher=void 0,t.PromiseSignalDispatcher=class extends S.PromiseDispatcherBase{constructor(){super()}async dispatch(){const e=await this._dispatchAsPromise(!1,this,arguments);if(null==e)throw new S.DispatchError("Got `null` back from dispatch.");return e}dispatchAsync(){this._dispatchAsPromise(!0,this,arguments)}asEvent(){return super.asEvent()}}}),z=m(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.PromiseSignalList=void 0,t.PromiseSignalList=class extends S.EventListBase{constructor(){super()}createDispatcher(){return new K.PromiseSignalDispatcher}}}),q=m(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.PromiseSignalHandlingBase=void 0,t.PromiseSignalHandlingBase=class extends S.HandlingBase{constructor(){super(new z.PromiseSignalList)}}}),Z=m(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.PromiseSignalList=t.PromiseSignalHandlingBase=t.PromiseSignalDispatcher=void 0,Object.defineProperty(t,"PromiseSignalDispatcher",{enumerable:!0,get:function(){return K.PromiseSignalDispatcher}}),Object.defineProperty(t,"PromiseSignalHandlingBase",{enumerable:!0,get:function(){return q.PromiseSignalHandlingBase}}),Object.defineProperty(t,"PromiseSignalList",{enumerable:!0,get:function(){return z.PromiseSignalList}})}),Q=m(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.PromiseSimpleEventDispatcher=void 0,t.PromiseSimpleEventDispatcher=class extends S.PromiseDispatcherBase{constructor(){super()}async dispatch(e){const t=await this._dispatchAsPromise(!1,this,arguments);if(null==t)throw new S.DispatchError("Got `null` back from dispatch.");return t}dispatchAsync(e){this._dispatchAsPromise(!0,this,arguments)}asEvent(){return super.asEvent()}}}),J=m(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.NonUniformPromiseSimpleEventList=void 0,t.NonUniformPromiseSimpleEventList=class{constructor(){this._events={}}get(e){if(this._events[e])return this._events[e];const t=this.createDispatcher();return this._events[e]=t,t}remove(e){delete this._events[e]}createDispatcher(){return new Q.PromiseSimpleEventDispatcher}}}),$=m(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.PromiseSimpleEventList=void 0,t.PromiseSimpleEventList=class extends S.EventListBase{constructor(){super()}createDispatcher(){return new Q.PromiseSimpleEventDispatcher}}}),ee=m(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.PromiseSimpleEventHandlingBase=void 0,t.PromiseSimpleEventHandlingBase=class extends S.HandlingBase{constructor(){super(new $.PromiseSimpleEventList)}}}),te=m(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.NonUniformPromiseSimpleEventList=t.PromiseSimpleEventList=t.PromiseSimpleEventHandlingBase=t.PromiseSimpleEventDispatcher=void 0,Object.defineProperty(t,"NonUniformPromiseSimpleEventList",{enumerable:!0,get:function(){return J.NonUniformPromiseSimpleEventList}}),Object.defineProperty(t,"PromiseSimpleEventDispatcher",{enumerable:!0,get:function(){return Q.PromiseSimpleEventDispatcher}}),Object.defineProperty(t,"PromiseSimpleEventHandlingBase",{enumerable:!0,get:function(){return ee.PromiseSimpleEventHandlingBase}}),Object.defineProperty(t,"PromiseSimpleEventList",{enumerable:!0,get:function(){return $.PromiseSimpleEventList}})}),ie=m(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.NonUniformPromiseSimpleEventList=t.PromiseSimpleEventList=t.PromiseSimpleEventHandlingBase=t.PromiseSimpleEventDispatcher=t.PromiseSignalList=t.PromiseSignalHandlingBase=t.PromiseSignalDispatcher=t.NonUniformPromiseEventList=t.PromiseEventList=t.PromiseEventHandlingBase=t.PromiseEventDispatcher=t.SignalList=t.SignalHandlingBase=t.SignalDispatcher=t.NonUniformSimpleEventList=t.SimpleEventList=t.SimpleEventHandlingBase=t.SimpleEventDispatcher=t.NonUniformEventList=t.EventList=t.EventHandlingBase=t.EventDispatcher=t.HandlingBase=t.PromiseDispatcherBase=t.PromiseSubscription=t.DispatchError=t.EventManagement=t.EventListBase=t.DispatcherWrapper=t.DispatcherBase=t.Subscription=void 0,Object.defineProperty(t,"Subscription",{enumerable:!0,get:function(){return S.Subscription}}),Object.defineProperty(t,"DispatcherBase",{enumerable:!0,get:function(){return S.DispatcherBase}}),Object.defineProperty(t,"DispatcherWrapper",{enumerable:!0,get:function(){return S.DispatcherWrapper}}),Object.defineProperty(t,"EventListBase",{enumerable:!0,get:function(){return S.EventListBase}}),Object.defineProperty(t,"EventManagement",{enumerable:!0,get:function(){return S.EventManagement}}),Object.defineProperty(t,"DispatchError",{enumerable:!0,get:function(){return S.DispatchError}}),Object.defineProperty(t,"PromiseSubscription",{enumerable:!0,get:function(){return S.PromiseSubscription}}),Object.defineProperty(t,"PromiseDispatcherBase",{enumerable:!0,get:function(){return S.PromiseDispatcherBase}}),Object.defineProperty(t,"HandlingBase",{enumerable:!0,get:function(){return S.HandlingBase}}),Object.defineProperty(t,"EventDispatcher",{enumerable:!0,get:function(){return D.EventDispatcher}}),Object.defineProperty(t,"EventHandlingBase",{enumerable:!0,get:function(){return D.EventHandlingBase}}),Object.defineProperty(t,"EventList",{enumerable:!0,get:function(){return D.EventList}}),Object.defineProperty(t,"NonUniformEventList",{enumerable:!0,get:function(){return D.NonUniformEventList}}),Object.defineProperty(t,"SimpleEventDispatcher",{enumerable:!0,get:function(){return L.SimpleEventDispatcher}}),Object.defineProperty(t,"SimpleEventHandlingBase",{enumerable:!0,get:function(){return L.SimpleEventHandlingBase}}),Object.defineProperty(t,"SimpleEventList",{enumerable:!0,get:function(){return L.SimpleEventList}}),Object.defineProperty(t,"NonUniformSimpleEventList",{enumerable:!0,get:function(){return L.NonUniformSimpleEventList}}),Object.defineProperty(t,"SignalDispatcher",{enumerable:!0,get:function(){return G.SignalDispatcher}}),Object.defineProperty(t,"SignalHandlingBase",{enumerable:!0,get:function(){return G.SignalHandlingBase}}),Object.defineProperty(t,"SignalList",{enumerable:!0,get:function(){return G.SignalList}}),Object.defineProperty(t,"PromiseEventDispatcher",{enumerable:!0,get:function(){return Y.PromiseEventDispatcher}}),Object.defineProperty(t,"PromiseEventHandlingBase",{enumerable:!0,get:function(){return Y.PromiseEventHandlingBase}}),Object.defineProperty(t,"PromiseEventList",{enumerable:!0,get:function(){return Y.PromiseEventList}}),Object.defineProperty(t,"NonUniformPromiseEventList",{enumerable:!0,get:function(){return Y.NonUniformPromiseEventList}}),Object.defineProperty(t,"PromiseSignalDispatcher",{enumerable:!0,get:function(){return Z.PromiseSignalDispatcher}}),Object.defineProperty(t,"PromiseSignalHandlingBase",{enumerable:!0,get:function(){return Z.PromiseSignalHandlingBase}}),Object.defineProperty(t,"PromiseSignalList",{enumerable:!0,get:function(){return Z.PromiseSignalList}}),Object.defineProperty(t,"PromiseSimpleEventDispatcher",{enumerable:!0,get:function(){return te.PromiseSimpleEventDispatcher}}),Object.defineProperty(t,"PromiseSimpleEventHandlingBase",{enumerable:!0,get:function(){return te.PromiseSimpleEventHandlingBase}}),Object.defineProperty(t,"PromiseSimpleEventList",{enumerable:!0,get:function(){return te.PromiseSimpleEventList}}),Object.defineProperty(t,"NonUniformPromiseSimpleEventList",{enumerable:!0,get:function(){return te.NonUniformPromiseSimpleEventList}})}),re=function(){for(var e=[],t=0;t<256;t++)e[t]=(t<16?"0":"")+t.toString(16);return function(){var t=4294967295*Math.random()|0,i=4294967295*Math.random()|0,r=4294967295*Math.random()|0,n=4294967295*Math.random()|0;return e[255&t]+e[t>>8&255]+e[t>>16&255]+e[t>>24&255]+"-"+e[255&i]+e[i>>8&255]+"-"+e[i>>16&15|64]+e[i>>24&255]+"-"+e[63&r|128]+e[r>>8&255]+"-"+e[r>>16&255]+e[r>>24&255]+e[255&n]+e[n>>8&255]+e[n>>16&255]+e[n>>24&255]}}(),ne=/*#__PURE__*/f("owner"),oe=/*#__PURE__*/f("ownedComponents"),se=/*#__PURE__*/f("prefixMessageWithID"),ae=/*#__PURE__*/f("own"),ce=/*#__PURE__*/function(){function e(e,t){void 0===t&&(t={}),Object.defineProperty(this,ae,{value:he}),Object.defineProperty(this,se,{value:le}),this.id=void 0,this.destroyed=void 0,this.dirty=void 0,Object.defineProperty(this,ne,{writable:!0,value:void 0}),Object.defineProperty(this,oe,{writable:!0,value:void 0}),this.onDestroyed=void 0,v(this,ne)[ne]=e,this.id=t.id||re(),this.destroyed=!1,v(this,oe)[oe]=null,this.dirty=!1,this.onDestroyed=new y(new ie.EventDispatcher),e&&v(e,ae)[ae](this)}var t=e.prototype;return t.log=function(e){e="[LOG] "+v(this,se)[se](e),console.log(e)},t.warn=function(e){e="[WARN] "+v(this,se)[se](e),console.warn(e)},t.error=function(e){e="[ERROR] "+v(this,se)[se](e),console.error(e)},t.setDirty=function(){this.dirty||(this.dirty=!0)},t.cleanIfDirty=function(){this.dirty&&(this.dirty=!1,this.clean())},t.clean=function(){},t.destroy=function(){if(!this.destroyed){if(this.destroyed=!0,v(this,oe)[oe])for(var e in v(this,oe)[oe])v(this,oe)[oe].hasOwnProperty(e)&&(v(this,oe)[oe][e].destroy(),delete v(this,oe)[oe][e]);v(this,oe)[oe]=null,this.dirty=!1,this.onDestroyed.dispatch(this,null),this.onDestroyed.clear()}},e}();function le(e){return" ["+this.constructor.name+' "'+this.id+'"]: '+e}function he(e){var t=this;v(this,oe)[oe]||(v(this,oe)[oe]={}),v(this,oe)[oe][e.id]||(v(this,oe)[oe][e.id]=e),e.onDestroyed.one(function(){delete v(t,oe)[oe][e.id]})}var ue=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}return n(t,e),t}(/*#__PURE__*/c(Error)),de={__proto__:null,Component:ce,SDKError:ue,EventEmitter:y},fe=1e3,ve=1003,pe=1006,ye=1007,me=1008,ge=1009,be=1023,we=33776,Pe=33777,Ee=33778,Te=33779,_e=35840,Ie=35841,xe=35842,Se=35843,Me=36196,Oe=37492,Re=37496,je=37808,De=37809,Ae=37810,Ce=37811,Be=37812,ke=37813,Le=37814,Fe=37815,Ue=37816,Ne=37817,Ge=37818,Ve=37819,He=37820,Xe=37821,We=36492,Ye=3e3,Ke=3001,ze=2e4,qe=20001,Ze=20002,Qe=20003,Je=20004,$e=3e4,et=4e5,tt=5e5,it=500001,rt=500002,nt=500003,ot={__proto__:null,RepeatWrapping:fe,ClampToEdgeWrapping:1001,MirroredRepeatWrapping:1002,NearestFilter:ve,NearestMipMapNearestFilter:1004,NearestMipmapNearestFilter:1004,NearestMipmapLinearFilter:1005,NearestMipMapLinearFilter:1005,LinearFilter:pe,LinearMipmapNearestFilter:1007,LinearMipMapNearestFilter:ye,LinearMipmapLinearFilter:me,LinearMipMapLinearFilter:1008,UnsignedByteType:ge,ByteType:1010,ShortType:1011,UnsignedShortType:1012,IntType:1013,UnsignedIntType:1014,FloatType:1015,HalfFloatType:1016,UnsignedShort4444Type:1017,UnsignedShort5551Type:1018,UnsignedInt248Type:1020,AlphaFormat:1021,RGBFormat:1022,RGBAFormat:be,LuminanceFormat:1024,LuminanceAlphaFormat:1025,DepthFormat:1026,DepthStencilFormat:1027,RedFormat:1028,RedIntegerFormat:1029,RGFormat:1030,RGIntegerFormat:1031,RGBAIntegerFormat:1033,RGB_S3TC_DXT1_Format:we,RGBA_S3TC_DXT1_Format:Pe,RGBA_S3TC_DXT3_Format:Ee,RGBA_S3TC_DXT5_Format:Te,RGB_PVRTC_4BPPV1_Format:_e,RGB_PVRTC_2BPPV1_Format:Ie,RGBA_PVRTC_4BPPV1_Format:xe,RGBA_PVRTC_2BPPV1_Format:Se,RGB_ETC1_Format:Me,RGB_ETC2_Format:Oe,RGBA_ETC2_EAC_Format:Re,RGBA_ASTC_4x4_Format:je,RGBA_ASTC_5x4_Format:De,RGBA_ASTC_5x5_Format:Ae,RGBA_ASTC_6x5_Format:Ce,RGBA_ASTC_6x6_Format:Be,RGBA_ASTC_8x5_Format:ke,RGBA_ASTC_8x6_Format:Le,RGBA_ASTC_8x8_Format:Fe,RGBA_ASTC_10x5_Format:Ue,RGBA_ASTC_10x6_Format:Ne,RGBA_ASTC_10x8_Format:Ge,RGBA_ASTC_10x10_Format:Ve,RGBA_ASTC_12x10_Format:He,RGBA_ASTC_12x12_Format:Xe,RGBA_BPTC_Format:We,LinearEncoding:Ye,sRGBEncoding:Ke,GIFMediaType:1e4,JPEGMediaType:10001,PNGMediaType:10002,PointsPrimitive:ze,LinesPrimitive:qe,TrianglesPrimitive:Ze,SolidPrimitive:Qe,SurfacePrimitive:Je,QualityRender:$e,FastRender:300001,MetersUnit:et,CentimetersUnit:400001,MillimetersUnit:400002,YardsUnit:400003,FeetUnit:400004,InchesUnit:400005,PerspectiveProjectionType:tt,OrthoProjectionType:it,FrustumProjectionType:rt,CustomProjectionType:nt},st=-Number.MAX_SAFE_INTEGER,at=Number.MAX_SAFE_INTEGER,ct=.0174532925;function lt(e,t,i){return Math.max(t,Math.min(i,e))}function ht(e){return new Float64Array(e)}var ut={__proto__:null,MIN_DOUBLE:st,MAX_DOUBLE:at,DEGTORAD:ct,RADTODEG:57.295779513,clamp:lt,newFloatArray:ht},dt=Et(),ft=Pt(),vt=Pt(),pt=Pt(),yt=Pt(),mt=Pt(),gt=Et();function bt(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function wt(e){return new Float64Array(e||2)}function Pt(e){return new Float64Array(e||3)}function Et(e){return new Float64Array(e||4)}function Tt(e,t,i){return i||(i=e),i[0]=e[0]+t[0],i[1]=e[1]+t[1],i[2]=e[2]+t[2],i[3]=e[3]+t[3],i}function _t(e,t,i){return i||(i=e),i[0]=e[0]*t,i[1]=e[1]*t,i[2]=e[2]*t,i[3]=e[3]*t,i}function It(e,t,i){return i||(i=e),i[0]=e[0]*t,i[1]=e[1]*t,i[2]=e[2]*t,i}function xt(e,t,i){return i||(i=e),i[0]=e[0]*t,i[1]=e[1]*t,i}function St(e,t,i){return i||(i=e),i[0]=e[0]+t[0],i[1]=e[1]+t[1],i[2]=e[2]+t[2],i}function Mt(e,t,i){return i||(i=e),i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],i[3]=e[3]-t[3],i}function Ot(e,t,i){return i||(i=e),i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],i}function Rt(e,t,i){return i||(i=e),i[0]=e[0]-t[0],i[1]=e[1]-t[1],i}function jt(){for(var e=[].slice.call(arguments),t=new Float32Array(e[0]),i=1;i<e.length;i++)t[0]+=e[i][0],t[1]+=e[i][1];return t[0]/=e.length,t[1]/=e.length,t}function Dt(e,t,i){return i||(i=t),i[0]=e/t[0],i[1]=e/t[1],i[2]=e/t[2],i}function At(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function Ct(e,t,i){i||(i=e);var r=e[0],n=e[1],o=e[2],s=t[0],a=t[1],c=t[2];return i[0]=n*c-o*a,i[1]=o*s-r*c,i[2]=r*a-n*s,i}function Bt(e){return At(e,e)}function kt(e){return Math.sqrt(Bt(e))}function Lt(e,t){return e[0]*t[0]+e[1]*t[1]}function Ft(e){return bt(e,e)}function Ut(e){return Lt(e,e)}function Nt(e){return Math.sqrt(Ft(e))}var Gt,Vt=(Gt=Pt(),function(e,t){return Nt(Ot(e,t,Gt))});function Ht(e){return Math.sqrt(Ut(e))}function Xt(e,t,i,r,n,o){var s=o||Pt(),a=(e-t)/(i-t);return s[0]=r[0]+a*(n[0]-r[0]),s[1]=r[1]+a*(n[1]-r[1]),s[2]=r[2]+a*(n[2]-r[2]),s}var Wt=function(){var e=wt();return function(t,i){return Ht(Rt(t,i,e))}}();function Yt(e,t){return _t(e,1/kt(e),t)}function Kt(e,t){return It(e,1/Nt(e),t)}var zt=function(){var e=Pt();return function(t,i){return e[0]=t[0],e[1]=t[1],e[2]=t[2],i[0]=Nt(e),e[0]=t[4],e[1]=t[5],e[2]=t[6],i[1]=Nt(e),e[0]=t[8],e[1]=t[9],e[2]=t[10],i[2]=Nt(e),i}}();function qt(e){return Math.round(1e5*e)/1e5}function Zt(e){return new ht(e||9)}function Qt(e){return ht(e||16)}var Jt=Qt(),$t=Qt();function ei(e,t,i,r,n){var o=[],s=[];return o[2]=i,s[2]=r,s[1]=o[2]*Math.tan(e/2),o[1]=-s[1],s[0]=s[1]*t,o[0]=-s[0],ti(o,s,n)}function ti(e,t,i){i||(i=Qt());var r=[e[0],e[1],e[2],0],n=[t[0],t[1],t[2],0];Tt(n,r,Jt),Mt(n,r,$t);var o=2*r[2],s=$t[0],a=$t[1],c=$t[2];return i[0]=o/s,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=o/a,i[6]=0,i[7]=0,i[8]=Jt[0]/s,i[9]=Jt[1]/a,i[10]=-Jt[2]/c,i[11]=-1,i[12]=0,i[13]=0,i[14]=-o*n[2]/c,i[15]=0,i}function ii(e,t,i,r,n,o,s){s||(s=Qt());var a=t-e,c=r-i,l=o-n;return s[0]=2/a,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=2/c,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=-2/l,s[11]=0,s[12]=-(e+t)/a,s[13]=-(r+i)/c,s[14]=-(o+n)/l,s[15]=1,s}function ri(e,t,i,r,n,o,s){s||(s=Qt());var a=t-e,c=r-i,l=o-n;return s[0]=2*n/a,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=2*n/c,s[6]=0,s[7]=0,s[8]=(t+e)/a,s[9]=(r+i)/c,s[10]=-(o+n)/l,s[11]=-1,s[12]=0,s[13]=0,s[14]=-o*n*2/l,s[15]=0,s}function ni(e){return e||(e=Qt()),e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function oi(e){return e||(e=Qt()),e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function si(e,t,i){i||(i=Qt());var r,n,o,s,a,c,l=Yt([t[0],t[1],t[2],0],[]),h=Math.sin(e),u=Math.cos(e),d=1-u,f=l[0],v=l[1],p=l[2];return r=f*v,n=v*p,o=p*f,s=f*h,a=v*h,c=p*h,i[0]=d*f*f+u,i[1]=d*r+c,i[2]=d*o-a,i[3]=0,i[4]=d*r-c,i[5]=d*v*v+u,i[6]=d*n+s,i[7]=0,i[8]=d*o+a,i[9]=d*n-s,i[10]=d*p*p+u,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function ai(e,t,i,r){r||(r=Qt());var n,o,s,a,c,l,h,u,d,f,v=e[0],p=e[1],y=e[2],m=i[0],g=i[1],b=i[2],w=t[0],P=t[1],E=t[2];return v===w&&p===P&&y===E?ni():(n=v-w,o=p-P,s=y-E,a=g*(s*=f=1/Math.sqrt(n*n+o*o+s*s))-b*(o*=f),c=b*(n*=f)-m*s,l=m*o-g*n,(f=Math.sqrt(a*a+c*c+l*l))?(a*=f=1/f,c*=f,l*=f):(a=0,c=0,l=0),h=o*l-s*c,u=s*a-n*l,d=n*c-o*a,(f=Math.sqrt(h*h+u*u+d*d))?(h*=f=1/f,u*=f,d*=f):(h=0,u=0,d=0),r[0]=a,r[1]=h,r[2]=n,r[3]=0,r[4]=c,r[5]=u,r[6]=o,r[7]=0,r[8]=l,r[9]=d,r[10]=s,r[11]=0,r[12]=-(a*v+c*p+l*y),r[13]=-(h*v+u*p+d*y),r[14]=-(n*v+o*p+s*y),r[15]=1,r)}function ci(e,t){t||(t=e);var i=e[0],r=e[1],n=e[2],o=e[3],s=e[4],a=e[5],c=e[6],l=e[7],h=e[8],u=e[9],d=e[10],f=e[11],v=e[12],p=e[13],y=e[14],m=e[15],g=i*a-r*s,b=i*c-n*s,w=i*l-o*s,P=r*c-n*a,E=r*l-o*a,T=n*l-o*c,_=h*p-u*v,I=h*y-d*v,x=h*m-f*v,S=u*y-d*p,M=u*m-f*p,O=d*m-f*y,R=1/(g*O-b*M+w*S+P*x-E*I+T*_);return t[0]=(a*O-c*M+l*S)*R,t[1]=(-r*O+n*M-o*S)*R,t[2]=(p*T-y*E+m*P)*R,t[3]=(-u*T+d*E-f*P)*R,t[4]=(-s*O+c*x-l*I)*R,t[5]=(i*O-n*x+o*I)*R,t[6]=(-v*T+y*w-m*b)*R,t[7]=(h*T-d*w+f*b)*R,t[8]=(s*M-a*x+l*_)*R,t[9]=(-i*M+r*x-o*_)*R,t[10]=(v*E-p*w+m*g)*R,t[11]=(-h*E+u*w-f*g)*R,t[12]=(-s*S+a*I-c*_)*R,t[13]=(i*S-r*I+n*_)*R,t[14]=(-v*P+p*b-y*g)*R,t[15]=(h*P-u*b+d*g)*R,t}function li(e,t){var i=e[4],r=e[14],n=e[8],o=e[13],s=e[12],a=e[9];if(!t||e===t){var c=e[1],l=e[2],h=e[3],u=e[6],d=e[7],f=e[11];return e[1]=i,e[2]=n,e[3]=s,e[4]=c,e[6]=a,e[7]=o,e[8]=l,e[9]=u,e[11]=r,e[12]=h,e[13]=d,e[14]=f,e}return t[0]=e[0],t[1]=i,t[2]=n,t[3]=s,t[4]=e[1],t[5]=e[5],t[6]=a,t[7]=o,t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=r,t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15],t}function hi(e,t,i){i||(i=e);var r=t[0],n=t[1],o=t[2],s=t[3];return i[0]=e[0]*r+e[4]*n+e[8]*o+e[12]*s,i[1]=e[1]*r+e[5]*n+e[9]*o+e[13]*s,i[2]=e[2]*r+e[6]*n+e[10]*o+e[14]*s,i[3]=e[3]*r+e[7]*n+e[11]*o+e[15]*s,i}function ui(e,t,i){i||(i=e);var r=e[0],n=e[1],o=e[2],s=e[3],a=e[4],c=e[5],l=e[6],h=e[7],u=e[8],d=e[9],f=e[10],v=e[11],p=e[12],y=e[13],m=e[14],g=e[15],b=t[0],w=t[1],P=t[2],E=t[3],T=t[4],_=t[5],I=t[6],x=t[7],S=t[8],M=t[9],O=t[10],R=t[11],j=t[12],D=t[13],A=t[14],C=t[15];return i[0]=b*r+w*a+P*u+E*p,i[1]=b*n+w*c+P*d+E*y,i[2]=b*o+w*l+P*f+E*m,i[3]=b*s+w*h+P*v+E*g,i[4]=T*r+_*a+I*u+x*p,i[5]=T*n+_*c+I*d+x*y,i[6]=T*o+_*l+I*f+x*m,i[7]=T*s+_*h+I*v+x*g,i[8]=S*r+M*a+O*u+R*p,i[9]=S*n+M*c+O*d+R*y,i[10]=S*o+M*l+O*f+R*m,i[11]=S*s+M*h+O*v+R*g,i[12]=j*r+D*a+A*u+C*p,i[13]=j*n+D*c+A*d+C*y,i[14]=j*o+D*l+A*f+C*m,i[15]=j*s+D*h+A*v+C*g,i}function di(e,t,i){void 0===i&&(i=ht(9));var r=e[0],n=e[3],o=e[6],s=e[1],a=e[4],c=e[7],l=e[2],h=e[5],u=e[8],d=t[0],f=t[3],v=t[6],p=t[1],y=t[4],m=t[7],g=t[2],b=t[5],w=t[8];return i[0]=r*d+n*p+o*g,i[3]=r*f+n*y+o*b,i[6]=r*v+n*m+o*w,i[1]=s*d+a*p+c*g,i[4]=s*f+a*y+c*b,i[7]=s*v+a*m+c*w,i[2]=l*d+h*p+u*g,i[5]=l*f+h*y+u*b,i[8]=l*v+h*m+u*w,i}function fi(e,t,i){i||(i=t);var r=t[0],n=t[1],o=t[2];return i[0]=e[0]*r+e[4]*n+e[8]*o+e[12],i[1]=e[1]*r+e[5]*n+e[9]*o+e[13],i[2]=e[2]*r+e[6]*n+e[10]*o+e[14],i}function vi(e,t,i){return i[0]=e[0]*t[0]+e[4]*t[1]+e[8]*t[2]+e[12]*t[3],i[1]=e[1]*t[0]+e[5]*t[1]+e[9]*t[2]+e[13]*t[3],i[2]=e[2]*t[0]+e[6]*t[1]+e[10]*t[2]+e[14]*t[3],i[3]=e[3]*t[0]+e[7]*t[1]+e[11]*t[2]+e[15]*t[3],i}function pi(e,t,i){var r;i||(i=t);var n,o,s,a=t.length,c=e[0],l=e[1],h=e[2],u=e[3],d=e[4],f=e[5],v=e[6],p=e[7],y=e[8],m=e[9],g=e[10],b=e[11],w=e[12],P=e[13],E=e[14],T=e[15];for(r=0;r<a;r+=3)i[r+0]=c*(n=t[r+0])+d*(o=t[r+1])+y*(s=t[r+2])+w,i[r+1]=l*n+f*o+m*s+P,i[r+2]=h*n+v*o+g*s+E,i[r+3]=u*n+p*o+b*s+T;return i}function yi(e,t,i){var r=t[0],n=t[1],o=t[2];return(i=i||Pt())[0]=e[0]*r+e[4]*n+e[8]*o,i[1]=e[1]*r+e[5]*n+e[9]*o,i[2]=e[2]*r+e[6]*n+e[10]*o,i}function mi(e,t,i){var r=t[0],n=t[1],o=t[2],s=t[3];return(i=i||Et())[0]=e[0]*r+e[4]*n+e[8]*o+e[12]*s,i[1]=e[1]*r+e[5]*n+e[9]*o+e[13]*s,i[2]=e[2]*r+e[6]*n+e[10]*o+e[14]*s,i[3]=e[3]*r+e[7]*n+e[11]*o+e[15]*s,i}function gi(e,t){void 0===t&&(t=ni());var i=e[0],r=e[1],n=e[2];return t[0]*=i,t[4]*=r,t[8]*=n,t[1]*=i,t[5]*=r,t[9]*=n,t[2]*=i,t[6]*=r,t[10]*=n,t[3]*=i,t[7]*=r,t[11]*=n,t}function bi(e,t){return void 0===t&&(t=ni()),t[0]=e[0],t[5]=e[1],t[10]=e[2],t}function wi(e,t){return void 0===t&&(t=oi()),t[0]=e[0],t[4]=e[1],t}var Pi,Ei=(Pi=ht(3),function(e,t,i,r){return Pi[0]=e,Pi[1]=t,Pi[2]=i,bi(Pi,r)});function Ti(e,t,i,r){return void 0===r&&(r=Qt()),Li(t,r),gi(i,r),Ii(e,r),r}var _i=function(){var e=Pt(),t=Qt();return function(i,r,n,o){e[0]=i[0],e[1]=i[1],e[2]=i[2];var s=Nt(e);e[0]=i[4],e[1]=i[5],e[2]=i[6];var a=Nt(e);e[8]=i[8],e[9]=i[9],e[10]=i[10];var c=Nt(e);ji(i)<0&&(s=-s),r[0]=i[12],r[1]=i[13],r[2]=i[14],t.set(i);var l=1/s,h=1/a,u=1/c;t[0]*=l,t[1]*=l,t[2]*=l,t[4]*=h,t[5]*=h,t[6]*=h,t[8]*=u,t[9]*=u,t[10]*=u,ki(t,n),o[0]=s,o[1]=a,o[2]=c}}();function Ii(e,t){return void 0===t&&(t=ni()),xi(e[0],e[1],e[2],t)}function xi(e,t,i,r){void 0===r&&(r=ni());var n=r[3];r[0]+=n*e,r[1]+=n*t,r[2]+=n*i;var o=r[7];r[4]+=o*e,r[5]+=o*t,r[6]+=o*i;var s=r[11];r[8]+=s*e,r[9]+=s*t,r[10]+=s*i;var a=r[15];return r[12]+=a*e,r[13]+=a*t,r[14]+=a*i,r}function Si(e,t,i){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=t[0],i[13]=t[1],i[14]=t[2],i[15]=e[15],i}function Mi(e,t){var i=t||ni();return i[12]=e[0],i[13]=e[1],i[14]=e[2],i}function Oi(e,t){var i=t||oi();return i[6]=e[0],i[7]=e[1],i}var Ri=function(){var e=ht(3);return function(t,i,r,n){return e[0]=t,e[1]=i,e[2]=r,Mi(e,n)}}();function ji(e){var t=e[0],i=e[1],r=e[2],n=e[3],o=e[4],s=e[5],a=e[6],c=e[7],l=e[8],h=e[9],u=e[10],d=e[11],f=e[12],v=e[13],p=e[14],y=e[15];return f*h*a*n-l*v*a*n-f*s*u*n+o*v*u*n+l*s*p*n-o*h*p*n-f*h*r*c+l*v*r*c+f*i*u*c-t*v*u*c-l*i*p*c+t*h*p*c+f*s*r*d-o*v*r*d-f*i*a*d+t*v*a*d+o*i*p*d-t*s*p*d-l*s*r*y+o*h*r*y+l*i*a*y-t*h*a*y-o*i*u*y+t*s*u*y}function Di(e,t,i){void 0===i&&(i=Pt());var r=e[0],n=e[4],o=e[8],s=e[1],a=e[5],c=e[9],l=e[2],h=e[6],u=e[10];return"XYZ"===t?(i[1]=Math.asin(lt(o,-1,1)),Math.abs(o)<.99999?(i[0]=Math.atan2(-c,u),i[2]=Math.atan2(-n,r)):(i[0]=Math.atan2(h,a),i[2]=0)):"YXZ"===t?(i[0]=Math.asin(-lt(c,-1,1)),Math.abs(c)<.99999?(i[1]=Math.atan2(o,u),i[2]=Math.atan2(s,a)):(i[1]=Math.atan2(-l,r),i[2]=0)):"ZXY"===t?(i[0]=Math.asin(lt(h,-1,1)),Math.abs(h)<.99999?(i[1]=Math.atan2(-l,u),i[2]=Math.atan2(-n,a)):(i[1]=0,i[2]=Math.atan2(s,r))):"ZYX"===t?(i[1]=Math.asin(-lt(l,-1,1)),Math.abs(l)<.99999?(i[0]=Math.atan2(h,u),i[2]=Math.atan2(s,r)):(i[0]=0,i[2]=Math.atan2(-n,a))):"YZX"===t?(i[2]=Math.asin(lt(s,-1,1)),Math.abs(s)<.99999?(i[0]=Math.atan2(-c,a),i[1]=Math.atan2(-l,r)):(i[0]=0,i[1]=Math.atan2(o,u))):"XZY"===t&&(i[2]=Math.asin(-lt(n,-1,1)),Math.abs(n)<.99999?(i[0]=Math.atan2(h,a),i[1]=Math.atan2(o,r)):(i[0]=Math.atan2(-c,u),i[1]=0)),i}function Ai(e,t,i,r,n,o){var s=o||Qt(),a=(e-t)/(i-t);return s[0]=r[0]+a*(n[0]-r[0]),s[1]=r[1]+a*(n[1]-r[1]),s[2]=r[2]+a*(n[2]-r[2]),s[3]=r[3]+a*(n[3]-r[3]),s[4]=r[4]+a*(n[4]-r[4]),s[5]=r[5]+a*(n[5]-r[5]),s[6]=r[6]+a*(n[6]-r[6]),s[7]=r[7]+a*(n[7]-r[7]),s[8]=r[8]+a*(n[8]-r[8]),s[9]=r[9]+a*(n[9]-r[9]),s[10]=r[10]+a*(n[10]-r[10]),s[11]=r[11]+a*(n[11]-r[11]),s[12]=r[12]+a*(n[12]-r[12]),s[13]=r[13]+a*(n[13]-r[13]),s[14]=r[14]+a*(n[14]-r[14]),s[15]=r[15]+a*(n[15]-r[15]),s}function Ci(e){return void 0===e&&(e=Et()),e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function Bi(e,t,i){void 0===i&&(i=Et());var r=e[0]*ct/2,n=e[1]*ct/2,o=e[2]*ct/2,s=Math.cos(r),a=Math.cos(n),c=Math.cos(o),l=Math.sin(r),h=Math.sin(n),u=Math.sin(o);return"XYZ"===t?(i[0]=l*a*c+s*h*u,i[1]=s*h*c-l*a*u,i[2]=s*a*u+l*h*c,i[3]=s*a*c-l*h*u):"YXZ"===t?(i[0]=l*a*c+s*h*u,i[1]=s*h*c-l*a*u,i[2]=s*a*u-l*h*c,i[3]=s*a*c+l*h*u):"ZXY"===t?(i[0]=l*a*c-s*h*u,i[1]=s*h*c+l*a*u,i[2]=s*a*u+l*h*c,i[3]=s*a*c-l*h*u):"ZYX"===t?(i[0]=l*a*c-s*h*u,i[1]=s*h*c+l*a*u,i[2]=s*a*u-l*h*c,i[3]=s*a*c+l*h*u):"YZX"===t?(i[0]=l*a*c+s*h*u,i[1]=s*h*c+l*a*u,i[2]=s*a*u-l*h*c,i[3]=s*a*c-l*h*u):"XZY"===t&&(i[0]=l*a*c-s*h*u,i[1]=s*h*c-l*a*u,i[2]=s*a*u+l*h*c,i[3]=s*a*c+l*h*u),i}function ki(e,t){void 0===t&&(t=Et());var i,r=e[0],n=e[4],o=e[8],s=e[1],a=e[5],c=e[9],l=e[2],h=e[6],u=e[10],d=r+a+u;return d>0?(i=.5/Math.sqrt(d+1),t[3]=.25/i,t[0]=(h-c)*i,t[1]=(o-l)*i,t[2]=(s-n)*i):r>a&&r>u?(i=2*Math.sqrt(1+r-a-u),t[3]=(h-c)/i,t[0]=.25*i,t[1]=(n+s)/i,t[2]=(o+l)/i):a>u?(i=2*Math.sqrt(1+a-r-u),t[3]=(o-l)/i,t[0]=(n+s)/i,t[1]=.25*i,t[2]=(c+h)/i):(i=2*Math.sqrt(1+u-r-a),t[3]=(s-n)/i,t[0]=(o+l)/i,t[1]=(c+h)/i,t[2]=.25*i),t}function Li(e,t){var i=e[0],r=e[1],n=e[2],o=e[3],s=i+i,a=r+r,c=n+n,l=i*s,h=i*a,u=i*c,d=r*a,f=r*c,v=n*c,p=o*s,y=o*a,m=o*c;return t[0]=1-(d+v),t[4]=h-m,t[8]=u+y,t[1]=h+m,t[5]=1-(l+v),t[9]=f-p,t[2]=u-y,t[6]=f+p,t[10]=1-(l+d),t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Fi(e,t){void 0===t&&(t=e);var i=kt([e[0],e[1],e[2],e[3]]);return t[0]=e[0]/i,t[1]=e[1]/i,t[2]=e[2]/i,t[3]=e[3]/i,t}function Ui(e,t){return void 0===t&&(t=e),t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}var Ni={__proto__:null,dotVec3:bt,createVec2:wt,createVec3:Pt,createVec4:Et,negateVec3:function(e,t){return t||(t=e),t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},negateVec4:function(e,t){return t||(t=e),t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},addVec4:Tt,addVec4Scalar:function(e,t,i){return i||(i=e),i[0]=e[0]+t,i[1]=e[1]+t,i[2]=e[2]+t,i[3]=e[3]+t,i},mulVec4Scalar:_t,mulVec3Scalar:It,mulVec2Scalar:xt,addVec3:St,addVec3Scalar:function(e,t,i){return i||(i=e),i[0]=e[0]+t,i[1]=e[1]+t,i[2]=e[2]+t,i},subVec4:Mt,compareVec3:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]},subVec3:Ot,subVec2:Rt,geometricMeanVec2:jt,subVec4Scalar:function(e,t,i){return i||(i=e),i[0]=e[0]-t,i[1]=e[1]-t,i[2]=e[2]-t,i[3]=e[3]-t,i},subScalarVec4:function(e,t,i){return i||(i=e),i[0]=t-e[0],i[1]=t-e[1],i[2]=t-e[2],i[3]=t-e[3],i},mulVec4:function(e,t,i){return i||(i=e),i[0]=e[0]*t[0],i[1]=e[1]*t[1],i[2]=e[2]*t[2],i[3]=e[3]*t[3],i},divVec3:function(e,t,i){return i||(i=e),i[0]=e[0]/t[0],i[1]=e[1]/t[1],i[2]=e[2]/t[2],i},divVec4:function(e,t,i){return i||(i=e),i[0]=e[0]/t[0],i[1]=e[1]/t[1],i[2]=e[2]/t[2],i[3]=e[3]/t[3],i},divScalarVec3:Dt,divVec3Scalar:function(e,t,i){return i||(i=e),i[0]=e[0]/t,i[1]=e[1]/t,i[2]=e[2]/t,i},divVec4Scalar:function(e,t,i){return i||(i=e),i[0]=e[0]/t,i[1]=e[1]/t,i[2]=e[2]/t,i[3]=e[3]/t,i},divScalarVec4:function(e,t,i){return i||(i=t),i[0]=e/t[0],i[1]=e/t[1],i[2]=e/t[2],i[3]=e/t[3],i},dotVec4:At,cross3Vec4:function(e,t){var i=e[0],r=e[1],n=e[2],o=t[0],s=t[1],a=t[2];return[r*a-n*s,n*o-i*a,i*s-r*o,0]},cross3Vec3:Ct,sqLenVec4:Bt,lenVec4:kt,dotVec2:Lt,sqLenVec3:Ft,sqLenVec2:Ut,lenVec3:Nt,distVec3:Vt,lenVec2:Ht,lerpVec3:Xt,distVec2:Wt,rcpVec3:function(e,t){return Dt(1,e,t)},normalizeVec4:Yt,normalizeVec3:Kt,normalizeVec2:function(e,t){return xt(e,1/Ht(e),t)},angleVec3:function(e,t){var i=bt(e,t)/Math.sqrt(Ft(e)*Ft(t));return i=i<-1?-1:i>1?1:i,Math.acos(i)},vec3FromMat4Scale:zt,vecToArray:function(e){for(var t=0,i=(e=Array.prototype.slice.call(e)).length;t<i;t++)e[t]=qt(e[t]);return e},triangleNormal:function(e,t,i,r){void 0===r&&(r=Pt());var n=t[0]-e[0],o=t[1]-e[1],s=t[2]-e[2],a=i[0]-e[0],c=i[1]-e[1],l=i[2]-e[2],h=o*l-s*c,u=s*a-n*l,d=n*c-o*a,f=Math.sqrt(h*h+u*u+d*d);return 0===f?(r[0]=0,r[1]=0,r[2]=0):(r[0]=h/f,r[1]=u/f,r[2]=d/f),r},createMat3:Zt,createMat4:Qt,compareMat4:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]},perspectiveMat4:ei,frustumMat4v:ti,orthoMat4c:ii,frustumMat4:ri,identityMat4:ni,identityMat3:oi,isIdentityMat4:function(e){return 1===e[0]&&0===e[1]&&0===e[2]&&0===e[3]&&0===e[4]&&1===e[5]&&0===e[6]&&0===e[7]&&0===e[8]&&0===e[9]&&1===e[10]&&0===e[11]&&0===e[12]&&0===e[13]&&0===e[14]&&1===e[15]},rotationMat4v:si,lookAtMat4v:ai,inverseMat4:ci,transposeMat4:li,mulMat4v4:hi,mulMat4:ui,mulMat3:di,transformPoint3:fi,transformPoint4:vi,transformPoints3:function(e,t,i){for(var r,n,o,s,a,c=i||[],l=t.length,h=e[0],u=e[1],d=e[2],f=e[3],v=e[4],p=e[5],y=e[6],m=e[7],g=e[8],b=e[9],w=e[10],P=e[11],E=e[12],T=e[13],_=e[14],I=e[15],x=0;x<l;++x)r=(s=t[x])[0],n=s[1],o=s[2],(a=c[x]||(c[x]=[0,0,0]))[0]=h*r+v*n+g*o+E,a[1]=u*r+p*n+b*o+T,a[2]=d*r+y*n+w*o+_,a[3]=f*r+m*n+P*o+I;return c.length=l,c},transformPositions3:pi,transformPositions4:function(e,t,i){var r;i||(i=t);var n,o,s,a=t.length,c=e[0],l=e[1],h=e[2],u=e[3],d=e[4],f=e[5],v=e[6],p=e[7],y=e[8],m=e[9],g=e[10],b=e[11],w=e[12],P=e[13],E=e[14],T=e[15];for(r=0;r<a;r+=4)i[r+0]=c*(n=t[r+0])+d*(o=t[r+1])+y*(s=t[r+2])+w,i[r+1]=l*n+f*o+m*s+P,i[r+2]=h*n+v*o+g*s+E,i[r+3]=u*n+p*o+b*s+T;return i},transformVec3:yi,transformVec4:mi,scaleMat4v:gi,scalingMat4v:bi,scalingMat3v:wi,scalingMat4c:Ei,scaleMat4c:function(e,t,i,r){return r[0]*=e,r[4]*=t,r[8]*=i,r[1]*=e,r[5]*=t,r[9]*=i,r[2]*=e,r[6]*=t,r[10]*=i,r[3]*=e,r[7]*=t,r[11]*=i,r},scalingMat4s:function(e){return Ei(e,e,e)},composeMat4:Ti,decomposeMat4:_i,translateMat4v:Ii,translateMat4c:xi,setMat4Translation:Si,translationMat4v:Mi,translationMat3v:Oi,translationMat4c:Ri,translationMat4s:function(e,t){return Ri(e,e,e,t)},determinantMat4:ji,mat4ToEuler:Di,lerpMat4:Ai,identityQuat:Ci,eulerToQuat:Bi,mat4ToQuat:ki,vec3PairToQuat:function(e,t,i){void 0===i&&(i=Et());var r=Math.sqrt(bt(e,e)*bt(t,t)),n=r+bt(e,t);return n<1e-8*r?(n=0,Math.abs(e[0])>Math.abs(e[2])?(i[0]=-e[1],i[1]=e[0],i[2]=0):(i[0]=0,i[1]=-e[2],i[2]=e[1])):Ct(e,t,i),i[3]=n,Fi(i)},angleAxisToQuaternion:function(e,t){void 0===t&&(t=Et());var i=e[3]/2,r=Math.sin(i);return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=Math.cos(i),t},quatToEuler:function(e,t,i){return void 0===i&&(i=Pt()),Li(e,Jt),Di(Jt,t,i),i},mulQuats:function(e,t,i){void 0===i&&(i=Et());var r=e[0],n=e[1],o=e[2],s=e[3],a=t[0],c=t[1],l=t[2],h=t[3];return i[0]=s*a+r*h+n*l-o*c,i[1]=s*c+n*h+o*a-r*l,i[2]=s*l+o*h+r*c-n*a,i[3]=s*h-r*a-n*c-o*l,i},vec3ApplyQuat:function(e,t,i){void 0===i&&(i=Pt());var r=t[0],n=t[1],o=t[2],s=e[0],a=e[1],c=e[2],l=e[3],h=l*r+a*o-c*n,u=l*n+c*r-s*o,d=l*o+s*n-a*r,f=-s*r-a*n-c*o;return i[0]=h*l+f*-s+u*-c-d*-a,i[1]=u*l+f*-a+d*-s-h*-c,i[2]=d*l+f*-c+h*-a-u*-s,i},quatToMat4:function(e,t){t=ni(t);var i=e[0],r=e[1],n=e[2],o=e[3],s=2*i,a=2*r,c=2*n,l=s*o,h=a*o,u=c*o,d=s*i,f=a*i,v=c*i,p=a*r,y=c*r,m=c*n;return t[0]=1-(p+m),t[1]=f+u,t[2]=v-h,t[4]=f-u,t[5]=1-(d+m),t[6]=y+l,t[8]=v+h,t[9]=y-l,t[10]=1-(d+p),t},quatToRotationMat4:Li,normalizeQuat:Fi,conjugateQuat:Ui,inverseQuat:function(e,t){return Fi(Ui(e,t))},quatToAngleAxis:function(e,t){void 0===t&&(t=Et());var i=(e=Fi(e,dt))[3],r=2*Math.acos(i),n=Math.sqrt(1-i*i);return n<.001?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=e[0]/n,t[1]=e[1]/n,t[2]=e[2]/n),t[3]=r,t},rayTriangleIntersect:function(e,t,i,r,n,o){o=o||Pt();var s=Ot(r,i,ft),a=Ot(n,i,vt),c=Ct(t,a,pt),l=bt(s,c);if(l<1e-6)return null;var h=Ot(e,i,yt),u=bt(h,c);if(u<0||u>l)return null;var d=Ct(h,s,mt),f=bt(t,d);if(f<0||u+f>l)return null;var v=bt(a,d)/l;return o[0]=e[0]+v*t[0],o[1]=e[1]+v*t[1],o[2]=e[2]+v*t[2],o},transformRay:function(e,t,i,r,n){dt[0]=t[0],dt[1]=t[1],dt[2]=t[2],dt[3]=1,mi(e,dt,gt),r[0]=gt[0],r[1]=gt[1],r[2]=gt[2],dt[0]=i[0],dt[1]=i[1],dt[2]=i[2],yi(e,dt,gt),Kt(gt),n[0]=gt[0],n[1]=gt[1],n[2]=gt[2]}},Gi=/*#__PURE__*/f("items"),Vi=/*#__PURE__*/f("lastUniqueId"),Hi=/*#__PURE__*/function(){function e(e,t){Object.defineProperty(this,Gi,{writable:!0,value:void 0}),Object.defineProperty(this,Vi,{writable:!0,value:void 0}),v(this,Gi)[Gi]=e||[],v(this,Vi)[Vi]=(t||0)+1}var t=e.prototype;return t.addItem=function(){var e;if(2===arguments.length){var t=arguments[0];if(e=arguments[1],v(this,Gi)[Gi][t])throw"ID clash: '"+t+"'";return v(this,Gi)[Gi][t]=e,t}for(e=arguments[0]||{};;){var i=v(this,Vi)[Vi]++;if(!v(this,Gi)[Gi][i])return v(this,Gi)[Gi][i]=e,i}},t.removeItem=function(e){var t=v(this,Gi)[Gi][e];return delete v(this,Gi)[Gi][e],t},e}(),Xi=/*#__PURE__*/function(){function e(){this._head=void 0,this._headLength=void 0,this._tail=void 0,this._index=void 0,this._length=void 0,this._head=[],this._headLength=0,this._tail=[],this._index=0,this._length=0}var t=e.prototype;return t.shift=function(){if(this._index>=this._headLength){var e=this._head;if(e.length=0,this._head=this._tail,this._tail=e,this._index=0,this._headLength=this._head.length,!this._headLength)return}var t=this._head[this._index];return this._index<0?delete this._head[this._index++]:this._head[this._index++]=void 0,this._length--,t},t.push=function(e){return this._length++,this._tail.push(e),this},t.unshift=function(e){return this._head[--this._index]=e,this._length++,this},t.clear=function(){this._head=[],this._headLength=0,this._tail=[],this._index=0,this._length=0},r(e,[{key:"length",get:function(){return this._length}}]),e}(),Wi=/*#__PURE__*/function(){function e(e,t,i){this.isLoading=void 0,this.itemsLoaded=void 0,this.itemsTotal=void 0,this.urlModifier=void 0,this.handlers=void 0,this.onStart=void 0,this.onLoad=void 0,this.onProgress=void 0,this.onError=void 0,this.isLoading=!1,this.itemsLoaded=0,this.itemsTotal=0,this.urlModifier=void 0,this.handlers=[],this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i}var t=e.prototype;return t.itemStart=function(e){this.itemsTotal++,this.isLoading||void 0!==this.onStart&&this.onStart(e,this.itemsLoaded,this.itemsTotal),this.isLoading=!0},t.itemEnd=function(e){this.itemsLoaded++,void 0!==this.onProgress&&this.onProgress(e,this.itemsLoaded,this.itemsTotal),this.itemsLoaded===this.itemsTotal&&(this.isLoading=!1,void 0!==this.onLoad&&this.onLoad())},t.itemError=function(e){void 0!==this.onError&&this.onError(e)},t.resolveURL=function(e){return this.urlModifier?this.urlModifier(e):e},t.setURLModifier=function(e){return this.urlModifier=e,this},t.addHandler=function(e,t){return this.handlers.push(e,t),this},t.removeHandler=function(e){var t=this.handlers.indexOf(e);return-1!==t&&this.handlers.splice(t,2),this},t.getHandler=function(e){for(var t=0,i=this.handlers.length;t<i;t+=2){var r=this.handlers[t],n=this.handlers[t+1];if(r.global&&(r.lastIndex=0),r.test(e))return n}return null},e}(),Yi=new Wi,Ki=/*#__PURE__*/function(){function e(e){this.manager=void 0,this.crossOrigin=void 0,this.withCredentials=void 0,this.path=void 0,this.resourcePath=void 0,this.requestHeader=void 0,this.manager=void 0!==e?e:Yi,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}var t=e.prototype;return t.load=function(e,t,i,r){},t.loadAsync=function(e,t){var i=this;return new Promise(function(r,n){i.load(e,r,t,n)})},t.parse=function(){},t.setCrossOrigin=function(e){return this.crossOrigin=e,this},t.setWithCredentials=function(e){return this.withCredentials=e,this},t.setPath=function(e){return this.path=e,this},t.setResourcePath=function(e){return this.resourcePath=e,this},t.setRequestHeader=function(e){return this.requestHeader=e,this},e}(),zi=/*#__PURE__*/function(){function e(e){void 0===e&&(e=4),this.pool=void 0,this.queue=void 0,this.workers=void 0,this.workersResolve=void 0,this.workerStatus=void 0,this.workerCreator=void 0,this.pool=e,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}var t=e.prototype;return t._initWorker=function(e){if(!this.workers[e]){var t=this.workerCreator();t.addEventListener("message",this._onMessage.bind(this,e)),this.workers[e]=t}},t._getIdleWorker=function(){for(var e=0;e<this.pool;e++)if(!(this.workerStatus&1<<e))return e;return-1},t._onMessage=function(e,t){var i=this.workersResolve[e];if(i&&i(t),this.queue.length){var r=this.queue.shift(),n=r.msg,o=r.transfer;this.workersResolve[e]=r.resolve,this.workers[e].postMessage(n,o)}else this.workerStatus^=1<<e},t.setWorkerCreator=function(e){this.workerCreator=e},t.setWorkerLimit=function(e){this.pool=e},t.postMessage=function(e,t){var i=this;return new Promise(function(r){var n=i._getIdleWorker();-1!==n?(i._initWorker(n),i.workerStatus|=1<<n,i.workersResolve[n]=r,i.workers[n].postMessage(e,t)):i.queue.push({resolve:r,msg:e,transfer:t})})},t.destroy=function(){this.workers.forEach(function(e){return e.terminate()}),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0},e}(),qi={enabled:!1,files:{},add:function(e,t){},get:function(e){},remove:function(e){},clear:function(){this.files={}}},Zi={},Qi=/*#__PURE__*/function(e){function t(t){var i;return(i=e.call(this,t)||this).mimeType=void 0,i.responseType=void 0,i}n(t,e);var i=t.prototype;return i.load=function(e,t,i,r){var n=this;void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var o=qi.get(e);if(void 0!==o)return this.manager.itemStart(e),setTimeout(function(){t&&t(o),n.manager.itemEnd(e)},0),o;if(void 0===Zi[e]){Zi[e]=[],Zi[e].push({onLoad:t,onProgress:i,onError:r});var s=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),a=this.mimeType,c=this.responseType;fetch(s).then(function(t){if(200===t.status||0===t.status){if(0===t.status&&console.warn("FileLoader: HTTP Status 0 received."),"undefined"==typeof ReadableStream||void 0===t.body.getReader)return t;var i=Zi[e],r=t.body.getReader(),n=t.headers.get("Content-Length"),o=n?parseInt(n):0,s=0!==o,a=0,c=new ReadableStream({start:function(e){!function t(){r.read().then(function(r){var n=r.value;if(r.done)e.close();else{for(var c=new ProgressEvent("progress",{lengthComputable:s,loaded:a+=n.byteLength,total:o}),l=0,h=i.length;l<h;l++){var u=i[l];u.onProgress&&u.onProgress(c)}e.enqueue(n),t()}})}()}});return new Response(c)}throw new Error('fetch for "'+t.url+'" responded with '+t.status+": "+t.statusText)}).then(function(e){switch(c){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"document":return e.text().then(function(e){return(new DOMParser).parseFromString(e,a)});case"json":return e.json();default:if(void 0===a)return e.text();var t=/charset="?([^;"\s]*)"?/i.exec(a),i=t&&t[1]?t[1].toLowerCase():void 0,r=new TextDecoder(i);return e.arrayBuffer().then(function(e){return r.decode(e)})}}).then(function(t){qi.add(e,t);var i=Zi[e];delete Zi[e];for(var r=0,n=i.length;r<n;r++){var o=i[r];o.onLoad&&o.onLoad(t)}}).catch(function(t){var i=Zi[e];if(void 0===i)throw n.manager.itemError(e),t;delete Zi[e];for(var r=0,o=i.length;r<o;r++){var s=i[r];s.onError&&s.onError(t)}n.manager.itemError(e)}).finally(function(){n.manager.itemEnd(e)}),this.manager.itemStart(e)}else Zi[e].push({onLoad:t,onProgress:i,onError:r})},i.setResponseType=function(e){return this.responseType=e,this},i.setMimeType=function(e){return this.mimeType=e,this},t}(Ki),Ji=[["0",10],["A",26],["a",26],["_",1],["$",1]].map(function(e){for(var t=[],i=e[0].charCodeAt(0),r=i+e[1],n=i;n<r;++n)t.push(n);return String.fromCharCode.apply(null,t)}).join("");function $i(e,t){return(t&&4!==t?[0,6]:[0,6,12,18]).map(function(t){return Ji.substr(parseInt(String(e/(1<<t)))%64,1)}).reverse().join("")}function er(e,t,i){var r=function(e){};t=t||r,i=i||r;var n=e.match(/^data:(.*?)(;base64)?,(.*)$/);if(n){var o=!!n[2],s=n[3];s=window.decodeURIComponent(s),o&&(s=window.atob(s));try{for(var a=new ArrayBuffer(s.length),c=new Uint8Array(a),l=0;l<s.length;l++)c[l]=s.charCodeAt(l);window.setTimeout(function(){t(a)},0)}catch(e){window.setTimeout(function(){i(e)},0)}}else{var h=new XMLHttpRequest;h.open("GET",e,!0),h.responseType="arraybuffer",h.onreadystatechange=function(){4===h.readyState&&(200===h.status?t(h.response):i("loadArrayBuffer error : "+h.response))},h.send(null)}}function tr(e){return e&&!e.propertyIsEnumerable("length")&&"object"==typeof e&&"number"==typeof e.length}function ir(e){return"string"==typeof e||e instanceof String}function rr(e){return!isNaN(parseFloat(e))&&isFinite(e)}function nr(e,t){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t}function or(e){return rr(e)?""+e:"'"+e+"'"}var sr=function(){for(var e=[],t=0;t<256;t++)e[t]=(t<16?"0":"")+t.toString(16);return function(){var t=4294967295*Math.random()|0,i=4294967295*Math.random()|0,r=4294967295*Math.random()|0,n=4294967295*Math.random()|0;return e[255&t]+e[t>>8&255]+e[t>>16&255]+e[t>>24&255]+"-"+e[255&i]+e[i>>8&255]+"-"+e[i>>16&15|64]+e[i>>24&255]+"-"+e[63&r|128]+e[r>>8&255]+"-"+e[r>>16&255]+e[r>>24&255]+e[255&n]+e[n>>8&255]+e[n>>16&255]+e[n>>24&255]}}(),ar={__proto__:null,clone:function(e){return JSON.parse(JSON.stringify(e))},b64:$i,compressGuid:function(e){var t=[0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30].map(function(t){return parseInt(e.substr(t,2),16)});return $i(t[0],2)+[1,4,7,10,13].map(function(e){return $i((t[e]<<16)+(t[e+1]<<8)+t[e+2],4)}).join("")},findNodeOfType:function(e,t){var i=[];return function e(r){r.type===t&&i.push(r),(r.children||[]).forEach(function(t){e(t)})}(e),i},timeout:function(e){return new Promise(function(t,i){setTimeout(t,e)})},httpRequest:function(e){return new Promise(function(t,i){var r=new XMLHttpRequest;r.open(e.method||"GET",e.url,!0),r.onload=function(n){console.log(e.url,r.readyState,r.status),4===r.readyState&&(200===r.status?t(r.responseXML):i(r.statusText))},r.send(null)})},loadJSON:function(e,t,i){var r=function(e){};t=t||r,i=i||r;var n=new XMLHttpRequest;n.overrideMimeType("application/json"),n.open("GET",e,!0),n.addEventListener("load",function(e){var r=e.target.response;if(200===this.status){var n;try{n=JSON.parse(r)}catch(e){i("utils.loadJSON(): Failed to parse JSON response - "+e)}t(n)}else if(0===this.status){console.warn("loadFile: HTTP Status 0 received.");try{t(JSON.parse(r))}catch(e){i("utils.loadJSON(): Failed to parse JSON response - "+e)}}else i(e)},!1),n.addEventListener("error",function(e){i(e)},!1),n.send(null)},loadArraybuffer:er,isArray:tr,isString:ir,isNumeric:rr,isID:function(e){return ir(e)||rr(e)},isFunction:function(e){return"function"==typeof e},isObject:function(e){return!!e&&e.constructor==={}.constructor},copy:function(e){return nr(e,{})},apply:nr,apply2:function(e,t){for(var i in e)e.hasOwnProperty(i)&&null!=e[i]&&(t[i]=e[i]);return t},applyIf:function(e,t){for(var i in e)e.hasOwnProperty(i)&&null==t[i]&&(t[i]=e[i]);return t},isEmptyObject:function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0},inQuotes:or,concat:function(e,t){var i=new e.constructor(e.length+t.length);return i.set(e),i.set(t,e.length),i},createUUID:sr,Map:Hi,Queue:Xi,Loader:Ki,DefaultLoadingManager:Yi,LoadingManager:Wi,WorkerPool:zi,Cache:qi,FileLoader:Qi},cr=Qt(),lr=Qt();function hr(e,t,i){return void 0===i&&(i=e),i[0]=e[0]*t[0]+t[12],i[1]=e[1]*t[5]+t[13],i[2]=e[2]*t[10]+t[14],i}function ur(e,t,i){void 0===i&&(i=new Float32Array(e.length));for(var r=0,n=e.length;r<n;r+=3)i[r+0]=e[r+0]*t[0]+t[12],i[r+1]=e[r+1]*t[5]+t[13],i[r+2]=e[r+2]*t[10]+t[14];return i}var dr=function(){var e=Zt(),t=Zt();return function(i,r,n){var o,s=new Uint16Array(i.length),a=new Float32Array([65535/(n[0]-r[0]),65535/(n[1]-r[1])]);for(o=0;o<i.length;o+=2)s[o+0]=Math.floor((i[o+0]-r[0])*a[0]),s[o+1]=Math.floor((i[o+1]-r[1])*a[1]);return oi(e),Oi(r,e),oi(t),wi([(n[0]-r[0])/65535,(n[1]-r[1])/65535],t),{quantized:s,decompressMatrix:di(e,t,oi())}}}();function fr(e,t,i,r){var n=e[t]/(Math.abs(e[t])+Math.abs(e[t+1])+Math.abs(e[t+2])),o=e[t+1]/(Math.abs(e[t])+Math.abs(e[t+1])+Math.abs(e[t+2]));if(e[t+2]<0){var s=(1-Math.abs(o))*(n>=0?1:-1),a=(1-Math.abs(n))*(o>=0?1:-1);n=s,o=a}return new Int8Array([Math[i](127.5*n+(n<0?-1:0)),Math[r](127.5*o+(o<0?-1:0))])}function vr(e,t,i){return e[t]*i[0]+e[t+1]*i[1]+e[t+2]*i[2]}function pr(e,t){void 0===t&&(t=Pt());var i=e[0],r=e[1];i=(2*i+1)/255,r=(2*r+1)/255;var n=1-Math.abs(i)-Math.abs(r);n<0&&(i=(1-Math.abs(r))*(i>=0?1:-1),r=(1-Math.abs(i))*(r>=0?1:-1));var o=Math.sqrt(i*i+r*r+n*n);return t[0]=i/o,t[1]=r/o,t[2]=n/o,t}function yr(e,t,i){for(var r=e.length,n=new Uint16Array(r),o=t[0],s=t[1],a=t[2],c=t[3]-o,l=t[4]-s,h=t[5]-a,u=65525,d=u/c,f=u/l,v=u/h,p=function(e){return e>=0?e:0},y=0;y<r;y+=3)n[y+0]=Math.floor(p(e[y+0]-o)*d),n[y+1]=Math.floor(p(e[y+1]-s)*f),n[y+2]=Math.floor(p(e[y+2]-a)*v);return ni(cr),Mi(t,cr),ni(lr),bi([c/u,l/u,h/u],lr),ui(cr,lr,i),n}function mr(e,t,i){var r,n,o=e[0]/(Math.abs(e[0])+Math.abs(e[1])+Math.abs(e[2])),s=e[1]/(Math.abs(e[0])+Math.abs(e[1])+Math.abs(e[2]));return e[2]<0&&(r=(1-Math.abs(s))*(o>=0?1:-1),n=(1-Math.abs(o))*(s>=0?1:-1),o=r,s=n),new Int8Array([Math[t](127.5*o+(o<0?-1:0)),Math[i](127.5*s+(s<0?-1:0))])}function gr(e,t,i,r){var n=e[t]/(Math.abs(e[t])+Math.abs(e[t+1])+Math.abs(e[t+2])),o=e[t+1]/(Math.abs(e[t])+Math.abs(e[t+1])+Math.abs(e[t+2]));if(e[t+2]<0){var s=(1-Math.abs(o))*(n>=0?1:-1),a=(1-Math.abs(n))*(o>=0?1:-1);n=s,o=a}return new Int8Array([Math[i](127.5*n+(n<0?-1:0)),Math[r](127.5*o+(o<0?-1:0))])}var br={__proto__:null,getPositions3MinMax:function(e,t,i){var r,n;for(t=t||new Float64Array(3),i=i||new Float64Array(3),r=0;r<3;r++)t[r]=Number.MAX_VALUE,i[r]=-Number.MAX_VALUE;for(r=0;r<e.length;r+=3)for(n=0;n<3;n++)t[n]=Math.min(t[n],e[r+n]),i[n]=Math.max(i[n],e[r+n]);return{min:t,max:i}},createPositions3DecompressMat4:function(e,t){t=t||Qt();var i=e[3]-e[0],r=e[4]-e[1],n=e[5]-e[2],o=65535;return ni(cr),Mi(e,cr),ni(lr),bi([i/o,r/o,n/o],lr),ui(cr,lr,t),t},compressPositions3:function(e,t,i){var r,n=new Uint16Array(e.length),o=new Float32Array([i[0]!==t[0]?65535/(i[0]-t[0]):0,i[1]!==t[1]?65535/(i[1]-t[1]):0,i[2]!==t[2]?65535/(i[2]-t[2]):0]);for(r=0;r<e.length;r+=3)n[r+0]=Math.floor((e[r+0]-t[0])*o[0]),n[r+1]=Math.floor((e[r+1]-t[1])*o[1]),n[r+2]=Math.floor((e[r+2]-t[2])*o[2]);return ni(cr),Mi(t,cr),ni(lr),bi([(i[0]-t[0])/65535,(i[1]-t[1])/65535,(i[2]-t[2])/65535],lr),{quantized:n,decompressMatrix:ui(cr,lr,ni())}},compressPoint3:function(e,t,i){void 0===i&&(i=e);var r=new Float32Array([t[3]!==t[0]?65535/(t[3]-t[0]):0,t[4]!==t[1]?65535/(t[4]-t[1]):0,t[5]!==t[2]?65535/(t[5]-t[2]):0]);return i[0]=Math.max(0,Math.min(65535,Math.floor((e[0]-t[0])*r[0]))),i[1]=Math.max(0,Math.min(65535,Math.floor((e[1]-t[1])*r[1]))),i[2]=Math.max(0,Math.min(65535,Math.floor((e[2]-t[2])*r[2]))),i},decompressPoint3:hr,decompressAABB3:function(e,t,i){return void 0===i&&(i=e),i[0]=e[0]*t[0]+t[12],i[1]=e[1]*t[5]+t[13],i[2]=e[2]*t[10]+t[14],i[3]=e[3]*t[0]+t[12],i[4]=e[4]*t[5]+t[13],i[5]=e[5]*t[10]+t[14],i},decompressPositions3:ur,getUVBounds:function(e){var t,i,r=new Float32Array(2),n=new Float32Array(2);for(t=0;t<2;t++)r[t]=Number.MAX_VALUE,n[t]=-Number.MAX_VALUE;for(t=0;t<e.length;t+=2)for(i=0;i<2;i++)r[i]=Math.min(r[i],e[t+i]),n[i]=Math.max(n[i],e[t+i]);return{min:r,max:n}},compressUVs:dr,compressNormals:function(e){for(var t,i,r,n,o=new Int8Array(e.length),s=0;s<e.length;s+=3)i=t=fr(e,s,"floor","floor"),r=n=vr(e,s,pr(t)),(r=vr(e,s,pr(t=fr(e,s,"ceil","floor"))))>n&&(i=t,n=r),(r=vr(e,s,pr(t=fr(e,s,"floor","ceil"))))>n&&(i=t,n=r),(r=vr(e,s,pr(t=fr(e,s,"ceil","ceil"))))>n&&(i=t,n=r),o[s]=i[0],o[s+1]=i[1];return o},decompressUV:function(e,t,i){void 0===i&&(i=new Float32Array(2)),i[0]=e[0]*t[0]+t[6],i[1]=e[1]*t[4]+t[7]},decompressUVs:function(e,t,i){void 0===i&&(i=new Float32Array(e.length));for(var r=0,n=e.length;r<n;r+=3)i[r+0]=e[r+0]*t[0]+t[6],i[r+1]=e[r+1]*t[4]+t[7];return i},decompressNormal:function(e,t){var i=e[0],r=e[1];i=(2*i+1)/255,r=(2*r+1)/255;var n=1-Math.abs(i)-Math.abs(r);n<0&&(i=(1-Math.abs(r))*(i>=0?1:-1),r=(1-Math.abs(i))*(r>=0?1:-1));var o=Math.sqrt(i*i+r*r+n*n);return t[0]=i/o,t[1]=r/o,t[2]=n/o,t},decompressNormals:function(e,t){for(var i=0,r=0,n=e.length;i<n;i+=2){var o=e[i+0],s=e[i+1];o=(2*o+1)/255,s=(2*s+1)/255;var a=1-Math.abs(o)-Math.abs(s);a<0&&(o=(1-Math.abs(s))*(o>=0?1:-1),s=(1-Math.abs(o))*(s>=0?1:-1));var c=Math.sqrt(o*o+s*s+a*a);t[r+0]=o/c,t[r+1]=s/c,t[r+2]=a/c,r+=3}return t},quantizePositions3:yr,transformAndOctEncodeNormals:function(e,t,i,r,n){function o(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}var s,a,c,l,h,u=new Float32Array([0,0,0,0]),d=new Float32Array([0,0,0,0]);for(h=0;h<i;h+=3)u[0]=t[h],u[1]=t[h+1],u[2]=t[h+2],yi(e,u,d),Kt(d,d),a=s=mr(d,"floor","floor"),c=l=o(d,pr(s)),(c=o(d,pr(s=mr(d,"ceil","floor"))))>l&&(a=s,l=c),(c=o(d,pr(s=mr(d,"floor","ceil"))))>l&&(a=s,l=c),(c=o(d,pr(s=mr(d,"ceil","ceil"))))>l&&(a=s,l=c),r[n+h+0]=a[0],r[n+h+1]=a[1],r[n+h+2]=0;return n+i},octEncodeNormals:function(e){for(var t,i,r,n,o=e.length,s=new Int8Array(o),a=0;a<o;a+=3)i=t=gr(e,a,"floor","floor"),r=n=vr(e,a,pr(t)),(r=vr(e,a,pr(t=gr(e,a,"ceil","floor"))))>n&&(i=t,n=r),(r=vr(e,a,pr(t=gr(e,a,"floor","ceil"))))>n&&(i=t,n=r),(r=vr(e,a,pr(t=gr(e,a,"ceil","ceil"))))>n&&(i=t,n=r),s[a+0]=i[0],s[a+1]=i[1],s[a+2]=0;return s},octEncodeVec3:mr,octEncodeNormal:gr},wr=Pt(),Pr=Pt(),Er=Qt();function Tr(e){return new Float64Array(e||6)}function _r(e){return new Int16Array(e||6)}function Ir(e){return ht(e||32)}function xr(e,t){return e[0]<=t[0]&&t[3]<=e[3]&&e[1]<=t[1]&&e[2]<=t[2]}function Sr(e,t){return e[0]<=t[0]&&t[3]<=e[3]&&e[1]<=t[1]&&t[4]<=e[4]&&e[2]<=t[2]&&t[5]<=e[5]}var Mr=function(){var e=ht(3),t=ht(3),i=ht(3);return function(r){return e[0]=r[0],e[1]=r[1],e[2]=r[2],t[0]=r[3],t[1]=r[4],t[2]=r[5],Ot(t,e,i),Math.abs(Nt(i))}}(),Or=function(){var e=ht(3),t=ht(3),i=ht(3);return function(r,n){e[0]=r[0],e[1]=r[1],e[2]=r[2],t[0]=r[3],t[1]=r[4],t[2]=r[5];var o=Ot(t,e,i),s=n[0]-r[0],a=r[3]-n[0],c=n[1]-r[1],l=r[4]-n[1],h=n[2]-r[2],u=r[5]-n[2];return o[0]+=s>a?s:a,o[1]+=c>l?c:l,o[2]+=h>u?h:u,Math.abs(Nt(o))}}();function Rr(e,t){return void 0===t&&(t=Pt()),t[0]=(e[0]+e[3])/2,t[1]=(e[1]+e[4])/2,t[2]=(e[2]+e[5])/2,t}function jr(e){return void 0===e&&(e=Tr()),e[0]=at,e[1]=at,e[2]=at,e[3]=st,e[4]=st,e[5]=st,e}function Dr(e,t){return void 0===e&&(e=Tr()),void 0===t&&(t=Ir()),t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=1,t[4]=e[3],t[5]=e[1],t[6]=e[2],t[7]=1,t[8]=e[3],t[9]=e[4],t[10]=e[2],t[11]=1,t[12]=e[0],t[13]=e[4],t[14]=e[2],t[15]=1,t[16]=e[0],t[17]=e[1],t[18]=e[5],t[19]=1,t[20]=e[3],t[21]=e[1],t[22]=e[5],t[23]=1,t[24]=e[3],t[25]=e[4],t[26]=e[5],t[27]=1,t[28]=e[0],t[29]=e[4],t[30]=e[5],t[31]=1,t}function Ar(e,t){return e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]>t[2]&&(e[2]=t[2]),e[3]<t[3]&&(e[3]=t[3]),e[4]<t[4]&&(e[4]=t[4]),e[5]<t[5]&&(e[5]=t[5]),e}function Cr(e,t){return e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]>t[2]&&(e[2]=t[2]),e[3]<t[0]&&(e[3]=t[0]),e[4]<t[1]&&(e[4]=t[1]),e[5]<t[2]&&(e[5]=t[2]),e}function Br(e,t){for(var i,r,n,o=0,s=t.length;o<s;o+=3)r=t[o+1],n=t[o+2],e[0]>(i=t[o])&&(e[0]=i),e[1]>r&&(e[1]=r),e[2]>n&&(e[2]=n),e[3]<i&&(e[3]=i),e[4]<r&&(e[4]=r),e[5]<n&&(e[5]=n);return e}var kr=function(){var e=ht(3);return function(t,i,r){i=i||Tr();for(var n,o,s,a=at,c=at,l=at,h=st,u=st,d=st,f=0,v=t.length;f<v;f+=3)r?(e[0]=t[f+0],e[1]=t[f+1],e[2]=t[f+2],hr(e,r,e),n=e[0],o=e[1],s=e[2]):(n=t[f+0],o=t[f+1],s=t[f+2]),n<a&&(a=n),o<c&&(c=o),s<l&&(l=s),n>h&&(h=n),o>u&&(u=o),s>d&&(d=s);return i[0]=a,i[1]=c,i[2]=l,i[3]=h,i[4]=u,i[5]=d,i}}();function Lr(e,t){void 0===t&&(t=Pt());for(var i=0,r=0,n=0,o=0,s=e.length;o<s;o+=3)i+=e[o+0],r+=e[o+1],n+=e[o+2];var a=e.length/3;return t[0]=i/a,t[1]=r/a,t[2]=n/a,t}var Fr=/*#__PURE__*/function(){function e(){this.testVertex=void 0,this.offset=void 0,this.normal=void 0,this.normal=Pt(),this.offset=0,this.testVertex=Pt()}return e.prototype.set=function(e,t,i,r){var n=1/Math.sqrt(e*e+t*t+i*i);this.normal[0]=e*n,this.normal[1]=t*n,this.normal[2]=i*n,this.offset=r*n,this.testVertex[0]=this.normal[0]>=0?1:0,this.testVertex[1]=this.normal[1]>=0?1:0,this.testVertex[2]=this.normal[2]>=0?1:0},e}(),Ur=1,Nr=2,Gr=3,Vr=function(){this.planes=void 0,this.planes=[new Fr,new Fr,new Fr,new Fr,new Fr,new Fr]};function Hr(e,t,i){var r=ui(t,e,Er),n=r[0],o=r[1],s=r[2],a=r[3],c=r[4],l=r[5],h=r[6],u=r[7],d=r[8],f=r[9],v=r[10],p=r[11],y=r[12],m=r[13],g=r[14],b=r[15];return(i=i||new Vr).planes[0].set(a-n,u-c,p-d,b-y),i.planes[1].set(a+n,u+c,p+d,b+y),i.planes[2].set(a-o,u-l,p-f,b-m),i.planes[3].set(a+o,u+l,p+f,b+m),i.planes[4].set(a-s,u-h,p-v,b-g),i.planes[5].set(a+s,u+h,p+v,b+g),i}function Xr(e,t){var i=Ur,r=wr,n=Pr;r[0]=t[0],r[1]=t[1],r[2]=t[2],n[0]=t[3],n[1]=t[4],n[2]=t[5];for(var o=[r,n],s=0;s<6;++s){var a=e.planes[s];if(a.normal[0]*o[a.testVertex[0]][0]+a.normal[1]*o[a.testVertex[1]][1]+a.normal[2]*o[a.testVertex[2]][2]+a.offset<0)return Gr;a.normal[0]*o[1-a.testVertex[0]][0]+a.normal[1]*o[1-a.testVertex[1]][1]+a.normal[2]*o[1-a.testVertex[2]][2]+a.offset<0&&(i=Nr)}return i}function Wr(e,t){return Nr}var Yr={__proto__:null,createAABB3:Tr,createAABB3Int16:_r,createAABB2:function(e){return ht(e||4)},createOBB3:Ir,createOBB2:function(e){return ht(e||16)},createSphere3:function(e,t,i,r){return ht([e,t,i,r])},transformOBB3:function(e,t,i){var r;void 0===i&&(i=t);var n,o,s,a=t.length,c=e[0],l=e[1],h=e[2],u=e[3],d=e[4],f=e[5],v=e[6],p=e[7],y=e[8],m=e[9],g=e[10],b=e[11],w=e[12],P=e[13],E=e[14],T=e[15];for(r=0;r<a;r+=4)i[r+0]=c*(n=t[r+0])+d*(o=t[r+1])+y*(s=t[r+2])+w,i[r+1]=l*n+f*o+m*s+P,i[r+2]=h*n+v*o+g*s+E,i[r+3]=u*n+p*o+b*s+T;return i},containsAABB2:xr,containsAABB3:Sr,getAABB3Diag:Mr,getAABB3DiagPoint:Or,getAABB3Area:function(e){return(e[3]-e[0])*(e[4]-e[1])*(e[5]-e[2])},getAABB3Center:Rr,getAABB2Center:function(e,t){return void 0===t&&(t=wt()),t[0]=(e[2]+e[0])/2,t[1]=(e[3]+e[1])/2,t},collapseAABB3:jr,collapseAABB3Int16:function(e){return void 0===e&&(e=_r()),e[0]=65535,e[1]=65535,e[2]=65535,e[3]=-65535,e[4]=-65535,e[5]=-65535,e},AABB3ToOBB3:Dr,expandAABB3:Ar,expandAABB2:function(e,t){return e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[3]<t[3]&&(e[3]=t[3]),e[4]<t[4]&&(e[4]=t[4]),e},expandAABB3Point3:Cr,expandAABB2Point2:function(e,t){return e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[3]<t[0]&&(e[3]=t[0]),e[4]<t[1]&&(e[4]=t[1]),e},expandAABB3Points3:Br,ABB3ToOBB3:function(e,t){return void 0===t&&(t=Ir()),t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=1,t[4]=e[3],t[5]=e[1],t[6]=e[2],t[7]=1,t[8]=e[3],t[9]=e[4],t[10]=e[2],t[11]=1,t[12]=e[0],t[13]=e[4],t[14]=e[2],t[15]=1,t[16]=e[0],t[17]=e[1],t[18]=e[5],t[19]=1,t[20]=e[3],t[21]=e[1],t[22]=e[5],t[23]=1,t[24]=e[3],t[25]=e[4],t[26]=e[5],t[27]=1,t[28]=e[0],t[29]=e[4],t[30]=e[5],t[31]=1,t},positions3ToAABB3:kr,OBB3ToAABB3:function(e,t){void 0===t&&(t=Tr());for(var i,r,n,o=at,s=at,a=at,c=st,l=st,h=st,u=0,d=e.length;u<d;u+=4)(i=e[u+0])<o&&(o=i),(r=e[u+1])<s&&(s=r),(n=e[u+2])<a&&(a=n),i>c&&(c=i),r>l&&(l=r),n>h&&(h=n);return t[0]=o,t[1]=s,t[2]=a,t[3]=c,t[4]=l,t[5]=h,t},points3ToAABB3:function(e,t){void 0===t&&(t=Tr());for(var i,r,n,o=at,s=at,a=at,c=st,l=st,h=st,u=0,d=e.length;u<d;u++)(i=e[u][0])<o&&(o=i),(r=e[u][1])<s&&(s=r),(n=e[u][2])<a&&(a=n),i>c&&(c=i),r>l&&(l=r),n>h&&(h=n);return t[0]=o,t[1]=s,t[2]=a,t[3]=c,t[4]=l,t[5]=h,t},getPositions3Center:Lr,FrustumPlane3:Fr,INSIDE:Ur,INTERSECT:Nr,OUTSIDE:Gr,Frustum3:Vr,setFrustum3:Hr,intersectFrustum3AABB3:Xr,intersectAABB3s:Wr,intersectFrustum3Triangles3:function(e,t,i){return!0},intersectFrustum3Triangle3:function(e,t,i,r){return!0},intersectFrustum3Lines3:function(e,t,i){return!0},intersectFrustum3Positions3:function(e,t){return!0},intersectFrustum3Point3:function(e,t){return!0},intersectAABB3Triangles3:function(e,t,i){return!1},intersectAABB3Lines3:function(e,t,i){return!1},intersectAABB3Positions3:function(e,t){for(var i=e[0],r=e[1],n=e[2],o=e[3],s=e[4],a=e[5],c=0,l=t.length;c<l;c+=3){var h=t[c];if(i<=h&&h<=o){var u=t[c+1];if(r<=u&&u<=s){var d=t[c+2];if(n<=d&&d<=a)return!0}}}return!1},containsAABB3Point3:function(e,t){return e[0]<=t[0]&&t[0]<=e[3]&&e[1]<=t[1]&&t[1]<=e[4]&&e[2]<=t[2]&&t[2]<=e[5]},containsAABB2Point2:function(e,t){return e[0]<=t[0]&&t[0]<=e[3]&&e[1]<=t[1]&&t[1]<=e[4]}},Kr=Pt(),zr=new Float32Array(16),qr=new Float64Array(4),Zr=new Float64Array(4);function Qr(e,t,i){return void 0===i&&(i=zr),qr[0]=t[0],qr[1]=t[1],qr[2]=t[2],qr[3]=1,mi(e,qr,Zr),Si(e,Zr,i),i}function Jr(e,t,i){return void 0===i&&(i=200),t[0]=Math.round(e[0]/i)*i,t[1]=Math.round(e[1]/i)*i,t[2]=Math.round(e[2]/i)*i,t}var $r={__proto__:null,createRTCViewMat:Qr,worldToRTCPos:function(e,t,i){var r=Float32Array.from([e[0]])[0],n=e[0]-r,o=Float32Array.from([e[1]])[0],s=e[1]-o,a=Float32Array.from([e[2]])[0],c=e[2]-a;t[0]=r,t[1]=o,t[2]=a,i[0]=n,i[1]=s,i[2]=c},worldToRTCCenter:Jr,worldToRTCPositions:function(e,t,i,r){void 0===r&&(r=200);for(var n=Lr(e,Kr),o=Math.round(n[0]/r)*r,s=Math.round(n[1]/r)*r,a=Math.round(n[2]/r)*r,c=0,l=e.length;c<l;c+=3)t[c+0]=e[c+0]-o,t[c+1]=e[c+1]-s,t[c+2]=e[c+2]-a;return i[0]=o,i[1]=s,i[2]=a,0!==i[0]||0!==i[1]||0!==i[2]},rtcToWorldPos:function(e,t,i){return i[0]=e[0]+t[0],i[1]=e[1]+t[1],i[2]=e[2]+t[2],i},getPlaneRTCPos:function(e,t,i,r){var n=bt(t,i)+e;return It(Kt(t,Kr),-n,r),r}},en=/*#__PURE__*/f("messages"),tn=/*#__PURE__*/f("locales"),rn=/*#__PURE__*/f("locale");function nn(e,t){if(t[e])return t[e];for(var i=e.split("."),r=t,n=0,o=i.length;r&&n<o;n++)r=r[i[n]];return r}function on(e,t){return void 0===t&&(t=[]),e.replace(/\{\{|\}\}|\{(\d+)\}/g,function(e,i){return"{{"===e?"{":"}}"===e?"}":t[i]})}var sn={__proto__:null,LocaleService:/*#__PURE__*/function(){function e(e){void 0===e&&(e={messages:{},locale:""}),this.onUpdated=void 0,Object.defineProperty(this,en,{writable:!0,value:void 0}),Object.defineProperty(this,tn,{writable:!0,value:void 0}),Object.defineProperty(this,rn,{writable:!0,value:"en"}),this.onUpdated=new y(new ie.EventDispatcher),this.messages=e.messages,this.locale=e.locale}var t=e.prototype;return t.loadMessages=function(e){for(var t in void 0===e&&(e={}),e)v(this,en)[en][t]=e[t];this.messages=v(this,en)[en]},t.clearMessages=function(){this.messages={}},t.translate=function(e,t){var i=v(this,en)[en][v(this,rn)[rn]];if(!i)return null;var r=nn(e,i);return r?t?on(r,t):r:null},t.translatePlurals=function(e,t,i){var r=v(this,en)[en][v(this,rn)[rn]];if(!r)return null;var n=nn(e,r);return(n=0===(t=parseInt(""+t,10))?n.zero:t>1?n.other:n.one)?(n=on(n,[t]),i&&(n=on(n,i)),n):null},r(e,[{key:"messages",set:function(e){v(this,en)[en]=e||{},v(this,tn)[tn]=Object.keys(v(this,en)[en]),this.onUpdated.dispatch(this,v(this,rn)[rn])}},{key:"locales",get:function(){return v(this,tn)[tn]}},{key:"locale",get:function(){return v(this,rn)[rn]},set:function(e){e=e||"de",v(this,rn)[rn]!==e&&(v(this,rn)[rn]=e,this.onUpdated.dispatch(this,v(this,rn)[rn]))}}]),e}()},an=function(e,t){this.propertySet=void 0,this.name=void 0,this.value=void 0,this.type=void 0,this.valueType=void 0,this.description=void 0,this.propertySet=e,this.name=t.name,this.type=t.type,this.value=t.value,this.valueType=t.valueType,this.description=t.description},cn=function(e,t){if(this.models=void 0,this.id=void 0,this.originalSystemId=void 0,this.name=void 0,this.type=void 0,this.properties=void 0,this.models=[e],this.id=t.id,this.name=t.name,this.type=t.type,this.properties=[],t.properties)for(var i=0,r=t.properties.length;i<r;i++){var n=new an(this,t.properties[i]);this.properties.push(n)}},ln=function(e,t,i,r,n,o){this.data=void 0,this.models=void 0,this.id=void 0,this.name=void 0,this.type=void 0,this.propertySets=void 0,this.relating=void 0,this.related=void 0,this.data=e,this.models=[t],this.id=i,this.name=r,this.type=n,this.propertySets=o||[],this.related={},this.relating={}},hn=function(e,t,i){this.type=void 0,this.relatingObject=void 0,this.relatedObject=void 0,this.type=e,this.relatingObject=t,this.relatedObject=i},un=/*#__PURE__*/f("destroyed"),dn=/*#__PURE__*/f("removeObjectFromModels"),fn=/*#__PURE__*/function(e){function t(t,i,r,n){var o;return o=e.call(this,t)||this,Object.defineProperty(l(o),dn,{value:vn}),o.data=void 0,o.projectId=void 0,o.revisionId=void 0,o.author=void 0,o.createdAt=void 0,o.creatingApplication=void 0,o.schema=void 0,o.propertySets=void 0,o.objects=void 0,o.rootObjects=void 0,o.objectsByType=void 0,o.relationships=void 0,o.typeCounts=void 0,o.onBuilt=void 0,o.built=void 0,Object.defineProperty(l(o),un,{writable:!0,value:void 0}),o.onBuilt=new y(new ie.EventDispatcher),o.data=t,o.id=i,o.projectId=r.projectId||"",o.revisionId=r.revisionId||"",o.author=r.author||"",o.createdAt=r.createdAt||"",o.creatingApplication=r.creatingApplication||"",o.schema=r.schema||"",o.propertySets={},o.objects={},o.objectsByType={},o.relationships=[],o.typeCounts={},o.rootObjects={},o.built=!1,v(l(o),un)[un]=!1,o.fromJSON(r),o}n(t,e);var i=t.prototype;return i.fromJSON=function(e){if(this.destroyed)return new ue("Failed to add components to DataModel - DataModel already destroyed");if(this.built)throw new ue("Failed to add components to DataModel - DataModel already built");if(e.propertySets)for(var t=0,i=e.propertySets.length;t<i;t++)this.createPropertySet(e.propertySets[t]);if(e.objects)for(var r=0,n=e.objects.length;r<n;r++)this.createObject(e.objects[r]);if(e.relationships)for(var o=0,s=e.relationships.length;o<s;o++)this.createRelationship(e.relationships[o])},i.createPropertySet=function(e){if(this.destroyed)return new ue("Failed to create PropertySet - DataModel already destroyed");if(this.built)return new ue("DataModel already built");if(this.propertySets[e.id])return new ue("Failed to create PropertySet - PropertySet with same ID already created in this DataModel. It's OK to have duplicates shared between DataModels, but they must be unique within each DataModel.");var t=this.data.propertySets[e.id];return t?(this.propertySets[e.id]=t,t.models.push(this),t):(t=new cn(this,e),this.propertySets[e.id]=t,this.data.propertySets[e.id]=t,t)},i.createObject=function(e){if(this.destroyed)return new ue("Failed to create DataObject - DataModel already destroyed");if(this.built)return new ue("Failed to create DataObject - DataModel already built");var t=e.id;if(this.objects[t])return new ue("Failed to create DataObject - DataObject with same ID already created in this DataModel. It's OK to have duplicates shared between DataModels, but they must be unique within each DataModel.");var i=e.type,r=this.data.objects[t];if(r)this.objects[t]=r,this.data.objects[t]=r,this.objectsByType[i]||(this.objectsByType[i]={}),this.objectsByType[i][t]=r,this.typeCounts[i]=void 0===this.typeCounts[i]?1:this.typeCounts[i]+1,r.models.push(this);else{var n=[];if(e.propertySetIds)for(var o=0,s=e.propertySetIds.length;o<s;o++){var a=e.propertySetIds[o],c=this.propertySets[a];if(!c)return new ue('Failed to create DataObject - PropertySet not found: "'+a+'"');n.push(c)}r=new ln(this.data,this,t,e.name,e.type,n),this.objects[t]=r,this.data.objects[t]=r,this.data.objectsByType[i]||(this.data.objectsByType[i]={}),this.data.objectsByType[i][t]=r,this.data.typeCounts[i]=void 0===this.data.typeCounts[i]?1:this.data.typeCounts[i]+1,r.models.push(this),this.data.onObjectCreated.dispatch(this.data,r)}return r},i.createRelationship=function(e){if(this.destroyed)return new ue("Failed to create Relationship - DataModel already destroyed");if(this.built)return new ue("Failed to create Relationship - DataModel already built");var t=this.data.objects[e.relatingObjectId];if(!t)return new ue("Failed to create Relationship - relating DataObject not found: "+e.relatingObjectId);var i=this.data.objects[e.relatedObjectId];if(!i)return new ue("Failed to create Relationship - related DataObject not found: "+e.relatedObjectId);var r=new hn(e.type,t,i);return i.relating[e.type]||(i.relating[e.type]=[]),i.relating[e.type].push(r),t.related[e.type]||(t.related[e.type]=[]),t.related[e.type].push(r),this.relationships.push(r),r},i.build=function(){var e=this;return new Promise(function(t){if(e.destroyed)throw new ue("Failed to build DataModel - DataModel already destroyed");if(e.built)throw new ue("Failed to build DataModel - DataModel already built");e.built=!0,e.onBuilt.dispatch(e,null),t(e)})},i.getJSON=function(){if(this.destroyed)return new ue("DataModel already destroyed");var e={id:this.id,propertySets:[],objects:[],relationships:[]};for(var t in this.propertySets){for(var i,r=this.propertySets[t],n={id:t,name:r.name,properties:[],type:r.type,originalSystemId:r.originalSystemId},o=0,s=r.properties.length;o<s;o++){var a=r.properties[o];n.properties.push({name:a.name,value:a.value,type:a.type,valueType:a.valueType,description:a.description})}null==(i=e.propertySets)||i.push(n)}for(var c in this.objects){var l,h=this.objects[c],u={id:c,type:h.type,name:h.name,propertySetIds:[]};if(h.propertySets)for(var d=0,f=h.propertySets.length;d<f;d++){var v;null==(v=u.propertySetIds)||v.push(h.propertySets[d].id)}null==(l=e.objects)||l.push(u)}for(var p=0,y=this.relationships.length;p<y;p++){var m,g=this.relationships[p];null==(m=e.relationships)||m.push({type:g.type,relatingObjectId:g.relatingObject.id,relatedObjectId:g.relatedObject.id})}return e},i.destroy=function(){if(this.destroyed)return new ue("Failed to destroy DataModel - DataModel already destroyed");for(var t in this.objects){var i=this.objects[t];if(i.models.length>1)v(this,dn)[dn](i);else{delete this.data.objects[t];var r=i.type;if(0==--this.data.typeCounts[r])for(var n in delete this.data.typeCounts[r],delete this.data.objectsByType[r],this.data.onObjectDestroyed.dispatch(this.data,i),i.relating)for(var o=i.relating[n],s=0,a=o.length;s<a;s++)for(var c=o[s].relatedObject.relating[n],l=0,h=c.length;l<h;l++)c[0].relatingObject===i&&(c[l]=c[l])}}v(this,un)[un]=!0,this.onBuilt.clear(),e.prototype.destroy.call(this)},t}(ce);function vn(e){for(var t=0,i=e.models.length;t<i;t++)if(e.models[t]===this){e.models=e.models.splice(t,1);break}}var pn=/*#__PURE__*/function(e){function t(){var t;return(t=e.call(this,null,{})||this).models=void 0,t.propertySets=void 0,t.objects=void 0,t.rootObjects=void 0,t.objectsByType=void 0,t.typeCounts=void 0,t.onModelCreated=void 0,t.onModelDestroyed=void 0,t.onObjectCreated=void 0,t.onObjectDestroyed=void 0,t.models={},t.propertySets={},t.objects={},t.rootObjects={},t.objectsByType={},t.typeCounts={},t.onModelCreated=new y(new ie.EventDispatcher),t.onModelDestroyed=new y(new ie.EventDispatcher),t.onObjectCreated=new y(new ie.EventDispatcher),t.onObjectDestroyed=new y(new ie.EventDispatcher),t}n(t,e);var i=t.prototype;return i.createModel=function(e,t){var i=this;if(this.destroyed)return new ue("Data already destroyed");var r=e.id;if(this.models[r])return new ue("DataModel already created in this Data: "+r);var n=new fn(this,r,e,t);return this.models[n.id]=n,n.onDestroyed.one(function(){delete i.models[n.id],i.onModelDestroyed.dispatch(i,n)}),n.onBuilt.one(function(){i.onModelCreated.dispatch(i,n)}),n},i.getObjectIdsByType=function(e){if(this.destroyed)return new ue("Data already destroyed");var t=this.objectsByType[e];return t?Object.keys(t):[]},i.searchObjects=function(e){if(this.destroyed)return new ue("Data already destroyed");var t=e.includeObjects&&e.includeObjects.length>0?yn(e.includeObjects):null,i=e.excludeObjects&&e.excludeObjects.length>0?yn(e.excludeObjects):null,r=e.includeRelating&&e.includeRelating.length>0?yn(e.includeRelating):null,n=e.excludeRelating&&e.excludeRelating.length>0?yn(e.excludeRelating):null;function o(s,a){if(s){var c=!0;(i&&i[s.type]||t&&!t[s.type])&&(c=!1),0===a&&!1===e.includeStart&&(c=!1),c&&(e.resultObjectIds?e.resultObjectIds.push(s.id):e.resultObjects?e.resultObjects.push(s):e.resultCallback&&e.resultCallback(s));var l=s.related;for(var h in l){var u=l[h];if(u)for(var d=0,f=u.length;d<f;d++){var v=!0;(n&&n[s.type]||r&&!r[s.type])&&(v=!1),v&&o(u[d].relatedObject,a+1)}}}}if(e.startObjectId){var s=this.objects[e.startObjectId];if(!s)return new ue('Failed to search DataObjects - starting DataObject not found in Data: "'+e.startObjectId+'"');o(s,0)}else if(e.startObject){if(e.startObject.data!=this)return new ue('Failed to search DataObjects - starting DataObject not in same Data: "'+e.startObjectId+'"');o(e.startObject,1)}else for(var a in this.rootObjects)o(this.rootObjects[a],1)},i.clear=function(){if(this.destroyed)return new ue("Data already destroyed");for(var e in this.models)this.models[e].destroy()},i.destroy=function(){if(this.destroyed)return new ue("Data already destroyed");this.clear(),this.onModelCreated.clear(),this.onModelDestroyed.clear(),e.prototype.destroy.call(this)},t}(ce);function yn(e){for(var t={},i=0,r=e.length;i<r;i++)t[e[i]]=!0;return t}var mn={__proto__:null,Data:pn,DataModel:fn,DataObject:ln,Relationship:hn,Property:an,PropertySet:cn},gn=function(e){this.positionsCompressed=void 0,this.uvsCompressed=void 0,this.colorsCompressed=void 0,this.indices=void 0,this.edgeIndices=void 0,this.positionsCompressed=e.positionsCompressed,this.uvsCompressed=e.uvsCompressed,this.colorsCompressed=e.colorsCompressed,this.indices=e.indices,this.edgeIndices=e.edgeIndices},bn=function(e){this.id=void 0,this.primitive=void 0,this.positionsDecompressMatrix=void 0,this.aabb=void 0,this.uvsDecompressMatrix=void 0,this.geometryBuckets=void 0,this.rendererGeometry=void 0,this.geometryBuckets=[];for(var t=0,i=e.geometryBuckets.length;t<i;t++)this.geometryBuckets[t]=new gn(e.geometryBuckets[t]);this.id=e.id,this.positionsDecompressMatrix=e.positionsDecompressMatrix,this.primitive=e.primitive},wn=/*#__PURE__*/f("positionsDecompressed"),Pn=/*#__PURE__*/f("positionsWorld"),En=/*#__PURE__*/function(){function e(){this.object=void 0,this.mesh=void 0,this.meshIndex=void 0,this.geometry=void 0,this.geometryBucket=void 0,this.geometryBucketIndex=void 0,Object.defineProperty(this,wn,{writable:!0,value:void 0}),Object.defineProperty(this,Pn,{writable:!0,value:void 0}),this.object=null,this.mesh=null,this.meshIndex=0,this.geometry=null,this.geometryBucket=null,this.geometryBucketIndex=0,v(this,wn)[wn]=null,v(this,Pn)[Pn]=null}return e.prototype.reset=function(){v(this,wn)[wn]=null,v(this,Pn)[Pn]=null},r(e,[{key:"totalGeometryBuckets",get:function(){var e=0;if(this.object)for(var t=0,i=this.object.meshes.length;t<i;t++)e+=this.object.meshes[t].geometry.geometryBuckets.length;return e}},{key:"numPrimitives",get:function(){var e=this.geometry.primitive;return this.geometryBucket.indices.length/(e===Ze?3:e===qe?2:1)}},{key:"positionsDecompressed",get:function(){return v(this,wn)[wn]||(v(this,wn)[wn]=new Float32Array(this.geometryBucket.positionsCompressed.length),ur(this.geometryBucket.positionsCompressed,this.geometry.positionsDecompressMatrix,v(this,wn)[wn])),v(this,wn)[wn]}},{key:"positionsWorld",get:function(){if(!v(this,Pn)[Pn]){var e=this.positionsDecompressed;v(this,Pn)[Pn]=new Float64Array(e.length),pi(e,this.mesh.matrix,v(this,Pn)[Pn])}return v(this,Pn)[Pn]}},{key:"uvsDecompressed",get:function(){return null}}]),e}(),Tn=new En;function _n(e,t){Tn.reset(),Tn.object=e;for(var i=0,r=e.meshes.length;i<r;i++){var n=e.meshes[i];Tn.mesh=n,Tn.meshIndex=i;var o=n.geometry;Tn.geometry=o;for(var s=0,a=o.geometryBuckets.length;s<a;s++)if(Tn.geometryBucket=o.geometryBuckets[s],Tn.geometryBucketIndex=s,t(Tn))return!0}return!1}var In=/*#__PURE__*/f("aabb"),xn=/*#__PURE__*/f("aabbDirty"),Sn=/*#__PURE__*/function(){function e(e){this.model=void 0,this.id=void 0,this.meshes=void 0,this.layerId=void 0,this.rendererObject=void 0,Object.defineProperty(this,In,{writable:!0,value:void 0}),Object.defineProperty(this,xn,{writable:!0,value:void 0}),this.id=e.id,this.layerId=e.layerId,this.meshes=e.meshes,v(this,In)[In]=Tr(),v(this,xn)[xn]=!0,this.rendererObject=null}return e.prototype.setAABBDirty=function(){v(this,xn)[xn]=!0},r(e,[{key:"aabb",get:function(){var e=this;return v(this,xn)[xn]&&(jr(v(this,In)[In]),_n(this,function(t){return Br(v(e,In)[In],t.positionsWorld),!1}),v(this,xn)[xn]=!1),v(this,In)[In]}}]),e}(),Mn=function(e,t){this.id=void 0,this.colorTexture=void 0,this.metallicRoughnessTexture=void 0,this.occlusionTexture=void 0,this.emissiveTexture=void 0,this.rendererTextureSet=void 0,this.id=e.id,this.colorTexture=t.colorTexture,this.metallicRoughnessTexture=t.metallicRoughnessTexture,this.occlusionTexture=t.occlusionTexture,this.emissiveTexture=t.emissiveTexture,this.rendererTextureSet=null},On=function(e){this.rendererTexture=void 0,this.id=void 0,this.src=void 0,this.imageData=void 0,this.buffers=void 0,this.image=void 0,this.height=void 0,this.width=void 0,this.compressed=void 0,this.mediaType=void 0,this.magFilter=void 0,this.minFilter=void 0,this.wrapS=void 0,this.wrapT=void 0,this.wrapR=void 0,this.flipY=void 0,this.encoding=void 0,this.preloadColor=void 0,this.channel=void 0,this.id=e.id,this.imageData=e.imageData,this.src=e.src,this.mediaType=e.mediaType,this.minFilter=e.minFilter||ye,this.magFilter=e.magFilter||ye,this.wrapS=e.wrapS||fe,this.wrapT=e.wrapT||fe,this.wrapR=e.wrapR||fe,this.encoding=e.encoding||Ye,this.preloadColor=Et(e.preloadColor||[1,1,1,1]),this.channel=0,this.rendererTexture=null},Rn=/*#__PURE__*/f("color"),jn=/*#__PURE__*/f("matrix"),Dn=/*#__PURE__*/f("metallic"),An=/*#__PURE__*/f("roughness"),Cn=/*#__PURE__*/f("opacity"),Bn=/*#__PURE__*/function(){function e(e){this.id=void 0,this.geometry=void 0,this.textureSet=void 0,this.rendererMesh=void 0,this.object=void 0,Object.defineProperty(this,Rn,{writable:!0,value:void 0}),Object.defineProperty(this,jn,{writable:!0,value:void 0}),Object.defineProperty(this,Dn,{writable:!0,value:void 0}),Object.defineProperty(this,An,{writable:!0,value:void 0}),Object.defineProperty(this,Cn,{writable:!0,value:void 0}),this.id=e.id,v(this,jn)[jn]=e.matrix?Qt(e.matrix):ni(),this.geometry=e.geometry,this.textureSet=e.textureSet,this.rendererMesh=null,this.color=e.color||Pt([1,1,1]),this.metallic=null!=e.metallic?e.metallic:0,this.roughness=null!=e.roughness?e.roughness:1,this.opacity=null!=e.opacity?e.opacity:1}return r(e,[{key:"color",get:function(){return v(this,Rn)[Rn]},set:function(e){var t=v(this,Rn)[Rn];t||((t=v(this,Rn)[Rn]=new Float32Array(4))[3]=1),e?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=1,t[1]=1,t[2]=1),this.rendererMesh&&this.rendererMesh.setColor(v(this,Rn)[Rn])}},{key:"matrix",get:function(){return v(this,jn)[jn]},set:function(e){e?v(this,jn)[jn].set(e):ni(v(this,jn)[jn]),this.rendererMesh&&this.rendererMesh.setMatrix(v(this,jn)[jn]),this.object&&this.object.setAABBDirty()}},{key:"metallic",get:function(){return v(this,Dn)[Dn]},set:function(e){e=null!=e?e:1,v(this,Dn)[Dn]!==e&&(v(this,Dn)[Dn]=e,this.rendererMesh&&this.rendererMesh.setMetallic(v(this,Dn)[Dn]))}},{key:"roughness",get:function(){return v(this,An)[An]},set:function(e){e=null!=e?e:1,v(this,An)[An]!==e&&(v(this,An)[An]=e,this.rendererMesh&&this.rendererMesh.setRoughness(v(this,An)[An]))}},{key:"opacity",get:function(){return v(this,Cn)[Cn]},set:function(e){e=null!=e?e:1,v(this,Cn)[Cn]!==e&&(v(this,Cn)[Cn]=e)}}]),e}(),kn=[],Ln=[],Fn=[],Un=[],Nn=[],Gn=0,Vn=new Uint16Array(3),Hn=new Uint16Array(3),Xn=new Uint16Array(3),Wn=Pt(),Yn=Pt(),Kn=Pt(),zn=Pt(),qn=Pt(),Zn=Pt(),Qn=Pt(),Jn=null;function $n(e,t){for(var i,r=0;r<3;r++)if(0!=(i=Jn[3*e+r]-Jn[3*t+r]))return i;return 0}var eo=null,to=null;function io(e,t){var i,r,n,o,s,a,c=3*e,l=3*t,h=Math.min(i=to[c],r=to[c+1],n=to[c+2]),u=Math.min(o=to[l],s=to[l+1],a=to[l+2]);if(h!=u)return h-u;var d=Math.max(i,r,n),f=Math.max(o,s,a);return d!=f?d-f:0}function ro(e){var t=Qt(),i=jr();Br(i,e.positions);var r,n=yr(e.positions,i,t),o=e.primitive!==Qe&&e.primitive!==Je&&e.primitive!==Ze||!e.indices?null:function(e,t,i,r){!function(e,t){var i,r,n,o,s,a,c={},l=Math.pow(10,4),h=0;for(s=0,a=e.length;s<a;s+=3)i=e[s],r=e[s+1],n=e[s+2],void 0===c[o=Math.round(i*l)+"_"+Math.round(r*l)+"_"+Math.round(n*l)]&&(c[o]=h/3,kn[h++]=i,kn[h++]=r,kn[h++]=n),Ln[s/3]=c[o];for(s=0,a=t.length;s<a;s++)Un[s]=Ln[t[s]],Fn[Un[s]]=t[s]}(e,t),function(e,t){Gn=0;for(var i=0,r=e;i<r;i+=3){var n=3*Un[i],o=3*Un[i+1],s=3*Un[i+2];t?(Vn[0]=kn[n],Vn[1]=kn[n+1],Vn[2]=kn[n+2],Hn[0]=kn[o],Hn[1]=kn[o+1],Hn[2]=kn[o+2],Xn[0]=kn[s],Xn[1]=kn[s+1],Xn[2]=kn[s+2],hr(Vn,t,Wn),hr(Hn,t,Yn),hr(Xn,t,Kn)):(Wn[0]=kn[n],Wn[1]=kn[n+1],Wn[2]=kn[n+2],Yn[0]=kn[o],Yn[1]=kn[o+1],Yn[2]=kn[o+2],Kn[0]=kn[s],Kn[1]=kn[s+1],Kn[2]=kn[s+2]),Ot(Kn,Yn,zn),Ot(Wn,Yn,qn),Ct(zn,qn,Zn),Kt(Zn,Qn);var a=Nn[Gn]||(Nn[Gn]={normal:Pt()});a.normal[0]=Qn[0],a.normal[1]=Qn[1],a.normal[2]=Qn[2],Gn++}}(t.length,i);for(var n,o,s,a,c,l,h,u,d=[],f=Math.cos(10*ct),v={},p=!1,y=0,m=t.length;y<m;y+=3)for(var g=y/3,b=0;b<3;b++)n=Un[y+b],o=Un[y+(b+1)%3],void 0===v[c=(s=Math.min(n,o))+","+(a=Math.max(n,o))]?v[c]={index1:s,index2:a,face1:g,face2:void 0}:v[c].face2=g;for(c in v)void 0!==(l=v[c]).face2&&bt(Nn[l.face1].normal,Nn[l.face2].normal)>f||(h=Fn[l.index1],u=Fn[l.index2],(!p&&h>65535||u>65535)&&(p=!0),d.push(h),d.push(u));return p?new Uint32Array(d):new Uint16Array(d)}(n,e.indices,t),s=function(e){var t=e.positionsCompressed,i=e.indices,r=e.edgeIndices;!function(e){if(!(null!==eo&&eo.length>=e)){eo=new Uint32Array(e);for(var t=0;t<e;t++)eo[t]=t}}(t.length/3);var n=eo.slice(0,t.length/3),o=eo.slice(0,t.length/3);Jn=t,n.sort($n);var s=0;o[n[0]]=0;for(var a=1,c=n.length;a<c;a++)0!=$n(n[a],n[a-1])&&s++,o[n[a]]=s;var l=new Uint16Array(3*(s+1));l[3*(s=0)+0]=t[3*n[0]+0],l[3*s+1]=t[3*n[0]+1],l[3*s+2]=t[3*n[0]+2];for(var h=1,u=n.length;h<u;h++)0!==$n(n[h],n[h-1])&&(l[3*++s+0]=t[3*n[h]+0],l[3*s+1]=t[3*n[h]+1],l[3*s+2]=t[3*n[h]+2]),o[n[h]]=s;Jn=null;for(var d,f=new Uint32Array(i.length),v=0,p=i.length;v<p;v++)f[v]=o[i[v]];if(r){d=new Uint32Array(r.length);for(var y=0,m=r.length;y<m;y++)d[y]=o[r[y]]}return[l,f,d]}({positionsCompressed:n,uvs:e.uvs,indices:e.indices,edgeIndices:o}),a=function(e,t,i){void 0===i&&(i=!1);var r=e.positionsCompressed||[],n=function(e,t){for(var i=new Int32Array(e.length/3),r=0,n=i.length;r<n;r++)i[r]=r;to=new Int32Array(e.length);for(var o=0,s=e.length;o<s;o++)to[o]=e[o]>>t;i.sort(io);for(var a=new Int32Array(e.length),c=0,l=i.length;c<l;c++)a[3*c+0]=e[3*i[c]+0],a[3*c+1]=e[3*i[c]+1],a[3*c+2]=e[3*i[c]+2];return a}(e.indices||[],t),o=[];function s(e,t){if(e>t){var i=e;e=t,t=i}function r(i,r){return i!=e?e-i:r!=t?t-r:0}for(var n=0,s=(o.length>>1)-1;n<=s;){var a=s+n>>1,c=r(o[2*a],o[2*a+1]);if(c>0)n=a+1;else{if(!(c<0))return a;s=a-1}}return-n-1}var a=new Int32Array(o.length/2);a.fill(0);var c=r.length/3;if(c>8*(1<<t))return[e];var l=new Int32Array(c);l.fill(-1);var h=[];function u(){l.fill(-1);var e={positionsCompressed:[],indices:[],edgeIndices:[],maxNumPositions:(1<<t)-t,numPositions:0,bucketNumber:h.length};return h.push(e),e}for(var d=u(),f=0,v=n.length;f<v;f+=3){var p=0,y=n[f],m=n[f+1],g=n[f+2];if(-1==l[y]&&p++,-1==l[m]&&p++,-1==l[g]&&p++,p+d.numPositions>d.maxNumPositions&&(d=u()),d.bucketNumber>8)return[e];-1==l[y]&&(l[y]=d.numPositions++,d.positionsCompressed.push(r[3*y]),d.positionsCompressed.push(r[3*y+1]),d.positionsCompressed.push(r[3*y+2])),-1==l[m]&&(l[m]=d.numPositions++,d.positionsCompressed.push(r[3*m]),d.positionsCompressed.push(r[3*m+1]),d.positionsCompressed.push(r[3*m+2])),-1==l[g]&&(l[g]=d.numPositions++,d.positionsCompressed.push(r[3*g]),d.positionsCompressed.push(r[3*g+1]),d.positionsCompressed.push(r[3*g+2])),d.indices.push(l[y]),d.indices.push(l[m]),d.indices.push(l[g]);var b=void 0;(b=s(y,m))>=0&&0==a[b]&&(a[b]=1,d.edgeIndices.push(l[o[2*b]]),d.edgeIndices.push(l[o[2*b+1]])),(b=s(y,g))>=0&&0==a[b]&&(a[b]=1,d.edgeIndices.push(l[o[2*b]]),d.edgeIndices.push(l[o[2*b+1]])),(b=s(m,g))>=0&&0==a[b]&&(a[b]=1,d.edgeIndices.push(l[o[2*b]]),d.edgeIndices.push(l[o[2*b+1]]))}var w=t/8,P=2*r.length+(n.length+o.length)*(t/8*2),E=0;return h.forEach(function(e){E+=2*e.positionsCompressed.length+(e.indices.length+e.edgeIndices.length)*w}),E>P?[e]:(i&&function(e,t){var i={};e.forEach(function(e){for(var t=e.indices,r=e.edgeIndices,n=e.positionsCompressed,o=0,s=t.length;o<s;o+=3)i[n[3*t[o]]+"_"+n[3*t[o]+1]+"_"+n[3*t[o]+2]+"/"+n[3*t[o+1]]+"_"+n[3*t[o+1]+1]+"_"+n[3*t[o+1]+2]+"/"+n[3*t[o+2]]+"_"+n[3*t[o+2]+1]+"_"+n[3*t[o+2]+2]]=!0;for(o=0,s=r.length;o<s;o+=2);});for(var r=t.indices,n=t.positionsCompressed,o=0,s=r.length;o<s;o+=3){var a=n[3*r[o]]+"_"+n[3*r[o]+1]+"_"+n[3*r[o]+2]+"/"+n[3*r[o+1]]+"_"+n[3*r[o+1]+1]+"_"+n[3*r[o+1]+2]+"/"+n[3*r[o+2]]+"_"+n[3*r[o+2]+1]+"_"+n[3*r[o+2]+2];if(!(a in i))throw console.log("Not found "+a),"Ohhhh!"}}(h,e),h)}({positionsCompressed:r=s[0],indices:s[1],edgeIndices:s[2]},r.length/3>65536?16:8);return{id:e.id,primitive:e.primitive===Qe&&a.length>1?Ze:e.primitive,aabb:i,positionsDecompressMatrix:t,uvsDecompressMatrix:void 0,geometryBuckets:a}}var no=/*#__PURE__*/f("texturesList"),oo=/*#__PURE__*/f("numObjects"),so=/*#__PURE__*/f("meshUsedByObject"),ao=/*#__PURE__*/f("removeUnusedTextures"),co=/*#__PURE__*/function(e){function t(t,i){var r;return r=e.call(this,t,{id:i.id})||this,Object.defineProperty(l(r),ao,{value:lo}),r.scene=void 0,r.layerId=void 0,r.built=void 0,r.edgeThreshold=void 0,r.geometries=void 0,r.textures=void 0,r.textureSets=void 0,r.meshes=void 0,r.objects=void 0,r.aabb=void 0,r.onBuilt=void 0,r.rendererModel=void 0,r.stats=void 0,Object.defineProperty(l(r),no,{writable:!0,value:void 0}),Object.defineProperty(l(r),oo,{writable:!0,value:void 0}),Object.defineProperty(l(r),so,{writable:!0,value:void 0}),r.scene=t,r.onBuilt=new y(new ie.EventDispatcher),r.onDestroyed=new y(new ie.EventDispatcher),v(l(r),oo)[oo]=0,v(l(r),so)[so]={},r.id=i.id||"default",r.layerId=i.layerId,r.edgeThreshold=10,r.geometries={},r.textures={},v(l(r),no)[no]=[],r.textureSets={},r.meshes={},r.objects={},r.aabb=Tr(),r.built=!1,r.rendererModel=null,r.stats={numGeometries:0,numLines:0,numMeshes:0,numObjects:0,numPoints:0,numTextureSets:0,numTextures:0,numTriangles:0,numVertices:0,textureBytes:0},r.fromJSON(i),r}n(t,e);var i=t.prototype;return i.fromJSON=function(e){if(this.destroyed)return new ue("Failed to add components to SceneModel - SceneModel already destroyed");if(this.built)return new ue("Failed to add components to SceneModel - SceneModel already built");if(e.geometries)for(var t=0,i=e.geometries.length;t<i;t++)this.createGeometry(e.geometries[t]);if(e.textures)for(var r=0,n=e.textures.length;r<n;r++)this.createTexture(e.textures[r]);if(e.textureSets)for(var o=0,s=e.textureSets.length;o<s;o++)this.createTextureSet(e.textureSets[o]);if(e.meshes)for(var a=0,c=e.meshes.length;a<c;a++)this.createMesh(e.meshes[a]);if(e.objects)for(var l=0,h=e.objects.length;l<h;l++)this.createObject(e.objects[l])},i.createTransform=function(e){return this.destroyed?new ue("Failed to create Transform in SceneModel - SceneModel already destroyed"):this.built?new ue("Failed to create Transform in SceneModel - SceneModel already built"):void 0},i.createTexture=function(e){if(this.destroyed)return new ue("Failed to create Texture in SceneModel - SceneModel already destroyed");if(this.built)return new ue("Failed to create Texture in SceneModel - SceneModel already built");if(!e.imageData&&!e.src&&!e.buffers)return new ue("Failed to create Texture in SceneModel - Parameter expected: textureParams.imageData, textureParams.src or textureParams.buffers");if(this.textures[e.id])return new ue("Failed to create Texture in SceneModel - Texture already exists with this ID: "+e.id);e.src&&e.src.split(".").pop(),e.imageData&&(this.stats.textureBytes+=e.imageData.width*e.imageData.height*4);var t=new On(e);return this.textures[e.id]=t,v(this,no)[no].push(t),this.stats.numTextures++,t},i.createTextureSet=function(e){if(this.destroyed)return new ue("Failed to create TextureSet in SceneModel - SceneModel already destroyed");if(this.built)return new ue("Failed to create TextureSet in SceneModel - SceneModel already built");if(this.textureSets[e.id])return new ue("Failed to create TextureSet in SceneModel - TextureSet already exists with this ID: "+e.id);var t,i,r,n,o;if(null!=e.colorTextureId){if(!(t=this.textures[e.colorTextureId]))return new ue("Failed to create TextureSet in SceneModel - Texture not found: "+e.colorTextureId+" - ensure that you create it first with createTexture()");t.channel=0}if(null!=e.metallicRoughnessTextureId){if(!(i=this.textures[e.metallicRoughnessTextureId]))return new ue("Failed to create TextureSet in SceneModel - Texture not found: "+e.metallicRoughnessTextureId+" - ensure that you create it first with createTexture()");i.channel=1}if(null!=e.normalsTextureId){if(!(r=this.textures[e.normalsTextureId]))return new ue("Failed to create TextureSet in SceneModel - Texture not found: "+e.normalsTextureId+" - ensure that you create it first with createTexture()");r.channel=2}if(null!=e.emissiveTextureId){if(!(n=this.textures[e.emissiveTextureId]))return new ue("Failed to create TextureSet in SceneModel - Texture not found: "+e.emissiveTextureId+" - ensure that you create it first with createTexture()");n.channel=3}if(null!=e.occlusionTextureId){if(!(o=this.textures[e.occlusionTextureId]))return new ue("Failed to create TextureSet in SceneModel - Texture not found: "+e.occlusionTextureId+" - ensure that you create it first with createTexture()");o.channel=4}var s=new Mn(e,{emissiveTexture:n,occlusionTexture:o,metallicRoughnessTexture:i,colorTexture:t});return this.textureSets[e.id]=s,this.stats.numTextureSets++,s},i.createGeometry=function(e){if(this.destroyed)return new ue("Failed to create Geometry in SceneModel - SceneModel already destroyed");if(this.built)return new ue("Failed to create Geometry in SceneModel - SceneModel already built");if(!e)return new ue("Failed to create Geometry in SceneModel - Parameters expected: geometryParams");if(null==e.id)return new ue("Failed to create Geometry in SceneModel - Parameter expected: geometryParams.id");var t=e.id;if(this.geometries[t])return new ue("Failed to create Geometry in SceneModel - Geometry with this ID already created: "+t);var i=e.primitive;if(i!==ze&&i!==qe&&i!==Ze&&i!==Qe&&i!==Je)return new ue("Failed to create Geometry in SceneModel - Unsupported value for geometryParams.primitive: '"+i+"' - supported values are PointsPrimitive, LinesPrimitive, TrianglesPrimitive, SolidPrimitive and SurfacePrimitive");if(!e.positions)return new ue("Failed to create Geometry in SceneModel - Param expected: geometryParams.positions");if(!e.indices&&i!==ze)return new ue("Failed to create Geometry in SceneModel - Param expected: geometryParams.indices (required for primitive type)");if(e.uvs&&e.uvs.length/2!=e.positions.length/3)return new ue("Failed to create Geometry in SceneModel - mismatch between given quantities of vertex positions and UVs");if(e.indices)for(var r=e.positions.length/3,n=0,o=e.indices.length;n<o;n++){var s=e.indices[n];if(s<0||s>=r)return new ue("Failed to create Geometry in SceneModel - indices out of range of vertex positions");if(e.uvs&&(s<0||s>=e.uvs.length/2))return new ue("Failed to create Geometry in SceneModel - indices out of range of vertex UVs")}var a=new bn(ro(e));return this.geometries[t]=a,this.stats.numGeometries++,e.indices?a.primitive===Ze?this.stats.numTriangles+=e.indices.length/3:a.primitive===qe&&(this.stats.numLines+=e.indices.length/2):a.primitive===ze&&(this.stats.numPoints+=e.positions.length/3),this.stats.numVertices+=e.positions.length/3,a},i.createGeometryCompressed=function(e){if(this.destroyed)return new ue("Failed to add compressed Geometry to SceneModel - SceneModel already destroyed");if(this.built)return new ue("Failed to add compressed Geometry to SceneModel - SceneModel already built");if(!e)return new ue("Failed to add compressed Geometry to SceneModel - Parameters expected: geometryCompressedParams");var t=e.id;if(this.geometries[t])return new ue("Failed to add compressed Geometry to SceneModel - Geometry with this ID already created: "+t);var i=e.primitive;if(i!==ze&&i!==qe&&i!==Ze&&i!==Qe&&i!==Je)return new ue("Failed to add compressed Geometry to SceneModel - Unsupported value for geometryCompressedParams.primitive: '"+i+"' - supported values are PointsPrimitive, LinesPrimitive, TrianglesPrimitive, SolidPrimitive and SurfacePrimitive");var r=new bn(e);return this.geometries[t]=r,this.stats.numGeometries++,r},i.createMesh=function(e){if(this.destroyed)return new ue("Failed to create Mesh in SceneModel - SceneModel already destroyed");if(this.built)return new ue("Failed to create Mesh in SceneModel - SceneModel already built");if(this.meshes[e.id])return new ue("Failed to create Mesh in SceneModel - Mesh already exists with this ID: "+e.id);var t=this.geometries[e.geometryId];if(!t)return new ue("Failed to create Mesh in SceneModel - Geometry not found: "+e.geometryId);var i=e.textureSetId?this.textureSets[e.textureSetId]:void 0;if(e.textureSetId&&!i)return new ue("Failed to create Mesh in SceneModel - TextureSet not found: "+e.textureSetId);var r=new Bn({id:e.id,geometry:t,textureSet:i,matrix:e.matrix,color:e.color,opacity:e.opacity,roughness:e.roughness,metallic:e.metallic});return this.meshes[e.id]=r,this.stats.numMeshes++,r},i.createObject=function(e){if(this.destroyed)return new ue("Failed to create SceneObject - SceneModel already destroyed");if(this.built)return new ue("Failed to create SceneObject SceneModel already built");if(0===e.meshIds.length)return new ue("Failed to create SceneObject - no meshes specified");if(this.scene.objects[e.id])return new ue("Failed to create SceneObject - SceneObject already exists in Scene: "+e.id);for(var t=e.meshIds,i=[],r=0,n=t.length;r<n;r++){var o=t[r],s=this.meshes[o];if(!s)return new ue("Failed to create SceneObject - Mesh not found: "+o);if(v(this,so)[so][o])return new ue("Failed to create SceneObject - Mesh "+o+" already belongs to another SceneObject");i.push(s),v(this,so)[so][s.id]=!0}for(var a=new Sn({id:e.id,layerId:e.layerId||this.layerId,model:this,meshes:i}),c=0,l=i.length;c<l;c++)i[c].object=a;return v(this,oo)[oo]++,this.objects[e.id]=a,this.stats.numObjects++,a},i.build=function(){var e=this;return new Promise(function(t){if(e.destroyed)throw new ue("Failed to build SceneModel - SceneModel already destroyed");if(e.built)throw new ue("Failed to build SceneModel - SceneModel already built");v(e,ao)[ao](),e.built=!0,e.onBuilt.dispatch(e,null),t(e)})},t}(ce);function lo(){}var ho=/*#__PURE__*/f("onModelBuilts"),uo=/*#__PURE__*/f("onModelDestroys"),fo=/*#__PURE__*/f("center"),vo=/*#__PURE__*/f("aabbDirty"),po=/*#__PURE__*/f("aabb"),yo=/*#__PURE__*/f("registerObjects"),mo=/*#__PURE__*/f("deregisterObjects"),go=/*#__PURE__*/function(e){function t(){var t;return t=e.call(this,null,{})||this,Object.defineProperty(l(t),mo,{value:wo}),Object.defineProperty(l(t),yo,{value:bo}),t.models=void 0,t.objects=void 0,t.onModelCreated=void 0,t.onModelDestroyed=void 0,Object.defineProperty(l(t),ho,{writable:!0,value:void 0}),Object.defineProperty(l(t),uo,{writable:!0,value:void 0}),Object.defineProperty(l(t),fo,{writable:!0,value:void 0}),Object.defineProperty(l(t),vo,{writable:!0,value:void 0}),Object.defineProperty(l(t),po,{writable:!0,value:void 0}),v(l(t),po)[po]=Tr(),v(l(t),vo)[vo]=!0,t.models={},t.objects={},v(l(t),ho)[ho]={},v(l(t),uo)[uo]={},t.onModelCreated=new y(new ie.EventDispatcher),t.onModelDestroyed=new y(new ie.EventDispatcher),t}n(t,e);var i=t.prototype;return i.createModel=function(e){var t=this;if(this.destroyed)return new ue("Scene already destroyed");var i=e.id;if(this.models[i])return new ue("SceneModel already created in this Scene: "+i);var r=new co(this,e);return this.models[i]=r,r.onDestroyed.one(function(){delete t.models[r.id],v(t,mo)[mo](r),t.onModelDestroyed.dispatch(t,r)}),r.onBuilt.one(function(){v(t,yo)[yo](r),t.onModelCreated.dispatch(t,r)}),r},i.setAABBDirty=function(){v(this,vo)[vo]||(v(this,vo)[vo]=!0)},i.clear=function(){if(this.destroyed)return new ue("Scene already destroyed");for(var e in this.models)this.models[e].destroy()},i.destroy=function(){this.clear(),this.onModelCreated.clear(),this.onModelDestroyed.clear(),e.prototype.destroy.call(this)},r(t,[{key:"center",get:function(){if(v(this,vo)[vo]){var e=this.aabb;v(this,fo)[fo][0]=(e[0]+e[3])/2,v(this,fo)[fo][1]=(e[1]+e[4])/2,v(this,fo)[fo][2]=(e[2]+e[5])/2}return v(this,fo)[fo]}},{key:"aabb",get:function(){if(v(this,vo)[vo]){var e,t=at,i=at,r=at,n=st,o=st,s=st,a=this.objects,c=!1;for(var l in a)a.hasOwnProperty(l)&&((e=a[l].aabb)[0]<t&&(t=e[0]),e[1]<i&&(i=e[1]),e[2]<r&&(r=e[2]),e[3]>n&&(n=e[3]),e[4]>o&&(o=e[4]),e[5]>s&&(s=e[5]),c=!0);c||(t=-100,i=-100,r=-100,n=100,o=100,s=100),v(this,po)[po][0]=t,v(this,po)[po][1]=i,v(this,po)[po][2]=r,v(this,po)[po][3]=n,v(this,po)[po][4]=o,v(this,po)[po][5]=s,v(this,vo)[vo]=!1}return v(this,po)[po]}}]),t}(ce);function bo(e){var t=e.objects;for(var i in t){var r=t[i];this.objects[r.id]=r}v(this,vo)[vo]=!0}function wo(e){var t=e.objects;for(var i in t)delete this.objects[t[i].id];v(this,vo)[vo]=!0}var Po={__proto__:null,Scene:go,SceneModel:co,SceneObject:Sn,Texture:On,TextureSet:Mn,Geometry:bn,GeometryBucket:gn,Mesh:Bn,compressGeometryParams:ro,getSceneObjectGeometry:_n},Eo=new Float32Array(2),To=/*#__PURE__*/f("insertItem"),_o=/*#__PURE__*/function(){function e(e){Object.defineProperty(this,To,{value:Io}),this.root=void 0,this.maxDepth=void 0,this.maxDepth=(null==e?void 0:e.maxDepth)||10,this.root={aabb:e.aabb.slice()}}return e.prototype.insertItem=function(e,t){v(this,To)[To](this.root,{item:e},t,1)},e}();function Io(e,t,i,r){if(r>=this.maxDepth)return e.items=e.items||[],void e.items.push(t);if(e.left&&xr(e.left.aabb,i))v(this,To)[To](e.left,t,i,r+1);else if(e.right&&xr(e.right.aabb,i))v(this,To)[To](e.right,t,i,r+1);else{var n=e.aabb;Eo[0]=n[2]-n[0],Eo[1]=n[3]-n[1];var o=0;if(Eo[1]>Eo[o]&&(o=1),!e.left){var s=n.slice();if(s[o+2]=(n[o]+n[o+2])/2,e.left={aabb:s},xr(s,i))return void v(this,To)[To](e.left,t,i,r+1)}if(!e.right){var a=n.slice();if(a[o]=(n[o]+n[o+2])/2,e.right={aabb:a},xr(a,i))return void v(this,To)[To](e.right,t,i,r+1)}e.items=e.items||[],e.items.push(t)}}var xo={__proto__:null,KdVertex2:function(){this.sceneObject=void 0,this.worldPos=void 0,this.canvasPos=void 0},KdTree2:_o,createKdTree2FromSceneObjectVerts:function(e){var t=new _o({aabb:e.canvasBoundary}),i=Qt(e.viewMatrix),r=Qt(e.projMatrix),n=Hr(i,r),o=e.canvasBoundary,s=e.sceneObjects;if(s)for(var a=0,c=s.length;a<c;a++)l(s[a]);function l(e,t){void 0===t&&(t=Nr),t!==Ur&&(t=Xr(n,e.aabb)),t!==Gr&&_n(e,function(t){for(var i=t.positionsWorld,r=0,n=i.length;r<n;r+=3){var o=Et();o[0]=i[r],o[1]=i[r+1],o[2]=i[r+2],o[3]=1,h(e,o)}return!1})}function h(e,n){var s=Et(),a=Et(),c=new Uint16Array(2);vi(i,n,s),vi(r,s,a),c[0]=Math.floor((1+a[0]/a[3])*o[2]/2),c[1]=Math.floor((1-a[1]/a[3])*o[3]/2),t.insertItem({sceneObject:e,worldPos:n,canvasPos:c},[c[0],c[1],c[0],c[1]])}return t},searchKdTree2ForNearestNeighbor:function(e){return[]}},So=new Float32Array(3),Mo=/*#__PURE__*/f("root"),Oo=/*#__PURE__*/f("maxDepth"),Ro=/*#__PURE__*/f("numNodes"),jo=/*#__PURE__*/f("numObjects"),Do=/*#__PURE__*/f("insertItem"),Ao=/*#__PURE__*/function(){function e(e){Object.defineProperty(this,Do,{value:Co}),Object.defineProperty(this,Mo,{writable:!0,value:void 0}),Object.defineProperty(this,Oo,{writable:!0,value:void 0}),Object.defineProperty(this,Ro,{writable:!0,value:void 0}),Object.defineProperty(this,jo,{writable:!0,value:void 0}),v(this,Oo)[Oo]=(null==e?void 0:e.maxDepth)||10,v(this,Mo)[Mo]={index:0,aabb:e.aabb.slice()},v(this,Ro)[Ro]=0}return e.prototype.insertItem=function(e,t){v(this,Do)[Do](v(this,Mo)[Mo],{index:v(this,jo)[jo]++,item:e},t,1)},r(e,[{key:"root",get:function(){return v(this,Mo)[Mo]}}]),e}();function Co(e,t,i,r){if(r>=v(this,Oo)[Oo])return e.items=e.items||[],e.items.push(t),void Ar(e.aabb,i);if(e.left&&Sr(e.left.aabb,i))v(this,Do)[Do](e.left,t,i,r+1);else if(e.right&&Sr(e.right.aabb,i))v(this,Do)[Do](e.right,t,i,r+1);else{var n=e.aabb;So[0]=n[3]-n[0],So[1]=n[4]-n[1],So[2]=n[5]-n[2];var o=0;if(So[1]>So[o]&&(o=1),So[2]>So[o]&&(o=2),!e.left){var s=n.slice();if(s[o+3]=(n[o]+n[o+3])/2,e.left={index:v(this,Ro)[Ro]++,aabb:s},Sr(s,i))return void v(this,Do)[Do](e.left,t,i,r+1)}if(!e.right){var a=n.slice();if(a[o]=(n[o]+n[o+3])/2,e.right={index:v(this,Ro)[Ro]++,aabb:a},Sr(a,i))return void v(this,Do)[Do](e.right,t,i,r+1)}e.items=e.items||[],e.items.push(t),Ar(e.aabb,i)}}var Bo=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}return n(t,e),t}(Ao),ko=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}return n(t,e),t}(Ao),Lo=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}return n(t,e),t}(Ao),Fo=new Int16Array(6);function Uo(e,t,i){var r=e[3*t+1],n=e[3*t+2],o=Fo;o[0]=o[3]=e[3*t],o[1]=o[4]=r,o[2]=o[5]=n,i.insertItem({a:t},o)}function No(e,t,i,r){var n=e[3*t],o=e[3*t+1],s=e[3*t+2],a=e[3*i],c=e[3*i+1],l=e[3*i+2],h=Fo;h[0]=Math.min(n,a),h[1]=Math.min(o,c),h[2]=Math.min(s,l),h[3]=Math.max(n,a),h[4]=Math.max(o,c),h[5]=Math.max(s,l),r.insertItem({a:t,b:i},h)}function Go(e,t,i,r,n){var o=e[3*t],s=e[3*t+1],a=e[3*t+2],c=e[3*i],l=e[3*i+1],h=e[3*i+2],u=e[3*r],d=e[3*r+1],f=e[3*r+2],v=Fo;v[0]=Math.min(o,c,u),v[1]=Math.min(s,l,d),v[2]=Math.min(a,h,f),v[3]=Math.max(o,c,u),v[4]=Math.max(s,l,d),v[5]=Math.max(a,h,f),n.insertItem({a:t,b:i,c:r},v)}var Vo,Ho,Xo={__proto__:null,PrimsKdTree3:Lo,SceneObjectsKdTree3:Bo,KdTree3:Ao,createSceneObjectsKdTree3:function(e){for(var t=jr(),i=0,r=e.length;i<r;i++)Ar(t,e[i].aabb);for(var n=new Bo({aabb:t}),o=0,s=e.length;o<s;o++){var a=e[o];n.insertItem(a,a.aabb)}return n},SceneObjectsPrimsKdTree3:ko,createSceneObjectPrimsKdTree3:function(e){var t=new Int16Array(6);function i(e,i,r,n,o){var s=r[3*n+1],a=r[3*n+2],c=t;c[0]=c[3]=r[3*n],c[1]=c[4]=s,c[2]=c[5]=a,o.insertItem({sceneObject:e,geometryBucket:i,prim:{a:n}},c)}function r(e,i,r,n,o,s){var a=r[3*n],c=r[3*n+1],l=r[3*n+2],h=r[3*o],u=r[3*o+1],d=r[3*o+2],f=t;f[0]=Math.min(a,h),f[1]=Math.min(c,u),f[2]=Math.min(l,d),f[3]=Math.max(a,h),f[4]=Math.max(c,u),f[5]=Math.max(l,d),s.insertItem({sceneObject:e,geometryBucket:i,prim:{a:n,b:o}},f)}function n(e,i,r,n,o,s,a){var c=r[3*n],l=r[3*n+1],h=r[3*n+2],u=r[3*o],d=r[3*o+1],f=r[3*o+2],v=r[3*s],p=r[3*s+1],y=r[3*s+2],m=t;m[0]=Math.min(c,u,v),m[1]=Math.min(l,d,p),m[2]=Math.min(h,f,y),m[3]=Math.max(c,u,v),m[4]=Math.max(l,d,p),m[5]=Math.max(h,f,y),a.insertItem({sceneObject:e,geometryBucket:i,prim:{a:n,b:o,c:s}},m)}for(var o=jr(),s=0,a=e.length;s<a;s++)Ar(o,e[s].aabb);for(var c=new ko({aabb:o}),l=function(){var t=e[h];_n(t,function(e){var o=e.geometryBucket,s=e.positionsWorld,a=o.indices;switch(e.geometry.primitive){case ze:for(var l=0,h=s.length/3;l<h;l++)i(t,o,s,l,c);break;case Ze:if(a)for(var u=0,d=a.length;u<d;u+=3)n(t,o,s,a[u],a[u+1],a[u+2],c);break;case qe:if(a)for(var f=0,v=a.length;f<v;f+=2)r(t,o,s,a[f],a[f+1],c)}return!0})},h=0,u=e.length;h<u;h++)l();return c},createPrimsKdTree3:function(e,t,i){var r=new Lo({aabb:Br(_r(),t)});switch(e){case ze:for(var n=0,o=t.length/3;n<o;n++)Uo(t,n,r);break;case Ze:if(i)for(var s=0,a=i.length;s<a;s+=3)Go(t,i[s],i[s+1],i[s+2],r);break;case qe:if(i)for(var c=0,l=i.length;c<l;c+=2)No(t,i[c],i[c+1],r)}return r},searchKdTree3WithAABB:function(e){var t=[];return function e(i,r){if(r!==Gr&&(r=Wr())!==Gr){var n=i.items;if(n&&n.length>0)for(var o=0,s=n.length;o<s;o++)t.push(n[o].item);i.left&&e(i.left,r),i.right&&e(i.right,r)}}(e.kdTree.root,Nr),t},searchKdTree3WithFrustum:function(e){var t=e.frustum,i=[];return function e(r,n){if(n!==Gr&&(n=Xr(t,r.aabb))!==Gr){var o=r.items;if(o&&o.length>0)for(var s=0,a=o.length;s<a;s++)i.push(o[s].item);r.left&&e(r.left,n),r.right&&e(r.right,n)}}(e.kdTree.root,Nr),i},searchKdTree3WithRay:function(e){var t=[];return function e(i,r){if(r!==Gr&&(r=0)!==Gr){var n=i.items;if(n&&n.length>0)for(var o=0,s=n.length;o<s;o++)t.push(n[o].item);i.left&&e(i.left,r),i.right&&e(i.right,r)}}(e.kdTree.root,Nr),t}},Wo=1001,Yo=((Vo={})[1e3]="BasicEntity",Vo[1001]="BasicAggregation",Vo),Ko={__proto__:null,BasicEntity:1e3,BasicAggregation:Wo,typeNames:Yo,typeCodes:{BasicEntity:1e3,BasicAggregation:Wo}},zo=2023,qo=2026,Zo=((Ho={})[2e3]="Bridge",Ho[2001]="BridgePart",Ho[2002]="BridgeInstallation",Ho[2003]="BridgeConstructiveElement",Ho[2004]="BridgeRoom",Ho[2005]="BridgeFurniture",Ho[2006]="Building",Ho[2007]="BuildingPart",Ho[2008]="BuildingInstallation",Ho[2009]="BuildingConstructiveElement",Ho[2010]="BuildingFurniture",Ho[2011]="BuildingStorey",Ho[2012]="BuildingRoom",Ho[2013]="BuildingUnit",Ho[2014]="CityFurniture",Ho[2015]="CityObjectGroup",Ho[2016]="LandUse",Ho[2017]="OtherConstruction",Ho[2018]="PlantCover",Ho[2019]="SolitaryVegetationObject",Ho[2020]="TINRelief",Ho[2021]="TransportationSquare",Ho[2022]="Railway",Ho[zo]="Road",Ho[2024]="Tunnel",Ho[2025]="TunnelPart",Ho[2026]="TunnelInstallation",Ho[2027]="TunnelInstallation",Ho[2028]="TunnelHollowSpace",Ho[2029]="TunnelFurniture",Ho[2030]="WaterBody",Ho[2031]="Waterway",Ho),Qo={Bridge:2e3,BridgePart:2001,BridgeInstallation:2002,BridgeConstructiveElement:2003,BridgeRoom:2004,BridgeFurniture:2005,Building:2006,BuildingPart:2007,BuildingInstallation:2008,BuildingConstructiveElement:2009,BuildingFurniture:2010,BuildingStorey:2011,BuildingRoom:2012,BuildingUnit:2013,CityFurniture:2014,CityObjectGroup:2015,LandUse:2016,OtherConstruction:2017,PlantCover:2018,SolitaryVegetationObject:2019,TINRelief:2020,TransportationSquare:2021,Railway:2022,Road:zo,Tunnel:2024,TunnelPart:2025,TunnelInstallation:qo,TunnelConstructiveElement:qo,TunnelHollowSpace:2028,TunnelFurniture:2029,WaterBody:2030,Waterway:2031},Jo={__proto__:null,BasicAggregation:2001,Bridge:2e3,BridgePart:2001,BridgeInstallation:2002,BridgeConstructiveElement:2003,BridgeRoom:2004,BridgeFurniture:2005,Building:2006,BuildingPart:2007,BuildingInstallation:2008,BuildingConstructiveElement:2009,BuildingFurniture:2010,BuildingStorey:2011,BuildingRoom:2012,BuildingUnit:2013,CityFurniture:2014,CityObjectGroup:2015,LandUse:2016,OtherConstruction:2017,PlantCover:2018,SolitaryVegetationObject:2019,TINRelief:2020,TransportationSquare:2021,Railway:2022,Road:zo,Tunnel:2024,TunnelPart:2025,TunnelInstallation:qo,TunnelConstructiveElement:2027,TunnelHollowSpace:2028,TunnelFurniture:2029,WaterBody:2030,Waterway:2031,typeNames:Zo,typeCodes:Qo};function $o(e,t,i){i=i||2;var r,n,o,s,a,c,l,h=t&&t.length,u=h?t[0]*i:e.length,d=es(e,0,u,i,!0),f=[];if(!d||d.next===d.prev)return f;if(h&&(d=function(e,t,i,r){var n,o,s,a=[];for(n=0,o=t.length;n<o;n++)(s=es(e,t[n]*r,n<o-1?t[n+1]*r:e.length,r,!1))===s.next&&(s.steiner=!0),a.push(us(s));for(a.sort(as),n=0;n<a.length;n++)cs(a[n],i),i=ts(i,i.next);return i}(e,t,d,i)),e.length>80*i){r=o=e[0],n=s=e[1];for(var v=i;v<u;v+=i)(a=e[v])<r&&(r=a),(c=e[v+1])<n&&(n=c),a>o&&(o=a),c>s&&(s=c);l=0!==(l=Math.max(o-r,s-n))?1/l:0}return is(d,f,i,r,n,l),f}function es(e,t,i,r,n){var o,s;if(n===_s(e,t,i,r)>0)for(o=t;o<i;o+=r)s=Ps(o,e[o],e[o+1],s);else for(o=i-r;o>=t;o-=r)s=Ps(o,e[o],e[o+1],s);return s&&ps(s,s.next)&&(Es(s),s=s.next),s}function ts(e,t){if(!e)return e;t||(t=e);var i,r=e;do{if(i=!1,r.steiner||!ps(r,r.next)&&0!==vs(r.prev,r,r.next))r=r.next;else{if(Es(r),(r=t=r.prev)===r.next)break;i=!0}}while(i||r!==t);return t}function is(e,t,i,r,n,o,s){if(e){!s&&o&&function(e,t,i,r){var n=e;do{null===n.z&&(n.z=hs(n.x,n.y,t,i,r)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==e);n.prevZ.nextZ=null,n.prevZ=null,function(e){var t,i,r,n,o,s,a,c,l=1;do{for(i=e,e=null,o=null,s=0;i;){for(s++,r=i,a=0,t=0;t<l&&(a++,r=r.nextZ);t++);for(c=l;a>0||c>0&&r;)0!==a&&(0===c||!r||i.z<=r.z)?(n=i,i=i.nextZ,a--):(n=r,r=r.nextZ,c--),o?o.nextZ=n:e=n,n.prevZ=o,o=n;i=r}o.nextZ=null,l*=2}while(s>1)}(n)}(e,r,n,o);for(var a,c,l=e;e.prev!==e.next;)if(a=e.prev,c=e.next,o?ns(e,r,n,o):rs(e))t.push(a.i/i),t.push(e.i/i),t.push(c.i/i),Es(e),e=c.next,l=c.next;else if((e=c)===l){s?1===s?is(e=os(ts(e),t,i),t,i,r,n,o,2):2===s&&ss(e,t,i,r,n,o):is(ts(e),t,i,r,n,o,1);break}}}function rs(e){var t=e.prev,i=e,r=e.next;if(vs(t,i,r)>=0)return!1;for(var n=e.next.next;n!==e.prev;){if(ds(t.x,t.y,i.x,i.y,r.x,r.y,n.x,n.y)&&vs(n.prev,n,n.next)>=0)return!1;n=n.next}return!0}function ns(e,t,i,r){var n=e.prev,o=e,s=e.next;if(vs(n,o,s)>=0)return!1;for(var a=n.x>o.x?n.x>s.x?n.x:s.x:o.x>s.x?o.x:s.x,c=n.y>o.y?n.y>s.y?n.y:s.y:o.y>s.y?o.y:s.y,l=hs(n.x<o.x?n.x<s.x?n.x:s.x:o.x<s.x?o.x:s.x,n.y<o.y?n.y<s.y?n.y:s.y:o.y<s.y?o.y:s.y,t,i,r),h=hs(a,c,t,i,r),u=e.prevZ,d=e.nextZ;u&&u.z>=l&&d&&d.z<=h;){if(u!==e.prev&&u!==e.next&&ds(n.x,n.y,o.x,o.y,s.x,s.y,u.x,u.y)&&vs(u.prev,u,u.next)>=0)return!1;if(u=u.prevZ,d!==e.prev&&d!==e.next&&ds(n.x,n.y,o.x,o.y,s.x,s.y,d.x,d.y)&&vs(d.prev,d,d.next)>=0)return!1;d=d.nextZ}for(;u&&u.z>=l;){if(u!==e.prev&&u!==e.next&&ds(n.x,n.y,o.x,o.y,s.x,s.y,u.x,u.y)&&vs(u.prev,u,u.next)>=0)return!1;u=u.prevZ}for(;d&&d.z<=h;){if(d!==e.prev&&d!==e.next&&ds(n.x,n.y,o.x,o.y,s.x,s.y,d.x,d.y)&&vs(d.prev,d,d.next)>=0)return!1;d=d.nextZ}return!0}function os(e,t,i){var r=e;do{var n=r.prev,o=r.next.next;!ps(n,o)&&ys(n,r,r.next,o)&&bs(n,o)&&bs(o,n)&&(t.push(n.i/i),t.push(r.i/i),t.push(o.i/i),Es(r),Es(r.next),r=e=o),r=r.next}while(r!==e);return ts(r)}function ss(e,t,i,r,n,o){var s=e;do{for(var a=s.next.next;a!==s.prev;){if(s.i!==a.i&&fs(s,a)){var c=ws(s,a);return s=ts(s,s.next),c=ts(c,c.next),is(s,t,i,r,n,o),void is(c,t,i,r,n,o)}a=a.next}s=s.next}while(s!==e)}function as(e,t){return e.x-t.x}function cs(e,t){if(t=function(e,t){var i,r=t,n=e.x,o=e.y,s=-Infinity;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var a=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(a<=n&&a>s){if(s=a,a===n){if(o===r.y)return r;if(o===r.next.y)return r.next}i=r.x<r.next.x?r:r.next}}r=r.next}while(r!==t);if(!i)return null;if(n===s)return i;var c,l=i,h=i.x,u=i.y,d=Infinity;r=i;do{n>=r.x&&r.x>=h&&n!==r.x&&ds(o<u?n:s,o,h,u,o<u?s:n,o,r.x,r.y)&&(c=Math.abs(o-r.y)/(n-r.x),bs(r,e)&&(c<d||c===d&&(r.x>i.x||r.x===i.x&&ls(i,r)))&&(i=r,d=c)),r=r.next}while(r!==l);return i}(e,t),t){var i=ws(t,e);ts(t,t.next),ts(i,i.next)}}function ls(e,t){return vs(e.prev,e,t.prev)<0&&vs(t.next,e,e.next)<0}function hs(e,t,i,r,n){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*n)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*n)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function us(e){var t=e,i=e;do{(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next}while(t!==e);return i}function ds(e,t,i,r,n,o,s,a){return(n-s)*(t-a)-(e-s)*(o-a)>=0&&(e-s)*(r-a)-(i-s)*(t-a)>=0&&(i-s)*(o-a)-(n-s)*(r-a)>=0}function fs(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&ys(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}(e,t)&&(bs(e,t)&&bs(t,e)&&function(e,t){var i=e,r=!1,n=(e.x+t.x)/2,o=(e.y+t.y)/2;do{i.y>o!=i.next.y>o&&i.next.y!==i.y&&n<(i.next.x-i.x)*(o-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next}while(i!==e);return r}(e,t)&&(vs(e.prev,e,t.prev)||vs(e,t.prev,t))||ps(e,t)&&vs(e.prev,e,e.next)>0&&vs(t.prev,t,t.next)>0)}function vs(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function ps(e,t){return e.x===t.x&&e.y===t.y}function ys(e,t,i,r){var n=gs(vs(e,t,i)),o=gs(vs(e,t,r)),s=gs(vs(i,r,e)),a=gs(vs(i,r,t));return n!==o&&s!==a||!(0!==n||!ms(e,i,t))||!(0!==o||!ms(e,r,t))||!(0!==s||!ms(i,e,r))||!(0!==a||!ms(i,t,r))}function ms(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function gs(e){return e>0?1:e<0?-1:0}function bs(e,t){return vs(e.prev,e,e.next)<0?vs(e,t,e.next)>=0&&vs(e,e.prev,t)>=0:vs(e,t,e.prev)<0||vs(e,e.next,t)<0}function ws(e,t){var i=new Ts(e.i,e.x,e.y),r=new Ts(t.i,t.x,t.y),n=e.next,o=t.prev;return e.next=t,t.prev=e,i.next=n,n.prev=i,r.next=i,i.prev=r,o.next=r,r.prev=o,r}function Ps(e,t,i,r){var n=new Ts(e,t,i);return r?(n.next=r.next,n.prev=r,r.next.prev=n,r.next=n):(n.prev=n,n.next=n),n}function Es(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Ts(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function _s(e,t,i,r){for(var n=0,o=t,s=i-r;o<i;o+=r)n+=(e[s]-e[o])*(e[o+1]+e[s+1]),s=o;return n}$o.deviation=function(e,t,i,r){var n=t&&t.length,o=Math.abs(_s(e,0,n?t[0]*i:e.length,i));if(n)for(var s=0,a=t.length;s<a;s++)o-=Math.abs(_s(e,t[s]*i,s<a-1?t[s+1]*i:e.length,i));var c=0;for(s=0;s<r.length;s+=3){var l=r[s]*i,h=r[s+1]*i,u=r[s+2]*i;c+=Math.abs((e[l]-e[u])*(e[h+1]-e[l+1])-(e[l]-e[h])*(e[u+1]-e[l+1]))}return 0===o&&0===c?0:Math.abs((c-o)/o)},$o.flatten=function(e){for(var t=e[0][0].length,i={vertices:[],holes:[],dimensions:t},r=0,n=0;n<e.length;n++){for(var o=0;o<e[n].length;o++)for(var s=0;s<t;s++)i.vertices.push(e[n][o][s]);n>0&&i.holes.push(r+=e[n-1].length)}return i};var Is=wt(),xs=Pt(),Ss=Pt(),Ms=Pt();function Os(e,t,i){for(var r=[],n=t.scale||Pt([1,1,1]),o=t.translate||Pt([0,0,0]),s=0,a=0;s<e.length;s++,a+=3){var c=e[s][0]*n[0]+o[0],l=e[s][1]*n[1]+o[1],h=e[s][2]*n[2]+o[2];r.push(i?[c,h,l]:[c,l,h])}return r}function Rs(e,t,i){if(e.dataModel&&e.dataModel.createObject({id:i,name:t.type+" : "+i,type:0|Qo[t.type],parent:t.parents?t.parents[0]:null}),e.sceneModel){if(!(t.geometry&&t.geometry.length>0))return;for(var r=[],n=0,o=t.geometry.length;n<o;n++){var s=t.geometry[n],a=void 0,c=void 0,l=e.fileData.appearance;if(l){var h=l.materials;if(h){var u=s.material;if(u){var d=Object.keys(u);if(d.length>0){var f=u[d[0]];if(void 0!==f.value)a=h[f.value];else{var v=f.values;if(v){c=[];for(var p=0,y=v.length;p<y;p++)c.push(h[v[n]])}}}}}}c?Ds(e,s,c,r):Cs(e,s,a,r)}r.length>0&&e.sceneModel.createObject({id:i,meshIds:r})}}function js(e,t,i){t.parents&&e.dataModel.createRelationship({relatingObjectId:t.parents[0],relatedObjectId:i,type:Wo})}function Ds(e,t,i,r){switch(t.type){case"MultiPoint":case"MultiLineString":break;case"MultiSurface":case"CompositeSurface":As(e,i,t.boundaries,r);break;case"Solid":for(var n=t.boundaries,o=0;o<n.length;o++)As(e,i,n[o],r);break;case"MultiSolid":case"CompositeSolid":for(var s=t.boundaries,a=0;a<s.length;a++)for(var c=0;c<s[a].length;c++)As(e,i,s[a][c],r)}}function As(e,t,i,r){for(var n=e.vertices,o=e.sceneModel,s=0;s<i.length;s++){for(var a=i[s],c=t[s]||{diffuseColor:[.8,.8,.8],transparency:1},l=[],h=[],u=[],d={positions:[],indices:[]},f=0;f<a.length;f++){l.length>0&&h.push(l.length);var v=ks(e,a[f],u,d);l.push.apply(l,v)}if(3===l.length)d.indices.push(l[0]),d.indices.push(l[1]),d.indices.push(l[2]);else if(l.length>3){for(var p=[],y=0;y<l.length;y++)p.push({x:n[u[l[y]]][0],y:n[u[l[y]]][1],z:n[u[l[y]]][2]});for(var m=Ls(p,Pt()),g=[],b=0;b<p.length;b++)Fs(p[b],m,Is),g.unshift(Is[0]),g.unshift(Is[1]);for(var w=$o(g,h,2),P=0;P<w.length;P+=3)d.indices.unshift(l[w[P]]),d.indices.unshift(l[w[P+1]]),d.indices.unshift(l[w[P+2]])}var E=""+e.nextId++;o.createGeometry({id:E,primitive:Ze,positions:d.positions,indices:d.indices});var T=""+e.nextId++;o.createMesh({id:T,geometryId:E,color:c&&c.diffuseColor?c.diffuseColor:[.8,.8,.8],opacity:c&&void 0!==c.transparency?1-c.transparency:1}),r.push(T)}}function Cs(e,t,i,r){var n=e.sceneModel,o=[],s={positions:[],indices:[]};switch(t.type){case"MultiPoint":case"MultiLineString":break;case"MultiSurface":case"CompositeSurface":Bs(e,t.boundaries,o,s);break;case"Solid":for(var a=t.boundaries,c=0;c<a.length;c++)Bs(e,a[c],o,s);break;case"MultiSolid":case"CompositeSolid":for(var l=t.boundaries,h=0;h<l.length;h++)for(var u=0;u<l[h].length;u++)Bs(e,l[h][u],o,s)}if(s.positions.length>0&&s.indices.length>0){var d=""+e.nextId++;n.createGeometry({id:d,primitive:Ze,positions:s.positions,indices:s.indices});var f=""+e.nextId++;n.createMesh({id:f,geometryId:d,color:i&&i.diffuseColor?i.diffuseColor:[.8,.8,.8],opacity:1}),r.push(f)}}function Bs(e,t,i,r){for(var n=e.vertices,o=0;o<t.length;o++){for(var s=[],a=[],c=0;c<t[o].length;c++){s.length>0&&a.push(s.length);var l=ks(e,t[o][c],i,r);s.push.apply(s,l)}if(3===s.length)r.indices.push(s[0]),r.indices.push(s[1]),r.indices.push(s[2]);else if(s.length>3){for(var h=[],u=0;u<s.length;u++)h.push({x:n[i[s[u]]][0],y:n[i[s[u]]][1],z:n[i[s[u]]][2]});for(var d=Ls(h,Pt()),f=[],v=0;v<h.length;v++)Fs(h[v],d,Is),f.unshift(Is[0]),f.unshift(Is[1]);for(var p=$o(f,a,2),y=0;y<p.length;y+=3)r.indices.unshift(s[p[y]]),r.indices.unshift(s[p[y+1]]),r.indices.unshift(s[p[y+2]])}}}function ks(e,t,i,r){for(var n=e.vertices,o=[],s=0,a=t.length;s<a;s++){var c=t[s];if(i.includes(c)){var l=i.indexOf(c);o.push(l)}else r.positions.push(n[c][0]),r.positions.push(n[c][1]),r.positions.push(n[c][2]),o.push(i.length),i.push(c)}return o}function Ls(e,t){for(var i=0;i<e.length;i++){var r=i+1;r===e.length&&(r=0),t[0]+=(e[i].y-e[r].y)*(e[i].z+e[r].z),t[1]+=(e[i].z-e[r].z)*(e[i].x+e[r].x),t[2]+=(e[i].x-e[r].x)*(e[i].y+e[r].y)}return Kt(t)}function Fs(e,t,i){var r=xs,n=Ss,o=Ms;r[0]=e.x,r[1]=e.y,r[2]=e.z,n[0]=t.x,n[1]=t.y,n[2]=t.z,o[0]=1.1,o[1]=1.1,o[2]=1.1,Nt(Ot(o,n))<.01&&(o[0]+=1,o[1]+=2,o[2]+=3);var s=It(n,bt(o,n),Pt());o[0]-=s[0],o[1]-=s[1],o[2]-=s[2],Kt(o);var a=Ct(n,o,Pt()),c=bt(r,o),l=bt(r,a);i[0]=c,i[1]=l}var Us,Ns={__proto__:null,loadCityJSON:function(e,t){if(void 0===t&&(t={rotateX:!1}),e.sceneModel){if(e.sceneModel.destroyed)return Promise.reject(new ue("SceneModel already destroyed"));if(e.sceneModel.built)return Promise.reject(new ue("SceneModel already built"))}if(e.dataModel){if(e.dataModel.destroyed)return Promise.reject(new ue("DataModel already destroyed"));if(e.dataModel.built)return Promise.reject(new ue("DataModel already built"))}var i=e.fileData;return function(e){var t=e.fileData.CityObjects;for(var i in t)Rs(e,t[i],i);if(e.dataModel)for(var r in t)js(e,t[r],r)}({fileData:i,vertices:i.transform&&e.sceneModel?Os(i.vertices,i.transform,t.rotateX):i.vertices,sceneModel:e.sceneModel,dataModel:e.dataModel,nextId:0}),Promise.resolve()}},Gs={__proto__:null,loadDotBIM:function(e,t){return void 0===t&&(t={}),new Promise(function(i,r){if(e.sceneModel.destroyed)throw new ue("SceneModel already destroyed");if(e.sceneModel.built)throw new ue("SceneModel already built");if(e.dataModel){if(e.dataModel.destroyed)throw new ue("DataModel already destroyed");if(e.dataModel.built)throw new ue("DataModel already built")}!function(e){for(var t=e.fileData,i=t.meshes,r=0,n=i.length;r<n;r++){var o=i[r],s=e.sceneModel.createGeometry({id:o.mesh_id,primitive:Ze,positions:o.coordinates,indices:o.indices});s instanceof ue&&e.error("[SceneModel.createGeometry]: "+s.message)}for(var a=t.elements,c=0,l=a.length;c<l;c++){var h=a[c],u=""+h.guid;if(e.sceneModel){var d=u+"-mesh-"+c,f=e.sceneModel.createMesh({id:d,geometryId:h.mesh_id,baseColor:h.color});if(f instanceof ue){e.error("[SceneModel.createMesh]: "+f.message);continue}var v=e.sceneModel.createObject({id:u,meshIds:[d]});if(v instanceof ue){e.error("[SceneModel.createObject]: "+v.message);continue}}if(e.dataModel&&!e.dataModel.objects[h.guid]){var p=e.dataModel.createObject({id:u,type:h.type});p instanceof ue&&e.error("[SceneModel.createObject]: "+p.message)}}}({fileData:e.fileData,sceneModel:e.sceneModel,dataModel:e.dataModel,nextId:0,error:t.error||function(e){}}),i()})}},Vs=/*#__PURE__*/f("rendererViewObject"),Hs=/*#__PURE__*/f("state"),Xs=/*#__PURE__*/function(){function e(e,t,i){this.id=void 0,this.layer=void 0,this.sceneObject=void 0,Object.defineProperty(this,Vs,{writable:!0,value:void 0}),Object.defineProperty(this,Hs,{writable:!0,value:void 0}),this.id=t.id,this.layer=e,this.sceneObject=t,v(this,Vs)[Vs]=i,v(this,Hs)[Hs]={visible:!0,culled:!1,pickable:!0,clippable:!0,collidable:!0,xrayed:!1,selected:!1,highlighted:!1,edges:!1,colorize:new Float32Array(4),colorized:!1,opacityUpdated:!1},v(this,Vs)[Vs].setVisible(this.layer.view.viewIndex,v(this,Hs)[Hs].visible),this.layer.objectVisibilityUpdated(this,v(this,Hs)[Hs].visible,!0)}return e.prototype._destroy=function(){v(this,Hs)[Hs].visible&&this.layer.objectVisibilityUpdated(this,!1,!1),v(this,Hs)[Hs].xrayed&&this.layer.objectXRayedUpdated(this,!1),v(this,Hs)[Hs].selected&&this.layer.objectSelectedUpdated(this,!1),v(this,Hs)[Hs].highlighted&&this.layer.objectHighlightedUpdated(this,!1),v(this,Hs)[Hs].colorized&&this.layer.objectColorizeUpdated(this,!1),v(this,Hs)[Hs].opacityUpdated&&this.layer.objectOpacityUpdated(this,!1),this.layer.redraw()},r(e,[{key:"aabb",get:function(){return this.sceneObject.aabb}},{key:"visible",get:function(){return v(this,Hs)[Hs].visible},set:function(e){e!==v(this,Hs)[Hs].visible&&(v(this,Hs)[Hs].visible=e,v(this,Vs)[Vs].setVisible(this.layer.view.viewIndex,e),this.layer.objectVisibilityUpdated(this,e,!0),this.layer.redraw())}},{key:"xrayed",get:function(){return v(this,Hs)[Hs].xrayed},set:function(e){v(this,Hs)[Hs].xrayed!==e&&(v(this,Hs)[Hs].xrayed=e,v(this,Vs)[Vs].setXRayed(this.layer.view.viewIndex,e),this.layer.objectXRayedUpdated(this,e),this.layer.redraw())}},{key:"edges",get:function(){return v(this,Hs)[Hs].edges},set:function(e){v(this,Hs)[Hs].edges!==e&&(v(this,Hs)[Hs].edges=e,v(this,Vs)[Vs].setEdges(this.layer.view.viewIndex,e),this.layer.redraw())}},{key:"highlighted",get:function(){return v(this,Hs)[Hs].highlighted},set:function(e){e!==v(this,Hs)[Hs].highlighted&&(v(this,Hs)[Hs].highlighted=e,v(this,Vs)[Vs].setHighlighted(this.layer.view.viewIndex,e),this.layer.objectHighlightedUpdated(this,e),this.layer.redraw())}},{key:"selected",get:function(){return v(this,Hs)[Hs].selected},set:function(e){e!==v(this,Hs)[Hs].selected&&(v(this,Hs)[Hs].selected=e,v(this,Vs)[Vs].setSelected(this.layer.view.viewIndex,e),this.layer.objectSelectedUpdated(this,e),this.layer.redraw())}},{key:"culled",get:function(){return v(this,Hs)[Hs].culled},set:function(e){e!==v(this,Hs)[Hs].culled&&(v(this,Hs)[Hs].culled=e,this.layer.redraw())}},{key:"clippable",get:function(){return v(this,Hs)[Hs].clippable},set:function(e){e!==v(this,Hs)[Hs].clippable&&(v(this,Hs)[Hs].clippable=e,this.layer.redraw())}},{key:"collidable",get:function(){return v(this,Hs)[Hs].collidable},set:function(e){e!==v(this,Hs)[Hs].collidable&&(v(this,Hs)[Hs].collidable=e)}},{key:"pickable",get:function(){return v(this,Hs)[Hs].pickable},set:function(e){v(this,Hs)[Hs].pickable!==e&&(v(this,Hs)[Hs].pickable=e)}},{key:"colorize",get:function(){return v(this,Hs)[Hs].colorize},set:function(e){var t=v(this,Hs)[Hs].colorize;e?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=1,t[1]=1,t[2]=1),v(this,Hs)[Hs].colorized=!!e,this.layer.objectColorizeUpdated(this,v(this,Hs)[Hs].colorized),this.layer.redraw()}},{key:"opacity",get:function(){return v(this,Hs)[Hs].colorize[3]},set:function(e){var t=v(this,Hs)[Hs].colorize;v(this,Hs)[Hs].opacityUpdated=null!=e,t[3]=v(this,Hs)[Hs].opacityUpdated?e:1,this.layer.objectOpacityUpdated(this,v(this,Hs)[Hs].opacityUpdated),this.layer.redraw()}}]),e}(),Ws=/*#__PURE__*/f("state"),Ys=/*#__PURE__*/function(e){function t(t,i){var r;return void 0===i&&(i={}),(r=e.call(this,t,i)||this).view=void 0,r.onPos=void 0,r.onDir=void 0,r.onActive=void 0,Object.defineProperty(l(r),Ws,{writable:!0,value:void 0}),r.view=t,v(l(r),Ws)[Ws]={active:!1!==i.active,pos:new Float64Array(i.pos||[0,0,0]),dir:new Float32Array(i.pos||[0,0,-1]),dist:0},r.onPos=new y(new ie.EventDispatcher),r.onDir=new y(new ie.EventDispatcher),r.onActive=new y(new ie.EventDispatcher),r}n(t,e);var i=t.prototype;return i.flipDir=function(){var e=v(this,Ws)[Ws].dir;e[0]*=-1,e[1]*=-1,e[2]*=-1,v(this,Ws)[Ws].dist=-bt(v(this,Ws)[Ws].pos,v(this,Ws)[Ws].dir),this.onDir.dispatch(this,v(this,Ws)[Ws].dir),this.view.redraw()},i.destroy=function(){this.onPos.clear(),this.onDir.clear(),e.prototype.destroy.call(this)},r(t,[{key:"active",get:function(){return v(this,Ws)[Ws].active},set:function(e){v(this,Ws)[Ws].active!==e&&(v(this,Ws)[Ws].active=e,this.view.redraw(),this.onActive.dispatch(this,v(this,Ws)[Ws].active))}},{key:"pos",get:function(){return v(this,Ws)[Ws].pos},set:function(e){v(this,Ws)[Ws].pos.set(e),v(this,Ws)[Ws].dist=-bt(v(this,Ws)[Ws].pos,v(this,Ws)[Ws].dir),this.onPos.dispatch(this,v(this,Ws)[Ws].pos)}},{key:"dir",get:function(){return v(this,Ws)[Ws].dir},set:function(e){v(this,Ws)[Ws].dir.set(e),v(this,Ws)[Ws].dist=-bt(v(this,Ws)[Ws].pos,v(this,Ws)[Ws].dir),this.view.redraw(),this.onDir.dispatch(this,v(this,Ws)[Ws].dir)}},{key:"dist",get:function(){return v(this,Ws)[Ws].dist}}]),t}(ce),Ks=((Us={})[4e5]={abbrev:"m"},Us[400001]={abbrev:"cm"},Us[400002]={abbrev:"mm"},Us[400003]={abbrev:"yd"},Us[400004]={abbrev:"ft"},Us[400005]={abbrev:"in"},Us),zs=/*#__PURE__*/f("units"),qs=/*#__PURE__*/f("scale"),Zs=/*#__PURE__*/f("origin"),Qs=/*#__PURE__*/function(e){function t(t,i){var r;return void 0===i&&(i={units:et,scale:1,origin:[1,1,1]}),r=e.call(this,t,i)||this,Object.defineProperty(l(r),zs,{writable:!0,value:void 0}),Object.defineProperty(l(r),qs,{writable:!0,value:void 0}),Object.defineProperty(l(r),Zs,{writable:!0,value:void 0}),r.onUnits=void 0,r.onScale=void 0,r.onOrigin=void 0,r.onUnits=new y(new ie.EventDispatcher),r.onScale=new y(new ie.EventDispatcher),r.onOrigin=new y(new ie.EventDispatcher),v(l(r),zs)[zs]=et,v(l(r),qs)[qs]=1,v(l(r),Zs)[Zs]=Pt([0,0,0]),r.units=i.units,r.scale=i.scale,r.origin=i.origin,r}n(t,e);var i=t.prototype;return i.worldToRealPos=function(e,t){return void 0===t&&(t=Pt()),t[0]=v(this,Zs)[Zs][0]+v(this,qs)[qs]*e[0],t[1]=v(this,Zs)[Zs][1]+v(this,qs)[qs]*e[1],t[2]=v(this,Zs)[Zs][2]+v(this,qs)[qs]*e[2],t},i.realToWorldPos=function(e,t){return void 0===t&&(t=Pt()),t[0]=(e[0]-v(this,Zs)[Zs][0])/v(this,qs)[qs],t[1]=(e[1]-v(this,Zs)[Zs][1])/v(this,qs)[qs],t[2]=(e[2]-v(this,Zs)[Zs][2])/v(this,qs)[qs],t},i.destroy=function(){e.prototype.destroy.call(this),this.onUnits.clear(),this.onScale.clear(),this.onOrigin.clear()},r(t,[{key:"unitsInfo",get:function(){return Ks}},{key:"units",get:function(){return v(this,zs)[zs]},set:function(e){e||(e=et),Ks[e]||(this.error("Unsupported value for 'units': "+e+" defaulting to MetersUnit"),e=et),v(this,zs)[zs]=e,this.onUnits.dispatch(this,v(this,zs)[zs])}},{key:"scale",get:function(){return v(this,qs)[qs]},set:function(e){(e=e||1)<=0?this.error("scale value should be larger than zero"):(v(this,qs)[qs]=e,this.onScale.dispatch(this,v(this,qs)[qs]))}},{key:"origin",get:function(){return v(this,Zs)[Zs]},set:function(e){if(!e)return v(this,Zs)[Zs][0]=0,v(this,Zs)[Zs][1]=0,void(v(this,Zs)[Zs][2]=0);v(this,Zs)[Zs][0]=e[0],v(this,Zs)[Zs][1]=e[1],v(this,Zs)[Zs][2]=e[2],this.onOrigin.dispatch(this,v(this,Zs)[Zs])}}]),t}(ce),Js=/*#__PURE__*/f("state"),$s=/*#__PURE__*/function(e){function t(t,i){var r;return(r=e.call(this,t,i)||this).view=void 0,Object.defineProperty(l(r),Js,{writable:!0,value:void 0}),r.view=t,v(l(r),Js)[Js]={renderModes:[$e],enabled:!1!==i.enabled,kernelRadius:i.kernelRadius||100,intensity:void 0!==i.intensity?i.intensity:.15,bias:void 0!==i.bias?i.bias:.5,scale:void 0!==i.scale?i.scale:1,minResolution:void 0!==i.minResolution?i.minResolution:0,numSamples:void 0!==i.numSamples?i.numSamples:10,blur:!!i.blur,blendCutoff:void 0!==i.blendCutff?i.blendCutoff:.3,blendFactor:void 0!==i.blendFactor?i.blendFactor:1},r}return n(t,e),t.prototype.destroy=function(){e.prototype.destroy.call(this)},r(t,[{key:"renderModes",get:function(){return v(this,Js)[Js].renderModes},set:function(e){v(this,Js)[Js].renderModes=e,this.view.redraw()}},{key:"supported",get:function(){return this.view.viewer.renderer.getSAOSupported()}},{key:"enabled",get:function(){return v(this,Js)[Js].enabled},set:function(e){e=!!e,v(this,Js)[Js].enabled!==e&&(v(this,Js)[Js].enabled=e,this.view.redraw())}},{key:"possible",get:function(){if(!this.supported)return!1;if(!v(this,Js)[Js].enabled)return!1;var e=this.view.camera.projectionType;return e!==nt&&e!==rt}},{key:"kernelRadius",get:function(){return v(this,Js)[Js].kernelRadius},set:function(e){null==e&&(e=100),v(this,Js)[Js].kernelRadius!==e&&(v(this,Js)[Js].kernelRadius=e,this.view.redraw())}},{key:"intensity",get:function(){return v(this,Js)[Js].intensity},set:function(e){null==e&&(e=.15),v(this,Js)[Js].intensity!==e&&(v(this,Js)[Js].intensity=e,this.view.redraw())}},{key:"bias",get:function(){return v(this,Js)[Js].bias},set:function(e){null==e&&(e=.5),v(this,Js)[Js].bias!==e&&(v(this,Js)[Js].bias=e,this.view.redraw())}},{key:"scale",get:function(){return v(this,Js)[Js].scale},set:function(e){null==e&&(e=1),v(this,Js)[Js].scale!==e&&(v(this,Js)[Js].scale=e,this.view.redraw())}},{key:"minResolution",get:function(){return v(this,Js)[Js].minResolution},set:function(e){null==e&&(e=0),v(this,Js)[Js].minResolution!==e&&(v(this,Js)[Js].minResolution=e,this.view.redraw())}},{key:"numSamples",get:function(){return v(this,Js)[Js].numSamples},set:function(e){null==e&&(e=10),v(this,Js)[Js].numSamples!==e&&(v(this,Js)[Js].numSamples=e,this.view.redraw())}},{key:"blur",get:function(){return v(this,Js)[Js].blur},set:function(e){e=!1!==e,v(this,Js)[Js].blur!==e&&(v(this,Js)[Js].blur=e,this.view.redraw())}},{key:"blendCutoff",get:function(){return v(this,Js)[Js].blendCutoff},set:function(e){null==e&&(e=.3),v(this,Js)[Js].blendCutoff!==e&&(v(this,Js)[Js].blendCutoff=e,this.view.redraw())}},{key:"blendFactor",get:function(){return v(this,Js)[Js].blendFactor},set:function(e){null==e&&(e=1),v(this,Js)[Js].blendFactor!==e&&(v(this,Js)[Js].blendFactor=e,this.view.redraw())}}]),t}(ce),ea=/*#__PURE__*/f("state"),ta=/*#__PURE__*/function(e){function t(t,i){var r;return void 0===i&&(i={lineWidth:1}),(r=e.call(this,t,i)||this).view=void 0,Object.defineProperty(l(r),ea,{writable:!0,value:void 0}),r.view=t,v(l(r),ea)[ea]={lineWidth:null!=i.lineWidth?i.lineWidth:1},r}return n(t,e),r(t,[{key:"lineWidth",get:function(){return v(this,ea)[ea].lineWidth},set:function(e){v(this,ea)[ea].lineWidth=e||1,this.view.redraw()}}]),t}(ce),ia=/*#__PURE__*/f("numObjects"),ra=/*#__PURE__*/f("objectIds"),na=/*#__PURE__*/f("numVisibleObjects"),oa=/*#__PURE__*/f("visibleObjectIds"),sa=/*#__PURE__*/f("numXRayedObjects"),aa=/*#__PURE__*/f("xrayedObjectIds"),ca=/*#__PURE__*/f("numHighlightedObjects"),la=/*#__PURE__*/f("highlightedObjectIds"),ha=/*#__PURE__*/f("numSelectedObjects"),ua=/*#__PURE__*/f("selectedObjectIds"),da=/*#__PURE__*/f("numColorizedObjects"),fa=/*#__PURE__*/f("colorizedObjectIds"),va=/*#__PURE__*/f("numOpacityObjects"),pa=/*#__PURE__*/f("opacityObjectIds"),ya=/*#__PURE__*/f("qualityRender"),ma=/*#__PURE__*/f("initViewObjects"),ga=/*#__PURE__*/f("createViewObjects"),ba=/*#__PURE__*/f("destroyViewObjects"),wa=/*#__PURE__*/function(e){function t(t){var i;return i=e.call(this,t.view,t)||this,Object.defineProperty(l(i),ba,{value:Ta}),Object.defineProperty(l(i),ga,{value:Ea}),Object.defineProperty(l(i),ma,{value:Pa}),i.objects=void 0,i.visibleObjects=void 0,i.xrayedObjects=void 0,i.highlightedObjects=void 0,i.selectedObjects=void 0,i.colorizedObjects=void 0,i.opacityObjects=void 0,i.autoDestroy=void 0,i.onObjectVisibility=void 0,Object.defineProperty(l(i),ia,{writable:!0,value:void 0}),Object.defineProperty(l(i),ra,{writable:!0,value:void 0}),Object.defineProperty(l(i),na,{writable:!0,value:void 0}),Object.defineProperty(l(i),oa,{writable:!0,value:void 0}),Object.defineProperty(l(i),sa,{writable:!0,value:void 0}),Object.defineProperty(l(i),aa,{writable:!0,value:void 0}),Object.defineProperty(l(i),ca,{writable:!0,value:void 0}),Object.defineProperty(l(i),la,{writable:!0,value:void 0}),Object.defineProperty(l(i),ha,{writable:!0,value:void 0}),Object.defineProperty(l(i),ua,{writable:!0,value:void 0}),Object.defineProperty(l(i),da,{writable:!0,value:void 0}),Object.defineProperty(l(i),fa,{writable:!0,value:void 0}),Object.defineProperty(l(i),va,{writable:!0,value:void 0}),Object.defineProperty(l(i),pa,{writable:!0,value:void 0}),Object.defineProperty(l(i),ya,{writable:!0,value:void 0}),i.gammaOutput=void 0,i.id=t.id,i.viewer=t.viewer,i.view=t.view,i.objects={},i.visibleObjects={},i.xrayedObjects={},i.highlightedObjects={},i.selectedObjects={},i.colorizedObjects={},i.opacityObjects={},i.autoDestroy=!1!==t.autoDestroy,v(l(i),ia)[ia]=0,v(l(i),na)[na]=0,v(l(i),sa)[sa]=0,v(l(i),ca)[ca]=0,v(l(i),ha)[ha]=0,v(l(i),da)[da]=0,v(l(i),va)[va]=0,v(l(i),ya)[ya]=!!t.qualityRender,i.onObjectVisibility=new y(new ie.EventDispatcher),v(l(i),ma)[ma](),i}n(t,e);var i=t.prototype;return i.registerViewObject=function(e){this.objects[e.id]=e,v(this,ia)[ia]++,v(this,ra)[ra]=null},i.deregisterViewObject=function(e){delete this.objects[e.id],delete this.visibleObjects[e.id],delete this.xrayedObjects[e.id],delete this.highlightedObjects[e.id],delete this.selectedObjects[e.id],delete this.colorizedObjects[e.id],delete this.opacityObjects[e.id],v(this,ia)[ia]--,v(this,ra)[ra]=null},i.redraw=function(){this.viewer.renderer.setImageDirty(this.view.viewIndex)},i.objectVisibilityUpdated=function(e,t,i){void 0===i&&(i=!0),t?(this.visibleObjects[e.id]=e,v(this,na)[na]++):(delete this.visibleObjects[e.id],v(this,na)[na]--),v(this,oa)[oa]=null,i&&this.onObjectVisibility.dispatch(this,e),this.view.objectVisibilityUpdated(e,t,i)},i.objectXRayedUpdated=function(e,t){t?(this.xrayedObjects[e.id]=e,v(this,sa)[sa]++):(delete this.xrayedObjects[e.id],v(this,sa)[sa]--),v(this,aa)[aa]=null,this.view.objectXRayedUpdated(e,t)},i.objectHighlightedUpdated=function(e,t){t?(this.highlightedObjects[e.id]=e,v(this,ca)[ca]++):(delete this.highlightedObjects[e.id],v(this,ca)[ca]--),v(this,la)[la]=null,this.view.objectHighlightedUpdated(e,t)},i.objectSelectedUpdated=function(e,t){t?(this.selectedObjects[e.id]=e,v(this,ha)[ha]++):(delete this.selectedObjects[e.id],v(this,ha)[ha]--),v(this,ua)[ua]=null,this.view.objectSelectedUpdated(e,t)},i.objectColorizeUpdated=function(e,t){t?(this.colorizedObjects[e.id]=e,v(this,da)[da]++):(delete this.colorizedObjects[e.id],v(this,da)[da]--),v(this,fa)[fa]=null,this.view.objectColorizeUpdated(e,t)},i.objectOpacityUpdated=function(e,t){t?(this.opacityObjects[e.id]=e,v(this,va)[va]++):(delete this.opacityObjects[e.id],v(this,va)[va]--),v(this,pa)[pa]=null,this.view.objectOpacityUpdated(e,t)},i.setObjectsVisible=function(e,t){return this.withObjects(e,function(e){var i=e.visible!==t;return e.visible=t,i})},i.setObjectsCollidable=function(e,t){return this.withObjects(e,function(e){var i=e.collidable!==t;return e.collidable=t,i})},i.setObjectsCulled=function(e,t){return this.withObjects(e,function(e){var i=e.culled!==t;return e.culled=t,i})},i.setObjectsSelected=function(e,t){return this.withObjects(e,function(e){var i=e.selected!==t;return e.selected=t,i})},i.setObjectsHighlighted=function(e,t){return this.withObjects(e,function(e){var i=e.highlighted!==t;return e.highlighted=t,i})},i.setObjectsXRayed=function(e,t){return this.withObjects(e,function(e){var i=e.xrayed!==t;return i&&(e.xrayed=t),i})},i.setObjectsColorized=function(e,t){return this.withObjects(e,function(e){e.colorize=t})},i.setObjectsOpacity=function(e,t){return this.withObjects(e,function(e){var i=e.opacity!==t;return i&&(e.opacity=t),i})},i.setObjectsPickable=function(e,t){return this.withObjects(e,function(e){var i=e.pickable!==t;return i&&(e.pickable=t),i})},i.setObjectsClippable=function(e,t){return this.withObjects(e,function(e){var i=e.clippable!==t;return i&&(e.clippable=t),i})},i.withObjects=function(e,t){for(var i=!1,r=0,n=e.length;r<n;r++){var o=this.objects[e[r]];o&&(i=t(o)||i)}return i},i.destroy=function(){e.prototype.destroy.call(this)},r(t,[{key:"gammaFactor",get:function(){return 1}},{key:"qualityRender",get:function(){return v(this,ya)[ya]},set:function(e){v(this,ya)[ya]!==e&&(v(this,ya)[ya]=e,this.redraw())}},{key:"numObjects",get:function(){return v(this,ia)[ia]}},{key:"objectIds",get:function(){return v(this,ra)[ra]||(v(this,ra)[ra]=Object.keys(this.objects)),v(this,ra)[ra]}},{key:"numVisibleObjects",get:function(){return v(this,na)[na]}},{key:"visibleObjectIds",get:function(){return v(this,oa)[oa]||(v(this,oa)[oa]=Object.keys(this.visibleObjects)),v(this,oa)[oa]}},{key:"numXRayedObjects",get:function(){return v(this,sa)[sa]}},{key:"xrayedObjectIds",get:function(){return v(this,aa)[aa]||(v(this,aa)[aa]=Object.keys(this.xrayedObjects)),v(this,aa)[aa]}},{key:"numHighlightedObjects",get:function(){return v(this,ca)[ca]}},{key:"highlightedObjectIds",get:function(){return v(this,la)[la]||(v(this,la)[la]=Object.keys(this.highlightedObjects)),v(this,la)[la]}},{key:"numSelectedObjects",get:function(){return v(this,ha)[ha]}},{key:"selectedObjectIds",get:function(){return v(this,ua)[ua]||(v(this,ua)[ua]=Object.keys(this.selectedObjects)),v(this,ua)[ua]}},{key:"numColorizedObjects",get:function(){return v(this,da)[da]}},{key:"colorizedObjectIds",get:function(){return v(this,fa)[fa]||(v(this,fa)[fa]=Object.keys(this.colorizedObjects)),v(this,fa)[fa]}},{key:"opacityObjectIds",get:function(){return v(this,pa)[pa]||(v(this,pa)[pa]=Object.keys(this.opacityObjects)),v(this,pa)[pa]}},{key:"numOpacityObjects",get:function(){return v(this,va)[va]}}]),t}(ce);function Pa(){var e=this,t=this.viewer.scene.models;for(var i in t){var r=t[i];v(this,ga)[ga](r)}this.viewer.scene.onModelCreated.subscribe(function(t,i){v(e,ga)[ga](i)}),this.viewer.scene.onModelDestroyed.subscribe(function(t,i){v(e,ba)[ba](i)})}function Ea(e){var t=e.objects;for(var i in t){var r=this.viewer.renderer.rendererViewObjects[i];if(r.layerId==this.id){var n=new Xs(this,t[i],r);this.objects[n.id]=n,v(this,ia)[ia]++,v(this,ra)[ra]=null}}}function Ta(e){var t=e.objects;for(var i in t)this.objects[t[i].id]._destroy(),v(this,ia)[ia]--,v(this,ra)[ra]=null}var _a=/*#__PURE__*/f("state"),Ia=/*#__PURE__*/function(e){function t(t,i){var r;return void 0===i&&(i={}),(r=e.call(this,t,i)||this).view=void 0,Object.defineProperty(l(r),_a,{writable:!0,value:void 0}),r.view=t,v(l(r),_a)[_a]={fill:!!i.fill,fillColor:new Float32Array(i.fillColor||[.4,.4,.4]),fillAlpha:null!=i.fillAlpha?i.fillAlpha:.2,edges:!1!==i.edges,edgeColor:new Float32Array(i.edgeColor||[.2,.2,.2]),edgeAlpha:null!=i.edgeAlpha?i.edgeAlpha:.5,edgeWidth:null!=i.edgeWidth?i.edgeWidth:1,backfaces:!!i.backfaces},r}return n(t,e),t.prototype.destroy=function(){e.prototype.destroy.call(this)},r(t,[{key:"fill",get:function(){return v(this,_a)[_a].fill},set:function(e){v(this,_a)[_a].fill!==e&&(v(this,_a)[_a].fill=e,this.view.redraw())}},{key:"fillColor",get:function(){return v(this,_a)[_a].fillColor},set:function(e){var t=v(this,_a)[_a].fillColor;t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]||(t[0]=.4,t[1]=.4,t[2]=.4,this.view.redraw())}},{key:"fillAlpha",get:function(){return v(this,_a)[_a].fillAlpha},set:function(e){v(this,_a)[_a].fillAlpha!==e&&(v(this,_a)[_a].fillAlpha=e,this.view.redraw())}},{key:"edges",get:function(){return v(this,_a)[_a].edges},set:function(e){v(this,_a)[_a].edges!==e&&(v(this,_a)[_a].edges=e,this.view.redraw())}},{key:"edgeColor",get:function(){return v(this,_a)[_a].edgeColor},set:function(e){var t=v(this,_a)[_a].edgeColor;t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]||(t[0]=.2,t[1]=.2,t[2]=.2,this.view.redraw())}},{key:"edgeAlpha",get:function(){return v(this,_a)[_a].edgeAlpha},set:function(e){v(this,_a)[_a].edgeAlpha!==e&&(v(this,_a)[_a].edgeAlpha=e,this.view.redraw())}},{key:"edgeWidth",get:function(){return v(this,_a)[_a].edgeWidth},set:function(e){v(this,_a)[_a].edgeWidth=e,this.view.redraw()}},{key:"backfaces",get:function(){return v(this,_a)[_a].backfaces},set:function(e){v(this,_a)[_a].backfaces!==e&&(v(this,_a)[_a].backfaces=e,this.view.redraw())}},{key:"hash",get:function(){return""}}]),t}(ce),xa=/*#__PURE__*/f("state"),Sa=/*#__PURE__*/function(e){function t(t,i){var r;return void 0===i&&(i={}),(r=e.call(this,t,i)||this).view=void 0,Object.defineProperty(l(r),xa,{writable:!0,value:void 0}),r.view=t,v(l(r),xa)[xa]={renderModes:i.renderModes||[$e],edges:!1!==i.edges,edgeColor:new Float32Array(i.edgeColor||[.2,.2,.2]),edgeAlpha:null!=i.edgeAlpha?i.edgeAlpha:.5,edgeWidth:null!=i.edgeWidth?i.edgeWidth:1},r}return n(t,e),t.prototype.destroy=function(){e.prototype.destroy.call(this)},r(t,[{key:"renderModes",get:function(){return v(this,xa)[xa].renderModes},set:function(e){v(this,xa)[xa].renderModes=e,this.view.redraw()}},{key:"edges",get:function(){return v(this,xa)[xa].edges},set:function(e){v(this,xa)[xa].edges!==e&&(v(this,xa)[xa].edges=e,this.view.redraw())}},{key:"edgeColor",get:function(){return v(this,xa)[xa].edgeColor},set:function(e){var t=v(this,xa)[xa].edgeColor;e&&t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]||(t[0]=.2,t[1]=.2,t[2]=.2,this.view.redraw())}},{key:"edgeAlpha",get:function(){return v(this,xa)[xa].edgeAlpha},set:function(e){v(this,xa)[xa].edgeAlpha!==e&&(v(this,xa)[xa].edgeAlpha=e,this.view.redraw())}},{key:"edgeWidth",get:function(){return v(this,xa)[xa].edgeWidth},set:function(e){v(this,xa)[xa].edgeWidth!==e&&(v(this,xa)[xa].edgeWidth=e,this.view.redraw())}}]),t}(ce),Ma=/*#__PURE__*/f("state"),Oa=/*#__PURE__*/function(e){function t(t,i){var r;return void 0===i&&(i={}),(r=e.call(this,t,i)||this).view=void 0,Object.defineProperty(l(r),Ma,{writable:!0,value:void 0}),r.view=t,v(l(r),Ma)[Ma]={pointSize:null!=i.pointSize?i.pointSize:1,roundPoints:!1!==i.roundPoints,perspectivePoints:!1!==i.perspectivePoints,minPerspectivePointSize:null!=i.minPerspectivePointSize?i.minPerspectivePointSize:1,maxPerspectivePointSize:null!=i.maxPerspectivePointSize?i.maxPerspectivePointSize:6,filterIntensity:!!i.filterIntensity,minIntensity:null!=i.minIntensity?i.minIntensity:0,maxIntensity:null!=i.maxIntensity?i.maxIntensity:1},r}return n(t,e),t.prototype.destroy=function(){e.prototype.destroy.call(this)},r(t,[{key:"pointSize",get:function(){return v(this,Ma)[Ma].pointSize},set:function(e){v(this,Ma)[Ma].pointSize=e,this.view.redraw()}},{key:"roundPoints",get:function(){return v(this,Ma)[Ma].roundPoints},set:function(e){v(this,Ma)[Ma].roundPoints!==e&&(v(this,Ma)[Ma].roundPoints=e,this.view.rebuild())}},{key:"perspectivePoints",get:function(){return v(this,Ma)[Ma].perspectivePoints},set:function(e){v(this,Ma)[Ma].perspectivePoints!==e&&(v(this,Ma)[Ma].perspectivePoints=e,this.view.rebuild())}},{key:"minPerspectivePointSize",get:function(){return v(this,Ma)[Ma].minPerspectivePointSize},set:function(e){v(this,Ma)[Ma].minPerspectivePointSize!==e&&(v(this,Ma)[Ma].minPerspectivePointSize=e,this.view.rebuild())}},{key:"maxPerspectivePointSize",get:function(){return v(this,Ma)[Ma].maxPerspectivePointSize},set:function(e){v(this,Ma)[Ma].maxPerspectivePointSize!==e&&(v(this,Ma)[Ma].maxPerspectivePointSize=e,this.view.rebuild())}},{key:"filterIntensity",get:function(){return v(this,Ma)[Ma].filterIntensity},set:function(e){v(this,Ma)[Ma].filterIntensity!==e&&(v(this,Ma)[Ma].filterIntensity=e,this.view.rebuild())}},{key:"minIntensity",get:function(){return v(this,Ma)[Ma].minIntensity},set:function(e){v(this,Ma)[Ma].minIntensity!==e&&(v(this,Ma)[Ma].minIntensity=e,this.view.redraw())}},{key:"maxIntensity",get:function(){return v(this,Ma)[Ma].maxIntensity},set:function(e){v(this,Ma)[Ma].maxIntensity!==e&&(v(this,Ma)[Ma].maxIntensity=e,this.view.redraw())}},{key:"hash",get:function(){var e=v(this,Ma)[Ma];return e.pointSize+";\n        "+e.roundPoints+";\n        "+e.perspectivePoints+";\n        "+e.minPerspectivePointSize+";\n        "+e.maxPerspectivePointSize+";\n        "+e.filterIntensity}}]),t}(ce),Ra=/*#__PURE__*/f("state"),ja=/*#__PURE__*/f("inverseMatrixDirty"),Da=/*#__PURE__*/f("transposedProjMatrixDirty"),Aa=/*#__PURE__*/f("onViewBoundary"),Ca=/*#__PURE__*/function(e){function t(t,i){var r;return void 0===i&&(i={}),(r=e.call(this,t,i)||this).camera=void 0,r.onProjMatrix=void 0,Object.defineProperty(l(r),Ra,{writable:!0,value:void 0}),Object.defineProperty(l(r),ja,{writable:!0,value:void 0}),Object.defineProperty(l(r),Da,{writable:!0,value:void 0}),Object.defineProperty(l(r),Aa,{writable:!0,value:void 0}),r.camera=t,v(l(r),Ra)[Ra]={near:i.near||.1,far:i.far||2e3,fov:i.fov||60,fovAxis:i.fovAxis||"min",projMatrix:Qt(),inverseProjMatrix:Qt(),transposedProjMatrix:Qt()},v(l(r),ja)[ja]=!0,v(l(r),Da)[Da]=!0,v(l(r),Aa)[Aa]=r.camera.view.onBoundary.subscribe(function(){r.setDirty()}),r.onProjMatrix=new y(new ie.EventDispatcher),r}n(t,e);var i=t.prototype;return i.clean=function(){var e=this.camera.view.boundary,t=e[2]/e[3],i=v(this,Ra)[Ra].fovAxis,r=v(this,Ra)[Ra].fov;("x"===i||"min"===i&&t<1||"max"===i&&t>1)&&(r/=t),ei((r=Math.min(r,120))*(Math.PI/180),t,v(this,Ra)[Ra].near,v(this,Ra)[Ra].far,v(this,Ra)[Ra].projMatrix),v(this,ja)[ja]=!0,v(this,Da)[Da]=!0,this.camera.view.redraw(),this.onProjMatrix.dispatch(this,v(this,Ra)[Ra].projMatrix)},i.unproject=function(e,t,i,r,n){var o=this.camera.view.canvasElement,s=o.offsetWidth/2,a=o.offsetHeight/2;return i[0]=(e[0]-s)/s,i[1]=(e[1]-a)/a,i[2]=t,i[3]=1,hi(this.inverseProjMatrix,i,r),It(r,1/r[3]),r[3]=1,r[1]*=-1,hi(this.camera.inverseViewMatrix,r,n),n},i.destroy=function(){e.prototype.destroy.call(this),this.camera.view.onBoundary.unsubscribe(v(this,Aa)[Aa]),this.onProjMatrix.clear()},r(t,[{key:"fov",get:function(){return v(this,Ra)[Ra].fov},set:function(e){e!==v(this,Ra)[Ra].fov&&(v(this,Ra)[Ra].fov=e,this.setDirty())}},{key:"fovAxis",get:function(){return v(this,Ra)[Ra].fovAxis},set:function(e){e=e||"min",v(this,Ra)[Ra].fovAxis!==e&&("x"!==e&&"y"!==e&&"min"!==e&&(this.error("Unsupported value for 'fovAxis': "+e+" - defaulting to 'min'"),e="min"),v(this,Ra)[Ra].fovAxis=e,this.setDirty())}},{key:"near",get:function(){return v(this,Ra)[Ra].near},set:function(e){v(this,Ra)[Ra].near!==e&&(v(this,Ra)[Ra].near=e,this.setDirty())}},{key:"far",get:function(){return v(this,Ra)[Ra].far},set:function(e){v(this,Ra)[Ra].far!==e&&(v(this,Ra)[Ra].far=e,this.setDirty())}},{key:"projMatrix",get:function(){return this.dirty&&this.cleanIfDirty(),v(this,Ra)[Ra].projMatrix}},{key:"inverseProjMatrix",get:function(){return this.dirty&&this.cleanIfDirty(),v(this,ja)[ja]&&(ci(v(this,Ra)[Ra].projMatrix,v(this,Ra)[Ra].inverseProjMatrix),v(this,ja)[ja]=!1),v(this,Ra)[Ra].inverseProjMatrix}},{key:"transposedProjMatrix",get:function(){return this.dirty&&this.cleanIfDirty(),v(this,Da)[Da]&&(li(v(this,Ra)[Ra].projMatrix,v(this,Ra)[Ra].transposedProjMatrix),v(this,Da)[Da]=!1),v(this,Ra)[Ra].transposedProjMatrix}}]),t}(ce);Ca.type=tt;var Ba=/*#__PURE__*/f("state"),ka=/*#__PURE__*/f("inverseMatrixDirty"),La=/*#__PURE__*/f("transposedProjMatrixDirty"),Fa=/*#__PURE__*/f("onViewBoundary"),Ua=/*#__PURE__*/function(e){function t(t,i){var r;return void 0===i&&(i={}),(r=e.call(this,t,i)||this).camera=void 0,r.onProjMatrix=void 0,Object.defineProperty(l(r),Ba,{writable:!0,value:void 0}),Object.defineProperty(l(r),ka,{writable:!0,value:void 0}),Object.defineProperty(l(r),La,{writable:!0,value:void 0}),Object.defineProperty(l(r),Fa,{writable:!0,value:void 0}),r.camera=t,v(l(r),Ba)[Ba]={near:i.near||.1,far:i.far||2e3,scale:i.scale||1,projMatrix:Qt(),inverseProjMatrix:Qt(),transposedProjMatrix:Qt()},r.onProjMatrix=new y(new ie.EventDispatcher),v(l(r),ka)[ka]=!0,v(l(r),La)[La]=!0,v(l(r),Fa)[Fa]=r.camera.view.onBoundary.subscribe(function(){r.setDirty()}),r}n(t,e);var i=t.prototype;return i.clean=function(){var e,t,i,r,n=this.camera.view,o=.5*v(this,Ba)[Ba].scale,s=n.boundary,a=s[2],c=s[3],l=a/c;a>c?(e=-o,t=o,i=o/l,r=-o/l):(e=-o*l,t=o*l,i=o,r=-o),ii(e,t,r,i,v(this,Ba)[Ba].near,v(this,Ba)[Ba].far,v(this,Ba)[Ba].projMatrix),v(this,ka)[ka]=!0,v(this,La)[La]=!0,this.camera.view.redraw(),this.onProjMatrix.dispatch(this,v(this,Ba)[Ba].projMatrix)},i.unproject=function(e,t,i,r,n){var o=this.camera.view.canvasElement,s=o.offsetWidth/2,a=o.offsetHeight/2;return i[0]=(e[0]-s)/s,i[1]=(e[1]-a)/a,i[2]=t,i[3]=1,hi(this.inverseProjMatrix,i,r),It(r,1/r[3]),r[3]=1,r[1]*=-1,hi(this.camera.inverseViewMatrix,r,n),n},i.destroy=function(){e.prototype.destroy.call(this),this.camera.view.onBoundary.unsubscribe(v(this,Fa)[Fa]),this.onProjMatrix.clear()},r(t,[{key:"scale",get:function(){return v(this,Ba)[Ba].scale},set:function(e){e<=0&&(e=.01),v(this,Ba)[Ba].scale=e,this.setDirty()}},{key:"near",get:function(){return v(this,Ba)[Ba].near},set:function(e){v(this,Ba)[Ba].near!==e&&(v(this,Ba)[Ba].near=e,this.setDirty())}},{key:"far",get:function(){return v(this,Ba)[Ba].far},set:function(e){v(this,Ba)[Ba].far!==e&&(v(this,Ba)[Ba].far=e,this.setDirty())}},{key:"projMatrix",get:function(){return this.dirty&&this.cleanIfDirty(),v(this,Ba)[Ba].projMatrix}},{key:"inverseProjMatrix",get:function(){return this.dirty&&this.cleanIfDirty(),v(this,ka)[ka]&&(ci(v(this,Ba)[Ba].projMatrix,v(this,Ba)[Ba].inverseProjMatrix),v(this,ka)[ka]=!1),v(this,Ba)[Ba].inverseProjMatrix}},{key:"transposedProjMatrix",get:function(){return this.dirty&&this.cleanIfDirty(),v(this,La)[La]&&(li(v(this,Ba)[Ba].projMatrix,v(this,Ba)[Ba].transposedProjMatrix),v(this,La)[La]=!1),v(this,Ba)[Ba].transposedProjMatrix}}]),t}(ce);Ua.type=it;var Na=/*#__PURE__*/f("state"),Ga=/*#__PURE__*/f("inverseMatrixDirty"),Va=/*#__PURE__*/f("transposedProjMatrixDirty"),Ha=/*#__PURE__*/function(e){function t(t,i){var r;return void 0===i&&(i={}),(r=e.call(this,t,i)||this).camera=void 0,r.onProjMatrix=void 0,Object.defineProperty(l(r),Na,{writable:!0,value:void 0}),Object.defineProperty(l(r),Ga,{writable:!0,value:void 0}),Object.defineProperty(l(r),Va,{writable:!0,value:void 0}),r.camera=t,v(l(r),Na)[Na]={projMatrix:Qt(),inverseProjMatrix:Qt(),transposedProjMatrix:Qt(),near:.1,far:1e4,left:null!=i.left?i.left:-1,right:null!=i.right?i.right:1,bottom:null!=i.bottom?i.bottom:-1,top:null!=i.top?i.top:1},r.onProjMatrix=new y(new ie.EventDispatcher),v(l(r),Ga)[Ga]=!0,v(l(r),Va)[Va]=!0,r}n(t,e);var i=t.prototype;return i.clean=function(){ri(v(this,Na)[Na].left,v(this,Na)[Na].right,v(this,Na)[Na].bottom,v(this,Na)[Na].top,v(this,Na)[Na].near,v(this,Na)[Na].far,v(this,Na)[Na].projMatrix),v(this,Ga)[Ga]=!0,v(this,Va)[Va]=!0,this.camera.view.redraw(),this.onProjMatrix.dispatch(this,v(this,Na)[Na].projMatrix)},i.unproject=function(e,t,i,r,n){var o=this.camera.view.canvasElement,s=o.offsetWidth/2,a=o.offsetHeight/2;return i[0]=(e[0]-s)/s,i[1]=(e[1]-a)/a,i[2]=t,i[3]=1,hi(this.inverseProjMatrix,i,r),It(r,1/r[3]),r[3]=1,r[1]*=-1,hi(this.camera.inverseViewMatrix,r,n),n},i.destroy=function(){e.prototype.destroy.call(this),this.onProjMatrix.clear()},r(t,[{key:"left",get:function(){return v(this,Na)[Na].left},set:function(e){v(this,Na)[Na].left=e,this.setDirty()}},{key:"right",get:function(){return v(this,Na)[Na].right},set:function(e){v(this,Na)[Na].right=e,this.setDirty()}},{key:"top",get:function(){return v(this,Na)[Na].top},set:function(e){v(this,Na)[Na].top=e,this.setDirty()}},{key:"bottom",get:function(){return v(this,Na)[Na].bottom},set:function(e){v(this,Na)[Na].bottom=e,this.setDirty()}},{key:"near",get:function(){return v(this,Na)[Na].near},set:function(e){v(this,Na)[Na].near=e,this.setDirty()}},{key:"far",get:function(){return v(this,Na)[Na].far},set:function(e){v(this,Na)[Na].far=e,this.setDirty()}},{key:"projMatrix",get:function(){return this.dirty&&this.cleanIfDirty(),v(this,Na)[Na].projMatrix}},{key:"inverseProjMatrix",get:function(){return this.dirty&&this.cleanIfDirty(),v(this,Ga)[Ga]&&(ci(v(this,Na)[Na].projMatrix,v(this,Na)[Na].inverseProjMatrix),v(this,Ga)[Ga]=!1),v(this,Na)[Na].inverseProjMatrix}},{key:"transposedProjMatrix",get:function(){return this.dirty&&this.cleanIfDirty(),v(this,Va)[Va]&&(li(v(this,Na)[Na].projMatrix,v(this,Na)[Na].transposedProjMatrix),v(this,Va)[Va]=!1),v(this,Na)[Na].transposedProjMatrix}}]),t}(ce);Ha.type=rt;var Xa=/*#__PURE__*/f("state"),Wa=/*#__PURE__*/f("inverseProjMatrixDirty"),Ya=/*#__PURE__*/f("transposedProjMatrixDirty"),Ka=/*#__PURE__*/function(e){function t(t,i){var r;return void 0===i&&(i={}),(r=e.call(this,t,i)||this).camera=void 0,r.onProjMatrix=void 0,Object.defineProperty(l(r),Xa,{writable:!0,value:void 0}),Object.defineProperty(l(r),Wa,{writable:!0,value:void 0}),Object.defineProperty(l(r),Ya,{writable:!0,value:void 0}),r.camera=t,v(l(r),Xa)[Xa]={projMatrix:Qt(i.projMatrix||ni()),inverseProjMatrix:Qt(),transposedProjMatrix:Qt()},r.onProjMatrix=new y(new ie.EventDispatcher),v(l(r),Wa)[Wa]=!0,v(l(r),Ya)[Ya]=!1,r}n(t,e);var i=t.prototype;return i.unproject=function(e,t,i,r,n){var o=this.camera.view.canvasElement,s=o.offsetWidth/2,a=o.offsetHeight/2;return i[0]=(e[0]-s)/s,i[1]=(e[1]-a)/a,i[2]=t,i[3]=1,hi(this.inverseProjMatrix,i,r),It(r,1/r[3]),r[3]=1,r[1]*=-1,hi(this.camera.inverseViewMatrix,r,n),n},i.destroy=function(){e.prototype.destroy.call(this),this.onProjMatrix.clear()},r(t,[{key:"projMatrix",get:function(){return v(this,Xa)[Xa].projMatrix},set:function(e){v(this,Xa)[Xa].projMatrix.set(e),v(this,Wa)[Wa]=!0,v(this,Ya)[Ya]=!0,this.setDirty(),this.camera.view.redraw(),this.onProjMatrix.dispatch(this,v(this,Xa)[Xa].projMatrix)}},{key:"inverseProjMatrix",get:function(){return this.dirty&&this.cleanIfDirty(),v(this,Wa)[Wa]&&(ci(v(this,Xa)[Xa].projMatrix,v(this,Xa)[Xa].inverseProjMatrix),v(this,Wa)[Wa]=!1),v(this,Xa)[Xa].inverseProjMatrix}},{key:"transposedProjMatrix",get:function(){return this.dirty&&this.cleanIfDirty(),v(this,Ya)[Ya]&&(li(v(this,Xa)[Xa].projMatrix,v(this,Xa)[Xa].transposedProjMatrix),v(this,Ya)[Ya]=!1),v(this,Xa)[Xa].transposedProjMatrix}}]),t}(ce);Ka.type=nt;var za=Pt(),qa=Pt(),Za=Pt(),Qa=Pt(),Ja=Pt(),$a=Pt(),ec=Qt(),tc=Qt(),ic=Pt(),rc=Pt(),nc=Pt(),oc=Pt(),sc=/*#__PURE__*/f("state"),ac=/*#__PURE__*/f("frustum"),cc=/*#__PURE__*/f("activeProjection"),lc=/*#__PURE__*/function(e){function t(t,i){var r;return void 0===i&&(i={}),(r=e.call(this,t,i)||this).view=void 0,r.perspectiveProjection=void 0,r.orthoProjection=void 0,r.frustumProjection=void 0,r.customProjection=void 0,r.onProjectionType=void 0,r.onViewMatrix=void 0,r.onProjMatrix=void 0,r.onWorldAxis=void 0,r.onFrustum=void 0,Object.defineProperty(l(r),sc,{writable:!0,value:void 0}),Object.defineProperty(l(r),ac,{writable:!0,value:void 0}),Object.defineProperty(l(r),cc,{writable:!0,value:void 0}),r.onProjectionType=new y(new ie.EventDispatcher),r.onViewMatrix=new y(new ie.EventDispatcher),r.onProjMatrix=new y(new ie.EventDispatcher),r.onWorldAxis=new y(new ie.EventDispatcher),r.onFrustum=new y(new ie.EventDispatcher),r.view=t,v(l(r),sc)[sc]={eye:Pt(i.eye||[0,0,10]),look:Pt(i.look||[0,0,0]),up:Pt(i.up||[0,1,0]),worldUp:Pt([0,1,0]),worldRight:Pt([1,0,0]),worldForward:Pt([0,0,-1]),worldAxis:new Float32Array(i.worldAxis||[1,0,0,0,1,0,0,0,1]),gimbalLock:!1!==i.gimbalLock,constrainPitch:!0===i.constrainPitch,projectionType:i.projectionType||tt,deviceMatrix:i.deviceMatrix?Qt(i.deviceMatrix):ni(),hasDeviceMatrix:!!i.deviceMatrix,viewMatrix:Qt(),viewNormalMatrix:Qt(),inverseViewMatrix:Qt()},v(l(r),ac)[ac]=new Vr,r.perspectiveProjection=new Ca(l(r)),r.orthoProjection=new Ua(l(r)),r.frustumProjection=new Ha(l(r)),r.customProjection=new Ka(l(r)),v(l(r),cc)[cc]=r.perspectiveProjection,r.perspectiveProjection.onProjMatrix.subscribe(function(){v(l(r),sc)[sc].projectionType===tt&&r.onProjMatrix.dispatch(l(r),r.perspectiveProjection.projMatrix)}),r.orthoProjection.onProjMatrix.subscribe(function(){v(l(r),sc)[sc].projectionType===it&&r.onProjMatrix.dispatch(l(r),r.orthoProjection.projMatrix)}),r.frustumProjection.onProjMatrix.subscribe(function(){v(l(r),sc)[sc].projectionType===rt&&r.onProjMatrix.dispatch(l(r),r.frustumProjection.projMatrix)}),r.customProjection.onProjMatrix.subscribe(function(){v(l(r),sc)[sc].projectionType===nt&&r.onProjMatrix.dispatch(l(r),r.customProjection.projMatrix)}),r}n(t,e);var i=t.prototype;return i.clean=function(){var e,t=v(this,sc)[sc];this.projectionType===it?(Ot(v(this,sc)[sc].eye,v(this,sc)[sc].look,ic),Kt(ic,rc),It(rc,1e3,nc),St(v(this,sc)[sc].look,nc,oc),e=oc):e=v(this,sc)[sc].eye,t.hasDeviceMatrix?(ai(e,v(this,sc)[sc].look,v(this,sc)[sc].up,tc),ui(t.deviceMatrix,tc,t.viewMatrix)):ai(e,v(this,sc)[sc].look,v(this,sc)[sc].up,t.viewMatrix),ci(v(this,sc)[sc].viewMatrix,v(this,sc)[sc].inverseViewMatrix),li(v(this,sc)[sc].inverseViewMatrix,v(this,sc)[sc].viewNormalMatrix),this.view.redraw(),Hr(v(this,sc)[sc].viewMatrix,v(this,cc)[cc].projMatrix,v(this,ac)[ac]),this.onViewMatrix.dispatch(this,v(this,sc)[sc].viewMatrix),this.onFrustum.dispatch(this,v(this,ac)[ac])},i.orbitYaw=function(e){var t=Ot(v(this,sc)[sc].eye,v(this,sc)[sc].look,za);si(.0174532925*e,v(this,sc)[sc].gimbalLock?v(this,sc)[sc].worldUp:v(this,sc)[sc].up,ec),t=fi(ec,t,qa),this.eye=St(v(this,sc)[sc].look,t,Za),this.up=fi(ec,v(this,sc)[sc].up,Qa)},i.orbitPitch=function(e){if(!(v(this,sc)[sc].constrainPitch&&(e=bt(v(this,sc)[sc].up,v(this,sc)[sc].worldUp)/ct)<1)){var t=Ot(v(this,sc)[sc].eye,v(this,sc)[sc].look,za);si(.0174532925*e,Ct(Kt(t,qa),Kt(v(this,sc)[sc].up,Za)),ec),t=fi(ec,t,Qa),this.up=fi(ec,v(this,sc)[sc].up,Ja),this.eye=St(t,v(this,sc)[sc].look,$a)}},i.yaw=function(e){var t=Ot(v(this,sc)[sc].look,v(this,sc)[sc].eye,za);si(.0174532925*e,v(this,sc)[sc].gimbalLock?v(this,sc)[sc].worldUp:v(this,sc)[sc].up,ec),t=fi(ec,t,qa),this.look=St(t,v(this,sc)[sc].eye,Za),v(this,sc)[sc].gimbalLock&&(this.up=fi(ec,v(this,sc)[sc].up,Qa))},i.pitch=function(e){if(!(v(this,sc)[sc].constrainPitch&&(e=bt(v(this,sc)[sc].up,v(this,sc)[sc].worldUp)/ct)<1)){var t=Ot(v(this,sc)[sc].look,v(this,sc)[sc].eye,za);si(.0174532925*e,Ct(Kt(t,qa),Kt(v(this,sc)[sc].up,Za)),ec),this.up=fi(ec,v(this,sc)[sc].up,$a),t=fi(ec,t,Qa),this.look=St(t,v(this,sc)[sc].eye,Ja)}},i.pan=function(e){var t,i=Ot(v(this,sc)[sc].eye,v(this,sc)[sc].look,za),r=[0,0,0];0!==e[0]&&(t=It(Ct(Kt(i,[]),Kt(v(this,sc)[sc].up,qa)),e[0]),r[0]+=t[0],r[1]+=t[1],r[2]+=t[2]),0!==e[1]&&(t=It(Kt(v(this,sc)[sc].up,Za),e[1]),r[0]+=t[0],r[1]+=t[1],r[2]+=t[2]),0!==e[2]&&(t=It(Kt(i,Qa),e[2]),r[0]+=t[0],r[1]+=t[1],r[2]+=t[2]),this.eye=St(v(this,sc)[sc].eye,r,Ja),this.look=St(v(this,sc)[sc].look,r,$a)},i.zoom=function(e){var t=Ot(v(this,sc)[sc].eye,v(this,sc)[sc].look,za),i=Math.abs(Nt(t)),r=Math.abs(i+e);if(!(r<.5)){var n=Kt(t,Za);this.eye=St(v(this,sc)[sc].look,It(n,r),Qa)}},i.destroy=function(){e.prototype.destroy.call(this),this.onProjectionType.clear(),this.onViewMatrix.clear(),this.onProjMatrix.clear(),this.onWorldAxis.clear()},r(t,[{key:"project",get:function(){return v(this,cc)[cc]}},{key:"eye",get:function(){return v(this,sc)[sc].eye},set:function(e){v(this,sc)[sc].eye.set(e),this.setDirty()}},{key:"look",get:function(){return v(this,sc)[sc].look},set:function(e){v(this,sc)[sc].look.set(e),this.setDirty()}},{key:"up",get:function(){return v(this,sc)[sc].up},set:function(e){v(this,sc)[sc].up.set(e),this.setDirty()}},{key:"worldUp",get:function(){return v(this,sc)[sc].worldUp}},{key:"worldRight",get:function(){return v(this,sc)[sc].worldRight}},{key:"worldForward",get:function(){return v(this,sc)[sc].worldForward}},{key:"constrainPitch",get:function(){return v(this,sc)[sc].constrainPitch},set:function(e){v(this,sc)[sc].constrainPitch=e}},{key:"gimbalLock",get:function(){return v(this,sc)[sc].gimbalLock},set:function(e){v(this,sc)[sc].gimbalLock=e}},{key:"worldAxis",get:function(){return v(this,sc)[sc].worldAxis},set:function(e){var t=v(this,sc)[sc];t.worldAxis.set(e),t.worldRight[0]=t.worldAxis[0],t.worldRight[1]=t.worldAxis[1],t.worldRight[2]=t.worldAxis[2],t.worldUp[0]=t.worldAxis[3],t.worldUp[1]=t.worldAxis[4],t.worldUp[2]=t.worldAxis[5],t.worldForward[0]=t.worldAxis[6],t.worldForward[1]=t.worldAxis[7],t.worldForward[2]=t.worldAxis[8],this.onWorldAxis.dispatch(this,t.worldAxis)}},{key:"deviceMatrix",get:function(){return v(this,sc)[sc].deviceMatrix},set:function(e){v(this,sc)[sc].deviceMatrix.set(e||[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),v(this,sc)[sc].hasDeviceMatrix=!!e,this.setDirty()}},{key:"xUp",get:function(){return v(this,sc)[sc].worldUp[0]>v(this,sc)[sc].worldUp[1]&&v(this,sc)[sc].worldUp[0]>v(this,sc)[sc].worldUp[2]}},{key:"yUp",get:function(){return v(this,sc)[sc].worldUp[1]>v(this,sc)[sc].worldUp[0]&&v(this,sc)[sc].worldUp[1]>v(this,sc)[sc].worldUp[2]}},{key:"zUp",get:function(){return v(this,sc)[sc].worldUp[2]>v(this,sc)[sc].worldUp[0]&&v(this,sc)[sc].worldUp[2]>v(this,sc)[sc].worldUp[1]}},{key:"eyeLookDist",get:function(){return Nt(Ot(v(this,sc)[sc].look,v(this,sc)[sc].eye,za))}},{key:"viewMatrix",get:function(){return this.dirty&&this.cleanIfDirty(),v(this,sc)[sc].viewMatrix}},{key:"inverseViewMatrix",get:function(){return this.dirty&&this.cleanIfDirty(),v(this,sc)[sc].inverseViewMatrix}},{key:"projMatrix",get:function(){return v(this,cc)[cc].projMatrix}},{key:"frustum",get:function(){return this.dirty&&this.cleanIfDirty(),v(this,ac)[ac]}},{key:"projectionType",get:function(){return v(this,sc)[sc].projectionType},set:function(e){e=e||tt,v(this,sc)[sc].projectionType!==e&&(e===tt?v(this,cc)[cc]=this.perspectiveProjection:e===it?v(this,cc)[cc]=this.orthoProjection:e===rt?v(this,cc)[cc]=this.frustumProjection:e===nt?v(this,cc)[cc]=this.customProjection:(this.error("Unsupported value for 'projection': "+e+" defaulting to PerspectiveProjectionType"),v(this,cc)[cc]=this.perspectiveProjection,e=tt),v(this,cc)[cc].clean(),v(this,sc)[sc].projectionType=e,this.clean(),this.onProjectionType.dispatch(this,v(this,sc)[sc].projectionType),this.onProjMatrix.dispatch(this,v(this,cc)[cc].projMatrix))}}]),t}(ce),hc={viewerId:"",time:0,startTime:0,prevTime:0,deltaTime:0},uc=/*#__PURE__*/f("viewersRenderInfo"),dc=/*#__PURE__*/f("viewerIDMap"),fc=/*#__PURE__*/f("taskQueue"),vc=/*#__PURE__*/f("taskBudget"),pc=/*#__PURE__*/f("lastTime"),yc=/*#__PURE__*/f("elapsedTime"),mc=/*#__PURE__*/f("runTasks"),gc=/*#__PURE__*/f("runTasksUntil"),bc=/*#__PURE__*/f("fireTickEvents"),wc=/*#__PURE__*/f("renderViewers");function Pc(e){v(this,gc)[gc](e+v(this,vc)[vc]),this.getNumTasks(),v(this,vc)}function Ec(e){void 0===e&&(e=-1);for(var t=(new Date).getTime(),i=0;v(this,fc)[fc].length>0&&(e<0||t<e);){var r=v(this,fc)[fc].shift(),n=v(this,fc)[fc].shift();n?r.call(n):r(),t=(new Date).getTime(),i++}return i}function Tc(e){for(var t in hc.time=e,Ic.viewers)if(this.viewers.hasOwnProperty(t)){var i=this.viewers[t];hc.viewerId=t,hc.startTime=i.startTime,hc.deltaTime=null!=hc.prevTime?hc.time-hc.prevTime:0,i.onTick.dispatch(i,hc)}hc.prevTime=e}function _c(){for(var e in this.viewers)if(this.viewers.hasOwnProperty(e)){var t=this.viewers[e],i=v(this,uc)[uc][e];i||(i=v(this,uc)[uc][e]={}),t.render({})}}var Ic=new(/*#__PURE__*/function(){function e(){var e=this;Object.defineProperty(this,wc,{value:_c}),Object.defineProperty(this,bc,{value:Tc}),Object.defineProperty(this,gc,{value:Ec}),Object.defineProperty(this,mc,{value:Pc}),this.viewers=void 0,Object.defineProperty(this,uc,{writable:!0,value:{}}),Object.defineProperty(this,dc,{writable:!0,value:new Hi}),Object.defineProperty(this,fc,{writable:!0,value:new Xi}),Object.defineProperty(this,vc,{writable:!0,value:10}),Object.defineProperty(this,pc,{writable:!0,value:0}),Object.defineProperty(this,yc,{writable:!0,value:0}),this.viewers={},requestAnimationFrame(function t(){var i=Date.now();v(e,pc)[pc]>0&&(v(e,yc)[yc]=i-v(e,pc)[pc]),v(e,mc)[mc](i),v(e,bc)[bc](i),v(e,wc)[wc](),v(e,pc)[pc]=i,requestAnimationFrame(t)})}var t=e.prototype;return t.registerViewer=function(e){if(e.id){if(this.viewers[e.id])return void console.error("[ERROR] Viewer "+or(e.id)+" already exists")}else e.id=v(this,dc)[dc].addItem({});this.viewers[e.id]=e,v(this,uc)[uc][e.id]={}},t.deregisterViewer=function(e){this.viewers[e.id]&&(v(this,dc)[dc].removeItem(e.id),delete this.viewers[e.id],delete v(this,uc)[uc][e.id])},t.scheduleTask=function(e,t){v(this,fc)[fc].push(e),v(this,fc)[fc].push(t)},t.getNumTasks=function(){return v(this,fc)[fc].length},e}()),xc=Pt(),Sc=Pt(),Mc=Pt(),Oc=Pt(),Rc=Pt(),jc=/*#__PURE__*/f("duration"),Dc=/*#__PURE__*/f("look1"),Ac=/*#__PURE__*/f("eye1"),Cc=/*#__PURE__*/f("up1"),Bc=/*#__PURE__*/f("look2"),kc=/*#__PURE__*/f("eye2"),Lc=/*#__PURE__*/f("up2"),Fc=/*#__PURE__*/f("orthoScale1"),Uc=/*#__PURE__*/f("orthoScale2"),Nc=/*#__PURE__*/f("fit"),Gc=/*#__PURE__*/f("trail"),Vc=/*#__PURE__*/f("flying"),Hc=/*#__PURE__*/f("flyEyeLookUp"),Xc=/*#__PURE__*/f("flyingEye"),Wc=/*#__PURE__*/f("flyingLook"),Yc=/*#__PURE__*/f("callback"),Kc=/*#__PURE__*/f("callbackScope"),zc=/*#__PURE__*/f("time1"),qc=/*#__PURE__*/f("time2"),Zc=/*#__PURE__*/f("flyingEyeLookUp"),Qc=/*#__PURE__*/f("fitFOV"),Jc=/*#__PURE__*/f("projection2"),$c=/*#__PURE__*/f("projMatrix1"),el=/*#__PURE__*/f("projMatrix2"),tl=/*#__PURE__*/f("jumpTo"),il=/*#__PURE__*/f("update"),rl=/*#__PURE__*/f("ease"),nl=/*#__PURE__*/f("easeInCubic"),ol=/*#__PURE__*/f("easeOutExpo"),sl=/*#__PURE__*/function(e){function t(t,i){var r;return r=e.call(this,t,i)||this,Object.defineProperty(l(r),il,{value:cl}),Object.defineProperty(l(r),tl,{value:al}),r.view=void 0,r.camera=void 0,Object.defineProperty(l(r),jc,{writable:!0,value:void 0}),Object.defineProperty(l(r),Dc,{writable:!0,value:void 0}),Object.defineProperty(l(r),Ac,{writable:!0,value:void 0}),Object.defineProperty(l(r),Cc,{writable:!0,value:void 0}),Object.defineProperty(l(r),Bc,{writable:!0,value:void 0}),Object.defineProperty(l(r),kc,{writable:!0,value:void 0}),Object.defineProperty(l(r),Lc,{writable:!0,value:void 0}),Object.defineProperty(l(r),Fc,{writable:!0,value:void 0}),Object.defineProperty(l(r),Uc,{writable:!0,value:void 0}),Object.defineProperty(l(r),Nc,{writable:!0,value:void 0}),Object.defineProperty(l(r),Gc,{writable:!0,value:void 0}),Object.defineProperty(l(r),Vc,{writable:!0,value:void 0}),Object.defineProperty(l(r),Hc,{writable:!0,value:void 0}),Object.defineProperty(l(r),Xc,{writable:!0,value:void 0}),Object.defineProperty(l(r),Wc,{writable:!0,value:void 0}),Object.defineProperty(l(r),Yc,{writable:!0,value:void 0}),Object.defineProperty(l(r),Kc,{writable:!0,value:void 0}),Object.defineProperty(l(r),zc,{writable:!0,value:void 0}),Object.defineProperty(l(r),qc,{writable:!0,value:void 0}),r.easing=void 0,Object.defineProperty(l(r),Zc,{writable:!0,value:void 0}),Object.defineProperty(l(r),Qc,{writable:!0,value:void 0}),Object.defineProperty(l(r),Jc,{writable:!0,value:void 0}),Object.defineProperty(l(r),$c,{writable:!0,value:void 0}),Object.defineProperty(l(r),el,{writable:!0,value:void 0}),r.onStarted=void 0,r.onStopped=void 0,r.onCancelled=void 0,r.view=t,r.camera=t.camera,v(l(r),Dc)[Dc]=Pt(),v(l(r),Ac)[Ac]=Pt(),v(l(r),Cc)[Cc]=Pt(),v(l(r),Bc)[Bc]=Pt(),v(l(r),kc)[kc]=Pt(),v(l(r),Lc)[Lc]=Pt(),v(l(r),Fc)[Fc]=1,v(l(r),Uc)[Uc]=1,v(l(r),Vc)[Vc]=!1,v(l(r),Hc)[Hc]=!1,v(l(r),Xc)[Xc]=!1,v(l(r),Wc)[Wc]=!1,v(l(r),Yc)[Yc]=null,v(l(r),Kc)[Kc]=null,v(l(r),zc)[zc]=null,v(l(r),qc)[qc]=null,r.easing=!0,v(l(r),Gc)[Gc]=!1,v(l(r),Nc)[Nc]=!0,v(l(r),jc)[jc]=500,r.onStarted=new y(new ie.EventDispatcher),r.onStopped=new y(new ie.EventDispatcher),r.onCancelled=new y(new ie.EventDispatcher),r}n(t,e);var i=t.prototype;return i.flyTo=function(e,t){void 0===e&&(e={}),v(this,Vc)[Vc]&&this.stop(),v(this,Vc)[Vc]=!1,v(this,Xc)[Xc]=!1,v(this,Wc)[Wc]=!1,v(this,Zc)[Zc]=!1,v(this,Yc)[Yc]=t;var i,r,n,o,s=this.camera,a=!!e.projection&&e.projection!==s.projectionType;v(this,Ac)[Ac][0]=s.eye[0],v(this,Ac)[Ac][1]=s.eye[1],v(this,Ac)[Ac][2]=s.eye[2],v(this,Dc)[Dc][0]=s.look[0],v(this,Dc)[Dc][1]=s.look[1],v(this,Dc)[Dc][2]=s.look[2],v(this,Cc)[Cc][0]=s.up[0],v(this,Cc)[Cc][1]=s.up[1],v(this,Cc)[Cc][2]=s.up[2],v(this,Fc)[Fc]=s.orthoProjection.scale,v(this,Uc)[Uc]=e.orthoScale||v(this,Fc)[Fc],e.aabb?i=e.aabb:e.eye&&e.look||e.up?(r=e.eye,n=e.look,o=e.up):e.eye?r=e.eye:e.look?n=e.look:a||(i=this.view.aabb);var c=e.poi;if(i){if(i[3]<i[0]||i[4]<i[1]||i[5]<i[2])return;if(i[3]===i[0]&&i[4]===i[1]&&i[5]===i[2])return;var l=Rr(i=i.slice());v(this,Bc)[Bc]=c||l;var h=Kt(Ot(v(this,Ac)[Ac],v(this,Dc)[Dc],xc)),u=c?Or(i,c):Mr(i),d=e.fitFOV||v(this,Qc)[Qc],f=Math.abs(u/Math.tan(d*ct));v(this,Uc)[Uc]=1.1*u,v(this,kc)[kc][0]=v(this,Bc)[Bc][0]+h[0]*f,v(this,kc)[kc][1]=v(this,Bc)[Bc][1]+h[1]*f,v(this,kc)[kc][2]=v(this,Bc)[Bc][2]+h[2]*f,v(this,Lc)[Lc][0]=v(this,Cc)[Cc][0],v(this,Lc)[Lc][1]=v(this,Cc)[Cc][1],v(this,Lc)[Lc][2]=v(this,Cc)[Cc][2],v(this,Zc)[Zc]=!0}else(r||n||o)&&(v(this,Zc)[Zc]=!!r&&!!n&&!!o,v(this,Xc)[Xc]=!!r&&!n,v(this,Wc)[Wc]=!!n&&!r,r&&(v(this,kc)[kc][0]=r[0],v(this,kc)[kc][1]=r[1],v(this,kc)[kc][2]=r[2]),n&&(v(this,Bc)[Bc][0]=n[0],v(this,Bc)[Bc][1]=n[1],v(this,Bc)[Bc][2]=n[2]),o&&(v(this,Lc)[Lc][0]=o[0],v(this,Lc)[Lc][1]=o[1],v(this,Lc)[Lc][2]=o[2]));a?(e.projection===it&&s.projectionType!==it&&(v(this,Jc)[Jc]=it,v(this,$c)[$c]=s.projMatrix.slice(),v(this,el)[el]=s.orthoProjection.projMatrix.slice(),s.projectionType=nt),e.projection===tt&&s.projectionType!==tt&&(v(this,Jc)[Jc]=tt,v(this,$c)[$c]=s.projMatrix.slice(),v(this,el)[el]=s.perspectiveProjection.projMatrix.slice(),s.projectionType=nt)):v(this,Jc)[Jc]=null,this.onStarted.dispatch(this,null),v(this,zc)[zc]=Date.now(),v(this,qc)[qc]=v(this,zc)[zc]+(e.duration?1e3*e.duration:v(this,jc)[jc]),v(this,Vc)[Vc]=!0,Ic.scheduleTask(v(this,il)[il],this)},i.jumpTo=function(e){v(this,tl)[tl](e)},i.stop=function(){if(v(this,Vc)[Vc]){v(this,Vc)[Vc]=!1,v(this,zc)[zc]=null,v(this,qc)[qc]=null,v(this,Jc)[Jc]&&(this.camera.projectionType=v(this,Jc)[Jc]);var e=v(this,Yc)[Yc];e&&(v(this,Yc)[Yc]=null,e()),this.onStopped.dispatch(this,null)}},i.cancel=function(){v(this,Vc)[Vc]&&(v(this,Vc)[Vc]=!1,v(this,zc)[zc]=null,v(this,qc)[qc]=null,v(this,Yc)[Yc]&&(v(this,Yc)[Yc]=null),this.onCancelled.dispatch(this,null))},i.destroy=function(){this.stop(),e.prototype.destroy.call(this),this.onStarted.clear(),this.onStopped.clear(),this.onCancelled.clear()},r(t,[{key:"duration",get:function(){return v(this,jc)[jc]/1e3},set:function(e){v(this,jc)[jc]=e?1e3*e:500,this.stop()}},{key:"fit",get:function(){return v(this,Nc)[Nc]},set:function(e){v(this,Nc)[Nc]=e}},{key:"fitFOV",get:function(){return v(this,Qc)[Qc]},set:function(e){v(this,Qc)[Qc]=e}},{key:"trail",get:function(){return v(this,Gc)[Gc]},set:function(e){v(this,Gc)[Gc]=e}}]),t}(ce);function al(e){v(this,Vc)[Vc]&&this.stop();var t,i,r,n,o=this.camera;e.aabb?t=e.aabb:e.eye||e.look||e.up?(i=e.eye,r=e.look,n=e.up):t=this.view.aabb;var s=e.poi;if(t){if(t[3]<=t[0]||t[4]<=t[1]||t[5]<=t[2])return;var a,c=s?Or(t,s):Mr(t);r=s||Rr(t,r),v(this,Gc)[Gc]?Ot(o.look,r,Rc):Ot(o.eye,o.look,Rc),Kt(Rc),a=(void 0!==e.fit?e.fit:v(this,Nc)[Nc])?Math.abs(c/Math.tan((e.fitFOV||v(this,Qc)[Qc])*ct)):Nt(Ot(o.eye,o.look,xc)),It(Rc,a),o.eye=St(r,Rc,xc),o.look=r,this.camera.orthoProjection.scale=1.1*c}else(i||r||n)&&(i&&(o.eye=i),r&&(o.look=r),n&&(o.up=n));e.projection&&(o.projectionType=e.projection)}function cl(){if(v(this,Vc)[Vc]){var e=(Date.now()-v(this,zc)[zc])/(v(this,qc)[qc]-v(this,zc)[zc]),t=e>=1;e>1&&(e=1);var i=this.easing?v(sl,rl)[rl](e,0,1,1):e,r=this.camera;if(v(this,Xc)[Xc]||v(this,Wc)[Wc]?v(this,Xc)[Xc]?(Ot(r.eye,r.look,Rc),r.eye=Xt(i,0,1,v(this,Ac)[Ac],v(this,kc)[kc],Mc),r.look=Ot(Mc,Rc,Sc)):v(this,Wc)[Wc]&&(r.look=Xt(i,0,1,v(this,Dc)[Dc],v(this,Bc)[Bc],Sc),r.up=Xt(i,0,1,v(this,Cc)[Cc],v(this,Lc)[Lc],Oc)):v(this,Zc)[Zc]&&(r.eye=Xt(i,0,1,v(this,Ac)[Ac],v(this,kc)[kc],Mc),r.look=Xt(i,0,1,v(this,Dc)[Dc],v(this,Bc)[Bc],Sc),r.up=Xt(i,0,1,v(this,Cc)[Cc],v(this,Lc)[Lc],Oc)),v(this,Jc)[Jc]){var n=v(this,Jc)[Jc]===it?v(sl,ol)[ol](e,0,1,1):v(sl,nl)[nl](e,0,1,1);r.customProjection.projMatrix=Ai(n,0,1,v(this,$c)[$c],v(this,el)[el])}else r.orthoProjection.scale=v(this,Fc)[Fc]+e*(v(this,Uc)[Uc]-v(this,Fc)[Fc]);if(t)return r.orthoProjection.scale=v(this,Uc)[Uc],void this.stop();Ic.scheduleTask(v(this,il)[il],this)}}Object.defineProperty(sl,ol,{value:function(e,t,i,r){return i*(1-Math.pow(2,-10*e/r))+t}}),Object.defineProperty(sl,nl,{value:function(e,t,i,r){return i*(e/=r)*e*e+t}}),Object.defineProperty(sl,rl,{value:function(e,t,i,r){return-i*(e/=r)*(e-2)+t}});var ll=/*#__PURE__*/f("onTick"),hl=/*#__PURE__*/f("backgroundColor"),ul=/*#__PURE__*/f("backgroundColorFromAmbientLight"),dl=/*#__PURE__*/f("resolutionScale"),fl=/*#__PURE__*/f("numObjects"),vl=/*#__PURE__*/f("objectIds"),pl=/*#__PURE__*/f("numVisibleObjects"),yl=/*#__PURE__*/f("visibleObjectIds"),ml=/*#__PURE__*/f("numXRayedObjects"),gl=/*#__PURE__*/f("xrayedObjectIds"),bl=/*#__PURE__*/f("numHighlightedObjects"),wl=/*#__PURE__*/f("highlightedObjectIds"),Pl=/*#__PURE__*/f("numSelectedObjects"),El=/*#__PURE__*/f("selectedObjectIds"),Tl=/*#__PURE__*/f("numColorizedObjects"),_l=/*#__PURE__*/f("colorizedObjectIds"),Il=/*#__PURE__*/f("numOpacityObjects"),xl=/*#__PURE__*/f("opacityObjectIds"),Sl=/*#__PURE__*/f("qualityRender"),Ml=/*#__PURE__*/f("lightsHash"),Ol=/*#__PURE__*/f("sectionPlanesHash"),Rl=/*#__PURE__*/f("createViewObjects"),jl=/*#__PURE__*/f("registerSectionPlane"),Dl=/*#__PURE__*/f("deregisterSectionPlane"),Al=/*#__PURE__*/f("destroyViewObjects"),Cl=/*#__PURE__*/function(e){function t(t){var i;i=e.call(this,null,t)||this,Object.defineProperty(l(i),Al,{value:Fl}),Object.defineProperty(l(i),Dl,{value:Ll}),Object.defineProperty(l(i),jl,{value:kl}),Object.defineProperty(l(i),Rl,{value:Bl}),i.viewIndex=void 0,i.camera=void 0,i.canvasElement=void 0,i.transparent=void 0,i.boundary=void 0,i.logarithmicDepthBufferEnabled=void 0,i.sao=void 0,i.cameraFlight=void 0,i.metrics=void 0,i.xrayMaterial=void 0,i.highlightMaterial=void 0,i.selectedMaterial=void 0,i.edgeMaterial=void 0,i.pointsMaterial=void 0,i.linesMaterial=void 0,i.objects=void 0,i.visibleObjects=void 0,i.xrayedObjects=void 0,i.highlightedObjects=void 0,i.selectedObjects=void 0,i.colorizedObjects=void 0,i.opacityObjects=void 0,i.sectionPlanes=void 0,i.sectionPlanesList=[],i.lights=void 0,i.lightsList=[],i.gammaOutput=void 0,i.layers=void 0,i.autoLayers=void 0,i.onBoundary=void 0,i.onObjectVisibility=void 0,i.onObjectXRayed=void 0,i.onLayerCreated=void 0,i.onLayerDestroyed=void 0,i.onSectionPlaneCreated=void 0,i.onSectionPlaneDestroyed=void 0,Object.defineProperty(l(i),ll,{writable:!0,value:void 0}),Object.defineProperty(l(i),hl,{writable:!0,value:void 0}),Object.defineProperty(l(i),ul,{writable:!0,value:void 0}),Object.defineProperty(l(i),dl,{writable:!0,value:void 0}),Object.defineProperty(l(i),fl,{writable:!0,value:void 0}),Object.defineProperty(l(i),vl,{writable:!0,value:void 0}),Object.defineProperty(l(i),pl,{writable:!0,value:void 0}),Object.defineProperty(l(i),yl,{writable:!0,value:void 0}),Object.defineProperty(l(i),ml,{writable:!0,value:void 0}),Object.defineProperty(l(i),gl,{writable:!0,value:void 0}),Object.defineProperty(l(i),bl,{writable:!0,value:void 0}),Object.defineProperty(l(i),wl,{writable:!0,value:void 0}),Object.defineProperty(l(i),Pl,{writable:!0,value:void 0}),Object.defineProperty(l(i),El,{writable:!0,value:void 0}),Object.defineProperty(l(i),Tl,{writable:!0,value:void 0}),Object.defineProperty(l(i),_l,{writable:!0,value:void 0}),Object.defineProperty(l(i),Il,{writable:!0,value:void 0}),Object.defineProperty(l(i),xl,{writable:!0,value:void 0}),Object.defineProperty(l(i),Sl,{writable:!0,value:void 0}),Object.defineProperty(l(i),Ml,{writable:!0,value:null}),Object.defineProperty(l(i),Ol,{writable:!0,value:null}),i.viewer=t.viewer;var r=t.canvasElement||document.getElementById(t.canvasId);if(!(r instanceof HTMLCanvasElement))throw"Mandatory View config expected: valid canvasId or canvasElement";i.canvasElement=r,i.viewIndex=0,i.objects={},i.visibleObjects={},i.xrayedObjects={},i.highlightedObjects={},i.selectedObjects={},i.colorizedObjects={},i.opacityObjects={},i.sectionPlanes={},i.sectionPlanesList=[],i.lights={},i.lightsList=[],i.layers={},v(l(i),fl)[fl]=0,v(l(i),vl)[vl]=null,v(l(i),pl)[pl]=0,v(l(i),yl)[yl]=null,v(l(i),ml)[ml]=0,v(l(i),gl)[gl]=null,v(l(i),bl)[bl]=0,v(l(i),wl)[wl]=null,v(l(i),Pl)[Pl]=0,v(l(i),El)[El]=null,v(l(i),Tl)[Tl]=0,v(l(i),_l)[_l]=null,v(l(i),Il)[Il]=0,v(l(i),xl)[xl]=null,v(l(i),Sl)[Sl]=!!t.qualityRender,i.gammaOutput=!0,v(l(i),Ol)[Ol]=null,v(l(i),Ml)[Ml]=null,i.onBoundary=new y(new ie.EventDispatcher),v(l(i),dl)[dl]=1,v(l(i),hl)[hl]=Pt([t.backgroundColor?t.backgroundColor[0]:1,t.backgroundColor?t.backgroundColor[1]:1,t.backgroundColor?t.backgroundColor[2]:1]),v(l(i),ul)[ul]=!!t.backgroundColorFromAmbientLight,i.transparent=!!t.transparent,i.canvasElement.width=i.canvasElement.clientWidth,i.canvasElement.height=i.canvasElement.clientHeight,i.boundary=[i.canvasElement.offsetLeft,i.canvasElement.offsetTop,i.canvasElement.clientWidth,i.canvasElement.clientHeight];var n=0,o=0,s=0,a=0,c=0,h=0,u=null,d=null;return v(l(i),ll)[ll]=i.viewer.onTick.subscribe(function(){var e=i.canvasElement,t=v(l(i),dl)[dl]!==d,r=window.innerWidth!==n||window.innerHeight!==o,f=e.clientWidth!==s||e.clientHeight!==a,p=e.offsetLeft!==c||e.offsetTop!==h,y=e.parentElement;if(t||r||f||p||y!==u){if(t||f||p){var m=e.clientWidth,g=e.clientHeight;(t||f)&&(e.width=Math.round(e.clientWidth*v(l(i),dl)[dl]),e.height=Math.round(e.clientHeight*v(l(i),dl)[dl]));var b=i.boundary;b[0]=e.offsetLeft,b[1]=e.offsetTop,b[2]=m,b[3]=g,t&&!f||i.onBoundary.dispatch(l(i),b),s=m,a=g}t&&(d=v(l(i),dl)[dl]),r&&(n=window.innerWidth,o=window.innerHeight),p&&(c=e.offsetLeft,h=e.offsetTop),u=y}}),i.camera=new lc(l(i)),i.sao=new $s(l(i),{}),i.cameraFlight=new sl(l(i),{duration:.5}),i.metrics=new Qs(l(i),{units:t.units,scale:t.scale,origin:t.origin}),i.xrayMaterial=new Ia(l(i),{fill:!0,fillColor:[.9,.7,.6],fillAlpha:.4,edges:!0,edgeColor:[.5,.4,.4],edgeAlpha:1,edgeWidth:1}),i.highlightMaterial=new Ia(l(i),{fill:!0,fillColor:[1,1,0],fillAlpha:.5,edges:!0,edgeColor:[.5,.4,.4],edgeAlpha:1,edgeWidth:1}),i.selectedMaterial=new Ia(l(i),{fill:!0,fillColor:[0,1,0],fillAlpha:.5,edges:!0,edgeColor:[.4,.5,.4],edgeAlpha:1,edgeWidth:1}),i.edgeMaterial=new Sa(l(i),{edgeColor:[0,0,0],edgeAlpha:1,edgeWidth:1,edges:!0,renderModes:[$e]}),i.pointsMaterial=new Oa(l(i),{pointSize:1,roundPoints:!0,perspectivePoints:!0,minPerspectivePointSize:1,maxPerspectivePointSize:6,filterIntensity:!1,minIntensity:0,maxIntensity:1}),i.linesMaterial=new ta(l(i),{lineWidth:1}),i.lights={},v(l(i),Sl)[Sl]=!!t.qualityRender,i.autoLayers=!1!==t.autoLayers,i.logarithmicDepthBufferEnabled=!!t.logarithmicDepthBufferEnabled,i.onObjectVisibility=new y(new ie.EventDispatcher),i.onObjectXRayed=new y(new ie.EventDispatcher),i.onLayerCreated=new y(new ie.EventDispatcher),i.onLayerDestroyed=new y(new ie.EventDispatcher),i.onSectionPlaneCreated=new y(new ie.EventDispatcher),i.onSectionPlaneDestroyed=new y(new ie.EventDispatcher),i}n(t,e);var i=t.prototype;return i.initViewObjects=function(){var e=this;for(var t in this.viewer.scene.models)v(this,Rl)[Rl](this.viewer.scene.models[t]);this.viewer.scene.onModelCreated.subscribe(function(t,i){v(e,Rl)[Rl](i)}),this.viewer.scene.onModelDestroyed.subscribe(function(t,i){v(e,Al)[Al](i)})},i.registerViewObject=function(e){this.objects[e.id]=e,v(this,fl)[fl]++,v(this,vl)[vl]=null},i.deregisterViewObject=function(e){delete this.objects[e.id],delete this.visibleObjects[e.id],delete this.xrayedObjects[e.id],delete this.highlightedObjects[e.id],delete this.selectedObjects[e.id],delete this.colorizedObjects[e.id],delete this.opacityObjects[e.id],v(this,fl)[fl]--,v(this,vl)[vl]=null},i.objectVisibilityUpdated=function(e,t,i){void 0===i&&(i=!0),t?(this.visibleObjects[e.id]=e,v(this,pl)[pl]++):(delete this.visibleObjects[e.id],v(this,pl)[pl]--),v(this,yl)[yl]=null,i&&this.onObjectVisibility.dispatch(this,e)},i.objectXRayedUpdated=function(e,t,i){void 0===i&&(i=!0),t?(this.xrayedObjects[e.id]=e,v(this,ml)[ml]++):(delete this.xrayedObjects[e.id],v(this,ml)[ml]--),v(this,gl)[gl]=null,i&&this.onObjectXRayed.dispatch(this,e)},i.objectHighlightedUpdated=function(e,t){t?(this.highlightedObjects[e.id]=e,v(this,bl)[bl]++):(delete this.highlightedObjects[e.id],v(this,bl)[bl]--),v(this,wl)[wl]=null},i.objectSelectedUpdated=function(e,t){t?(this.selectedObjects[e.id]=e,v(this,Pl)[Pl]++):(delete this.selectedObjects[e.id],v(this,Pl)[Pl]--),v(this,El)[El]=null},i.objectColorizeUpdated=function(e,t){t?(this.colorizedObjects[e.id]=e,v(this,Tl)[Tl]++):(delete this.colorizedObjects[e.id],v(this,Tl)[Tl]--),v(this,_l)[_l]=null},i.objectOpacityUpdated=function(e,t){t?(this.opacityObjects[e.id]=e,v(this,Il)[Il]++):(delete this.opacityObjects[e.id],v(this,Il)[Il]--),v(this,xl)[xl]=null},i.createSectionPlane=function(e){var t=this,i=e.id||sr();this.sectionPlanes[i]&&(this.error('SectionPlane with ID "'+i+'" already exists - will randomly-generate ID'),i=sr());var r=new Ys(this,e);return v(this,jl)[jl](r),r.onDestroyed.one(function(){v(t,Dl)[Dl](r)}),r},i.clearSectionPlanes=function(){for(var e=Object.keys(this.sectionPlanes),t=0,i=e.length;t<i;t++)this.sectionPlanes[e[t]].destroy();this.sectionPlanesList.length=0,v(this,Ol)[Ol]=null},i.getSectionPlanesHash=function(){if(v(this,Ol)[Ol])return v(this,Ol)[Ol];if(0===this.sectionPlanesList.length)return v(this,Ol)[Ol]=";";for(var e=[],t=0,i=this.sectionPlanesList.length;t<i;t++)e.push("cp");return e.push(";"),v(this,Ol)[Ol]=e.join(""),v(this,Ol)[Ol]},i.registerLight=function(e){this.lightsList.push(e),this.lights[e.id]=e,v(this,Ml)[Ml]=null,this.rebuild()},i.deregisterLight=function(e){for(var t=0,i=this.lightsList.length;t<i;t++)if(this.lightsList[t].id===e.id)return this.lightsList.splice(t,1),v(this,Ml)[Ml]=null,delete this.lights[e.id],void this.rebuild()},i.clearLights=function(){for(var e=Object.keys(this.lights),t=0,i=e.length;t<i;t++)this.lights[e[t]].destroy()},i.getLightsHash=function(){if(v(this,Ml)[Ml])return v(this,Ml)[Ml];if(0===this.lightsList.length)return v(this,Ml)[Ml]=";";for(var e=[],t=this.lightsList,i=0,r=t.length;i<r;i++){var n=t[i];e.push("/"),e.push(n.type),e.push("world"===n.space?"w":"v"),n.castsShadow&&e.push("sh")}return e.push(";"),v(this,Ml)[Ml]=e.join(""),v(this,Ml)[Ml]},i.rebuild=function(){this.viewer.renderer.needsRebuild(this.viewIndex)},i.redraw=function(){this.viewer.renderer.setImageDirty(this.viewIndex)},i.getAmbientColorAndIntensity=function(){return[0,0,0,1]},i.setObjectsVisible=function(e,t){return this.withObjects(e,function(e){var i=e.visible!==t;return e.visible=t,i})},i.setObjectsCollidable=function(e,t){return this.withObjects(e,function(e){var i=e.collidable!==t;return e.collidable=t,i})},i.setObjectsCulled=function(e,t){return this.withObjects(e,function(e){var i=e.culled!==t;return e.culled=t,i})},i.setObjectsSelected=function(e,t){return this.withObjects(e,function(e){var i=e.selected!==t;return e.selected=t,i})},i.setObjectsHighlighted=function(e,t){return this.withObjects(e,function(e){var i=e.highlighted!==t;return e.highlighted=t,i})},i.setObjectsXRayed=function(e,t){return this.withObjects(e,function(e){var i=e.xrayed!==t;return i&&(e.xrayed=t),i})},i.setObjectsColorized=function(e,t){return this.withObjects(e,function(e){e.colorize=t})},i.setObjectsOpacity=function(e,t){return this.withObjects(e,function(e){var i=e.opacity!==t;return i&&(e.opacity=t),i})},i.setObjectsPickable=function(e,t){return this.withObjects(e,function(e){var i=e.pickable!==t;return i&&(e.pickable=t),i})},i.setObjectsClippable=function(e,t){return this.withObjects(e,function(e){var i=e.clippable!==t;return i&&(e.clippable=t),i})},i.withObjects=function(e,t){for(var i=!1,r=0,n=e.length;r<n;r++){var o=this.objects[e[r]];o&&(i=t(o)||i)}return i},i.createLayer=function(e){var t=this,i=this.layers[e.id];return i||(i=new wa({id:e.id,view:this,viewer:this.viewer}),this.layers[e.id]=i,this.onLayerCreated.dispatch(this,i),i.onDestroyed.one(function(){delete t.layers[i.id],t.onLayerDestroyed.dispatch(t,i)})),i.autoDestroy=!1,i},i.destroy=function(){this.viewer.onTick.unsubscribe(v(this,ll)[ll]),e.prototype.destroy.call(this),this.onObjectVisibility.clear(),this.onObjectXRayed.clear(),this.onLayerCreated.clear(),this.onLayerDestroyed.clear(),this.onSectionPlaneCreated.clear(),this.onSectionPlaneDestroyed.clear()},r(t,[{key:"aabb",get:function(){return this.viewer.scene.aabb}},{key:"backgroundColor",get:function(){return v(this,hl)[hl]},set:function(e){e?(v(this,hl)[hl][0]=e[0],v(this,hl)[hl][1]=e[1],v(this,hl)[hl][2]=e[2]):(v(this,hl)[hl][0]=1,v(this,hl)[hl][1]=1,v(this,hl)[hl][2]=1),this.redraw()}},{key:"backgroundColorFromAmbientLight",get:function(){return v(this,ul)[ul]},set:function(e){v(this,ul)[ul]=!1!==e}},{key:"resolutionScale",get:function(){return v(this,dl)[dl]},set:function(e){if((e=e||1)!==v(this,dl)[dl]){v(this,dl)[dl]=e;var t=this.canvasElement;t.width=Math.round(t.clientWidth*v(this,dl)[dl]),t.height=Math.round(t.clientHeight*v(this,dl)[dl]),this.redraw()}}},{key:"gammaFactor",get:function(){return 1}},{key:"qualityRender",get:function(){return v(this,Sl)[Sl]},set:function(e){v(this,Sl)[Sl]!==e&&(v(this,Sl)[Sl]=e,this.redraw())}},{key:"numObjects",get:function(){return v(this,fl)[fl]}},{key:"objectIds",get:function(){return v(this,vl)[vl]||(v(this,vl)[vl]=Object.keys(this.objects)),v(this,vl)[vl]}},{key:"numVisibleObjects",get:function(){return v(this,pl)[pl]}},{key:"visibleObjectIds",get:function(){return v(this,yl)[yl]||(v(this,yl)[yl]=Object.keys(this.visibleObjects)),v(this,yl)[yl]}},{key:"numXRayedObjects",get:function(){return v(this,ml)[ml]}},{key:"xrayedObjectIds",get:function(){return v(this,gl)[gl]||(v(this,gl)[gl]=Object.keys(this.xrayedObjects)),v(this,gl)[gl]}},{key:"numHighlightedObjects",get:function(){return v(this,bl)[bl]}},{key:"highlightedObjectIds",get:function(){return v(this,wl)[wl]||(v(this,wl)[wl]=Object.keys(this.highlightedObjects)),v(this,wl)[wl]}},{key:"numSelectedObjects",get:function(){return v(this,Pl)[Pl]}},{key:"selectedObjectIds",get:function(){return v(this,El)[El]||(v(this,El)[El]=Object.keys(this.selectedObjects)),v(this,El)[El]}},{key:"numColorizedObjects",get:function(){return v(this,Tl)[Tl]}},{key:"colorizedObjectIds",get:function(){return v(this,_l)[_l]||(v(this,_l)[_l]=Object.keys(this.colorizedObjects)),v(this,_l)[_l]}},{key:"opacityObjectIds",get:function(){return v(this,xl)[xl]||(v(this,xl)[xl]=Object.keys(this.opacityObjects)),v(this,xl)[xl]}},{key:"numOpacityObjects",get:function(){return v(this,Il)[Il]}}]),t}(ce);function Bl(e){var t=this,i=e.objects,r=this.viewer.renderer.rendererViewObjects,n=function(){var e=i[o],n=r[o],s="default",a=t.layers[s];if(!a){if(!t.autoLayers)return"continue";a=new wa({id:s,view:t,viewer:t.viewer}),t.layers[s]=a,a.onDestroyed.one(function(){delete t.layers[a.id],t.onLayerDestroyed.dispatch(t,a)}),t.onLayerCreated.dispatch(t,a)}var c=new Xs(a,e,n);a.registerViewObject(c),t.registerViewObject(c)};for(var o in i)n()}function kl(e){this.sectionPlanesList.push(e),this.sectionPlanes[e.id]=e,v(this,Ol)[Ol]=null,this.rebuild(),this.onSectionPlaneCreated.dispatch(this,e)}function Ll(e){for(var t=0,i=this.sectionPlanesList.length;t<i;t++)if(this.sectionPlanesList[t].id===e.id)return this.sectionPlanesList.splice(t,1),v(this,Ol)[Ol]=null,delete this.sectionPlanes[e.id],this.rebuild(),void this.onSectionPlaneDestroyed.dispatch(this,e)}function Fl(e){var t=e.objects;for(var i in t){var r=this.layers.default,n=this.objects[t[i].id];this.deregisterViewObject(n),r&&(r.deregisterViewObject(n),r.autoDestroy&&0===r.numObjects&&r.destroy())}}var Ul=/*#__PURE__*/f("prefixMessageWithID"),Nl=/*#__PURE__*/f("registerView"),Gl=/*#__PURE__*/f("deregisterView"),Vl=/*#__PURE__*/function(e){function t(t){var i;return i=e.call(this,null,{})||this,Object.defineProperty(l(i),Gl,{value:Wl}),Object.defineProperty(l(i),Nl,{value:Xl}),Object.defineProperty(l(i),Ul,{value:Hl}),i.capabilities=void 0,i.onTick=void 0,i.onViewCreated=void 0,i.onViewDestroyed=void 0,i.scene=void 0,i.views=void 0,i.viewList=void 0,i.numViews=void 0,i.startTime=(new Date).getTime(),i.renderer=void 0,i.onTick=new y(new ie.EventDispatcher),i.onViewCreated=new y(new ie.EventDispatcher),i.onViewDestroyed=new y(new ie.EventDispatcher),i.id=t.id||sr(),i.viewList=[],i.numViews=0,i.views={},i.destroyed=!1,i.capabilities={maxViews:0,astcSupported:!1,etc1Supported:!1,etc2Supported:!1,dxtSupported:!1,bptcSupported:!1,pvrtcSupported:!1},i.scene=t.scene||new go,i.renderer=t.renderer,i.renderer.getCapabilities(i.capabilities),i.renderer.attachViewer(l(i)),Ic.registerViewer(l(i)),i}n(t,e);var i=t.prototype;return i.createView=function(e){var t=this;if(this.viewList.length>=this.capabilities.maxViews)return new ue("Attempted to create too many Views with View.createView() - maximum of "+this.capabilities.maxViews+" is allowed");var i=e.id||sr();if(this.views[i])return new ue('View with ID "'+i+'" already exists');if(!((e.canvasElement||document.getElementById(e.canvasId))instanceof HTMLCanvasElement))return new ue("Mandatory View config expected: valid canvasId or canvasElement");var r=new Cl(nr({viewId:i,viewer:this},e));for(var n in v(this,Nl)[Nl](r),r.viewIndex=this.renderer.attachView(r),r.onDestroyed.one(function(){v(t,Gl)[Gl](r),t.renderer.detachView(r.viewIndex),t.onViewDestroyed.dispatch(t,r)}),this.scene.onModelCreated.subscribe(function(e,i){t.renderer.attachSceneModel(i)}),this.scene.onModelDestroyed.subscribe(function(e,i){t.renderer.detachSceneModel(i)}),this.scene.models)this.renderer.attachSceneModel(this.scene.models[n]);return r.initViewObjects(),this.onViewCreated.dispatch(this,r),this.log("View created: "+r.viewId),r},i.redraw=function(){for(var e in this.views)this.views[e].redraw()},i.log=function(e){e="[LOG] "+v(this,Ul)[Ul](e),window.console.log(e)},i.warn=function(e){e="[WARN] "+v(this,Ul)[Ul](e),window.console.warn(e)},i.error=function(e){e="[ERROR] "+v(this,Ul)[Ul](e),window.console.error(e)},i.destroy=function(){if(!this.destroyed){for(var e in Ic.deregisterViewer(this),this.views)this.views[e].destroy();this.onTick.clear(),this.onViewCreated.clear(),this.onViewDestroyed.clear()}},i.render=function(e){for(var t=0;t<this.viewList.length;t++)this.renderer.render(t,{force:!0})},t}(ce);function Hl(e){return" ["+this.constructor.name+' "'+or(this.id)+'"]: '+e}function Xl(e){if(!this.views[e.id]){this.views[e.id]=e;for(var t=0;;t++)if(!this.viewList[t])return this.viewList[t]=e,this.numViews++,void(e.viewIndex=t)}}function Wl(e){this.views[e.id]&&(delete this.views[e.id],delete this.viewList[e.viewIndex],this.numViews--)}var Yl=/*#__PURE__*/f("state"),Kl=/*#__PURE__*/function(e){function t(t,i){var r;return void 0===i&&(i={}),(r=e.call(this,t,i)||this).view=void 0,Object.defineProperty(l(r),Yl,{writable:!0,value:void 0}),r.view=t,v(l(r),Yl)[Yl]={type:"ambient",color:new Float32Array(i.color||[.7,.7,.7]),intensity:null!=i.intensity?i.intensity:1},r.view.registerLight(l(r)),r}return n(t,e),t.prototype.destroy=function(){e.prototype.destroy.call(this),this.view.deregisterLight(this)},r(t,[{key:"color",get:function(){return v(this,Yl)[Yl].color},set:function(e){v(this,Yl)[Yl].color.set(e),this.view.redraw()}},{key:"intensity",get:function(){return v(this,Yl)[Yl].intensity},set:function(e){v(this,Yl)[Yl].intensity=void 0!==e?e:1,this.view.redraw()}}]),t}(ce),zl=/*#__PURE__*/f("state"),ql=/*#__PURE__*/function(e){function t(t,i){var r;return void 0===i&&(i={}),(r=e.call(this,t,i)||this).view=void 0,Object.defineProperty(l(r),zl,{writable:!0,value:void 0}),r.view=t,v(l(r),zl)[zl]={type:"dir",dir:new Float32Array(i.dir||[1,1,1]),color:new Float32Array(i.color||[.7,.7,.8]),intensity:null!=i.intensity?i.intensity:1,space:i.space||"view"},r.view.registerLight(l(r)),r}return n(t,e),t.prototype.destroy=function(){e.prototype.destroy.call(this),this.view.deregisterLight(this),this.view.redraw()},r(t,[{key:"dir",get:function(){return v(this,zl)[zl].dir},set:function(e){v(this,zl)[zl].dir.set(e),this.view.redraw()}},{key:"color",get:function(){return v(this,zl)[zl].color},set:function(e){v(this,zl)[zl].color.set(e),this.view.redraw()}},{key:"intensity",get:function(){return v(this,zl)[zl].intensity},set:function(e){v(this,zl)[zl].intensity=e,this.view.redraw()}}]),t}(ce),Zl=/*#__PURE__*/f("state"),Ql=/*#__PURE__*/function(e){function t(t,i){var r;return void 0===i&&(i={}),(r=e.call(this,t,i)||this).view=void 0,Object.defineProperty(l(r),Zl,{writable:!0,value:void 0}),r.view=t,v(l(r),Zl)[Zl]={type:"point",pos:new Float64Array(i.pos||[1,1,1]),color:new Float32Array(i.color||[.7,.7,.8]),intensity:1,attenuation:new Float32Array([i.constantAttenuation,i.linearAttenuation,i.quadraticAttenuation]),space:i.space||"view"},r.view.registerLight(l(r)),r}return n(t,e),t.prototype.destroy=function(){e.prototype.destroy.call(this),this.view.deregisterLight(this),this.view.redraw()},r(t,[{key:"pos",get:function(){return v(this,Zl)[Zl].pos},set:function(e){v(this,Zl)[Zl].pos.set(e||[1,1,1]),this.view.redraw()}},{key:"color",get:function(){return v(this,Zl)[Zl].color},set:function(e){v(this,Zl)[Zl].color.set(e||[.7,.7,.8]),this.view.redraw()}},{key:"intensity",get:function(){return v(this,Zl)[Zl].intensity},set:function(e){e!==v(this,Zl)[Zl].intensity&&(v(this,Zl)[Zl].intensity=e,this.view.redraw())}},{key:"constantAttenuation",get:function(){return v(this,Zl)[Zl].attenuation[0]},set:function(e){v(this,Zl)[Zl].attenuation[0]=e,this.view.redraw()}},{key:"linearAttenuation",get:function(){return v(this,Zl)[Zl].attenuation[1]},set:function(e){v(this,Zl)[Zl].attenuation[1]=e,this.view.redraw()}},{key:"quadraticAttenuation",get:function(){return v(this,Zl)[Zl].attenuation[2]},set:function(e){v(this,Zl)[Zl].attenuation[2]=e,this.view.redraw()}}]),t}(ce),Jl=/*#__PURE__*/f("viewObject"),$l=/*#__PURE__*/f("gotCanvasPos"),eh=/*#__PURE__*/f("gotOrigin"),th=/*#__PURE__*/f("gotDirection"),ih=/*#__PURE__*/f("gotIndices"),rh=/*#__PURE__*/f("gotLocalPos"),nh=/*#__PURE__*/f("gotWorldPos"),oh=/*#__PURE__*/f("gotViewPos"),sh=/*#__PURE__*/f("gotWorldNormal"),ah=/*#__PURE__*/f("gotUV"),ch=/*#__PURE__*/f("canvasPos"),lh=/*#__PURE__*/f("origin"),hh=/*#__PURE__*/f("direction"),uh=/*#__PURE__*/f("indices"),dh=/*#__PURE__*/f("localPos"),fh=/*#__PURE__*/f("worldPos"),vh=/*#__PURE__*/f("viewPos"),ph=/*#__PURE__*/f("worldNormal"),yh=/*#__PURE__*/f("uv"),mh={__proto__:null,Viewer:Vl,Camera:lc,FrustumProjection:Ha,OrthoProjection:Ua,PerspectiveProjection:Ca,CustomProjection:Ka,CameraFlightAnimation:sl,AmbientLight:Kl,DirLight:ql,PointLight:Ql,EmphasisMaterial:Ia,EdgeMaterial:Sa,PointsMaterial:Oa,Metrics:Qs,View:Cl,ViewLayer:wa,ViewObject:Xs,SectionPlane:Ys,SAO:$s,PickResult:/*#__PURE__*/function(){function e(){Object.defineProperty(this,Jl,{writable:!0,value:void 0}),Object.defineProperty(this,$l,{writable:!0,value:void 0}),Object.defineProperty(this,eh,{writable:!0,value:void 0}),Object.defineProperty(this,th,{writable:!0,value:void 0}),Object.defineProperty(this,ih,{writable:!0,value:void 0}),Object.defineProperty(this,rh,{writable:!0,value:void 0}),Object.defineProperty(this,nh,{writable:!0,value:void 0}),Object.defineProperty(this,oh,{writable:!0,value:void 0}),Object.defineProperty(this,sh,{writable:!0,value:void 0}),Object.defineProperty(this,ah,{writable:!0,value:void 0}),Object.defineProperty(this,ch,{writable:!0,value:void 0}),Object.defineProperty(this,lh,{writable:!0,value:void 0}),Object.defineProperty(this,hh,{writable:!0,value:void 0}),Object.defineProperty(this,uh,{writable:!0,value:void 0}),Object.defineProperty(this,dh,{writable:!0,value:void 0}),Object.defineProperty(this,fh,{writable:!0,value:void 0}),Object.defineProperty(this,vh,{writable:!0,value:void 0}),Object.defineProperty(this,ph,{writable:!0,value:void 0}),Object.defineProperty(this,yh,{writable:!0,value:void 0}),v(this,Jl)[Jl]=null,v(this,ch)[ch]=new Int16Array([0,0]),v(this,lh)[lh]=new Float64Array([0,0,0]),v(this,hh)[hh]=new Float64Array([0,0,0]),v(this,uh)[uh]=new Int32Array(3),v(this,dh)[dh]=new Float64Array([0,0,0]),v(this,fh)[fh]=new Float64Array([0,0,0]),v(this,vh)[vh]=new Float64Array([0,0,0]),v(this,ph)[ph]=new Float64Array([0,0,0]),v(this,yh)[yh]=new Float64Array([0,0]),v(this,eh)[eh]=!1,v(this,th)[th]=!1,v(this,ih)[ih]=!1,v(this,$l)[$l]=!1,v(this,rh)[rh]=!1,v(this,nh)[nh]=!1,v(this,oh)[oh]=!1,v(this,sh)[sh]=!1,v(this,ah)[ah]=!1,this.reset()}return e.prototype.reset=function(){v(this,Jl)[Jl]=null,v(this,$l)[$l]=!1,v(this,eh)[eh]=!1,v(this,th)[th]=!1,v(this,ih)[ih]=!1,v(this,rh)[rh]=!1,v(this,nh)[nh]=!1,v(this,oh)[oh]=!1,v(this,sh)[sh]=!1,v(this,ah)[ah]=!1},r(e,[{key:"viewObject",get:function(){return v(this,Jl)[Jl]},set:function(e){v(this,Jl)[Jl]=e}},{key:"canvasPos",get:function(){return v(this,$l)[$l]?v(this,ch)[ch]:void 0},set:function(e){e?(v(this,ch)[ch][0]=e[0],v(this,ch)[ch][1]=e[1],v(this,$l)[$l]=!0):v(this,$l)[$l]=!1}},{key:"origin",get:function(){return v(this,eh)[eh]?v(this,lh)[lh]:null},set:function(e){e?(v(this,lh)[lh][0]=e[0],v(this,lh)[lh][1]=e[1],v(this,lh)[lh][2]=e[2],v(this,eh)[eh]=!0):v(this,eh)[eh]=!1}},{key:"direction",get:function(){return v(this,th)[th]?v(this,hh)[hh]:null},set:function(e){e?(v(this,hh)[hh][0]=e[0],v(this,hh)[hh][1]=e[1],v(this,hh)[hh][2]=e[2],v(this,th)[th]=!0):v(this,th)[th]=!1}},{key:"indices",get:function(){return v(this,Jl)[Jl]&&v(this,ih)[ih]?v(this,uh)[uh]:null},set:function(e){e?(v(this,uh)[uh][0]=e[0],v(this,uh)[uh][1]=e[1],v(this,uh)[uh][2]=e[2],v(this,ih)[ih]=!0):v(this,ih)[ih]=!1}},{key:"localPos",get:function(){return v(this,Jl)[Jl]&&v(this,rh)[rh]?v(this,dh)[dh]:null},set:function(e){e?(v(this,dh)[dh][0]=e[0],v(this,dh)[dh][1]=e[1],v(this,dh)[dh][2]=e[2],v(this,rh)[rh]=!0):v(this,rh)[rh]=!1}},{key:"worldPos",get:function(){return v(this,Jl)[Jl]&&v(this,nh)[nh]?v(this,fh)[fh]:null},set:function(e){e?(v(this,fh)[fh][0]=e[0],v(this,fh)[fh][1]=e[1],v(this,fh)[fh][2]=e[2],v(this,nh)[nh]=!0):v(this,nh)[nh]=!1}},{key:"viewPos",get:function(){return v(this,Jl)[Jl]&&v(this,oh)[oh]?v(this,vh)[vh]:null},set:function(e){e?(v(this,vh)[vh][0]=e[0],v(this,vh)[vh][1]=e[1],v(this,vh)[vh][2]=e[2],v(this,oh)[oh]=!0):v(this,oh)[oh]=!1}},{key:"worldNormal",get:function(){return v(this,Jl)[Jl]&&v(this,sh)[sh]?v(this,ph)[ph]:null},set:function(e){e?(v(this,ph)[ph][0]=e[0],v(this,ph)[ph][1]=e[1],v(this,ph)[ph][2]=e[2],v(this,sh)[sh]=!0):v(this,sh)[sh]=!1}},{key:"uv",get:function(){return v(this,Jl)[Jl]&&v(this,ah)[ah]?v(this,yh)[yh]:null},set:function(e){e?(v(this,yh)[yh][0]=e[0],v(this,yh)[yh][1]=e[1],v(this,ah)[ah]=!0):v(this,ah)[ah]=!1}}]),e}()},gh=0,bh={ETC1S:0,UASTC_4x4:1},wh={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16},Ph={RGBAFormat:be,RGBA_ASTC_4x4_Format:je,RGBA_BPTC_Format:We,RGBA_ETC2_EAC_Format:Re,RGBA_PVRTC_4BPPV1_Format:xe,RGBA_S3TC_DXT5_Format:Te,RGB_ETC1_Format:Me,RGB_ETC2_Format:Oe,RGB_PVRTC_4BPPV1_Format:_e,RGB_S3TC_DXT1_Format:we},Eh=/*#__PURE__*/f("transcoderPath"),Th=/*#__PURE__*/f("transcoderBinary"),_h=/*#__PURE__*/f("transcoderPending"),Ih=/*#__PURE__*/f("workerPool"),xh=/*#__PURE__*/f("workerSourceURL"),Sh=/*#__PURE__*/f("workerConfig"),Mh=/*#__PURE__*/f("supportedFileTypes"),Oh=/*#__PURE__*/f("withCredentials"),Rh=/*#__PURE__*/f("initTranscoder"),jh=/*#__PURE__*/function(){function e(e){Object.defineProperty(this,Rh,{value:Dh}),Object.defineProperty(this,Eh,{writable:!0,value:void 0}),Object.defineProperty(this,Th,{writable:!0,value:void 0}),Object.defineProperty(this,_h,{writable:!0,value:void 0}),Object.defineProperty(this,Ih,{writable:!0,value:void 0}),Object.defineProperty(this,xh,{writable:!0,value:void 0}),Object.defineProperty(this,Sh,{writable:!0,value:void 0}),Object.defineProperty(this,Mh,{writable:!0,value:void 0}),Object.defineProperty(this,Oh,{writable:!0,value:void 0}),v(this,Eh)[Eh]=e.transcoderPath||"https://cdn.jsdelivr.net/npm/@xeokit/sdk/dist/basis/",v(this,Th)[Th]=null,v(this,_h)[_h]=null,v(this,Ih)[Ih]=new zi,v(this,xh)[xh]="",e.workerLimit&&v(this,Ih)[Ih].setWorkerLimit(e.workerLimit),v(this,Sh)[Sh]=null,v(this,Oh)[Oh]=!1,v(this,Mh)[Mh]=["xkt2"]}var t=e.prototype;return t.init=function(e){v(this,Sh)[Sh]={astcSupported:e.astcSupported,etc1Supported:e.etc1Supported,etc2Supported:e.etc2Supported,dxtSupported:e.dxtSupported,bptcSupported:e.bptcSupported,pvrtcSupported:e.pvrtcSupported}},t.transcode=function(e,t){var i=this;return void 0===t&&(t={}),new Promise(function(r,n){var o=t;v(i,Rh)[Rh]().then(function(){return v(i,Ih)[Ih].postMessage({type:"transcode",buffers:e,taskConfig:o},e)}).then(function(e){var t=e.data,i=t.mipmaps,o=t.format,s=t.dfdTransferFn,a=t.dfdFlags;if("error"===t.type)return n(t.error);r({mipmaps:i,props:{format:o,minFilter:1===i.length?pe:me,magFilter:1===i.length?pe:me,encoding:2===s?Ke:Ye,premultiplyAlpha:!!(1&a)}})})})},t.destroy=function(){URL.revokeObjectURL(v(this,xh)[xh]),v(this,Ih)[Ih].destroy(),gh--},e}();function Dh(){var e=this;if(!v(this,_h)[_h]){var t=new Qi;t.setPath(v(this,Eh)[Eh]),t.setWithCredentials(v(this,Oh)[Oh]);var i=t.loadAsync("basis_transcoder.js"),r=new Qi;r.setPath(v(this,Eh)[Eh]),r.setResponseType("arraybuffer"),r.setWithCredentials(v(this,Oh)[Oh]);var n=r.loadAsync("basis_transcoder.wasm");v(this,_h)[_h]=Promise.all([i,n]).then(function(t){var i=t[0],r=t[1],n=Ah.toString(),o=["/* constants */","let _EngineFormat = "+JSON.stringify(Ph),"let _TranscoderFormat = "+JSON.stringify(wh),"let _BasisFormat = "+JSON.stringify(bh),"/* basis_transcoder.js */",i,"/* worker */",n.substring(n.indexOf("{")+1,n.lastIndexOf("}"))].join("\n");v(e,xh)[xh]=URL.createObjectURL(new Blob([o])),v(e,Th)[Th]=r,v(e,Ih)[Ih].setWorkerCreator(function(){var t=new Worker(v(e,xh)[xh]),i=v(e,Th)[Th].slice(0);return t.postMessage({type:"init",config:v(e,Sh)[Sh],transcoderBinary:i},[i]),t})}),gh>0&&console.warn("KTX2TextureTranscoder: Multiple active KTX2TextureTranscoder may cause performance issues. Use a single KTX2TextureTranscoder instance, or call .dispose() on old instances."),gh++}return v(this,_h)[_h]}var Ah=function(){var e,t,i,r=_EngineFormat,n=_TranscoderFormat,o=_BasisFormat;self.addEventListener("message",function(s){var h,u=s.data;switch(u.type){case"init":e=u.config,h=u.transcoderBinary,t=new Promise(function(e){i={wasmBinary:h,onRuntimeInitialized:e},BASIS(i)}).then(function(){i.initializeBasis(),void 0===i.KTX2File&&console.warn("KTX2TextureTranscoder: Please update Basis Universal transcoder.")});break;case"transcode":t.then(function(){try{for(var t=function(t){var s=new i.KTX2File(new Uint8Array(t));function h(){s.close(),s.delete()}if(!s.isValid())throw h(),new Error("KTX2TextureTranscoder: Invalid or unsupported .ktx2 file");var u=s.isUASTC()?o.UASTC_4x4:o.ETC1S,d=s.getWidth(),f=s.getHeight(),v=s.getLevels(),p=s.getHasAlpha(),y=s.getDFDTransferFunc(),m=s.getDFDFlags(),g=function(t,i,s,h){for(var u=t===o.ETC1S?a:c,d=0;d<u.length;d++){var f=u[d];if(e[f.if]&&f.basisFormat.includes(t)&&!(h&&f.transcoderFormat.length<2)&&(!f.needsPowerOfTwo||l(i)&&l(s)))return{transcoderFormat:f.transcoderFormat[h?1:0],engineFormat:f.engineFormat[h?1:0]}}return console.warn("KTX2TextureTranscoder: No suitable compressed texture format found. Decoding to RGBA32."),{transcoderFormat:n.RGBA32,engineFormat:r.RGBAFormat}}(u,d,f,p),b=g.transcoderFormat,w=g.engineFormat;if(!d||!f||!v)throw h(),new Error("KTX2TextureTranscoder: Invalid texture");if(!s.startTranscoding())throw h(),new Error("KTX2TextureTranscoder: .startTranscoding failed");for(var P=[],E=0;E<v;E++){var T=s.getImageLevelInfo(E,0,0),_=T.origWidth,I=T.origHeight,x=new Uint8Array(s.getImageTranscodedSizeInBytes(E,0,0,b));if(!s.transcodeImage(x,E,0,0,b,0,-1,-1))throw h(),new Error("KTX2TextureTranscoder: .transcodeImage failed.");P.push({data:x,width:_,height:I})}return h(),{width:d,height:f,hasAlpha:p,mipmaps:P,format:w,dfdTransferFn:y,dfdFlags:m}}(u.buffers[0]),s=t.width,h=t.height,d=t.hasAlpha,f=t.mipmaps,v=t.format,p=t.dfdTransferFn,y=t.dfdFlags,m=[],g=0;g<f.length;++g)m.push(f[g].data.buffer);self.postMessage({type:"transcode",id:u.id,width:s,height:h,hasAlpha:d,mipmaps:f,format:v,dfdTransferFn:p,dfdFlags:y},m)}catch(e){console.error("[BasisWorker]: "+e),self.postMessage({type:"error",id:u.id,error:e.message})}})}});var s=[{if:"astcSupported",basisFormat:[o.UASTC_4x4],transcoderFormat:[n.ASTC_4x4,n.ASTC_4x4],engineFormat:[r.RGBA_ASTC_4x4_Format,r.RGBA_ASTC_4x4_Format],priorityETC1S:Infinity,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[o.ETC1S,o.UASTC_4x4],transcoderFormat:[n.BC7_M5,n.BC7_M5],engineFormat:[r.RGBA_BPTC_Format,r.RGBA_BPTC_Format],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[o.ETC1S,o.UASTC_4x4],transcoderFormat:[n.BC1,n.BC3],engineFormat:[r.RGB_S3TC_DXT1_Format,r.RGBA_S3TC_DXT5_Format],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[o.ETC1S,o.UASTC_4x4],transcoderFormat:[n.ETC1,n.ETC2],engineFormat:[r.RGB_ETC2_Format,r.RGBA_ETC2_EAC_Format],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[o.ETC1S,o.UASTC_4x4],transcoderFormat:[n.ETC1],engineFormat:[r.RGB_ETC1_Format],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[o.ETC1S,o.UASTC_4x4],transcoderFormat:[n.PVRTC1_4_RGB,n.PVRTC1_4_RGBA],engineFormat:[r.RGB_PVRTC_4BPPV1_Format,r.RGBA_PVRTC_4BPPV1_Format],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0}],a=s.sort(function(e,t){return e.priorityETC1S-t.priorityETC1S}),c=s.sort(function(e,t){return e.priorityUASTC-t.priorityUASTC});function l(e){return e<=2||0==(e&e-1)&&0!==e}},Ch={__proto__:null,KTX2TextureTranscoder:jh},Bh=/*#__PURE__*/function(){function e(e,t){this.gl=void 0,this.location=void 0,this.gl=e,this.location=t}return e.prototype.bindArrayBuffer=function(e){e&&(e.bind(),this.gl.enableVertexAttribArray(this.location),this.gl.vertexAttribPointer(this.location,e.itemSize,e.itemType,e.normalized,e.stride,e.offset))},e}(),kh=/*#__PURE__*/f("onDestroyed"),Lh=/*#__PURE__*/function(){function e(e){void 0===e&&(e={}),this.gl=void 0,this.texture=void 0,this.textureWidth=void 0,this.textureHeight=void 0,this.textureData=void 0,Object.defineProperty(this,kh,{writable:!0,value:void 0}),this.gl=e.gl,this.texture=e.texture,this.textureWidth=e.textureWidth,this.textureHeight=e.textureHeight,this.textureData=e.textureData,v(this,kh)[kh]=e.onDestroyed}var t=e.prototype;return t.bindTexture=function(e,t,i){this.gl&&t.bindTexture(this,i)},t.bind=function(e){return!(!this.gl||!this.texture||(this.gl.activeTexture(this.gl["TEXTURE"+e]),this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture),0))},t.disableFiltering=function(){this.gl&&(this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.NEAREST),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.NEAREST),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE))},t.unbind=function(e){},t.destroy=function(){this.gl&&this.texture&&(this.gl.deleteTexture(this.texture),this.texture=null,v(this,kh)[kh]&&v(this,kh)[kh]())},e}(),Fh=/*#__PURE__*/function(){function e(e,t,i){if(this.errors=void 0,this.allocated=void 0,this.compiled=void 0,this.handle=void 0,this.allocated=!1,this.compiled=!1,this.handle=e.createShader(t),this.handle){if(this.allocated=!0,e.shaderSource(this.handle,i),e.compileShader(this.handle),this.compiled=e.getShaderParameter(this.handle,e.COMPILE_STATUS),!this.compiled&&!e.isContextLost()){for(var r=i.split("\n"),n=[],o=0;o<r.length;o++)n.push(o+1+": "+r[o]+"\n");this.errors=[],this.errors.push(""),this.errors.push(e.getShaderInfoLog(this.handle)||""),this.errors=this.errors.concat(n.join(""))}}else this.errors=["Failed to allocate"]}return e.prototype.destroy=function(){},e}(),Uh=/*#__PURE__*/function(){function e(e,t){this.location=void 0,this.gl=void 0,this.gl=e,this.location=t}return e.prototype.bindTexture=function(e,t){return!!e.bind(t)&&(this.gl.uniform1i(this.location,t),!0)},e}(),Nh=new Hi({},""),Gh=/*#__PURE__*/function(){function e(e,t){if(this.id=void 0,this.vertexShader=void 0,this.fragmentShader=void 0,this.attributes=void 0,this.samplers=void 0,this.uniforms=void 0,this.errors=void 0,this.validated=void 0,this.linked=void 0,this.compiled=void 0,this.allocated=void 0,this.gl=void 0,this.source=void 0,this.handle=void 0,this.id=Nh.addItem({}),this.source=t,this.gl=e,this.allocated=!1,this.compiled=!1,this.linked=!1,this.validated=!1,this.errors=[],this.uniforms={},this.samplers={},this.attributes={},this.vertexShader=new Fh(e,e.VERTEX_SHADER,this.source.vertex),this.fragmentShader=new Fh(e,e.FRAGMENT_SHADER,this.source.fragment),!this.vertexShader.allocated)return this.errors=["Vertex shader failed to allocate"].concat(this.vertexShader.errors),void Vh(this.errors);if(!this.fragmentShader.allocated)return this.errors=["Fragment shader failed to allocate"].concat(this.fragmentShader.errors),void Vh(this.errors);if(this.allocated=!0,!this.vertexShader.compiled)return this.errors=["Vertex shader failed to compile"].concat(this.vertexShader.errors),void Vh(this.errors);if(!this.fragmentShader.compiled)return this.errors=["Fragment shader failed to compile"].concat(this.fragmentShader.errors),void Vh(this.errors);if(this.compiled=!0,this.handle=e.createProgram(),this.handle){if(e.attachShader(this.handle,this.vertexShader.handle),e.attachShader(this.handle,this.fragmentShader.handle),e.linkProgram(this.handle),this.linked=e.getProgramParameter(this.handle,e.LINK_STATUS),this.validated=!0,!this.linked||!this.validated)return this.errors=[],this.errors.push(""),this.errors.push(e.getProgramInfoLog(this.handle)),this.errors.push("\nVertex shader:\n"),this.errors=this.errors.concat(this.source.vertex),this.errors.push("\nFragment shader:\n"),this.errors=this.errors.concat(this.source.fragment),void Vh(this.errors);for(var i=e.getProgramParameter(this.handle,e.ACTIVE_UNIFORMS),r=0;r<i;++r){var n=e.getActiveUniform(this.handle,r);if(n){var o=n.name;"\0"===o[o.length-1]&&(o=o.substr(0,o.length-1));var s=e.getUniformLocation(this.handle,o);n.type===e.SAMPLER_2D||n.type===e.SAMPLER_CUBE||35682===n.type?this.samplers[o]=new Uh(e,s):this.uniforms[o]=s}}for(var a=e.getProgramParameter(this.handle,e.ACTIVE_ATTRIBUTES),c=0;c<a;c++){var l=e.getActiveAttrib(this.handle,c);if(l){var h=e.getAttribLocation(this.handle,l.name);this.attributes[l.name]=new Bh(e,h)}}this.allocated=!0}else this.errors=["Failed to allocate program"]}var t=e.prototype;return t.bind=function(){this.allocated&&this.gl.useProgram(this.handle)},t.getLocation=function(e){return this.uniforms[e]},t.getAttribute=function(e){return this.attributes[e]},t.getSampler=function(e){return this.samplers[e]},t.bindTexture=function(e,t,i){if(!this.allocated)return!1;var r=this.samplers[e];return!!r&&r.bindTexture(t,i)},t.destroy=function(){this.allocated&&(Nh.removeItem(this.id),this.gl.deleteProgram(this.handle),this.gl.deleteShader(this.vertexShader.handle),this.gl.deleteShader(this.fragmentShader.handle),this.attributes={},this.uniforms={},this.samplers={},this.allocated=!1)},e}();function Vh(e){console.error(e.join("\n"))}function Hh(e,t){if(void 0===e._cachedExtensions&&(e._cachedExtensions={}),void 0!==e._cachedExtensions[t])return e._cachedExtensions[t];var i;switch(t){case"WEBGL_depth_texture":i=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=e.getExtension(t)}return e._cachedExtensions[t]=i,i}function Xh(e,t,i){var r,n=t;if(n===ge)return e.UNSIGNED_BYTE;if(1017===n)return e.UNSIGNED_SHORT_4_4_4_4;if(1018===n)return e.UNSIGNED_SHORT_5_5_5_1;if(1010===n)return e.BYTE;if(1011===n)return e.SHORT;if(1012===n)return e.UNSIGNED_SHORT;if(1013===n)return e.INT;if(1014===n)return e.UNSIGNED_INT;if(1015===n)return e.FLOAT;if(1016===n)return e.HALF_FLOAT;if(1021===n)return e.ALPHA;if(n===be)return e.RGBA;if(1024===n)return e.LUMINANCE;if(1025===n)return e.LUMINANCE_ALPHA;if(1026===n)return e.DEPTH_COMPONENT;if(1027===n)return e.DEPTH_STENCIL;if(1028===n)return e.RED;if(1022===n)return e.RGBA;if(1029===n)return e.RED_INTEGER;if(1030===n)return e.RG;if(1031===n)return e.RG_INTEGER;if(1033===n)return e.RGBA_INTEGER;if(n===we||n===Pe||n===Ee||n===Te)if(i===Ke){var o=Hh(e,"WEBGL_compressed_texture_s3tc_srgb");if(null===o)return null;if(n===we)return o.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(n===Pe)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(n===Ee)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(n===Te)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(null===(r=Hh(e,"WEBGL_compressed_texture_s3tc")))return null;if(n===we)return r.COMPRESSED_RGB_S3TC_DXT1_EXT;if(n===Pe)return r.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(n===Ee)return r.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(n===Te)return r.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(n===_e||n===Ie||n===xe||n===Se){var s=Hh(e,"WEBGL_compressed_texture_pvrtc");if(null===s)return null;if(n===_e)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(n===Ie)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(n===xe)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(n===Se)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(n===Me){var a=Hh(e,"WEBGL_compressed_texture_etc1");return null!==a?a.COMPRESSED_RGB_ETC1_WEBGL:null}if(n===Oe||n===Re){var c=Hh(e,"WEBGL_compressed_texture_etc");if(null===c)return null;if(n===Oe)return i===Ke?c.COMPRESSED_SRGB8_ETC2:c.COMPRESSED_RGB8_ETC2;if(n===Re)return i===Ke?c.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:c.COMPRESSED_RGBA8_ETC2_EAC}if(n===je||n===De||n===Ae||n===Ce||n===Be||n===ke||n===Le||n===Fe||n===Ue||n===Ne||n===Ge||n===Ve||n===He||n===Xe){var l=Hh(e,"WEBGL_compressed_texture_astc");if(null===l)return null;if(n===je)return i===Ke?l.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:l.COMPRESSED_RGBA_ASTC_4x4_KHR;if(n===De)return i===Ke?l.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:l.COMPRESSED_RGBA_ASTC_5x4_KHR;if(n===Ae)return i===Ke?l.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:l.COMPRESSED_RGBA_ASTC_5x5_KHR;if(n===Ce)return i===Ke?l.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:l.COMPRESSED_RGBA_ASTC_6x5_KHR;if(n===Be)return i===Ke?l.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:l.COMPRESSED_RGBA_ASTC_6x6_KHR;if(n===ke)return i===Ke?l.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:l.COMPRESSED_RGBA_ASTC_8x5_KHR;if(n===Le)return i===Ke?l.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:l.COMPRESSED_RGBA_ASTC_8x6_KHR;if(n===Fe)return i===Ke?l.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:l.COMPRESSED_RGBA_ASTC_8x8_KHR;if(n===Ue)return i===Ke?l.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:l.COMPRESSED_RGBA_ASTC_10x5_KHR;if(n===Ne)return i===Ke?l.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:l.COMPRESSED_RGBA_ASTC_10x6_KHR;if(n===Ge)return i===Ke?l.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:l.COMPRESSED_RGBA_ASTC_10x8_KHR;if(n===Ve)return i===Ke?l.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:l.COMPRESSED_RGBA_ASTC_10x10_KHR;if(n===He)return i===Ke?l.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:l.COMPRESSED_RGBA_ASTC_12x10_KHR;if(n===Xe)return i===Ke?l.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:l.COMPRESSED_RGBA_ASTC_12x12_KHR}if(n===We){var h=Hh(e,"EXT_texture_compression_bptc");if(null===h)return null;if(n===We)return i===Ke?h.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:h.COMPRESSED_RGBA_BPTC_UNORM_EXT}return 1020===n?e.UNSIGNED_INT_24_8:n===fe?e.REPEAT:1001===n?e.CLAMP_TO_EDGE:1004===n||1005===n?e.NEAREST_MIPMAP_LINEAR:n===ye?e.LINEAR_MIPMAP_NEAREST:1008===n?e.LINEAR_MIPMAP_LINEAR:n===ve?e.NEAREST:n===pe?e.LINEAR:null}!function(){var e=document.createElement("canvas");if(!e.getContext)return{saveAsBMP:function(){},saveAsPNG:function(){},saveAsJPEG:function(){}};e.getContext("2d"),window}();var Wh=new Uint8Array([0,0,0,1]),Yh=/*#__PURE__*/function(){function e(e){this.gl=void 0,this.target=void 0,this.format=void 0,this.type=void 0,this.internalFormat=void 0,this.premultiplyAlpha=void 0,this.flipY=void 0,this.unpackAlignment=void 0,this.wrapS=void 0,this.wrapT=void 0,this.wrapR=void 0,this.texture=void 0,this.allocated=void 0,this.minFilter=void 0,this.magFilter=void 0,this.encoding=void 0,this.gl=e.gl,this.target=e.target||e.gl.TEXTURE_2D,this.format=e.format||be,this.type=e.type||ge,this.internalFormat=-1,this.premultiplyAlpha=!!e.premultiplyAlpha,this.flipY=!!e.flipY,this.unpackAlignment=4,this.wrapS=e.wrapS||fe,this.wrapT=e.wrapT||fe,this.wrapR=e.wrapR||fe,this.texture=e.gl.createTexture(),e.preloadColor&&this.setPreloadColor(e.preloadColor),this.allocated=!0}var t=e.prototype;return t.setPreloadColor=function(e){e?(Wh[0]=Math.floor(255*e[0]),Wh[1]=Math.floor(255*e[1]),Wh[2]=Math.floor(255*e[2]),Wh[3]=Math.floor(255*(void 0!==e[3]?e[3]:1))):(Wh[0]=0,Wh[1]=0,Wh[2]=0,Wh[3]=255);var t=this.gl;if(t.bindTexture(this.target,this.texture),this.target===t.TEXTURE_CUBE_MAP)for(var i=[t.TEXTURE_CUBE_MAP_POSITIVE_X,t.TEXTURE_CUBE_MAP_NEGATIVE_X,t.TEXTURE_CUBE_MAP_POSITIVE_Y,t.TEXTURE_CUBE_MAP_NEGATIVE_Y,t.TEXTURE_CUBE_MAP_POSITIVE_Z,t.TEXTURE_CUBE_MAP_NEGATIVE_Z],r=0,n=i.length;r<n;r++)t.texImage2D(i[r],0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,Wh);else t.texImage2D(this.target,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,Wh);t.bindTexture(this.target,null)},t.setTarget=function(e){this.target=e||this.gl.TEXTURE_2D},t.setImage=function(e,t){void 0===t&&(t={});var i=this.gl;void 0!==t.format&&(this.format=t.format),void 0!==t.internalFormat&&(this.internalFormat=t.internalFormat),void 0!==t.encoding&&(this.encoding=t.encoding),void 0!==t.type&&(this.type=t.type),void 0!==t.flipY&&(this.flipY=t.flipY),void 0!==t.premultiplyAlpha&&(this.premultiplyAlpha=t.premultiplyAlpha),void 0!==t.unpackAlignment&&(this.unpackAlignment=t.unpackAlignment),void 0!==t.minFilter&&(this.minFilter=t.minFilter),void 0!==t.magFilter&&(this.magFilter=t.magFilter),void 0!==t.wrapS&&(this.wrapS=t.wrapS),void 0!==t.wrapT&&(this.wrapT=t.wrapT),void 0!==t.wrapR&&(this.wrapR=t.wrapR),i.bindTexture(this.target,this.texture),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,this.flipY),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha),i.pixelStorei(i.UNPACK_ALIGNMENT,this.unpackAlignment),i.pixelStorei(i.UNPACK_COLORSPACE_CONVERSION_WEBGL,i.NONE);var r=Xh(i,this.minFilter);i.texParameteri(this.target,i.TEXTURE_MIN_FILTER,r);var n=Xh(i,this.magFilter);n&&i.texParameteri(this.target,i.TEXTURE_MAG_FILTER,n);var o=Xh(i,this.wrapS);o&&i.texParameteri(this.target,i.TEXTURE_WRAP_S,o);var s=Xh(i,this.wrapT);s&&i.texParameteri(this.target,i.TEXTURE_WRAP_T,s);var a=Xh(i,this.format,this.encoding),c=Xh(i,this.type),l=Kh(i,this.internalFormat,a,c,this.encoding,!1);if(this.target===i.TEXTURE_CUBE_MAP){if(tr(e))for(var h=e,u=[i.TEXTURE_CUBE_MAP_POSITIVE_X,i.TEXTURE_CUBE_MAP_NEGATIVE_X,i.TEXTURE_CUBE_MAP_POSITIVE_Y,i.TEXTURE_CUBE_MAP_NEGATIVE_Y,i.TEXTURE_CUBE_MAP_POSITIVE_Z,i.TEXTURE_CUBE_MAP_NEGATIVE_Z],d=0,f=u.length;d<f;d++)i.texImage2D(u[d],0,l,a,c,h[d])}else i.texImage2D(i.TEXTURE_2D,0,l,a,c,e);i.bindTexture(this.target,null)},t.setCompressedData=function(e){var t=this.gl,i=e.mipmaps||[],r=i.length,n=e.props;void 0!==n.format&&(this.format=n.format),void 0!==n.internalFormat&&(this.internalFormat=n.internalFormat),void 0!==n.encoding&&(this.encoding=n.encoding),void 0!==n.type&&(this.type=n.type),void 0!==n.flipY&&(this.flipY=n.flipY),void 0!==n.premultiplyAlpha&&(this.premultiplyAlpha=n.premultiplyAlpha),void 0!==n.unpackAlignment&&(this.unpackAlignment=n.unpackAlignment),void 0!==n.minFilter&&(this.minFilter=n.minFilter),void 0!==n.magFilter&&(this.magFilter=n.magFilter),void 0!==n.wrapS&&(this.wrapS=n.wrapS),void 0!==n.wrapT&&(this.wrapT=n.wrapT),void 0!==n.wrapR&&(this.wrapR=n.wrapR),t.activeTexture(t.TEXTURE0+0),t.bindTexture(this.target,this.texture);var o=i.length>1;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,this.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha),t.pixelStorei(t.UNPACK_ALIGNMENT,this.unpackAlignment),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,t.NONE);var s=Xh(t,this.wrapS);s&&t.texParameteri(this.target,t.TEXTURE_WRAP_S,s);var a=Xh(t,this.wrapT);if(a&&t.texParameteri(this.target,t.TEXTURE_WRAP_T,a),this.type===t.TEXTURE_3D||this.type===t.TEXTURE_2D_ARRAY){var c=Xh(t,this.wrapR);c&&t.texParameteri(this.target,t.TEXTURE_WRAP_R,c),t.texParameteri(this.type,t.TEXTURE_WRAP_R,c)}o?(t.texParameteri(this.target,t.TEXTURE_MIN_FILTER,zh(t,this.minFilter)),t.texParameteri(this.target,t.TEXTURE_MAG_FILTER,zh(t,this.magFilter))):(t.texParameteri(this.target,t.TEXTURE_MIN_FILTER,Xh(t,this.minFilter)),t.texParameteri(this.target,t.TEXTURE_MAG_FILTER,Xh(t,this.magFilter)));var l=Xh(t,this.format,this.encoding),h=Xh(t,this.type),u=Kh(t,this.internalFormat,l,h,this.encoding,!1);t.texStorage2D(t.TEXTURE_2D,r,u,i[0].width,i[0].height);for(var d=0,f=i.length;d<f;d++){var v=i[d];this.format!==be?null!==l?t.compressedTexSubImage2D(t.TEXTURE_2D,d,0,0,v.width,v.height,l,v.data):console.warn("Attempt to load unsupported compressed texture format in .setCompressedData()"):t.texSubImage2D(t.TEXTURE_2D,d,0,0,v.width,v.height,l,h,v.data)}t.bindTexture(this.target,null)},t.setProps=function(e){var t=this.gl;t.bindTexture(this.target,this.texture),this._uploadProps(e),t.bindTexture(this.target,null)},t._uploadProps=function(e){var t=this.gl;if(void 0!==e.format&&(this.format=e.format),void 0!==e.internalFormat&&(this.internalFormat=e.internalFormat),void 0!==e.encoding&&(this.encoding=e.encoding),void 0!==e.type&&(this.type=e.type),void 0!==e.minFilter){var i=Xh(t,e.minFilter);i&&(this.minFilter=e.minFilter,t.texParameteri(this.target,t.TEXTURE_MIN_FILTER,i),i!==t.NEAREST_MIPMAP_NEAREST&&i!==t.LINEAR_MIPMAP_NEAREST&&i!==t.NEAREST_MIPMAP_LINEAR&&i!==t.LINEAR_MIPMAP_LINEAR||t.generateMipmap(this.target))}if(void 0!==e.magFilter){var r=Xh(t,e.magFilter);r&&(this.magFilter=e.magFilter,t.texParameteri(this.target,t.TEXTURE_MAG_FILTER,r))}if(void 0!==e.wrapS){var n=Xh(t,e.wrapS);n&&(this.wrapS=e.wrapS,t.texParameteri(this.target,t.TEXTURE_WRAP_S,n))}if(void 0!==e.wrapT){var o=Xh(t,e.wrapT);o&&(this.wrapT=e.wrapT,t.texParameteri(this.target,t.TEXTURE_WRAP_T,o))}},t.bind=function(e){if(!this.allocated)return!1;if(this.texture){var t=this.gl;return t.activeTexture(t["TEXTURE"+e]),t.bindTexture(this.target,this.texture),!0}return!1},t.unbind=function(e){if(this.allocated&&this.texture){var t=this.gl;t.activeTexture(t["TEXTURE"+e]),t.bindTexture(this.target,null)}},t.destroy=function(){this.allocated&&this.texture&&(this.gl.deleteTexture(this.texture),this.texture=null)},e}();function Kh(e,t,i,r,n,o){if(void 0===o&&(o=!1),null!==t){if(void 0!==e[t])return e[t];console.warn("Attempt to use non-existing WebGL internal format '"+t+"'")}var s=i;return i===e.RED&&(r===e.FLOAT&&(s=e.R32F),r===e.HALF_FLOAT&&(s=e.R16F),r===e.UNSIGNED_BYTE&&(s=e.R8)),i===e.RG&&(r===e.FLOAT&&(s=e.RG32F),r===e.HALF_FLOAT&&(s=e.RG16F),r===e.UNSIGNED_BYTE&&(s=e.RG8)),i===e.RGBA&&(r===e.FLOAT&&(s=e.RGBA32F),r===e.HALF_FLOAT&&(s=e.RGBA16F),r===e.UNSIGNED_BYTE&&(s=n===Ke&&!1===o?e.SRGB8_ALPHA8:e.RGBA8),r===e.UNSIGNED_SHORT_4_4_4_4&&(s=e.RGBA4),r===e.UNSIGNED_SHORT_5_5_5_1&&(s=e.RGB5_A1)),s!==e.R16F&&s!==e.R32F&&s!==e.RG16F&&s!==e.RG32F&&s!==e.RGBA16F&&s!==e.RGBA32F||Hh(e,"EXT_color_buffer_float"),s}function zh(e,t){return t===ve||1004===t||1005===t?e.NEAREST:e.LINEAR}var qh={WEBGL:!1,SUPPORTED_EXTENSIONS:{}},Zh=document.createElement("canvas");if(Zh){var Qh=Zh.getContext("webgl2",{antialias:!0});qh.WEBGL=!!Qh,qh.WEBGL&&(qh.ANTIALIAS=Qh.getContextAttributes().antialias,qh.FS_MAX_FLOAT_PRECISION=Qh.getShaderPrecisionFormat?Qh.getShaderPrecisionFormat(Qh.FRAGMENT_SHADER,Qh.HIGH_FLOAT).precision>0?"highp":Qh.getShaderPrecisionFormat(Qh.FRAGMENT_SHADER,Qh.MEDIUM_FLOAT).precision>0?"mediump":"lowp":"mediump",qh.DEPTH_BUFFER_BITS=Qh.getParameter(Qh.DEPTH_BITS),qh.MAX_TEXTURE_SIZE=Qh.getParameter(Qh.MAX_TEXTURE_SIZE),qh.MAX_CUBE_MAP_SIZE=Qh.getParameter(Qh.MAX_CUBE_MAP_TEXTURE_SIZE),qh.MAX_RENDERBUFFER_SIZE=Qh.getParameter(Qh.MAX_RENDERBUFFER_SIZE),qh.MAX_TEXTURE_UNITS=Qh.getParameter(Qh.MAX_COMBINED_TEXTURE_IMAGE_UNITS),qh.MAX_TEXTURE_IMAGE_UNITS=Qh.getParameter(Qh.MAX_TEXTURE_IMAGE_UNITS),qh.MAX_VERTEX_ATTRIBS=Qh.getParameter(Qh.MAX_VERTEX_ATTRIBS),qh.MAX_VERTEX_UNIFORM_VECTORS=Qh.getParameter(Qh.MAX_VERTEX_UNIFORM_VECTORS),qh.MAX_FRAGMENT_UNIFORM_VECTORS=Qh.getParameter(Qh.MAX_FRAGMENT_UNIFORM_VECTORS),qh.MAX_VARYING_VECTORS=Qh.getParameter(Qh.MAX_VARYING_VECTORS),Qh.getSupportedExtensions().forEach(function(e){qh.SUPPORTED_EXTENSIONS[e]=!0}),qh.depthTexturesSupported=qh.SUPPORTED_EXTENSIONS.WEBGL_depth_texture)}var Jh=/*#__PURE__*/function(){function e(e,t,i){this.viewer=void 0,this.view=void 0,this.gl=void 0,this.viewMatrixDataTexture=void 0,this.pbrEnabled=void 0,this.withSAO=void 0,this.backfaces=void 0,this.frontface=void 0,this.textureUnit=void 0,this.bindTexture=void 0,this.renderPass=void 0,this.shadowViewMatrix=void 0,this.shadowProjMatrix=void 0,this.pickViewMatrix=void 0,this.pickProjMatrix=void 0,this.pickZNear=void 0,this.pickZFar=void 0,this.pickInvisible=void 0,this.lineWidth=void 0,this.lastProgramId=void 0,this.occlusionTexture=void 0,this.viewer=e,this.view=t,this.gl=i,this.reset()}return e.prototype.reset=function(){this.lastProgramId=-1,this.pbrEnabled=!1,this.withSAO=!1,this.backfaces=!1,this.frontface=!0,this.textureUnit=0,this.shadowViewMatrix=null,this.shadowProjMatrix=null,this.pickViewMatrix=null,this.pickProjMatrix=null,this.pickZNear=.01,this.pickZFar=5e3,this.pickInvisible=!1,this.lineWidth=1,this.occlusionTexture=null},r(e,[{key:"nextTextureUnit",get:function(){var e=this.textureUnit;return this.textureUnit=(this.textureUnit+1)%qh.MAX_TEXTURE_UNITS,e}}]),e}(),$h={NOT_RENDERED:0,COLOR_OPAQUE:1,COLOR_TRANSPARENT:2,SILHOUETTE_HIGHLIGHTED:3,SILHOUETTE_SELECTED:4,SILHOUETTE_XRAYED:5,EDGES_COLOR_OPAQUE:6,EDGES_COLOR_TRANSPARENT:7,EDGES_HIGHLIGHTED:8,EDGES_SELECTED:9,EDGES_XRAYED:10,PICK:11},eu=Et(),tu=/*#__PURE__*/f("hash"),iu=/*#__PURE__*/f("program"),ru=/*#__PURE__*/f("needRebuild"),nu=/*#__PURE__*/f("uniforms"),ou=/*#__PURE__*/f("samplers"),su=/*#__PURE__*/f("build"),au=/*#__PURE__*/f("buildShader"),cu=/*#__PURE__*/f("getValid"),lu=/*#__PURE__*/f("bind"),hu=/*#__PURE__*/function(){function e(e){Object.defineProperty(this,lu,{value:vu}),Object.defineProperty(this,cu,{value:fu}),Object.defineProperty(this,au,{value:du}),Object.defineProperty(this,su,{value:uu}),this.errors=void 0,this.renderContext=void 0,Object.defineProperty(this,tu,{writable:!0,value:void 0}),Object.defineProperty(this,iu,{writable:!0,value:void 0}),Object.defineProperty(this,ru,{writable:!0,value:void 0}),Object.defineProperty(this,nu,{writable:!0,value:void 0}),Object.defineProperty(this,ou,{writable:!0,value:void 0}),this.renderContext=e,v(this,ru)[ru]=!0,v(this,su)[su]()}var t=e.prototype;return t.needRebuild=function(){v(this,ru)[ru]=!0},t.draw=function(e){if(v(this,iu)[iu]&&!v(this,cu)[cu]()&&(v(this,iu)[iu].destroy(),v(this,iu)[iu]=null),!v(this,iu)[iu]){if(v(this,su)[su](),this.errors)return;this.renderContext.lastProgramId=-1}var t=e.renderState,i=v(this,iu)[iu],r=this.renderContext,n=r.renderPass,o=this.renderContext.gl,s=this.renderContext.view,a=v(this,nu)[nu],c=v(this,ou)[ou];if(r.lastProgramId!==i.id&&(r.lastProgramId=i.id,v(this,lu)[lu]()),a.renderPass&&o.uniform1i(a.renderPass,n),a.projMatrix&&o.uniformMatrix4fv(a.projMatrix,!1,s.camera.projMatrix),a.worldMatrix&&o.uniformMatrix4fv(a.worldMatrix,!1,e.rendererModel.worldMatrix),a.color)if(n===$h.SILHOUETTE_XRAYED){var l=s.xrayMaterial,h=l.fillColor;o.uniform4f(a.color,h[0],h[1],h[2],l.fillAlpha)}else if(n===$h.SILHOUETTE_HIGHLIGHTED){var u=s.highlightMaterial,d=u.fillColor;o.uniform4f(a.color,d[0],d[1],d[2],u.fillAlpha)}else if(n===$h.SILHOUETTE_SELECTED){var f=s.selectedMaterial,p=f.fillColor;o.uniform4f(a.color,p[0],p[1],p[2],f.fillAlpha)}else o.uniform4fv(a.color,new Float32Array([1,1,1]));c.viewMatrices&&t.dataTextureSet.viewMatrices.bindTexture(i,c.viewMatrices,r.nextTextureUnit),c.positions&&t.dataTextureSet.positions.bindTexture(i,c.positions,r.nextTextureUnit),c.eachMeshMatrices&&t.dataTextureSet.eachMeshMatrices.bindTexture(i,c.eachMeshMatrices,r.nextTextureUnit),c.eachMeshAttributes&&t.dataTextureSet.eachMeshAttributes.bindTexture(i,c.eachMeshAttributes,r.nextTextureUnit),c.eachPrimitiveMesh&&(t.numIndices8Bits>0&&(t.dataTextureSet.eachPrimitiveMesh_8Bits.bindTexture(i,c.eachPrimitiveMesh,r.nextTextureUnit),t.dataTextureSet.indices_8Bits.bindTexture(i,c.indices,r.nextTextureUnit),o.drawArrays(o.TRIANGLES,0,t.numIndices8Bits)),t.numIndices16Bits>0&&(t.dataTextureSet.eachPrimitiveMesh_16Bits.bindTexture(i,c.eachPrimitiveMesh,r.nextTextureUnit),t.dataTextureSet.indices_16Bits.bindTexture(i,c.indices,r.nextTextureUnit),o.drawArrays(o.TRIANGLES,0,t.numIndices16Bits)),t.numIndices32Bits>0&&(t.dataTextureSet.eachPrimitiveMesh_32Bits.bindTexture(i,c.eachPrimitiveMesh,r.nextTextureUnit),t.dataTextureSet.indices_32Bits.bindTexture(i,c.indices,r.nextTextureUnit),o.drawArrays(o.TRIANGLES,0,t.numIndices32Bits))),c.baseColorMap&&c.baseColorMap.bindTexture(t.materialTextureSet.colorTexture.texture2D,r.nextTextureUnit),c.metallicRoughMap&&c.metallicRoughMap.bindTexture(t.materialTextureSet.metallicRoughnessTexture.texture2D,r.nextTextureUnit),c.emissiveMap&&c.emissiveMap.bindTexture(t.materialTextureSet.emissiveTexture.texture2D,r.nextTextureUnit),c.occlusionMap&&c.occlusionMap.bindTexture(t.materialTextureSet.occlusionTexture.texture2D,r.nextTextureUnit)},t.destroy=function(){v(this,iu)[iu]&&v(this,iu)[iu].destroy(),v(this,iu)[iu]=null},r(e,[{key:"vertHeader",get:function(){return"#version 300 es\n                #ifdef GL_FRAGMENT_PRECISION_HIGH\n                precision highp float;\n                precision highp int;\n                precision highp usampler2D;\n                precision highp isampler2D;\n                precision highp sampler2D;\n                #else\n                precision mediump float;\n                precision mediump int;\n                precision mediump usampler2D;\n                precision mediump isampler2D;\n                precision mediump sampler2D;\n                uniform int renderPass;\n                #endif"}},{key:"vertDataTextureDefs",get:function(){return"uniform mediump sampler2D eachMeshMatrices;\n                uniform lowp usampler2D eachMeshAttributes;\n                uniform highp sampler2D eachMeshOffset;\n                uniform mediump usampler2D positions;\n                uniform highp usampler2D indices;\n                uniform mediump usampler2D eachPrimitiveMesh;\n                uniform highp sampler2D cameraMatrices;\n                uniform highp sampler2D sceneModelRendererMatrices;"}},{key:"vertLogDepthBufDefs",get:function(){return this.renderContext.view.logarithmicDepthBufferEnabled?"uniform float logDepthBufFC;\n                    out float fragDepth;\n                    bool isPerspectiveMatrix(mat4 m) {\n                        return (m[2][3] == - 1.0);\n                    }\n                    out float isPerspective;":""}},{key:"vertDataTextureSamples",get:function(){return""}},{key:"vertLogDepthBufOutputs",get:function(){return this.renderContext.view.logarithmicDepthBufferEnabled?"fragDepth = 1.0 + clipPos.w;\n                    isPerspective = float (isPerspectiveMatrix(projMatrix));":""}},{key:"fragmentShader",get:function(){return this.fragHeader+"\n        "+this.fragGammaDefs+"\n        "+this.fragSectionPlaneDefs+"\n        "+this.fragLightDefs+"\n        "+this.fragLogDepthBufDefs+"\n        void main(void) {\n            "+this.fragSectionPlanesSlice+"\n            "+this.fragLighting+"\n            "+this.fragLogDepthBufOutput+"\n        }"}},{key:"fragHeader",get:function(){return"#version 300 es\n        #ifdef GL_FRAGMENT_PRECISION_HIGH\n       precision highp float;\n        precision highp int;\n        #else\n        precision mediump float;\n        precision mediump int;\n        #endif"}},{key:"fragGammaDefs",get:function(){return'uniform float gammaFactor;\n        vec4 linearToLinear( in vec4 value ) {\n            return value;\n        }\n        vec4 sRGBToLinear( in vec4 value ) {\n            return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );\n        }\n        vec4 gammaToLinear( in vec4 value) {\n            return vec4( pow( value.xyz, vec3( gammaFactor ) ), value.w );\n        }\n        vec4 linearToGamma( in vec4 value, in float gammaFactor ) {\n              return vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );");\n        }'}},{key:"fragLightDefs",get:function(){var e=this.renderContext.view,t=[];t.push("uniform vec4 lightAmbient;");for(var i=0,r=e.lightsList.length;i<r;i++){var n=e.lightsList[i];"ambient"!==n.type&&(t.push("uniform vec4 lightColor"+i+";"),"dir"===n.type&&t.push("uniform vec3 lightDir"+i+";"),"point"===n.type&&t.push("uniform vec3 lightPos"+i+";"),"spot"===n.type&&(t.push("uniform vec3 lightPos"+i+";"),t.push("uniform vec3 lightDir"+i+";")))}return t.join("\n")}},{key:"fragLogDepthBufDefs",get:function(){return this.renderContext.view.logarithmicDepthBufferEnabled?"in float isPerspective;\n                    uniform float logDepthBufFC;\n                    in float fragDepth;":""}},{key:"fragLogDepthBufOutput",get:function(){return this.renderContext.view.logarithmicDepthBufferEnabled?"gl_FragDepth = isPerspective == 0.0 ? gl_FragCoord.z : log2( fragDepth ) * logDepthBufFC * 0.5;":""}},{key:"fragLighting",get:function(){var e=[];e.push("vec4 viewPosition  = viewMatrix * worldPosition; "),e.push("vec4 modelNormal = vec4(octDecode(normal.xy), 0.0); "),e.push("vec4 worldNormal = worldNormalMatrix * vec4(dot(modelNormal, modelNormalMatrixCol0), dot(modelNormal, modelNormalMatrixCol1), dot(modelNormal, modelNormalMatrixCol2), 0.0);"),e.push("vec3 viewNormal = normalize(vec4(viewNormalMatrix * worldNormal).xyz);"),e.push("vec3 reflectedColor = vec3(0.0, 0.0, 0.0);"),e.push("vec3 viewLightDir = vec3(0.0, 0.0, -1.0);"),e.push("float lambertian = 1.0;");for(var t=0,i=this.renderContext.view.lightsList.length;t<i;t++){var r=this.renderContext.view.lightsList[t];if("ambient"!==r.type){if("dir"===r.type)e.push("view"===r.space?"viewLightDir = normalize(lightDir"+t+");":"viewLightDir = normalize((viewMatrix * vec4(lightDir"+t+", 0.0)).xyz);");else if("point"===r.type)e.push("view"===r.space?"viewLightDir = -normalize(lightPos"+t+" - viewPosition.xyz);":"viewLightDir = -normalize((viewMatrix * vec4(lightPos"+t+", 0.0)).xyz);");else{if("spot"!==r.type)continue;e.push("view"===r.space?"viewLightDir = normalize(lightDir"+t+");":"viewLightDir = normalize((viewMatrix * vec4(lightDir"+t+", 0.0)).xyz);")}e.push("lambertian = max(dot(-viewNormal, viewLightDir), 0.0);"),e.push("reflectedColor += lambertian * (lightColor"+t+".rgb * lightColor"+t+".a);")}}return e.push("vec3 rgb = (vec3(float(color.r) / 255.0, float(color.g) / 255.0, float(color.b) / 255.0));"),e.push("meshColor =  vec4((lightAmbient.rgb * lightAmbient.a * rgb) + (reflectedColor * rgb), float(color.a) / 255.0);"),e.join("\n")}},{key:"fragSAOOutput",get:function(){return this.renderContext.view.sao.enabled?"float viewportWidth     = uSAOParams[0];\n                    float viewportHeight    = uSAOParams[1];\n                    float blendCutoff       = uSAOParams[2];\n                    float blendFactor       = uSAOParams[3];\n                    vec2 uv                 = vec2(gl_FragCoord.x / viewportWidth, gl_FragCoord.y / viewportHeight);\n                    float ambient           = smoothstep(blendCutoff, 1.0, unpackRGBToFloat(texture(uOcclusionTexture, uv))) * blendFactor;\n                    outColor                = vec4(fragColor.rgb * ambient, 1.0);":"outColor            = fragColor;"}},{key:"fragOutput",get:function(){return"outColor            = fragColor;"}},{key:"fragSectionPlaneDefs",get:function(){var e=[];e.push("in vec4 worldPosition;\n                  in vec4 meshFlags2;");for(var t=0,i=this.renderContext.view.sectionPlanesList.length;t<i;t++)e.push("uniform bool sectionPlaneActive"+t+";\n                      uniform vec3 sectionPlanePos"+t+";\n                      uniform vec3 sectionPlaneDir"+t+";");return e.join("\n")}},{key:"fragLightSourceUniforms",get:function(){var e=[];e.push("uniform vec4 lightAmbient;");for(var t=0,i=this.renderContext.view.lightsList.length;t<i;t++){var r=this.renderContext.view.lightsList[t];r instanceof Kl||(e.push("uniform vec4 lightColor"+t+";"),r instanceof ql&&e.push("uniform vec3 lightDir"+t+";"),r instanceof Ql&&e.push("uniform vec3 lightPos"+t+";"))}return e.join("\n")}},{key:"fragSectionPlanesSlice",get:function(){var e=[];if(this.renderContext.view.sectionPlanesList.length>0){e.push("bool clippable = (float(meshFlags2.x) > 0.0);\n                      if (clippable) {\n                          float dist = 0.0;");for(var t=0,i=this.renderContext.view.sectionPlanesList.length;t<i;t++)e.push("if (sectionPlaneActive"+t+") {\n                              dist += clamp(dot(-sectionPlaneDir"+t+".xyz, worldPosition.xyz - sectionPlanePos"+t+".xyz), 0.0, 1000.0);\n                          }");e.push("if (dist > 0.0) { \n                          discard;\n                      }\n                  }")}return e.join("\n")}},{key:"fragFlatShading",get:function(){var e=[];return e.push(""),e.join("\n")}}]),e}();function uu(){var e=this.renderContext.view,t=this.renderContext.gl;if(v(this,iu)[iu]=new Gh(t,v(this,au)[au]()),v(this,iu)[iu].errors)this.errors=v(this,iu)[iu].errors;else{var i=v(this,iu)[iu];v(this,nu)[nu]={renderPass:i.getLocation("renderPass"),viewMatrix:i.getLocation("viewMatrix"),projMatrix:i.getLocation("projMatrix"),worldMatrix:i.getLocation("worldMatrix"),sao:i.getLocation("sao"),logDepthBufFC:i.getLocation("logDepthBufFC"),gammaFactor:i.getLocation("gammaFactor"),pointSize:i.getLocation("pointSize"),nearPlaneHeight:i.getLocation("nearPlaneHeight"),pointCloudIntensityRange:i.getLocation("pointCloudIntensityRange"),pickZNear:i.getLocation("pickZNear"),pickZFar:i.getLocation("pickZFar"),pickInvisible:i.getLocation("pickInvisible"),color:i.getLocation("color"),lightAmbient:i.getLocation("lightAmbient"),lights:[],sectionPlanes:[]};for(var r=v(this,nu)[nu],n=e.lightsList,o=0,s=n.length;o<s;o++)switch(n[o].type){case"dir":r.lights.push({color:i.getLocation("lightColor"+o),dir:i.getLocation("lightDir"+o)});break;case"point":r.lights.push({color:i.getLocation("lightColor"+o),pos:i.getLocation("lightPos"+o),attenuation:i.getLocation("lightAttenuation"+o)});break;case"spot":r.lights.push({color:i.getLocation("lightColor"+o),pos:i.getLocation("lightPos"+o),dir:i.getLocation("lightDir"+o),attenuation:i.getLocation("lightAttenuation"+o)})}for(var a=0,c=e.sectionPlanesList.length;a<c;a++)r.sectionPlanes.push({active:i.getLocation("sectionPlaneActive"+a),pos:i.getLocation("sectionPlanePos"+a),dir:i.getLocation("sectionPlaneDir"+a)});v(this,ou)[ou]={viewMatrices:i.getSampler("viewMatrices"),positions:i.getSampler("positions"),indices:i.getSampler("indices"),edgeIndices:i.getSampler("edgeIndices"),eachMeshAttributes:i.getSampler("eachMeshAttributes"),eachMeshMatrices:i.getSampler("eachMeshMatrices"),eachEdgeOffset:i.getSampler("eachMeshOffset"),eachPrimitiveMesh:i.getSampler("eachMeshTriangleMesh"),eachEdgeMesh:i.getSampler("eachEdgeMesh"),baseColorMap:i.getSampler("baseColorMap"),metallicRoughMap:i.getSampler("metallicRoughMap"),emissiveMap:i.getSampler("emissiveMap"),normalMap:i.getSampler("normalMap"),occlusionMap:i.getSampler("occlusionMap")},v(this,tu)[tu]=this.getHash()}}function du(){return{vertex:this.buildVertexShader(),fragment:this.buildFragmentShader()}}function fu(){return!v(this,ru)[ru]||(v(this,ru)[ru]=!1,v(this,tu)[tu]===this.getHash())}function vu(){var e=this.renderContext.view,t=this.renderContext.gl,i=v(this,nu)[nu],r=e.camera.project;v(this,iu)[iu].bind(),i.lightAmbient&&t.uniform4fv(i.lightAmbient,e.getAmbientColorAndIntensity());for(var n=0,o=i.lights.length;n<o;n++){var s=i.lights[n],a=e.lightsList[n];s.color&&t.uniform4f(s.color,a.color[0],a.color[1],a.color[2],a.intensity),s.dir&&t.uniform3f(s.dir,a.dir[0],a.dir[1],a.dir[2]),s.pos&&t.uniform3f(s.pos,a.pos[0],a.pos[1],a.pos[2]),s.attenuation&&t.uniform1f(s.attenuation,a.attenuation)}if(i.sao){var c=e.sao;if(c.possible){var l=t.drawingBufferHeight;eu[0]=t.drawingBufferWidth,eu[1]=l,eu[2]=c.blendCutoff,eu[3]=c.blendFactor,t.uniform4fv(i.sao,eu)}}if(i.gammaFactor&&t.uniform1f(i.gammaFactor,e.gammaFactor),i.pointSize&&t.uniform1f(i.pointSize,e.pointsMaterial.pointSize),i.nearPlaneHeight&&t.uniform1f(i.nearPlaneHeight,e.camera.projectionType===it?1:t.drawingBufferHeight/(2*Math.tan(.5*e.camera.perspectiveProjection.fov*Math.PI/180))),i.pickZNear&&(t.uniform1f(i.pickZNear,this.renderContext.pickZNear),t.uniform1f(i.pickZFar,this.renderContext.pickZFar)),i.pickInvisible&&t.uniform1i(i.pickInvisible,this.renderContext.pickInvisible?1:0),i.logDepthBufFC){var h=2/(Math.log(r.far+1)/Math.LN2);t.uniform1f(i.logDepthBufFC,h)}}var pu,yu=/*#__PURE__*/function(e){function t(t){return e.call(this,t)||this}n(t,e);var i=t.prototype;return i.getHash=function(){return this.renderContext.view.getSectionPlanesHash()+"-"+this.renderContext.view.getLightsHash()},i.buildVertexShader=function(){return this.vertHeader+"   \n        \n                uniform int                 renderPass;   \n            \n                uniform highp   mat4        projMatrix;\n                uniform highp   mat4        worldMatrix;\n                      \n                uniform mediump sampler2D   viewMatrices;\n                           \n                uniform mediump usampler2D  eachPrimitiveMesh;\n                uniform lowp    usampler2D  eachMeshAttributes;\n                \n                uniform mediump sampler2D   eachMeshMatrices;\n                uniform mediump usampler2D  positions;\n                uniform highp   usampler2D  indices;\n                \n                uniform  float  logDepthBufFC;\n                 \n                out vec4        worldPosition;\n                flat out uint   meshFlags2r;                       \n                flat out uvec4  meshColor;\n                out float       fragDepth;\n                \n                bool isPerspectiveMatrix(mat4 m) {\n                    return (m[2][3] == - 1.0);\n                }\n                \n                out float isPerspective;\n                    \n                void main(void) {\n                                   \n                    int triangleIndex      = gl_VertexID / 3;\n                    \n                    int hPackedMeshIdIndex = (triangleIndex >> 3) & 1023;\n                    int vPackedMeshIdIndex = (triangleIndex >> 3) >> 10;\n                    \n                    int meshIndex          = int(texelFetch(eachPrimitiveMesh, ivec2(hPackedMeshIdIndex, vPackedMeshIdIndex), 0).r);                   \n                    uvec4 meshFlags        = texelFetch (eachMeshAttributes, ivec2(2, meshIndex), 0);\n\n                    if (int(meshFlags.x) != renderPass) {\n                        gl_Position = vec4(3.0, 3.0, 3.0, 1.0);\n                        return;\n                    } \n                 \n                    uvec4 meshFlags2 = texelFetch (eachMeshAttributes, ivec2(3, meshIndex), 0);\n\n                    ivec4 packedVertexBase = ivec4(texelFetch (eachMeshAttributes, ivec2(4, meshIndex), 0));\n                    ivec4 packedIndexBaseOffset = ivec4(texelFetch (eachMeshAttributes, ivec2(5, meshIndex), 0));\n                    int indexBaseOffset =   (packedIndexBaseOffset.r << 24) + \n                                            (packedIndexBaseOffset.g << 16) + \n                                            (packedIndexBaseOffset.b << 8) + \n                                            (packedIndexBaseOffset.a);\n\n                    int hIndex = (triangleIndex - indexBaseOffset) & 1023;\n                    int vIndex = (triangleIndex - indexBaseOffset) >> 10;\n\n                    ivec3 vertexIndices = ivec3(texelFetch(indices, ivec2(hIndex, vIndex), 0));\n                    ivec3 uniqueVertexIndexes = vertexIndices + (packedVertexBase.r << 24) + (packedVertexBase.g << 16) + (packedVertexBase.b << 8) + packedVertexBase.a;\n\n                    ivec3 indexPositionH = uniqueVertexIndexes & 1023;\n                    ivec3 indexPositionV = uniqueVertexIndexes >> 10;\n\n                    mat4 positionsDecompressMatrix = mat4 (\n                        texelFetch (eachMeshMatrices, ivec2(0, meshIndex), 0), \n                        texelFetch (eachMeshMatrices, ivec2(1, meshIndex), 0), \n                        texelFetch (eachMeshMatrices, ivec2(2, meshIndex), 0), \n                        texelFetch (eachMeshMatrices, ivec2(3, meshIndex), 0));\n                        \n                    mat4 meshMatrix = mat4 (\n                        texelFetch (eachMeshMatrices, ivec2(4, meshIndex), 0), \n                        texelFetch (eachMeshMatrices, ivec2(5, meshIndex), 0), \n                        texelFetch (eachMeshMatrices, ivec2(6, meshIndex), 0), \n                        texelFetch (eachMeshMatrices, ivec2(7, meshIndex), 0));\n\n                    ivec4 packedViewMatrixIndex = ivec4(texelFetch (eachMeshAttributes, ivec2(7, meshIndex), 0));\n                    int viewMatrixIndex = \n                            (packedViewMatrixIndex.r << 24) + \n                            (packedViewMatrixIndex.g << 16) + \n                            (packedViewMatrixIndex.b << 8) + \n                            (packedViewMatrixIndex.a);\n                   \n                    mat4 viewMatrix = mat4 (\n                        texelFetch (viewMatrices, ivec2(4, viewMatrixIndex), 0), \n                        texelFetch (viewMatrices, ivec2(5, viewMatrixIndex), 0), \n                        texelFetch (viewMatrices, ivec2(6, viewMatrixIndex), 0), \n                        texelFetch (viewMatrices, ivec2(7, viewMatrixIndex), 0));\n\n                    vec3 _positions[3];\n                   \n                    _positions[0] = vec3(texelFetch(positions, ivec2(indexPositionH.r, indexPositionV.r), 0));\n                    _positions[1] = vec3(texelFetch(positions, ivec2(indexPositionH.g, indexPositionV.g), 0));\n                    _positions[2] = vec3(texelFetch(positions, ivec2(indexPositionH.b, indexPositionV.b), 0));\n  \n                    vec3  position       = _positions[gl_VertexID % 3];\n                   \n                    vec4  _worldPosition = worldMatrix * ((meshMatrix * positionsDecompressMatrix) * vec4(position, 1.0)); \n                    vec4  viewPosition   = viewMatrix * _worldPosition;                   \n                    vec4  clipPosition   = projMatrix * viewPosition;\n\n                    meshFlags2r     = meshFlags2.r;                     \n                    meshColor       = texelFetch (eachMeshAttributes, ivec2(0, meshIndex), 0);                          \n                    fragDepth       = 1.0 + clipPosition.w;\n                    isPerspective   = float (isPerspectiveMatrix(projMatrix));\n                    worldPosition   = _worldPosition;                                               \n                    \n                    gl_Position     = clipPosition;\n                }"},i.buildFragmentShader=function(){return this.fragHeader+"                        \n    \n             flat   in uvec4    meshColor;\n                in float        fragDepth;\n                in float        isPerspective;    \n                flat in uint    meshFlags2r;        \n                uniform float   logDepthBufFC;                        \n    \n                "+this.fragSectionPlaneDefs+"                  \n                "+this.fragLightSourceUniforms+'                                                             \n    \n                out vec4 outColor;        \n    \n                void main(void) {         \n                \n                // src.push("float lambertian = 1.0;");\n                // \n                //  vec3 xTangent = dFdx( vViewPosition.xyz );\n                //  vec3 yTangent = dFdy( vViewPosition.xyz );\n                // \n                //  vec3 viewNormal = normalize( cross( xTangent, yTangent ) );        \n    \n                    '+this.fragSectionPlanesSlice+"                                    \n                    "+this.fragFlatShading+"     \n          \n                    outColor = vec4(meshColor);                   \n                    gl_FragDepth = isPerspective == 0.0 ? gl_FragCoord.z : log2( fragDepth ) * logDepthBufFC * 0.5;                        \n                }"},t}(hu),mu=/*#__PURE__*/f("built"),gu=/*#__PURE__*/function(){function e(){this.positions=void 0,this.indices_8Bits=void 0,this.indices_16Bits=void 0,this.indices_32Bits=void 0,this.edgeIndices_8Bits=void 0,this.edgeIndices_16Bits=void 0,this.edgeIndices_32Bits=void 0,this.indices=void 0,this.edgeIndices=void 0,this.eachMeshAttributes=void 0,this.eachMeshMatrices=void 0,this.eachEdgeOffset=void 0,this.eachPrimitiveMesh_8Bits=void 0,this.eachPrimitiveMesh_16Bits=void 0,this.eachPrimitiveMesh_32Bits=void 0,this.eachPrimitiveMesh=void 0,this.eachEdgeMesh_8Bits=void 0,this.eachEdgeMesh_16Bits=void 0,this.eachEdgeMesh_32Bits=void 0,this.eachEdgeMesh=void 0,Object.defineProperty(this,mu,{writable:!0,value:void 0}),this.positions=null,this.indices_8Bits=null,this.indices_16Bits=null,this.indices_32Bits=null,this.edgeIndices_8Bits=null,this.edgeIndices_16Bits=null,this.edgeIndices_32Bits=null,this.eachMeshAttributes=null,this.eachMeshMatrices=null,this.eachPrimitiveMesh_8Bits=null,this.eachPrimitiveMesh_16Bits=null,this.eachPrimitiveMesh_32Bits=null,this.eachEdgeMesh_8Bits=null,this.eachEdgeMesh_16Bits=null,this.eachEdgeMesh_32Bits=null,this.eachEdgeOffset=null,v(this,mu)[mu]=!1}var t=e.prototype;return t.build=function(){this.indices={8:this.indices_8Bits,16:this.indices_16Bits,32:this.indices_32Bits},this.eachPrimitiveMesh={8:this.eachPrimitiveMesh_8Bits,16:this.eachPrimitiveMesh_16Bits,32:this.eachPrimitiveMesh_32Bits},this.edgeIndices={8:this.edgeIndices_8Bits,16:this.edgeIndices_16Bits,32:this.edgeIndices_32Bits},this.eachEdgeMesh={8:this.eachEdgeMesh_8Bits,16:this.eachEdgeMesh_16Bits,32:this.eachEdgeMesh_32Bits},v(this,mu)[mu]=!0},t.destroy=function(){this.positions&&this.positions.destroy(),this.indices_8Bits&&this.indices_8Bits.destroy(),this.indices_16Bits&&this.indices_16Bits.destroy(),this.indices_32Bits&&this.indices_32Bits.destroy(),this.edgeIndices_8Bits&&this.edgeIndices_8Bits.destroy(),this.edgeIndices_16Bits&&this.edgeIndices_16Bits.destroy(),this.edgeIndices_32Bits&&this.edgeIndices_32Bits.destroy(),this.eachMeshMatrices&&this.eachMeshMatrices.destroy(),this.eachMeshAttributes&&this.eachMeshAttributes.destroy(),this.eachEdgeOffset&&this.eachEdgeOffset.destroy(),this.eachPrimitiveMesh_8Bits&&this.eachPrimitiveMesh_8Bits.destroy(),this.eachPrimitiveMesh_16Bits&&this.eachPrimitiveMesh_16Bits.destroy(),this.eachPrimitiveMesh_32Bits&&this.eachPrimitiveMesh_32Bits.destroy(),this.eachEdgeMesh_8Bits&&this.eachEdgeMesh_8Bits.destroy(),this.eachEdgeMesh_16Bits&&this.eachEdgeMesh_16Bits.destroy(),this.eachEdgeMesh_32Bits&&this.eachEdgeMesh_32Bits.destroy()},e}(),bu=/*#__PURE__*/function(){function e(){this.numMeshes=void 0,this.numVisible=void 0,this.numTransparent=void 0,this.numEdges=void 0,this.numXRayed=void 0,this.numSelected=void 0,this.numHighlighted=void 0,this.numClippable=void 0,this.numPickable=void 0,this.numCulled=void 0,this.reset()}return e.prototype.reset=function(){this.numMeshes=0,this.numVisible=0,this.numTransparent=0,this.numEdges=0,this.numXRayed=0,this.numSelected=0,this.numHighlighted=0,this.numClippable=0,this.numPickable=0,this.numCulled=0},e}(),wu={VISIBLE:1,CULLED:4,PICKABLE:8,CLIPPABLE:16,COLLIDABLE:32,CAST_SHADOW:64,RECEIVE_SHADOW:128,XRAYED:256,HIGHLIGHTED:512,SELECTED:1024,EDGES:2048,BACKFACES:4096,TRANSPARENT:8192};function Pu(e){return function(t){return Tu(e,t,[].slice.call(arguments,1))}}function Eu(e,t){return Pu(Su(e,t).get)}for(var Tu=Reflect.apply,_u=Reflect.construct,Iu=Reflect.defineProperty,xu=Reflect.get,Su=Reflect.getOwnPropertyDescriptor,Mu=Reflect.getPrototypeOf,Ou=Reflect.has,Ru=Reflect.ownKeys,ju=Reflect.set,Du=Reflect.setPrototypeOf,Au=Proxy,Cu=Number,Bu=Cu.isFinite,ku=Cu.isNaN,Lu=Symbol.iterator,Fu=Symbol.species,Uu=Symbol.toStringTag,Nu=Symbol.for,Gu=Object,Vu=Gu.create,Hu=Gu.defineProperty,Xu=Gu.freeze,Wu=Gu.is,Yu=Gu.prototype,Ku=Pu(Yu.isPrototypeOf),zu=Gu.hasOwn||Pu(Yu.hasOwnProperty),qu=Array,Zu=qu.isArray,Qu=qu.prototype,Ju=Pu(Qu.join),$u=Pu(Qu.push),ed=Pu(Qu.toLocaleString),td=Qu[Lu],id=Pu(td),rd=Math.trunc,nd=ArrayBuffer,od=nd.isView,sd=Pu(nd.prototype.slice),ad=Eu(nd.prototype,"byteLength"),cd="undefined"!=typeof SharedArrayBuffer?SharedArrayBuffer:null,ld=cd&&Eu(cd.prototype,"byteLength"),hd=Mu(Uint8Array),ud=hd.from,dd=hd.prototype,fd=dd[Lu],vd=Pu(dd.keys),pd=Pu(dd.values),yd=Pu(dd.entries),md=Pu(dd.set),gd=Pu(dd.reverse),bd=Pu(dd.fill),wd=Pu(dd.copyWithin),Pd=Pu(dd.sort),Ed=Pu(dd.slice),Td=Pu(dd.subarray),_d=Eu(dd,"buffer"),Id=Eu(dd,"byteOffset"),xd=Eu(dd,"length"),Sd=Eu(dd,Uu),Md=Uint16Array,Od=function(){return Tu(ud,Md,[].slice.call(arguments))},Rd=Uint32Array,jd=Float32Array,Dd=Mu([][Lu]()),Ad=Pu(Dd.next),Cd=Pu(t().mark(function e(){return t().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)})().next),Bd=Mu(Dd),kd=TypeError,Ld=RangeError,Fd=Set,Ud=Fd.prototype,Nd=Pu(Ud.add),Gd=Pu(Ud.has),Vd=WeakMap,Hd=Vd.prototype,Xd=Pu(Hd.get),Wd=Pu(Hd.has),Yd=Pu(Hd.set),Kd=new nd(4),zd=new jd(Kd),qd=new Rd(Kd),Zd=new Rd(512),Qd=new Rd(512),Jd=0;Jd<256;++Jd){var $d=Jd-127;$d<-27?(Zd[Jd]=0,Zd[256|Jd]=32768,Qd[Jd]=24,Qd[256|Jd]=24):$d<-14?(Zd[Jd]=1024>>-$d-14,Zd[256|Jd]=1024>>-$d-14|32768,Qd[Jd]=-$d-1,Qd[256|Jd]=-$d-1):$d<=15?(Zd[Jd]=$d+15<<10,Zd[256|Jd]=$d+15<<10|32768,Qd[Jd]=13,Qd[256|Jd]=13):$d<128?(Zd[Jd]=31744,Zd[256|Jd]=64512,Qd[Jd]=24,Qd[256|Jd]=24):(Zd[Jd]=31744,Zd[256|Jd]=64512,Qd[Jd]=13,Qd[256|Jd]=13)}function ef(e){zd[0]=e;var t=qd[0],i=t>>23&511;return Zd[i]+((8388607&t)>>Qd[i])}var tf=new Rd(2048),rf=new Rd(64),nf=new Rd(64);tf[0]=0;for(var of=1;of<1024;++of){for(var sf=of<<13,af=0;0==(8388608&sf);)af-=8388608,sf<<=1;tf[of]=(sf&=-8388609)|(af+=947912704)}for(var cf=1024;cf<2048;++cf)tf[cf]=939524096+(cf-1024<<13);rf[0]=0;for(var lf=1;lf<31;++lf)rf[lf]=lf<<23;rf[31]=1199570944,rf[32]=2147483648;for(var hf=33;hf<63;++hf)rf[hf]=2147483648+(hf-32<<23);rf[63]=3347054592,nf[0]=0;for(var uf=1;uf<64;++uf)nf[uf]=32===uf?0:1024;function df(e){var t=e>>10;return qd[0]=tf[nf[t]+(1023&e)]+rf[t],zd[0]}function ff(e){var t;if(e[Lu]===td)return e;var i=id(e);return Vu(null,((t={next:{value:function(){return Ad(i)}}})[Lu]={value:function(){return this}},t))}var vf=new Vd,pf=Vu(Bd,(pu={next:{value:function(){var e=Xd(vf,this);return Cd(e)},writable:!0,configurable:!0}},pu[Uu]={value:"Array Iterator",configurable:!0},pu));function yf(e){var t=Vu(pf);return Yd(vf,t,e),t}function mf(e){return null!==e&&"object"==typeof e||"function"==typeof e}function gf(e){return null!==e&&"object"==typeof e}function bf(e){return void 0!==Sd(e)}function wf(e){var t=Sd(e);return"BigInt64Array"===t||"BigUint64Array"===t}function Pf(e){if(null===cd)return!1;try{return ld(e),!0}catch(e){return!1}}function Ef(e){return!!Zu(e)&&(e[Lu]===td||"Array Iterator"===e[Lu]()[Uu])}function Tf(e){if("string"!=typeof e)return!1;var t=Cu(e);return e===t+""&&!!Bu(t)&&t===rd(t)}var _f=Cu.MAX_SAFE_INTEGER;function If(e){if("bigint"==typeof e)throw kd("Cannot convert a BigInt value to a number");var t=Cu(e);return ku(t)||0===t?0:rd(t)}function xf(e){var t=If(e);return t<0?0:t<_f?t:_f}function Sf(e,t){if(!mf(e))throw kd("This is not an object");var i=e.constructor;if(void 0===i)return t;if(!mf(i))throw kd("The constructor property value is not an object");var r=i[Fu];return null==r?t:r}function Mf(e){if(Pf(e))return!1;try{return sd(e,0,0),!1}catch(e){}return!0}function Of(e,t){var i=ku(e),r=ku(t);if(i&&r)return 0;if(i)return 1;if(r)return-1;if(e<t)return-1;if(e>t)return 1;if(0===e&&0===t){var n=Wu(e,0),o=Wu(t,0);if(!n&&o)return-1;if(n&&!o)return 1}return 0}var Rf=Nu("__Float16Array__"),jf=new Vd;function Df(e){return Wd(jf,e)||!od(e)&&function(e){if(!gf(e))return!1;var t=Mu(e);if(!gf(t))return!1;var i=t.constructor;if(void 0===i)return!1;if(!mf(i))throw kd("The constructor property value is not an object");return Ou(i,Rf)}(e)}function Af(e){if(!Df(e))throw kd("This is not a Float16Array object")}function Cf(e,t){var i=Df(e),r=bf(e);if(!i&&!r)throw kd("Species constructor didn't return TypedArray object");if("number"==typeof t){var n;if(i){var o=Bf(e);n=xd(o)}else n=xd(e);if(n<t)throw kd("Derived constructor created TypedArray object which was too small length")}if(wf(e))throw kd("Cannot mix BigInt and other types, use explicit conversions")}function Bf(e){var t=Xd(jf,e);if(void 0!==t){if(Mf(_d(t)))throw kd("Attempting to access detached ArrayBuffer");return t}var i=e.buffer;if(Mf(i))throw kd("Attempting to access detached ArrayBuffer");var r=_u(Hf,[i,e.byteOffset,e.length],e.constructor);return Xd(jf,r)}function kf(e){for(var t=xd(e),i=[],r=0;r<t;++r)i[r]=df(e[r]);return i}for(var Lf,Ff=new Fd,Uf=u(Ru(dd));!(Lf=Uf()).done;){var Nf=Lf.value;if(Nf!==Uu){var Gf=Su(dd,Nf);zu(Gf,"get")&&Nd(Ff,Nf)}}var Vf=Xu({get:function(e,t,i){return Tf(t)&&zu(e,t)?df(xu(e,t)):Gd(Ff,t)&&Ku(dd,e)?xu(e,t):xu(e,t,i)},set:function(e,t,i,r){return Tf(t)&&zu(e,t)?ju(e,t,ef(i)):ju(e,t,i,r)},getOwnPropertyDescriptor:function(e,t){if(Tf(t)&&zu(e,t)){var i=Su(e,t);return i.value=df(i.value),i}return Su(e,t)},defineProperty:function(e,t,i){return Tf(t)&&zu(e,t)&&zu(i,"value")?(i.value=ef(i.value),Iu(e,t,i)):Iu(e,t,i)}}),Hf=/*#__PURE__*/function(){function e(t,i,r){var n;if(Df(t))n=_u(Md,[Bf(t)],this instanceof e?this.constructor:void 0);else if(mf(t)&&!function(e){try{return ad(e),!0}catch(e){return!1}}(t)){var o,s;if(bf(t)){o=t,s=xd(t);var a=_d(t),c=Pf(a)?nd:Sf(a,nd);if(Mf(a))throw kd("Attempting to access detached ArrayBuffer");if(wf(t))throw kd("Cannot mix BigInt and other types, use explicit conversions");var l=new c(2*s);n=_u(Md,[l],this instanceof e?this.constructor:void 0)}else{var h=t[Lu];if(null!=h&&"function"!=typeof h)throw kd("@@iterator property is not callable");null!=h?Ef(t)?(o=t,s=t.length):s=(o=[].concat(t)).length:s=xf((o=t).length),n=_u(Md,[s],this instanceof e?this.constructor:void 0)}for(var u=0;u<s;++u)n[u]=ef(o[u])}else n=_u(Md,arguments,this instanceof e?this.constructor:void 0);var d=new Au(n,Vf);return Yd(jf,d,n),d}e.from=function(t){var i,r,n=this,o=[].slice.call(arguments,1),s=this;if(!Ou(s,Rf))throw kd("This constructor is not a subclass of Float16Array");if(s===e){if(Df(t)&&0===o.length){var a=Bf(t),c=new Md(_d(a),Id(a),xd(a));return new e(_d(Ed(c)))}if(0===o.length)return new e(_d(Od(t,ef)));var l=o[0];return new e(_d(Od(t,function(e){return ef(Tu(l,n,[e].concat(ff([].slice.call(arguments,1)))))},o[1])))}var h,u=t[Lu];if(null!=u&&"function"!=typeof u)throw kd("@@iterator property is not callable");if(null!=u)Ef(t)?(i=t,r=t.length):!bf(h=t)||h[Lu]!==fd&&"Array Iterator"!==h[Lu]()[Uu]?r=(i=[].concat(t)).length:(i=t,r=xd(t));else{if(null==t)throw kd("Cannot convert undefined or null to object");r=xf((i=Gu(t)).length)}var d=new s(r);if(0===o.length)for(var f=0;f<r;++f)d[f]=i[f];else for(var v=o[0],p=o[1],y=0;y<r;++y)d[y]=Tu(v,p,[i[y],y]);return d},e.of=function(){var t=[].slice.call(arguments),i=this;if(!Ou(i,Rf))throw kd("This constructor is not a subclass of Float16Array");var r=t.length;if(i===e){for(var n=new e(r),o=Bf(n),s=0;s<r;++s)o[s]=ef(t[s]);return n}for(var a=new i(r),c=0;c<r;++c)a[c]=t[c];return a};var i=e.prototype;return i.keys=function(){Af(this);var e=Bf(this);return vd(e)},i.values=function(){Af(this);var e=Bf(this);return yf(/*#__PURE__*/t().mark(function i(){var r,n,o;return t().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:r=u(pd(e));case 1:if((n=r()).done){t.next=7;break}return o=n.value,t.next=5,df(o);case 5:t.next=1;break;case 7:case"end":return t.stop()}},i)})())},i.entries=function(){Af(this);var e=Bf(this);return yf(/*#__PURE__*/t().mark(function i(){var r,n,o,s,a;return t().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:r=u(yd(e));case 1:if((n=r()).done){t.next=7;break}return s=(o=n.value)[0],a=o[1],t.next=5,[s,df(a)];case 5:t.next=1;break;case 7:case"end":return t.stop()}},i)})())},i.at=function(e){Af(this);var t=Bf(this),i=xd(t),r=If(e),n=r>=0?r:i+r;if(!(n<0||n>=i))return df(t[n])},i.map=function(t){Af(this);var i=Bf(this),r=xd(i),n=[].slice.call(arguments,1)[0],o=Sf(i,e);if(o===e){for(var s=new e(r),a=Bf(s),c=0;c<r;++c){var l=df(i[c]);a[c]=ef(Tu(t,n,[l,c,this]))}return s}var h=new o(r);Cf(h,r);for(var u=0;u<r;++u){var d=df(i[u]);h[u]=Tu(t,n,[d,u,this])}return h},i.filter=function(t){Af(this);for(var i=Bf(this),r=xd(i),n=[].slice.call(arguments,1)[0],o=[],s=0;s<r;++s){var a=df(i[s]);Tu(t,n,[a,s,this])&&$u(o,a)}var c=new(Sf(i,e))(o);return Cf(c),c},i.reduce=function(e){var t=[].slice.call(arguments,1);Af(this);var i,r,n=Bf(this),o=xd(n);if(0===o&&0===t.length)throw kd("Reduce of empty array with no initial value");0===t.length?(i=df(n[0]),r=1):(i=t[0],r=0);for(var s=r;s<o;++s)i=e(i,df(n[s]),s,this);return i},i.reduceRight=function(e){var t=[].slice.call(arguments,1);Af(this);var i,r,n=Bf(this),o=xd(n);if(0===o&&0===t.length)throw kd("Reduce of empty array with no initial value");0===t.length?(i=df(n[o-1]),r=o-2):(i=t[0],r=o-1);for(var s=r;s>=0;--s)i=e(i,df(n[s]),s,this);return i},i.forEach=function(e){Af(this);for(var t=Bf(this),i=xd(t),r=[].slice.call(arguments,1)[0],n=0;n<i;++n)Tu(e,r,[df(t[n]),n,this])},i.find=function(e){Af(this);for(var t=Bf(this),i=xd(t),r=[].slice.call(arguments,1)[0],n=0;n<i;++n){var o=df(t[n]);if(Tu(e,r,[o,n,this]))return o}},i.findIndex=function(e){Af(this);for(var t=Bf(this),i=xd(t),r=[].slice.call(arguments,1)[0],n=0;n<i;++n){var o=df(t[n]);if(Tu(e,r,[o,n,this]))return n}return-1},i.findLast=function(e){Af(this);for(var t=Bf(this),i=xd(t),r=[].slice.call(arguments,1)[0],n=i-1;n>=0;--n){var o=df(t[n]);if(Tu(e,r,[o,n,this]))return o}},i.findLastIndex=function(e){Af(this);for(var t=Bf(this),i=xd(t),r=[].slice.call(arguments,1)[0],n=i-1;n>=0;--n){var o=df(t[n]);if(Tu(e,r,[o,n,this]))return n}return-1},i.every=function(e){Af(this);for(var t=Bf(this),i=xd(t),r=[].slice.call(arguments,1)[0],n=0;n<i;++n)if(!Tu(e,r,[df(t[n]),n,this]))return!1;return!0},i.some=function(e){Af(this);for(var t=Bf(this),i=xd(t),r=[].slice.call(arguments,1)[0],n=0;n<i;++n)if(Tu(e,r,[df(t[n]),n,this]))return!0;return!1},i.set=function(e){Af(this);var t=Bf(this),i=If([].slice.call(arguments,1)[0]);if(i<0)throw Ld("Offset is out of bounds");if(null==e)throw kd("Cannot convert undefined or null to object");if(wf(e))throw kd("Cannot mix BigInt and other types, use explicit conversions");if(Df(e))return md(Bf(this),Bf(e),i);if(bf(e)&&Mf(_d(e)))throw kd("Attempting to access detached ArrayBuffer");var r=xd(t),n=Gu(e),o=xf(n.length);if(i===1/0||o+i>r)throw Ld("Offset is out of bounds");for(var s=0;s<o;++s)t[s+i]=ef(n[s])},i.reverse=function(){Af(this);var e=Bf(this);return gd(e),this},i.fill=function(e){Af(this);var t=Bf(this);return bd.apply(void 0,[t,ef(e)].concat(ff([].slice.call(arguments,1)))),this},i.copyWithin=function(e,t){Af(this);var i=Bf(this);return wd.apply(void 0,[i,e,t].concat(ff([].slice.call(arguments,2)))),this},i.sort=function(){var e=[].slice.call(arguments);Af(this);var t=Bf(this),i=void 0!==e[0]?e[0]:Of;return Pd(t,function(e,t){return i(df(e),df(t))}),this},i.slice=function(){var t=[].slice.call(arguments);Af(this);var i=Bf(this),r=Sf(i,e);if(r===e){var n=new Md(_d(i),Id(i),xd(i));return new e(_d(Ed.apply(void 0,[n].concat(ff(t)))))}var o,s,a=xd(i),c=If(t[0]),l=void 0===t[1]?a:If(t[1]),h=(s=l===-1/0?0:l<0?a+l>0?a+l:0:a<l?a:l)-(o=c===-1/0?0:c<0?a+c>0?a+c:0:a<c?a:c)>0?s-o:0,u=new r(h);if(Cf(u,h),0===h)return u;if(Mf(_d(i)))throw kd("Attempting to access detached ArrayBuffer");for(var d=0;o<s;)u[d]=df(i[o]),++o,++d;return u},i.subarray=function(){Af(this);var t=Bf(this),i=Sf(t,e),r=new Md(_d(t),Id(t),xd(t)),n=Td.apply(void 0,[r].concat(ff([].slice.call(arguments)))),o=new i(_d(n),Id(n),xd(n));return Cf(o),o},i.indexOf=function(e){Af(this);var t=Bf(this),i=xd(t),r=If([].slice.call(arguments,1)[0]);if(r===1/0)return-1;r<0&&(r+=i)<0&&(r=0);for(var n=r;n<i;++n)if(zu(t,n)&&df(t[n])===e)return n;return-1},i.lastIndexOf=function(e){var t=[].slice.call(arguments,1);Af(this);var i=Bf(this),r=xd(i),n=t.length>=1?If(t[0]):r-1;if(n===-1/0)return-1;n>=0?n=n<r-1?n:r-1:n+=r;for(var o=n;o>=0;--o)if(zu(i,o)&&df(i[o])===e)return o;return-1},i.includes=function(e){Af(this);var t=Bf(this),i=xd(t),r=If([].slice.call(arguments,1)[0]);if(r===1/0)return!1;r<0&&(r+=i)<0&&(r=0);for(var n=ku(e),o=r;o<i;++o){var s=df(t[o]);if(n&&ku(s))return!0;if(s===e)return!0}return!1},i.join=function(){Af(this);var e=kf(Bf(this));return Ju.apply(void 0,[e].concat(ff([].slice.call(arguments))))},i.toLocaleString=function(){Af(this);var e=kf(Bf(this));return ed.apply(void 0,[e].concat(ff([].slice.call(arguments))))},r(e,[{key:Uu,get:function(){if(Df(this))return"Float16Array"}}]),e}();Hu(Hf,"BYTES_PER_ELEMENT",{value:2}),Hu(Hf,Rf,{}),Du(Hf,hd);var Xf=Hf.prototype;Hu(Xf,"BYTES_PER_ELEMENT",{value:2}),Hu(Xf,Lu,{value:Xf.values,writable:!0,configurable:!0}),Du(Xf,dd);var Wf=new Lh({textureWidth:0,textureHeight:0});function Yf(e){e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)}var Kf=function(){this.positionsDecompressMatrices=void 0,this.positionsCompressed=void 0,this.indices_8Bits=void 0,this.indices_16Bits=void 0,this.indices_32Bits=void 0,this.edgeIndices_8Bits=void 0,this.edgeIndices_16Bits=void 0,this.edgeIndices_32Bits=void 0,this.eachPrimitiveMesh_8Bits=void 0,this.eachPrimitiveMesh_16Bits=void 0,this.eachPrimitiveMesh_32Bits=void 0,this.eachEdgeMesh_8Bits=void 0,this.eachEdgeMesh_16Bits=void 0,this.eachEdgeMesh_32Bits=void 0,this.eachMeshVertexPortionBase=void 0,this.eachMeshVertexPortionOffset=void 0,this.eachMeshEdgeIndicesOffset=void 0,this.eachMeshColor=void 0,this.eachMeshPickColor=void 0,this.eachMeshMatrices=void 0,this.eachMeshNormalMatrix=void 0,this.eachMeshPositionsDecompressMatrix=void 0,this.eachMeshFlags1=void 0,this.eachMeshFlags2=void 0,this.eachEdgeOffset=void 0,this.eachMeshParts=void 0,this.positionsDecompressMatrices=[],this.positionsCompressed=[],this.indices_8Bits=[],this.indices_16Bits=[],this.indices_32Bits=[],this.edgeIndices_8Bits=[],this.edgeIndices_16Bits=[],this.edgeIndices_32Bits=[],this.eachMeshVertexPortionBase=[],this.eachMeshVertexPortionOffset=[],this.eachMeshEdgeIndicesOffset=[],this.eachMeshColor=[],this.eachMeshPickColor=[],this.eachMeshMatrices=[],this.eachMeshNormalMatrix=[],this.eachMeshPositionsDecompressMatrix=[],this.eachMeshFlags1=[],this.eachMeshFlags2=[],this.eachPrimitiveMesh_32Bits=[],this.eachPrimitiveMesh_16Bits=[],this.eachPrimitiveMesh_8Bits=[],this.eachEdgeMesh_32Bits=[],this.eachEdgeMesh_16Bits=[],this.eachEdgeMesh_8Bits=[],this.eachEdgeOffset=[],this.eachMeshParts=[]},zf=8,qf=ni(),Zf=Et([0,0,0,1]),Qf=Et([0,0,0,1]),Jf=new Uint8Array(4),$f=new Float32Array(3),ev=/*#__PURE__*/f("gl"),tv=/*#__PURE__*/f("view"),iv=/*#__PURE__*/f("dataTextureBuffer"),rv=/*#__PURE__*/f("geometryHandles"),nv=/*#__PURE__*/f("meshPartHandles"),ov=/*#__PURE__*/f("numMeshParts"),sv=/*#__PURE__*/f("deferredSetFlagsActive"),av=/*#__PURE__*/f("deferredSetFlagsDirty"),cv=/*#__PURE__*/f("built"),lv=/*#__PURE__*/f("createGeometryBucket"),hv=/*#__PURE__*/f("createMeshPart"),uv=/*#__PURE__*/f("setMeshFlags"),dv=/*#__PURE__*/f("setMeshFlags2"),fv=/*#__PURE__*/function(){function e(e,t){Object.defineProperty(this,dv,{value:mv}),Object.defineProperty(this,uv,{value:yv}),Object.defineProperty(this,hv,{value:pv}),Object.defineProperty(this,lv,{value:vv}),this.rendererModel=void 0,this.layerIndex=void 0,this.meshCounts=void 0,this.renderState=void 0,Object.defineProperty(this,ev,{writable:!0,value:void 0}),Object.defineProperty(this,tv,{writable:!0,value:void 0}),Object.defineProperty(this,iv,{writable:!0,value:void 0}),Object.defineProperty(this,rv,{writable:!0,value:void 0}),Object.defineProperty(this,nv,{writable:!0,value:void 0}),Object.defineProperty(this,ov,{writable:!0,value:void 0}),Object.defineProperty(this,sv,{writable:!0,value:void 0}),Object.defineProperty(this,av,{writable:!0,value:void 0}),Object.defineProperty(this,cv,{writable:!0,value:void 0}),this.meshCounts=new bu,this.layerIndex=e.layerIndex,this.rendererModel=e.rendererModel,this.renderState={primitive:e.primitive,dataTextureSet:new gu,numIndices8Bits:0,numIndices16Bits:0,numIndices32Bits:0,numEdgeIndices8Bits:0,numEdgeIndices16Bits:0,numEdgeIndices32Bits:0,numVertices:0},v(this,ev)[ev]=e.gl,v(this,tv)[tv]=e.view,v(this,iv)[iv]=new Kf,v(this,ov)[ov]=0,v(this,rv)[rv]={},v(this,nv)[nv]=[],v(this,cv)[cv]=!1,this.beginDeferredFlags()}var t=e.prototype;return t.canCreateMesh=function(e){if(v(this,cv)[cv])throw"Already built";var t=this.renderState,i=e.geometryBuckets.length;if(v(this,ov)[ov]+i>4096)return!1;for(var r=0,n=0,o=0;o<i;o++){var s=e.geometryBuckets[o];r+=s.positionsCompressed.length,s.indices&&(n+=s.indices.length)}return t.numVertices+r/(e.primitive===ze?1:e.primitive==qe?2:3)<=2097152&&n/3+n<=2097152},t.hasGeometry=function(e){return v(this,rv)[rv][e]},t.createGeometryCompressed=function(e){if(v(this,cv)[cv])throw"Already built";for(var t=[],i=0,r=e.geometryBuckets.length;i<r;i++)t.push(v(this,lv)[lv](e.geometryBuckets[i]));v(this,rv)[rv][e.id]={id:e.id,aabb:e.aabb,positionsDecompressMatrix:e.positionsDecompressMatrix,geometryBucketHandles:t}},t.createMesh=function(e){var t=this;if(v(this,cv)[cv])throw new Error("Already built");var i=this.meshCounts.numMeshes;if(!e.geometryId)throw new Error("geometryId expected");var r=v(this,rv)[rv][e.geometryId];if(!r)throw new Error("Geometry not found");r.geometryBucketHandles.forEach(function(i){v(t,hv)[hv](e,r,i)});for(var n=jr(),o=Dr(r.aabb),s=0,a=o.length;s<a;s+=4)Zf[0]=o[s+0],Zf[1]=o[s+1],Zf[2]=o[s+2],e.matrix?(vi(e.matrix,Zf,Qf),Cr(n,Qf)):Cr(n,Qf);return this.meshCounts.numMeshes++,i},t.build=function(){if(v(this,cv)[cv])throw new Error("Already built");var e=v(this,ev)[ev],t=v(this,iv)[iv],i=this.renderState.dataTextureSet;i.positions=function(e,t){var i=1024,r=Math.ceil(t.length/3/i);if(0==r)throw"texture height == 0";var n=new Uint16Array(i*r*3);n.fill(0),n.set(t,0);var o=e.createTexture();return e.bindTexture(e.TEXTURE_2D,o),e.texStorage2D(e.TEXTURE_2D,1,e.RGB16UI,i,r),e.texSubImage2D(e.TEXTURE_2D,0,0,0,i,r,e.RGB_INTEGER,e.UNSIGNED_SHORT,n,0),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(e.TEXTURE_2D,null),new Lh({gl:e,texture:o,textureWidth:i,textureHeight:r})}(e,t.positionsCompressed),i.indices_8Bits=function(e,t){if(0==t.length)return Wf;var i=1024,r=Math.ceil(t.length/3/i);if(0==r)throw"texture height == 0";var n=new Uint8Array(i*r*3);n.fill(0),n.set(t,0);var o=e.createTexture();return o?(e.bindTexture(e.TEXTURE_2D,o),e.texStorage2D(e.TEXTURE_2D,1,e.RGB8UI,i,r),e.texSubImage2D(e.TEXTURE_2D,0,0,0,i,r,e.RGB_INTEGER,e.UNSIGNED_BYTE,n,0),Yf(e),e.bindTexture(e.TEXTURE_2D,null),new Lh({gl:e,texture:o,textureWidth:i,textureHeight:r})):Wf}(e,t.indices_8Bits),i.indices_16Bits=function(e,t){if(0==t.length)return Wf;var i=1024,r=Math.ceil(t.length/3/i);if(0==r)throw"texture height == 0";var n=new Uint16Array(i*r*3);n.fill(0),n.set(t,0);var o=e.createTexture();return o?(e.bindTexture(e.TEXTURE_2D,o),e.texStorage2D(e.TEXTURE_2D,1,e.RGB16UI,i,r),e.texSubImage2D(e.TEXTURE_2D,0,0,0,i,r,e.RGB_INTEGER,e.UNSIGNED_SHORT,n,0),Yf(e),e.bindTexture(e.TEXTURE_2D,null),new Lh({gl:e,texture:o,textureWidth:i,textureHeight:r})):Wf}(e,t.indices_16Bits),i.indices_32Bits=function(e,t){if(0==t.length)return Wf;var i=1024,r=Math.ceil(t.length/3/i);if(0==r)throw"texture height == 0";var n=new Uint32Array(i*r*3);n.fill(0),n.set(t,0);var o=e.createTexture();return o?(e.bindTexture(e.TEXTURE_2D,o),e.texStorage2D(e.TEXTURE_2D,1,e.RGB32UI,i,r),e.texSubImage2D(e.TEXTURE_2D,0,0,0,i,r,e.RGB_INTEGER,e.UNSIGNED_INT,n,0),Yf(e),e.bindTexture(e.TEXTURE_2D,null),new Lh({gl:e,texture:o,textureWidth:i,textureHeight:r})):Wf}(e,t.indices_32Bits),i.edgeIndices_8Bits=function(e,t){if(0==t.length)return Wf;var i=1024,r=Math.ceil(t.length/2/i);if(0==r)throw"texture height == 0";var n=new Uint8Array(i*r*2);n.fill(0),n.set(t,0);var o=e.createTexture();return o?(e.bindTexture(e.TEXTURE_2D,o),e.texStorage2D(e.TEXTURE_2D,1,e.RG8UI,i,r),e.texSubImage2D(e.TEXTURE_2D,0,0,0,i,r,e.RG_INTEGER,e.UNSIGNED_BYTE,n,0),Yf(e),e.bindTexture(e.TEXTURE_2D,null),new Lh({gl:e,texture:o,textureWidth:i,textureHeight:r})):Wf}(e,t.edgeIndices_8Bits),i.edgeIndices_16Bits=function(e,t){if(0==t.length)return Wf;var i=1024,r=Math.ceil(t.length/2/i);if(0==r)throw"texture height == 0";var n=new Uint16Array(i*r*2);n.fill(0),n.set(t,0);var o=e.createTexture();return o?(e.bindTexture(e.TEXTURE_2D,o),e.texStorage2D(e.TEXTURE_2D,1,e.RG16UI,i,r),e.texSubImage2D(e.TEXTURE_2D,0,0,0,i,r,e.RG_INTEGER,e.UNSIGNED_SHORT,n,0),Yf(e),e.bindTexture(e.TEXTURE_2D,null),new Lh({gl:e,texture:o,textureWidth:i,textureHeight:r})):Wf}(e,t.edgeIndices_16Bits),i.edgeIndices_32Bits=function(e,t){if(0==t.length)return Wf;var i=1024,r=Math.ceil(t.length/2/i);if(0==r)throw"texture height == 0";var n=new Uint32Array(i*r*2);n.fill(0),n.set(t,0);var o=e.createTexture();return o?(e.bindTexture(e.TEXTURE_2D,o),e.texStorage2D(e.TEXTURE_2D,1,e.RG32UI,i,r),e.texSubImage2D(e.TEXTURE_2D,0,0,0,i,r,e.RG_INTEGER,e.UNSIGNED_INT,n,0),Yf(e),e.bindTexture(e.TEXTURE_2D,null),new Lh({gl:e,texture:o,textureWidth:i,textureHeight:r})):Wf}(e,t.edgeIndices_32Bits),i.eachMeshAttributes=function(e,t,i,r,n,o){var s=t.length;if(0==s)throw"texture height == 0";for(var a=new Uint8Array(32*s),c=0;c<s;c++)a.set(t[c],28*c+0),a.set(i[c],28*c+4),a.set([0,0,0,0],28*c+8),a.set([0,0,0,0],28*c+12),a.set([r[c]>>24&255,r[c]>>16&255,r[c]>>8&255,255&r[c]],28*c+16),a.set([n[c]>>24&255,n[c]>>16&255,n[c]>>8&255,255&n[c]],28*c+20),a.set([o[c]>>24&255,o[c]>>16&255,o[c]>>8&255,255&o[c]],28*c+24);var l=e.createTexture();return l?(e.bindTexture(e.TEXTURE_2D,l),e.texStorage2D(e.TEXTURE_2D,1,e.RGBA8UI,8,s),e.texSubImage2D(e.TEXTURE_2D,0,0,0,8,s,e.RGBA_INTEGER,e.UNSIGNED_BYTE,a,0),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(e.TEXTURE_2D,null),new Lh({gl:e,texture:l,textureWidth:8,textureHeight:s,textureData:a})):Wf}(e,t.eachMeshColor,t.eachMeshPickColor,t.eachMeshVertexPortionBase,t.eachMeshVertexPortionOffset,t.eachMeshEdgeIndicesOffset),i.eachMeshMatrices=function(e,t,i){var r=t.length;if(0==r)throw"texture height == 0";for(var n=new Hf(48*r),o=0;o<t.length;o++)n.set(t[o],48*o),n.set(i[o],48*o+16);var s=e.createTexture();return s?(e.bindTexture(e.TEXTURE_2D,s),e.texStorage2D(e.TEXTURE_2D,1,e.RGBA16F,12,r),e.texSubImage2D(e.TEXTURE_2D,0,0,0,12,r,e.RGBA,e.HALF_FLOAT,new Uint16Array(n.buffer),0),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(e.TEXTURE_2D,null),new Lh({gl:e,texture:s,textureWidth:12,textureHeight:r})):Wf}(e,t.eachMeshPositionsDecompressMatrix,t.eachMeshMatrices),i.eachEdgeOffset=function(e,t){var i=t.length;if(0==i)throw"texture height == 0";for(var r=new Float32Array(3*i),n=0;n<t.length;n++)r.set(t[n],3*n);var o=e.createTexture();return o?(e.bindTexture(e.TEXTURE_2D,o),e.texStorage2D(e.TEXTURE_2D,1,e.RGB32F,1,i),e.texSubImage2D(e.TEXTURE_2D,0,0,0,1,i,e.RGB,e.FLOAT,r,0),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(e.TEXTURE_2D,null),new Lh({gl:e,texture:o,textureWidth:1,textureHeight:i,textureData:r})):Wf}(e,t.eachEdgeOffset),i.build(),v(this,iv)[iv]=null,v(this,rv)[rv]={},v(this,nv)[nv]=[],v(this,cv)[cv]=!0},t.isEmpty=function(){return 0==this.meshCounts.numMeshes},t.initFlags=function(e,t,i){t&wu.VISIBLE&&this.meshCounts.numVisible++,t&wu.HIGHLIGHTED&&this.meshCounts.numHighlighted++,t&wu.XRAYED&&this.meshCounts.numXRayed++,t&wu.SELECTED&&this.meshCounts.numSelected++,t&wu.CLIPPABLE&&this.meshCounts.numClippable++,t&wu.EDGES&&this.meshCounts.numEdges++,t&wu.PICKABLE&&this.meshCounts.numPickable++,t&wu.CULLED&&this.meshCounts.numCulled++,i&&this.meshCounts.numTransparent++,v(this,uv)[uv](e,t,i),v(this,dv)[dv](e,t)},t.beginDeferredFlags=function(){v(this,sv)[sv]=!0},t.commitDeferredFlags=function(){if(v(this,sv)[sv]=!1,v(this,av)[av]){v(this,av)[av]=!1;var e=v(this,ev)[ev],t=this.renderState.dataTextureSet;e.bindTexture(e.TEXTURE_2D,t.eachMeshAttributes.texture),e.texSubImage2D(e.TEXTURE_2D,0,0,0,t.eachMeshAttributes.textureWidth,t.eachMeshAttributes.textureHeight,e.RGBA_INTEGER,e.UNSIGNED_BYTE,t.eachMeshAttributes.textureData),e.bindTexture(e.TEXTURE_2D,t.eachEdgeOffset.texture),e.texSubImage2D(e.TEXTURE_2D,0,0,0,t.eachEdgeOffset.textureWidth,t.eachEdgeOffset.textureHeight,e.RGB,e.FLOAT,t.eachEdgeOffset.textureData)}},t.flushInitFlags=function(){this.commitDeferredFlags()},t.setMeshVisible=function(e,t,i){if(!v(this,cv)[cv])throw"Not built";t&wu.VISIBLE?this.meshCounts.numVisible++:this.meshCounts.numVisible--,v(this,uv)[uv](e,t,i)},t.setMeshHighlighted=function(e,t,i){if(!v(this,cv)[cv])throw"Not built";t&wu.HIGHLIGHTED?this.meshCounts.numHighlighted++:this.meshCounts.numHighlighted--,v(this,uv)[uv](e,t,i)},t.setMeshXRayed=function(e,t,i){if(!v(this,cv)[cv])throw"Not built";t&wu.XRAYED?this.meshCounts.numXRayed++:this.meshCounts.numXRayed--,v(this,uv)[uv](e,t,i)},t.setMeshSelected=function(e,t,i){if(!v(this,cv)[cv])throw"Not built";t&wu.SELECTED?this.meshCounts.numSelected++:this.meshCounts.numSelected--,v(this,uv)[uv](e,t,i)},t.setMeshEdges=function(e,t,i){if(!v(this,cv)[cv])throw"Not built";t&wu.EDGES?this.meshCounts.numEdges++:this.meshCounts.numEdges--,v(this,uv)[uv](e,t,i)},t.setMeshClippable=function(e,t){if(!v(this,cv)[cv])throw"Not built";t&wu.CLIPPABLE?this.meshCounts.numClippable++:this.meshCounts.numClippable--,v(this,dv)[dv](e,t)},t.setMeshCulled=function(e,t,i){if(!v(this,cv)[cv])throw"Not built";t&wu.CULLED?this.meshCounts.numCulled++:this.meshCounts.numCulled--,v(this,uv)[uv](e,t,i)},t.setMeshCollidable=function(e,t){if(!v(this,cv)[cv])throw"Not built"},t.setMeshPickable=function(e,t,i){if(!v(this,cv)[cv])throw"Not built";t&wu.PICKABLE?this.meshCounts.numPickable++:this.meshCounts.numPickable--,v(this,uv)[uv](e,t,i)},t.setMeshColor=function(e,t,i){if(!v(this,cv)[cv])throw"Not built";var r=this.renderState.dataTextureSet,n=v(this,ev)[ev];Jf[0]=t[0],Jf[1]=t[1],Jf[2]=t[2],Jf[3]=t[3],r.eachMeshAttributes.textureData.set(Jf,28*e),v(this,sv)[sv]?v(this,av)[av]=!0:(n.bindTexture(n.TEXTURE_2D,r.eachMeshAttributes.texture),n.texSubImage2D(n.TEXTURE_2D,0,0,e,1,1,n.RGBA_INTEGER,n.UNSIGNED_BYTE,Jf))},t.setMeshTransparent=function(e,t,i){if(!v(this,cv)[cv])throw"Not built";i?(this.meshCounts.numTransparent++,this.meshCounts.numTransparent++):(this.meshCounts.numTransparent--,this.meshCounts.numTransparent--),v(this,uv)[uv](e,t,i)},t.setMeshOffset=function(e,t){if(!v(this,cv)[cv])throw"Not built";var i=v(this,ev)[ev];$f[0]=t[0],$f[1]=t[1],$f[2]=t[2],v(this,sv)[sv]?v(this,av)[av]=!0:i.texSubImage2D(i.TEXTURE_2D,0,0,e,1,1,i.RGB,i.FLOAT,$f)},t.setMeshMatrix=function(e,t){if(!v(this,cv)[cv])throw"Not built";v(this,ev),v(this,sv)[sv]&&(v(this,av)[av]=!0)},t.setMeshViewMatrixIndex=function(e,t){if(!v(this,cv)[cv])throw"Not built";v(this,ev),v(this,sv)[sv]&&(v(this,av)[av]=!0)},t.destroy=function(){this.renderState.dataTextureSet.destroy()},r(e,[{key:"hash",get:function(){return"layer-"+this.renderState.primitive}}]),e}();function vv(e){var t=this.renderState;if(e.indices){var i=this.renderState.primitive===ze?1:this.renderState.primitive===qe?2:3,r=Math.ceil(e.indices.length/i/zf)*zf*i,n=new Uint32Array(r);n.fill(0),n.set(e.indices),e.indices=n}if(e.edgeIndices){var o=Math.ceil(e.edgeIndices.length/2/zf)*zf*2,s=new Uint32Array(o);s.fill(0),s.set(e.edgeIndices),e.edgeIndices=s}for(var a,c=v(this,iv)[iv],l=e.positionsCompressed,h=e.indices,u=e.edgeIndices,d=c.positionsCompressed.length/3,f=l.length/3,p=0,y=l.length;p<y;p++)c.positionsCompressed.push(l[p]);var m,g=0;if(h){var b;g=h.length/3,a=(b=f<=256?c.indices_8Bits:f<=65536?c.indices_16Bits:c.indices_32Bits).length/3;for(var w=0,P=h.length;w<P;w++)b.push(h[w])}var E=0;if(u){var T;E=u.length/2,m=(T=f<=256?c.edgeIndices_8Bits:f<=65536?c.edgeIndices_16Bits:c.edgeIndices_32Bits).length/2;for(var _=0,I=u.length;_<I;_++)T.push(u[_])}return t.numVertices+=f,{vertexBase:d,numVertices:f,numTriangles:g,numEdges:E,indicesBase:a,edgeIndicesBase:m}}function pv(e,t,i){var r,n=v(this,iv)[iv],o=this.renderState,s=e.matrix||qf,a=e.color||[255,255,255],c=n.positionsCompressed.length/3;n.eachMeshPositionsDecompressMatrix.push(t.positionsDecompressMatrix),n.eachMeshMatrices.push(s),n.eachMeshColor.push([a[0],a[1],a[2],255]),n.eachMeshPickColor.push(e.pickColor),r=i.numVertices<=256?o.numIndices8Bits:i.numVertices<=65536?o.numIndices16Bits:o.numIndices32Bits,n.eachMeshVertexPortionBase.push(i.vertexBase),n.eachMeshVertexPortionOffset.push(r/3-i.indicesBase),n.eachMeshEdgeIndicesOffset.push((i.numVertices<=256?o.numEdgeIndices8Bits:i.numVertices<=65536?o.numEdgeIndices16Bits:o.numEdgeIndices32Bits)/2-i.edgeIndicesBase);var l=v(this,nv)[nv].length;if(i.numTriangles>0){var h,u=3*i.numTriangles;i.numVertices<=256?(h=n.eachPrimitiveMesh_8Bits,o.numIndices8Bits+=u):i.numVertices<=65536?(h=n.eachPrimitiveMesh_16Bits,o.numIndices16Bits+=u):(h=n.eachPrimitiveMesh_32Bits,o.numIndices32Bits+=u);for(var d=0;d<i.numTriangles;d+=zf)h.push(l)}if(i.numEdges>0){var f,p=2*i.numEdges;i.numVertices<=256?(f=n.eachEdgeMesh_8Bits,o.numEdgeIndices8Bits+=p):i.numVertices<=65536?(f=n.eachEdgeMesh_16Bits,o.numEdgeIndices16Bits+=p):(f=n.eachEdgeMesh_32Bits,o.numEdgeIndices32Bits+=p);for(var y=0;y<i.numEdges;y+=zf)f.push(l)}return n.eachEdgeOffset.push([0,0,0]),v(this,nv)[nv].push({vertsBase:c,numVerts:i.numTriangles}),v(this,ov)[ov]++,l}function yv(e,t,i){if(!v(this,cv)[cv])throw"Not built";var r,n,o,s=!!(t&wu.VISIBLE),a=!!(t&wu.XRAYED),c=!!(t&wu.HIGHLIGHTED),l=!!(t&wu.SELECTED),h=!!(t&wu.CULLED);r=!s||h||a?$h.NOT_RENDERED:i?$h.COLOR_TRANSPARENT:$h.COLOR_OPAQUE,n=!s||h?$h.NOT_RENDERED:l?$h.SILHOUETTE_SELECTED:c?$h.SILHOUETTE_HIGHLIGHTED:a?$h.SILHOUETTE_XRAYED:$h.NOT_RENDERED,o=!s||h?$h.NOT_RENDERED:l?$h.EDGES_SELECTED:c?$h.EDGES_HIGHLIGHTED:a?$h.EDGES_XRAYED:t&wu.EDGES?i?$h.EDGES_COLOR_TRANSPARENT:$h.EDGES_COLOR_OPAQUE:$h.NOT_RENDERED;var u=s&&!h&&t&wu.PICKABLE?$h.PICK:$h.NOT_RENDERED,d=this.renderState.dataTextureSet,f=v(this,ev)[ev];if(Jf[0]=r,Jf[1]=n,Jf[2]=o,Jf[3]=u,v(this,sv)[sv])return d.eachMeshAttributes.textureData.set(Jf,28*e+8),void(v(this,av)[av]=!0);f.bindTexture(f.TEXTURE_2D,d.eachMeshAttributes.texture),f.texSubImage2D(f.TEXTURE_2D,0,2,e,1,1,f.RGBA_INTEGER,f.UNSIGNED_BYTE,Jf)}function mv(e,t){if(!v(this,cv)[cv])throw"Not built";var i=t&wu.CLIPPABLE?255:0,r=this.renderState.dataTextureSet,n=v(this,ev)[ev];if(Jf[0]=i,Jf[1]=0,Jf[2]=1,Jf[3]=2,v(this,sv)[sv])return r.eachMeshAttributes.textureData.set(Jf,28*e+12),void(v(this,av)[av]=!0);n.bindTexture(n.TEXTURE_2D,r.eachMeshAttributes.texture),n.texSubImage2D(n.TEXTURE_2D,0,3,e,1,1,n.RGBA_INTEGER,n.UNSIGNED_BYTE,Jf)}var gv=function(){},bv=/*#__PURE__*/function(){function e(e,t){this.texture=void 0,this.texture2D=void 0,this.texture=e,this.texture2D=t}return e.prototype.destroy=function(){this.texture2D&&this.texture2D.destroy()},e}(),wv=new Uint16Array([0,0,0]),Pv=/*#__PURE__*/f("flags"),Ev=/*#__PURE__*/f("aabb"),Tv=/*#__PURE__*/f("offsetAABB"),_v=/*#__PURE__*/f("offset"),Iv=/*#__PURE__*/f("colorizeUpdated"),xv=/*#__PURE__*/f("opacityUpdated"),Sv=/*#__PURE__*/function(){function e(e){this.id=void 0,this.model=void 0,this.sceneObject=void 0,this.layerId=void 0,this.rendererMeshes=void 0,Object.defineProperty(this,Pv,{writable:!0,value:void 0}),Object.defineProperty(this,Ev,{writable:!0,value:void 0}),Object.defineProperty(this,Tv,{writable:!0,value:void 0}),Object.defineProperty(this,_v,{writable:!0,value:void 0}),Object.defineProperty(this,Iv,{writable:!0,value:void 0}),Object.defineProperty(this,xv,{writable:!0,value:void 0}),this.id=e.id,this.rendererMeshes=e.rendererMeshes||[],v(this,Pv)[Pv]=0,v(this,Ev)[Ev]=e.aabb,v(this,Tv)[Tv]=Tr(e.aabb),v(this,_v)[_v]=Pt(),v(this,Iv)[Iv]=!1,v(this,xv)[xv]=!1,this.layerId=e.layerId||null;for(var t=0,i=this.rendererMeshes.length;t<i;t++)this.rendererMeshes[t].setSceneObject(this)}var t=e.prototype;return t.setVisible=function(e,t){if(!!(v(this,Pv)[Pv]&wu.VISIBLE)!==t){v(this,Pv)[Pv]=t?v(this,Pv)[Pv]|wu.VISIBLE:v(this,Pv)[Pv]&~wu.VISIBLE;for(var i=0,r=this.rendererMeshes.length;i<r;i++)this.rendererMeshes[i].setVisible(v(this,Pv)[Pv])}},t.setHighlighted=function(e,t){if(!!(v(this,Pv)[Pv]&wu.HIGHLIGHTED)!==t){v(this,Pv)[Pv]=t?v(this,Pv)[Pv]|wu.HIGHLIGHTED:v(this,Pv)[Pv]&~wu.HIGHLIGHTED;for(var i=0,r=this.rendererMeshes.length;i<r;i++)this.rendererMeshes[i].setHighlighted(v(this,Pv)[Pv])}},t.setXRayed=function(e,t){if(!!(v(this,Pv)[Pv]&wu.XRAYED)!==t){v(this,Pv)[Pv]=t?v(this,Pv)[Pv]|wu.XRAYED:v(this,Pv)[Pv]&~wu.XRAYED;for(var i=0,r=this.rendererMeshes.length;i<r;i++)this.rendererMeshes[i].setXRayed(v(this,Pv)[Pv])}},t.setSelected=function(e,t){if(!!(v(this,Pv)[Pv]&wu.SELECTED)!==t){v(this,Pv)[Pv]=t?v(this,Pv)[Pv]|wu.SELECTED:v(this,Pv)[Pv]&~wu.SELECTED;for(var i=0,r=this.rendererMeshes.length;i<r;i++)this.rendererMeshes[i].setSelected(v(this,Pv)[Pv])}},t.setEdges=function(e,t){if(!!(v(this,Pv)[Pv]&wu.EDGES)!==t){v(this,Pv)[Pv]=t?v(this,Pv)[Pv]|wu.EDGES:v(this,Pv)[Pv]&~wu.EDGES;for(var i=0,r=this.rendererMeshes.length;i<r;i++)this.rendererMeshes[i].setEdges(v(this,Pv)[Pv])}},t.setCulled=function(e,t){if(!!(v(this,Pv)[Pv]&wu.CULLED)!==t){v(this,Pv)[Pv]=t?v(this,Pv)[Pv]|wu.CULLED:v(this,Pv)[Pv]&~wu.CULLED;for(var i=0,r=this.rendererMeshes.length;i<r;i++)this.rendererMeshes[i].setCulled(v(this,Pv)[Pv])}},t.setClippable=function(e,t){if(!!(v(this,Pv)[Pv]&wu.CLIPPABLE)!==t){v(this,Pv)[Pv]=t?v(this,Pv)[Pv]|wu.CLIPPABLE:v(this,Pv)[Pv]&~wu.CLIPPABLE;for(var i=0,r=this.rendererMeshes.length;i<r;i++)this.rendererMeshes[i].setClippable(v(this,Pv)[Pv])}},t.setCollidable=function(e,t){if(!!(v(this,Pv)[Pv]&wu.COLLIDABLE)!==t){v(this,Pv)[Pv]=t?v(this,Pv)[Pv]|wu.COLLIDABLE:v(this,Pv)[Pv]&~wu.COLLIDABLE;for(var i=0,r=this.rendererMeshes.length;i<r;i++)this.rendererMeshes[i].setCollidable(v(this,Pv)[Pv])}},t.setPickable=function(e,t){if(!!(v(this,Pv)[Pv]&wu.PICKABLE)!==t){v(this,Pv)[Pv]=t?v(this,Pv)[Pv]|wu.PICKABLE:v(this,Pv)[Pv]&~wu.PICKABLE;for(var i=0,r=this.rendererMeshes.length;i<r;i++)this.rendererMeshes[i].setPickable(v(this,Pv)[Pv])}},t.setColorize=function(e,t){if(t){wv[0]=Math.floor(255*t[0]),wv[1]=Math.floor(255*t[1]),wv[2]=Math.floor(255*t[2]);for(var i=0,r=this.rendererMeshes.length;i<r;i++)this.rendererMeshes[i].setColorize(wv)}else for(var n=0,o=this.rendererMeshes.length;n<o;n++)this.rendererMeshes[n].setColorize(null)},t.setOpacity=function(e,t){if(0!==this.rendererMeshes.length){var i=this.rendererMeshes[0].colorize[3],r=255;if(null!=t){if(t<0?t=0:t>1&&(t=1),i===(r=Math.floor(255*t)))return}else if(i===(r=255))return;for(var n=0,o=this.rendererMeshes.length;n<o;n++)this.rendererMeshes[n].setOpacity(r,v(this,Pv)[Pv])}},t.setOffset=function(e,t){},t.build=function(){for(var e=0,t=this.rendererMeshes.length;e<t;e++)this.rendererMeshes[e].build(v(this,Pv)[Pv])},t.finalize2=function(){for(var e=0,t=this.rendererMeshes.length;e<t;e++)this.rendererMeshes[e].finalize2()},t.destroy=function(){for(var e=0,t=this.rendererMeshes.length;e<t;e++)this.rendererMeshes[e].destroy()},r(e,[{key:"aabb",get:function(){return v(this,Tv)[Tv]}}]),e}(),Mv=Qt(),Ov=Qt(),Rv=/*#__PURE__*/function(){function e(e){this.id=void 0,this.color=void 0,this.rendererGeometry=void 0,this.rendererTextureSet=void 0,this.matrix=void 0,this.metallic=void 0,this.roughness=void 0,this.opacity=void 0,this.pickId=void 0,this.tileManager=void 0,this.tile=void 0,this.sceneObjectRenderer=void 0,this.aabb=void 0,this.layer=void 0,this.meshIndex=void 0,this.colorize=void 0,this.colorizing=void 0,this.transparent=void 0,this.sceneObjectRenderer=null,this.tileManager=e.tileManager,this.id=e.id,this.pickId=0,this.color=[e.color[0],e.color[1],e.color[2],e.opacity],this.colorize=[e.color[0],e.color[1],e.color[2],e.opacity],this.colorizing=!1,this.transparent=e.opacity<255,this.layer=e.layer,this.matrix=e.matrix,this.metallic=e.metallic,this.roughness=e.roughness,this.opacity=e.opacity,this.aabb=Tr(),this.rendererTextureSet=e.rendererTextureSet,this.rendererGeometry=e.rendererGeometry,this.meshIndex=e.meshIndex}var t=e.prototype;return t.delegatePickedEntity=function(){throw new Error("Method not implemented.")},t.setSceneObject=function(e){this.sceneObjectRenderer=e},t.build=function(e){this.layer.initFlags(this.meshIndex,e,this.transparent)},t.finalize2=function(){this.layer.flushInitFlags&&this.layer.flushInitFlags()},t.setVisible=function(e){this.layer.setMeshVisible(this.meshIndex,e,this.transparent)},t.setMatrix=function(e){var t=fi(e,[0,0,0]),i=this.tile;this.tile=i?this.tileManager.updateTileCenter(i,t):this.tileManager.getTile(t);var r=!i||i.id!==this.tile.id,n=this.tile.center;this.layer.setMeshMatrix(this.meshIndex,0!==n[0]||0!==n[1]||0!==n[2]?ui(e,Ri(-n[0],-n[1],-n[2],Mv),Ov):e),r&&this.layer.setMeshViewMatrixIndex(this.meshIndex,this.tile.index)},t.setMetallic=function(e){},t.setRoughness=function(e){},t.setColor=function(e){this.color[0]=e[0],this.color[1]=e[1],this.color[2]=e[2],this.colorizing||this.layer.setMeshColor(this.meshIndex,this.color)},t.setColorize=function(e){e?(this.colorize[0]=e[0],this.colorize[1]=e[1],this.colorize[2]=e[2],this.layer.setMeshColor(this.meshIndex,this.colorize,!1),this.colorizing=!0):(this.layer.setMeshColor(this.meshIndex,this.color,!1),this.colorizing=!1)},t.setOpacity=function(e,t){var i=e<255,r=this.transparent!==i;this.color[3]=e,this.colorize[3]=e,this.transparent=i,this.layer.setMeshColor(this.meshIndex,this.colorizing?this.colorize:this.color),r&&this.layer.setMeshTransparent(this.meshIndex,t,i)},t.setHighlighted=function(e){this.layer.setMeshHighlighted(this.meshIndex,e,this.transparent)},t.setXRayed=function(e){this.layer.setMeshXRayed(this.meshIndex,e,this.transparent)},t.setSelected=function(e){this.layer.setMeshSelected(this.meshIndex,e,this.transparent)},t.setEdges=function(e){this.layer.setMeshEdges(this.meshIndex,e,this.transparent)},t.setClippable=function(e){this.layer.setMeshClippable(this.meshIndex,e)},t.setCollidable=function(e){this.layer.setMeshCollidable(this.meshIndex,e)},t.setPickable=function(e){this.layer.setMeshPickable(this.meshIndex,e,this.transparent)},t.setCulled=function(e){this.layer.setMeshCulled(this.meshIndex,e,this.transparent)},t.canPickTriangle=function(){return!1},t.drawPickTriangles=function(e,t){},t.pickTriangleSurface=function(e){},t.canPickWorldPos=function(){return!0},t.drawPickNormals=function(e){},t.destroy=function(){this.tile&&this.tileManager&&this.tileManager.putTile(this.tile)},e}(),jv=function(e){this.id=void 0,this.colorTexture=void 0,this.metallicRoughnessTexture=void 0,this.emissiveTexture=void 0,this.occlusionTexture=void 0,this.id=e.id,this.colorTexture=e.colorTexture,this.metallicRoughnessTexture=e.metallicRoughnessTexture,this.emissiveTexture=e.emissiveTexture,this.occlusionTexture=e.occlusionTexture};Ci();var Dv="defaultTextureSet",Av=/*#__PURE__*/f("view"),Cv=/*#__PURE__*/f("webglRenderer"),Bv=/*#__PURE__*/f("renderContext"),kv=/*#__PURE__*/f("position"),Lv=/*#__PURE__*/f("rotation"),Fv=/*#__PURE__*/f("quaternion"),Uv=/*#__PURE__*/f("scale"),Nv=/*#__PURE__*/f("worldMatrix"),Gv=/*#__PURE__*/f("viewMatrix"),Vv=/*#__PURE__*/f("colorTextureEnabled"),Hv=/*#__PURE__*/f("backfaces"),Xv=/*#__PURE__*/f("layers"),Wv=/*#__PURE__*/f("numGeometries"),Yv=/*#__PURE__*/f("numTriangles"),Kv=/*#__PURE__*/f("numLines"),zv=/*#__PURE__*/f("numPoints"),qv=/*#__PURE__*/f("numRendererObjects"),Zv=/*#__PURE__*/f("textureTranscoder"),Qv=/*#__PURE__*/f("aabbDirty"),Jv=/*#__PURE__*/f("edgeThreshold"),$v=/*#__PURE__*/f("currentLayers"),ep=/*#__PURE__*/f("aabb"),tp=/*#__PURE__*/f("viewMatrixDirty"),ip=/*#__PURE__*/f("worldMatrixNonIdentity"),rp=/*#__PURE__*/f("onCameraViewMatrix"),np=/*#__PURE__*/f("layerId"),op=/*#__PURE__*/f("attachSceneModel"),sp=/*#__PURE__*/f("attachTexture"),ap=/*#__PURE__*/f("attachGeometry"),cp=/*#__PURE__*/f("attachMesh"),lp=/*#__PURE__*/f("getLayer"),hp=/*#__PURE__*/f("attachSceneObject"),up=/*#__PURE__*/f("createDefaultTextureSetRenderer"),dp=/*#__PURE__*/f("rebuildAABB"),fp=/*#__PURE__*/f("detachSceneModel"),vp=/*#__PURE__*/function(e){function t(t){var i;i=e.call(this,t.view)||this,Object.defineProperty(l(i),fp,{value:Tp}),Object.defineProperty(l(i),dp,{value:Ep}),Object.defineProperty(l(i),up,{value:Pp}),Object.defineProperty(l(i),hp,{value:wp}),Object.defineProperty(l(i),lp,{value:bp}),Object.defineProperty(l(i),cp,{value:gp}),Object.defineProperty(l(i),ap,{value:mp}),Object.defineProperty(l(i),sp,{value:yp}),Object.defineProperty(l(i),op,{value:pp}),i.qualityRender=void 0,i.sceneModel=void 0,i.rendererGeometries=void 0,i.rendererTextures=void 0,i.rendererTextureSets=void 0,i.rendererMeshes=void 0,i.rendererObjects=void 0,i.rendererObjectsList=void 0,i.rendererViewObjects=void 0,i.viewer=void 0,i.layerList=void 0,i.onBuilt=void 0,Object.defineProperty(l(i),Av,{writable:!0,value:void 0}),Object.defineProperty(l(i),Cv,{writable:!0,value:void 0}),Object.defineProperty(l(i),Bv,{writable:!0,value:void 0}),Object.defineProperty(l(i),kv,{writable:!0,value:void 0}),Object.defineProperty(l(i),Lv,{writable:!0,value:void 0}),Object.defineProperty(l(i),Fv,{writable:!0,value:void 0}),Object.defineProperty(l(i),Uv,{writable:!0,value:void 0}),Object.defineProperty(l(i),Nv,{writable:!0,value:void 0}),Object.defineProperty(l(i),Gv,{writable:!0,value:void 0}),Object.defineProperty(l(i),Vv,{writable:!0,value:void 0}),Object.defineProperty(l(i),Hv,{writable:!0,value:void 0}),Object.defineProperty(l(i),Xv,{writable:!0,value:void 0}),Object.defineProperty(l(i),Wv,{writable:!0,value:void 0}),Object.defineProperty(l(i),Yv,{writable:!0,value:void 0}),Object.defineProperty(l(i),Kv,{writable:!0,value:void 0}),Object.defineProperty(l(i),zv,{writable:!0,value:void 0}),Object.defineProperty(l(i),qv,{writable:!0,value:void 0}),Object.defineProperty(l(i),Zv,{writable:!0,value:void 0}),Object.defineProperty(l(i),Qv,{writable:!0,value:void 0}),Object.defineProperty(l(i),Jv,{writable:!0,value:void 0}),Object.defineProperty(l(i),$v,{writable:!0,value:void 0}),Object.defineProperty(l(i),ep,{writable:!0,value:void 0}),Object.defineProperty(l(i),tp,{writable:!0,value:void 0}),Object.defineProperty(l(i),ip,{writable:!0,value:void 0}),Object.defineProperty(l(i),rp,{writable:!0,value:void 0}),Object.defineProperty(l(i),np,{writable:!0,value:void 0}),i.id=t.id,i.sceneModel=t.sceneModel,i.viewer=t.view.viewer,v(l(i),Av)[Av]=t.view,v(l(i),Cv)[Cv]=t.webglRenderer,v(l(i),Bv)[Bv]=t.renderContext,v(l(i),Zv)[Zv]=t.textureTranscoder,v(l(i),ep)[ep]=jr(),v(l(i),Qv)[Qv]=!1,v(l(i),Xv)[Xv]={},i.layerList=[],v(l(i),$v)[$v]={},i.rendererGeometries={},i.rendererTextures={},i.rendererTextureSets={},i.rendererMeshes={},i.rendererObjects={},i.rendererObjectsList=[],i.rendererViewObjects={},v(l(i),Wv)[Wv]=0,v(l(i),qv)[qv]=0,v(l(i),Yv)[Yv]=0,v(l(i),Kv)[Kv]=0,v(l(i),zv)[zv]=0,v(l(i),Jv)[Jv]=t.edgeThreshold||10,i.built=!1,v(l(i),kv)[kv]=Pt(t.position||[0,0,0]),v(l(i),Lv)[Lv]=Pt(t.rotation||[0,0,0]),v(l(i),Fv)[Fv]=Et(t.quaternion||[0,0,0,1]),t.rotation&&Bi(v(l(i),Lv)[Lv],"XYZ",v(l(i),Fv)[Fv]),v(l(i),Uv)[Uv]=Pt(t.scale||[1,1,1]),v(l(i),Nv)[Nv]=Qt(),Ti(v(l(i),kv)[kv],v(l(i),Fv)[Fv],v(l(i),Uv)[Uv],v(l(i),Nv)[Nv]),(t.matrix||t.position||t.rotation||t.scale||t.quaternion)&&(v(l(i),Gv)[Gv]=Qt(),v(l(i),tp)[tp]=!0,v(l(i),ip)[ip]=!0),i.qualityRender=!1!==t.qualityRender,v(l(i),np)[np]=t.layerId,v(l(i),rp)[rp]=v(l(i),Av)[Av].camera.onViewMatrix.subscribe(function(e,t){v(l(i),tp)[tp]=!0}),v(l(i),up)[up](),i.onBuilt=new y(new ie.EventDispatcher),v(l(i),op)[op](t.sceneModel);for(var r=0,n=i.layerList.length;r<n;r++)i.layerList[r].layerIndex=r;return v(l(i),$v)[$v]={},i.built=!0,v(l(i),Cv)[Cv].setImageDirty(),i.onBuilt.dispatch(l(i),null),i}n(t,e);var i=t.prototype;return i.setVisible=function(e,t){for(var i=0,r=this.rendererObjectsList.length;i<r;i++)this.rendererObjectsList[i].setVisible(e,t);v(this,Cv)[Cv].setImageDirty(e)},i.setXRayed=function(e,t){for(var i=0,r=this.rendererObjectsList.length;i<r;i++)this.rendererObjectsList[i].setXRayed(e,t);v(this,Cv)[Cv].setImageDirty(e)},i.setHighlighted=function(e,t){for(var i=0,r=this.rendererObjectsList.length;i<r;i++)this.rendererObjectsList[i].setHighlighted(e,t);v(this,Cv)[Cv].setImageDirty(e)},i.setSelected=function(e,t){for(var i=0,r=this.rendererObjectsList.length;i<r;i++)this.rendererObjectsList[i].setSelected(e,t);v(this,Cv)[Cv].setImageDirty(e)},i.setEdges=function(e,t){for(var i=0,r=this.rendererObjectsList.length;i<r;i++)this.rendererObjectsList[i].setEdges(e,t);v(this,Cv)[Cv].setImageDirty(e)},i.setCulled=function(e,t){for(var i=0,r=this.rendererObjectsList.length;i<r;i++)this.rendererObjectsList[i].setCulled(e,t);v(this,Cv)[Cv].setImageDirty(e)},i.setClippable=function(e,t){for(var i=0,r=this.rendererObjectsList.length;i<r;i++)this.rendererObjectsList[i].setClippable(e,t);v(this,Cv)[Cv].setImageDirty(e)},i.setCollidable=function(e,t){for(var i=0,r=this.rendererObjectsList.length;i<r;i++)this.rendererObjectsList[i].setCollidable(e,t)},i.setPickable=function(e,t){for(var i=0,r=this.rendererObjectsList.length;i<r;i++)this.rendererObjectsList[i].setPickable(e,t)},i.setColorize=function(e,t){for(var i=0,r=this.rendererObjectsList.length;i<r;i++)this.rendererObjectsList[i].setColorize(e,t)},i.setOpacity=function(e,t){for(var i=0,r=this.rendererObjectsList.length;i<r;i++)this.rendererObjectsList[i].setOpacity(e,t)},i.destroy=function(){if(!this.destroyed){for(var t in v(this,fp)[fp](),v(this,Av)[Av].camera.onViewMatrix.unsubscribe(v(this,rp)[rp]),v(this,$v)[$v])v(this,$v)[$v].hasOwnProperty(t)&&v(this,$v)[$v][t].destroy();for(var i=0,r=this.layerList.length;i<r;i++)this.layerList[i].destroy();for(var n in this.rendererObjects)this.rendererObjects[n].destroy();v(this,$v)[$v]={},v(this,Xv)[Xv]={},this.layerList=[],this.rendererGeometries={},this.rendererTextures={},this.rendererTextureSets={},this.rendererMeshes={},this.rendererViewObjects={},this.onBuilt.clear(),e.prototype.destroy.call(this)}},r(t,[{key:"position",get:function(){return v(this,kv)[kv]}},{key:"rotation",get:function(){return v(this,Lv)[Lv]}},{key:"quaternion",get:function(){return v(this,Fv)[Fv]}},{key:"scale",get:function(){return v(this,Uv)[Uv]}},{key:"worldMatrix",get:function(){return v(this,Nv)[Nv]}},{key:"viewMatrix",get:function(){return v(this,Gv)[Gv]?(v(this,tp)[tp]&&(ui(v(this,Av)[Av].camera.viewMatrix,v(this,Nv)[Nv],v(this,Gv)[Gv]),v(this,tp)[tp]=!1),v(this,Gv)[Gv]):v(this,Av)[Av].camera.viewMatrix}},{key:"colorTextureEnabled",get:function(){return v(this,Vv)[Vv]}},{key:"backfaces",get:function(){return v(this,Hv)[Hv]},set:function(e){e=!!e,v(this,Hv)[Hv]=e,v(this,Cv)[Cv].setImageDirty()}},{key:"matrix",get:function(){return v(this,Nv)[Nv]}},{key:"aabb",get:function(){return v(this,Qv)[Qv]&&v(this,dp)[dp](),v(this,ep)[ep]}},{key:"numTriangles",get:function(){return v(this,Yv)[Yv]}},{key:"numLines",get:function(){return v(this,Kv)[Kv]}},{key:"numPoints",get:function(){return v(this,zv)[zv]}}]),t}(ce);function pp(e){var t=e.textures,i=e.geometries,r=e.meshes,n=e.objects;if(t)for(var o in t)v(this,sp)[sp](t[o]);if(i)for(var s in i)v(this,ap)[ap](i[s]);if(r)for(var a in r)v(this,cp)[cp](r[a]);if(n)for(var c in n)v(this,hp)[hp](n[c]);for(var l in v(this,$v)[$v])v(this,$v)[$v][l].build();for(var h=0,u=this.rendererObjectsList.length;h<u;h++)this.rendererObjectsList[h].build();for(var d=0,f=this.rendererObjectsList.length;d<f;d++)this.rendererObjectsList[d].finalize2()}function yp(e){var t=this,i=e.id;if(this.rendererTextures[i])throw new ue("RendererTexture already created: "+i);var r=new Yh({gl:v(this,Bv)[Bv].gl});if(e.preloadColor&&r.setPreloadColor(e.preloadColor),e.image){var n=e.image;n.crossOrigin="Anonymous",r.setImage(n,{minFilter:e.minFilter,magFilter:e.magFilter,wrapS:e.wrapS,wrapT:e.wrapT,wrapR:e.wrapR,flipY:e.flipY,encoding:e.encoding})}else if(e.src){var o=e.src.split(".").pop();switch(o){case"jpeg":case"jpg":case"png":case"gif":var s=new Image;s.onload=function(){r.setImage(s,{minFilter:e.minFilter,magFilter:e.magFilter,wrapS:e.wrapS,wrapT:e.wrapT,wrapR:e.wrapR,flipY:e.flipY,encoding:e.encoding})},s.src=e.src;break;default:v(this,Zv)[Zv]?er(e.src,function(e){e.byteLength?v(t,Zv)[Zv].transcode([e]).then(function(e){r.setCompressedData(e),v(t,Cv)[Cv].setImageDirty()}):t.error("Can't create texture from 'src': file data is zero length")},function(e){t.error("Can't create texture from 'src': "+e)}):this.error("Can't create texture from 'src' - rendererModel needs to be configured with a TextureTranscoder for this file type ('"+o+"')")}}else e.buffers&&(v(this,Zv)[Zv]?v(this,Zv)[Zv].transcode(e.buffers).then(function(e){r.setCompressedData(e),v(t,Cv)[Cv].setImageDirty()}):this.error("Can't create texture from 'buffers' - rendererModel needs to be configured with a TextureTranscoder for this option"));var a=new bv(e,r);e.rendererTexture=a,this.rendererTextures[i]=a}function mp(e){var t=e.id;if(this.rendererGeometries[t])throw new ue("RendererGeometry already created: "+t);var i=new gv;this.rendererGeometries[t]=i,e.rendererGeometry=i,v(this,Wv)[Wv]++}function gp(e){var t=this.rendererGeometries[e.geometry.id];if(!t)throw new ue("RendererGeometry not found");var i=this.rendererTextureSets[e.textureSet.id];if(!i)throw new ue("rendererTextureSet not found");var r=v(this,lp)[lp](e.textureSet?e.textureSet.id:void 0,e.geometry);if(r){var n;r.hasGeometry(e.geometry.id)||r.createGeometryCompressed(e.geometry),v(this,ip)[ip]&&v(this,Nv),n=e.matrix;var o=e.color?new Uint8Array([Math.floor(255*e.color[0]),Math.floor(255*e.color[1]),Math.floor(255*e.color[2])]):[255,255,255],s=null!=e.opacity?Math.floor(255*e.opacity):255,a=null!=e.metallic?Math.floor(255*e.metallic):0,c=null!=e.roughness?Math.floor(255*e.roughness):255,l=new Rv({tileManager:v(this,Cv)[Cv].tileManager,id:e.id,layer:r,color:o,opacity:s,matrix:n,metallic:a,roughness:c,rendererTextureSet:i,rendererGeometry:t,meshIndex:0});l.pickId=v(this,Cv)[Cv].attachPickable(l);var h=new Uint8Array([255&l.pickId,l.pickId>>8&255,l.pickId>>16&255,l.pickId>>24&255]);jr(l.aabb);var u=r.createMesh({id:e.id,geometryId:e.geometry.id,color:o,opacity:s,metallic:a,roughness:c,matrix:n,pickColor:h});v(this,Wv)[Wv]++,Ar(v(this,ep)[ep],l.aabb),l.layer=r,l.meshIndex=u,this.rendererMeshes[e.id]=l}}function bp(e,t){var i,r=(e=e||Dv)+"_"+t.primitive,n=v(this,$v)[$v][r];if(n){if(n.canCreateMesh(t))return n;n.build(),delete v(this,$v)[$v][r]}if(!e||(i=this.rendererTextureSets[e]))return n=new fv({gl:v(this,Bv)[Bv].gl,view:v(this,Av)[Av],rendererModel:this,primitive:t.primitive,textureSet:i,layerIndex:0}),v(this,Xv)[Xv][r]=n,this.layerList.push(n),v(this,$v)[$v][r]=n,n;this.error("TextureSet not found: "+e+" - ensure that you create it first with createTextureSet()")}function wp(e){var t=e.id;void 0===t?t=sr():this.rendererObjects[t]&&(this.error("[createObject] rendererModel already has a ViewerObject with this ID: "+t+" - will assign random ID"),t=sr());var i=e.meshes;if(void 0===i)throw new ue("[createObject] Param expected: meshes");for(var r=[],n=0,o=i.length;n<o;n++)r.push(this.rendererMeshes[i[n].id]);var s=new Sv({id:t,rendererModel:this,rendererMeshes:r,aabb:e.aabb,layerId:v(this,np)[np]});this.rendererObjectsList.push(s),this.rendererObjects[t]=s,this.rendererViewObjects[t]=s,v(this,qv)[qv]++}function Pp(){var e=new bv(null,new Yh({gl:v(this,Bv)[Bv].gl,preloadColor:[1,1,1,1]})),t=new bv(null,new Yh({gl:v(this,Bv)[Bv].gl,preloadColor:[0,1,1,1]})),i=new bv(null,new Yh({gl:v(this,Bv)[Bv].gl,preloadColor:[0,0,0,0]})),r=new bv(null,new Yh({gl:v(this,Bv)[Bv].gl,preloadColor:[0,0,0,1]})),n=new bv(null,new Yh({gl:v(this,Bv)[Bv].gl,preloadColor:[1,1,1,1]}));this.rendererTextures.defaultColorTexture=e,this.rendererTextures.defaultMetalRoughTexture=t,this.rendererTextures.defaultNormalsTexture=i,this.rendererTextures.defaultEmissiveTexture=r,this.rendererTextures.defaultOcclusionTexture=n,this.rendererTextureSets[Dv]=new jv({id:Dv,colorTexture:e,metallicRoughnessTexture:t,emissiveTexture:r,occlusionTexture:n})}function Ep(){jr(v(this,ep)[ep]);for(var e=0,t=this.rendererObjectsList.length;e<t;e++){var i=this.rendererObjectsList[e];Ar(v(this,ep)[ep],i.aabb)}v(this,Qv)[Qv]=!1}function Tp(){var e=this.sceneModel;if(e){var t=e.textures,i=e.geometries,r=e.meshes,n=e.objects;if(t)for(var o in t){var s=t[o];s.rendererTexture&&(s.rendererTexture=null)}if(i)for(var a in i){var c=i[a];c.rendererGeometry&&(c.rendererGeometry=null)}if(r)for(var l in r){var h=r[l];h.rendererMesh&&(h.rendererMesh=null)}if(n)for(var u in n){var d=n[u];d.rendererObject&&(d.rendererObject=null)}this.sceneModel=null}}var _p=2e3,Ip=/*#__PURE__*/f("gl"),xp=/*#__PURE__*/f("indexesUsed"),Sp=/*#__PURE__*/f("tiles"),Mp=/*#__PURE__*/f("dataTexture"),Op=/*#__PURE__*/f("camera"),Rp=/*#__PURE__*/f("lastFreeIndex"),jp=/*#__PURE__*/f("putFreeTile"),Dp=/*#__PURE__*/f("findFreeTile"),Ap=/*#__PURE__*/function(){function e(e){Object.defineProperty(this,Dp,{value:Bp}),Object.defineProperty(this,jp,{value:Cp}),Object.defineProperty(this,Ip,{writable:!0,value:void 0}),Object.defineProperty(this,xp,{writable:!0,value:void 0}),Object.defineProperty(this,Sp,{writable:!0,value:void 0}),Object.defineProperty(this,Mp,{writable:!0,value:void 0}),Object.defineProperty(this,Op,{writable:!0,value:void 0}),Object.defineProperty(this,Rp,{writable:!0,value:void 0}),v(this,Op)[Op]=e.camera,v(this,Ip)[Ip]=e.gl,v(this,xp)[xp]=[],v(this,Rp)[Rp]=0,v(this,Sp)[Sp]={},v(this,Mp)[Mp]=function(e,t){var i=t;if(0==i)throw"texture height == 0";var r=new Hf(48*i),n=e.createTexture();return n?(e.bindTexture(e.TEXTURE_2D,n),e.texStorage2D(e.TEXTURE_2D,1,e.RGBA16F,12,i),e.texSubImage2D(e.TEXTURE_2D,0,0,0,12,i,e.RGBA,e.HALF_FLOAT,new Uint16Array(r.buffer),0),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(e.TEXTURE_2D,null),new Lh({gl:e,texture:n,textureWidth:12,textureHeight:i})):Wf}(v(this,Ip)[Ip],_p)}var t=e.prototype;return t.getTile=function(e){var t=Jr(e,Pt()),i=t[0]+"-"+t[1]+"-"+t[2],r=v(this,Sp)[Sp][i];return r||(r={id:i,index:v(this,Dp)[Dp](),useCount:0,center:Pt(),rtcViewMatrix:Qt()},v(this,Sp)[Sp][r.id]=r),r.useCount++,r},t.putTile=function(e){--e.useCount<=0&&(delete v(this,Sp)[Sp][e.id],v(this,jp)[jp](e.index))},t.updateTileCenter=function(e,t){var i=Jr(t,Pt()),r=i[0]+"-"+i[1]+"-"+i[2];if(r===e.id)return e;this.putTile(e);var n=v(this,Sp)[Sp][r];return n||(n={id:r,index:v(this,Dp)[Dp](),useCount:0,center:Pt(),rtcViewMatrix:Qt()},v(this,Sp)[Sp][n.id]=n),n.useCount++,n},t.refreshMatrices=function(){if(v(this,Mp)[Mp].texture){for(var e=v(this,Ip)[Ip],t=v(this,Op)[Op].viewMatrix,i=Object.keys(v(this,Sp)[Sp]),r=new Float32Array(16*i.length),n=0,o=i.length;n<o;n++){var s=i[n],a=v(this,Sp)[Sp][s];Qr(t,a.center,a.rtcViewMatrix),r.set(a.rtcViewMatrix,16*a.index)}e.bindTexture(e.TEXTURE_2D,v(this,Mp)[Mp].texture),e.texSubImage2D(e.TEXTURE_2D,0,0,0,1,1,e.RGBA,e.FLOAT,r),e.bindTexture(e.TEXTURE_2D,null)}},e}();function Cp(e){delete v(this,xp)[xp][e],v(this,Rp)[Rp]=e}function Bp(){for(var e=v(this,Rp)[Rp];;e=(e+1)%_p)if(!v(this,xp)[xp][e])return v(this,xp)[xp][e]=!0,e}var kp=navigator.userAgent.match(/(opera|chrome|safari|firefox|msie|mobile)\/?\s*(\.?\d+(\.\d+)*)/i),Lp=kp&&"safari"===kp[1].toLowerCase(),Fp=/*#__PURE__*/f("sceneModels"),Up=/*#__PURE__*/f("viewer"),Np=/*#__PURE__*/f("view"),Gp=/*#__PURE__*/f("renderContext"),Vp=/*#__PURE__*/f("canvasTransparent"),Hp=/*#__PURE__*/f("transparentEnabled"),Xp=/*#__PURE__*/f("edgesEnabled"),Wp=/*#__PURE__*/f("imageDirty"),Yp=/*#__PURE__*/f("saoEnabled"),Kp=/*#__PURE__*/f("pbrEnabled"),zp=/*#__PURE__*/f("backgroundColor"),qp=/*#__PURE__*/f("rendererModels"),Zp=/*#__PURE__*/f("layerList"),Qp=/*#__PURE__*/f("layerListDirty"),Jp=/*#__PURE__*/f("stateSortDirty"),$p=/*#__PURE__*/f("pickIDs"),ey=/*#__PURE__*/f("saoDepthRenderBuffer"),ty=/*#__PURE__*/f("extensionHandles"),iy=/*#__PURE__*/f("logarithmicDepthBufferEnabled"),ry=/*#__PURE__*/f("alphaDepthMask"),ny=/*#__PURE__*/f("occlusionTester"),oy=/*#__PURE__*/f("textureTranscoder"),sy=/*#__PURE__*/f("layerRenderers"),ay=/*#__PURE__*/f("viewMatrixDirty"),cy=/*#__PURE__*/f("attachRendererViewObjects"),ly=/*#__PURE__*/f("detachRendererViewObjects"),hy=/*#__PURE__*/f("updateLayerList"),uy=/*#__PURE__*/f("buildLayerList"),dy=/*#__PURE__*/f("draw"),fy=/*#__PURE__*/f("activateExtensions"),vy=/*#__PURE__*/f("drawSAOBuffers"),py=/*#__PURE__*/f("drawDepth"),yy=/*#__PURE__*/f("drawColor"),my=/*#__PURE__*/f("drawLayer"),gy=/*#__PURE__*/function(){function e(e){Object.defineProperty(this,my,{value:My}),Object.defineProperty(this,yy,{value:Sy}),Object.defineProperty(this,py,{value:xy}),Object.defineProperty(this,vy,{value:Iy}),Object.defineProperty(this,fy,{value:_y}),Object.defineProperty(this,dy,{value:Ty}),Object.defineProperty(this,uy,{value:Ey}),Object.defineProperty(this,hy,{value:Py}),Object.defineProperty(this,ly,{value:wy}),Object.defineProperty(this,cy,{value:by}),this.rendererViewObjects=void 0,this.tileManager=void 0,Object.defineProperty(this,Fp,{writable:!0,value:void 0}),Object.defineProperty(this,Up,{writable:!0,value:void 0}),Object.defineProperty(this,Np,{writable:!0,value:void 0}),Object.defineProperty(this,Gp,{writable:!0,value:void 0}),Object.defineProperty(this,Vp,{writable:!0,value:void 0}),Object.defineProperty(this,Hp,{writable:!0,value:void 0}),Object.defineProperty(this,Xp,{writable:!0,value:void 0}),Object.defineProperty(this,Wp,{writable:!0,value:void 0}),Object.defineProperty(this,Yp,{writable:!0,value:void 0}),Object.defineProperty(this,Kp,{writable:!0,value:void 0}),Object.defineProperty(this,zp,{writable:!0,value:void 0}),Object.defineProperty(this,qp,{writable:!0,value:void 0}),Object.defineProperty(this,Zp,{writable:!0,value:void 0}),Object.defineProperty(this,Qp,{writable:!0,value:void 0}),Object.defineProperty(this,Jp,{writable:!0,value:void 0}),Object.defineProperty(this,$p,{writable:!0,value:new Hi({})}),Object.defineProperty(this,ey,{writable:!0,value:void 0}),Object.defineProperty(this,ty,{writable:!0,value:void 0}),Object.defineProperty(this,iy,{writable:!0,value:void 0}),Object.defineProperty(this,ry,{writable:!0,value:void 0}),Object.defineProperty(this,ny,{writable:!0,value:void 0}),Object.defineProperty(this,oy,{writable:!0,value:void 0}),Object.defineProperty(this,sy,{writable:!0,value:void 0}),Object.defineProperty(this,ay,{writable:!0,value:void 0}),this.rendererViewObjects={},this.tileManager=null,v(this,Fp)[Fp]={},v(this,oy)[oy]=e.textureTranscoder||new jh({}),v(this,Vp)[Vp]=!1,v(this,ry)[ry]=!1,v(this,ty)[ty]={},v(this,$p)[$p]=new Hi({}),v(this,Zp)[Zp]=[],v(this,Qp)[Qp]=!0,v(this,Jp)[Jp]=!0,v(this,Wp)[Wp]=!0,v(this,Hp)[Hp]=!0,v(this,Xp)[Xp]=!0,v(this,Yp)[Yp]=!0,v(this,Kp)[Kp]=!0,v(this,zp)[zp]=Pt(),v(this,ny)[ny]=null,v(this,iy)[iy]=!1,v(this,qp)[qp]={},v(this,ay)[ay]=!0}var t=e.prototype;return t.getCapabilities=function(e){e.maxViews=1;var t,i=document.createElement("canvas");try{t=i.getContext("webgl2")}catch(e){console.error("Failed to get a WebGL context")}t&&(e.astcSupported=!!Hh(t,"WEBGL_compressed_texture_astc"),e.etc1Supported=!0,e.etc2Supported=!!Hh(t,"WEBGL_compressed_texture_etc"),e.dxtSupported=!!Hh(t,"WEBGL_compressed_texture_s3tc"),e.bptcSupported=!!Hh(t,"EXT_texture_compression_bptc"),e.pvrtcSupported=!(!Hh(t,"WEBGL_compressed_texture_pvrtc")&&!Hh(t,"WEBKIT_WEBGL_compressed_texture_pvrtc")))},t.attachViewer=function(e){v(this,Up)[Up]=e,v(this,oy)[oy].init(v(this,Up)[Up].capabilities)},t.attachView=function(e){var t=this;if(v(this,Gp)[Gp])throw"Only one View allowed with WebGLRenderer (see WebViewerCapabilities.maxViews)";v(this,Np)[Np]=e;for(var i=["webgl2"],r=e.canvasElement,n={},o=null,s=0;!o&&s<i.length;s++)try{o=r.getContext(i[s],n)}catch(e){}return o?(o&&o.hint(o.FRAGMENT_SHADER_DERIVATIVE_HINT,o.NICEST),v(this,Gp)[Gp]=new Jh(v(this,Up)[Up],v(this,Np)[Np],o),this.tileManager=new Ap({camera:e.camera,gl:o}),v(this,sy)[sy]={colorTriangles:new yu(v(this,Gp)[Gp])},e.camera.onViewMatrix.sub(function(){v(t,ay)[ay]=!0}),0):(console.error("Failed to get a WebGL2 context"),0)},t.detachView=function(e){},t.attachSceneModel=function(e){var t=this;if(!v(this,Gp)[Gp])throw new ue("Must attach a View before you attach a SceneModel");var i=new vp({id:e.id,sceneModel:e,view:v(this,Np)[Np],textureTranscoder:v(this,oy)[oy],webglRenderer:this,renderContext:v(this,Gp)[Gp]});v(this,qp)[qp][i.id]=i,v(this,cy)[cy](i),v(this,Qp)[Qp]=!0,i.onDestroyed.one(function(e){var i=v(t,qp)[qp][e.id];delete v(t,qp)[qp][e.id],v(t,ly)[ly](i),v(t,Qp)[Qp]=!0}),e.rendererModel=i},t.detachSceneModel=function(e){if(v(this,Fp)[Fp][e.id]){var t=v(this,qp)[qp][e.id];delete v(this,qp)[qp][e.id],v(this,ly)[ly](t),v(this,Qp)[Qp]=!0,e.rendererModel=null}},t.attachPickable=function(e){return v(this,$p)[$p].addItem(e)},t.detachPickable=function(e){v(this,$p)[$p].removeItem(e)},t.setImageDirty=function(e){v(this,Wp)[Wp]=!0},t.setBackgroundColor=function(e,t){v(this,zp)[zp].set(t),v(this,Wp)[Wp]=!0},t.setEdgesEnabled=function(e,t){v(this,Xp)[Xp]=t,v(this,Wp)[Wp]=!0},t.setPBREnabled=function(e,t){v(this,Kp)[Kp]=t,v(this,Wp)[Wp]=!0},t.getSAOSupported=function(){return Lp&&qh.SUPPORTED_EXTENSIONS.OES_standard_derivatives},t.setSAOEnabled=function(e,t){v(this,Yp)[Yp]=t,v(this,Wp)[Wp]=!0},t.setTransparentEnabled=function(e,t){v(this,Hp)[Hp]=t,v(this,Wp)[Wp]=!0},t.clear=function(e){var t=v(this,Gp)[Gp].gl;t.viewport(0,0,t.drawingBufferWidth,t.drawingBufferHeight),v(this,Vp)[Vp]?t.clearColor(1,1,1,1):t.clearColor(v(this,zp)[zp][0],v(this,zp)[zp][1],v(this,zp)[zp][2],1),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)},t.needsRebuild=function(e){for(var t in v(this,sy)[sy])v(this,sy)[sy][t].needRebuild()},t.needsRender=function(e){return v(this,Wp)[Wp]||v(this,Qp)[Qp]||v(this,Jp)[Jp]},t.render=function(e,t){(t=t||{}).force&&(v(this,Wp)[Wp]=!0),v(this,ay)[ay]&&(this.tileManager.refreshMatrices(),v(this,ay)[ay]=!1),v(this,hy)[hy](),v(this,Wp)[Wp]&&(v(this,dy)[dy]({clear:!0}),v(this,Wp)[Wp]=!1)},t.pickSceneObject=function(e,t){return null},e}();function by(e){var t=e.rendererViewObjects;for(var i in t)this.rendererViewObjects[i]=t[i]}function wy(e){var t=e.rendererViewObjects;for(var i in t)delete this.rendererViewObjects[i]}function Py(){v(this,Qp)[Qp]&&(v(this,uy)[uy](),v(this,Qp)[Qp]=!1,v(this,Jp)[Jp]=!0),v(this,Jp)[Jp]&&(v(this,Jp)[Jp]=!1,v(this,Wp)[Wp]=!0)}function Ey(){var e=0;for(var t in v(this,qp)[qp])for(var i=v(this,qp)[qp][t],r=0,n=i.layerList.length;r<n;r++)v(this,Zp)[Zp][e++]=i.layerList[r];v(this,Zp)[Zp].length=e}function Ty(e){v(this,fy)[fy](),v(this,Yp)[Yp]&&v(this,Np)[Np].sao.possible&&v(this,vy)[vy](e),v(this,yy)[yy](e)}function _y(){qh.SUPPORTED_EXTENSIONS.OES_element_index_uint&&(v(this,ty)[ty].OES_element_index_uint=v(this,Gp)[Gp].gl.getExtension("OES_element_index_uint")),v(this,iy)[iy]&&qh.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(v(this,ty)[ty].EXT_frag_depth=v(this,Gp)[Gp].gl.getExtension("EXT_frag_depth")),qh.SUPPORTED_EXTENSIONS.WEBGL_depth_texture&&(v(this,ty)[ty].WEBGL_depth_texture=v(this,Gp)[Gp].gl.getExtension("WEBGL_depth_texture"))}function Iy(e){}function xy(e){v(this,Gp)[Gp].reset();var t=v(this,Gp)[Gp].gl;t.viewport(0,0,t.drawingBufferWidth,t.drawingBufferHeight),t.clearColor(0,0,0,0),t.enable(t.DEPTH_TEST),t.frontFace(t.CCW),t.enable(t.CULL_FACE),t.depthMask(!0),!1!==e.clear&&t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)}function Sy(e){var t=v(this,Np)[Np],i=v(this,Gp)[Gp],r=i.gl,n=[],o=[],s=[],a=[],c=[],l=[],h=[],u=[],d=[],f=[],p=[],y=[],m=[],g=[],b=[],w=[];i.reset(),i.withSAO=!1,i.pbrEnabled=v(this,Kp)[Kp]&&!!t.qualityRender,r.viewport(0,0,r.drawingBufferWidth,r.drawingBufferHeight),v(this,Vp)[Vp]?r.clearColor(0,0,0,0):r.clearColor(v(this,zp)[zp][0],v(this,zp)[zp][1],v(this,zp)[zp][2],1),r.enable(r.DEPTH_TEST),r.frontFace(r.CCW),r.enable(r.CULL_FACE),r.depthMask(!0),r.lineWidth(1),i.lineWidth=1;var P=t.sao.possible;v(this,Yp)[Yp]&&P||(i.occlusionTexture=null),!1!==e.clear&&r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT);for(var E=0,T=0,_=0,I=0,x=0,S=0,M=0,O=0,R=0,j=0,D=0,A=0,C=0,B=0,k=0,L=0,F=0,U=v(this,Zp)[Zp].length;F<U;F++){var N=v(this,Zp)[Zp][F],G=N.meshCounts;G.numCulled!==G.numMeshes&&0!==G.numVisible&&(G.numTransparent<G.numMeshes&&(v(this,Yp)[Yp]&&P&&N.rendererModel.qualityRender?n[E++]=N:v(this,my)[my](N,$h.COLOR_OPAQUE,N.rendererModel.qualityRender)),v(this,Hp)[Hp]&&G.numTransparent&&(s[_++]=N),G.numXRayed>0&&t.xrayMaterial.fill&&(t.xrayMaterial.fillAlpha<1?h[M++]=N:c[x++]=N),G.numHighlighted>0&&t.highlightMaterial.fill&&(t.highlightMaterial.fillAlpha<1?p[D++]=N:d[R++]=N),G.numSelected>0&&t.selectedMaterial.fill&&(t.selectedMaterial.fillAlpha<1?b[k++]=N:m[C++]=N),v(this,Xp)[Xp]&&v(this,Np)[Np].edgeMaterial.edges&&G.numEdges>0&&(G.numTransparent<G.numMeshes&&(o[T++]=N),G.numTransparent>0&&(a[I++]=N),t.selectedMaterial.edgeAlpha<1?w[L++]=N:g[B++]=N,t.xrayMaterial.edgeAlpha<1?u[O++]=N:l[S++]=N,t.highlightMaterial.edgeAlpha<1?y[A++]=N:f[j++]=N))}E>0&&(i.withSAO=!0);for(var V=0;V<T;V++)v(this,my)[my](o[V],$h.EDGES_COLOR_OPAQUE);for(var H=0;H<x;H++)v(this,my)[my](c[H],$h.SILHOUETTE_XRAYED);for(var X=0;X<S;X++)v(this,my)[my](l[X],$h.EDGES_XRAYED);if(M>0||O>0||_>0||I>0){r.enable(r.CULL_FACE),r.enable(r.BLEND),v(this,Vp)[Vp]?(r.blendEquation(r.FUNC_ADD),r.blendFuncSeparate(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA)):(r.blendEquation(r.FUNC_ADD),r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA)),i.backfaces=!1,v(this,ry)[ry]||r.depthMask(!1);for(var W=0;W<O;W++)v(this,my)[my](u[W],$h.EDGES_XRAYED);for(var Y=0;Y<M;Y++)v(this,my)[my](h[Y],$h.SILHOUETTE_XRAYED);(_>0||I>0)&&r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA);for(var K=0;K<I;K++)v(this,my)[my](a[K],$h.EDGES_COLOR_TRANSPARENT);for(var z=0;z<_;z++)v(this,my)[my](s[z],$h.COLOR_TRANSPARENT);r.disable(r.BLEND),v(this,ry)[ry]||r.depthMask(!0)}if(R>0||j>0){i.lastProgramId=-1,r.clear(r.DEPTH_BUFFER_BIT);for(var q=0;q<j;q++)v(this,my)[my](f[q],$h.EDGES_HIGHLIGHTED);for(var Z=0;Z<R;Z++)v(this,my)[my](d[Z],$h.SILHOUETTE_HIGHLIGHTED)}if(D>0||A>0||R>0){i.lastProgramId=-1,r.clear(r.DEPTH_BUFFER_BIT),r.enable(r.CULL_FACE),r.enable(r.BLEND),v(this,Vp)[Vp]?(r.blendEquation(r.FUNC_ADD),r.blendFuncSeparate(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA)):r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA);for(var Q=0;Q<A;Q++)v(this,my)[my](y[Q],$h.EDGES_HIGHLIGHTED);for(var J=0;J<D;J++)v(this,my)[my](p[J],$h.SILHOUETTE_HIGHLIGHTED);r.disable(r.BLEND)}if(C>0||B>0){i.lastProgramId=-1,r.clear(r.DEPTH_BUFFER_BIT);for(var $=0;$<B;$++)v(this,my)[my](g[$],$h.EDGES_SELECTED);for(var ee=0;ee<C;ee++)v(this,my)[my](m[ee],$h.SILHOUETTE_SELECTED)}if(k>0||L>0){i.lastProgramId=-1,r.clear(r.DEPTH_BUFFER_BIT),r.enable(r.CULL_FACE),r.enable(r.BLEND),v(this,Vp)[Vp]?(r.blendEquation(r.FUNC_ADD),r.blendFuncSeparate(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA)):r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA);for(var te=0;te<L;te++)v(this,my)[my](w[te],$h.EDGES_SELECTED);for(var ie=0;ie<k;ie++)v(this,my)[my](b[ie],$h.SILHOUETTE_SELECTED);r.disable(r.BLEND)}for(var re=qh.MAX_TEXTURE_UNITS,ne=0;ne<re;ne++)r.activeTexture(r.TEXTURE0+ne);r.bindTexture(r.TEXTURE_CUBE_MAP,null),r.bindTexture(r.TEXTURE_2D,null);for(var oe=qh.MAX_VERTEX_ATTRIBS,se=0;se<oe;se++)r.disableVertexAttribArray(se)}function My(e,t,i){switch(void 0===i&&(i=!0),e.renderState.primitive){case Ze:case Je:case Qe:switch(t){case $h.COLOR_OPAQUE:if(e.meshCounts.numTransparent===e.meshCounts.numMeshes||e.meshCounts.numXRayed===e.meshCounts.numMeshes)return;i||v(this,sy)[sy].colorTriangles.draw(e);break;case $h.COLOR_TRANSPARENT:if(0===e.meshCounts.numTransparent)return;i||v(this,sy)[sy].colorTriangles.draw(e)}}}var Oy={__proto__:null,WebGLRenderer:gy},Ry=Et(),jy=Et(),Dy=Pt(),Ay=Pt(),Cy=Pt(),By=Et(),ky=Et(),Ly=Et(),Fy=/*#__PURE__*/f("unproject"),Uy=/*#__PURE__*/function(){function e(e){Object.defineProperty(this,Fy,{value:Ny}),this.view=void 0,this.view=e.view}var t=e.prototype;return t.dollyToCanvasPos=function(e,t,i){var r=!1,n=this.view.camera;if(e&&(r=Nt(Ot(e,n.eye,Dy))<i),n.projectionType===tt){n.orthoProjection.scale=n.orthoProjection.scale-i;var o=It(Kt(Ot(v(this,Fy)[Fy](t,By),n.eye,Ly)),-i,[]);if(n.eye=[n.eye[0]-o[0],n.eye[1]-o[1],n.eye[2]-o[2]],n.look=[n.look[0]-o[0],n.look[1]-o[1],n.look[2]-o[2]],e){var s=Nt(Ot(e,n.eye,Dy)),a=It(Kt(Ot(n.look,n.eye,Ay)),s);n.look=[n.eye[0]+a[0],n.eye[1]+a[1],n.eye[2]+a[2]]}}else if(n.projectionType===it){var c=v(this,Fy)[Fy](t,By);n.orthoProjection.scale=n.orthoProjection.scale-i,n.orthoProjection.clean();var l=St(Ot(v(this,Fy)[Fy](t,ky),c,Ly),It(Kt(Ot(n.look,n.eye,Dy)),-i,Ay),Cy);n.eye=[n.eye[0]-l[0],n.eye[1]-l[1],n.eye[2]-l[2]],n.look=[n.look[0]-l[0],n.look[1]-l[1],n.look[2]-l[2]]}return r},t.destroy=function(){},e}();function Ny(e,t){var i=this.view.camera,r=i.project.transposedProjMatrix,n=r.subarray(8,12),o=r.subarray(12),s=[0,0,-1,1],a=At(s,n)/At(s,o);return i.project.unproject(e,a,Ry,jy,t),t}var Gy=Pt(),Vy=Pt(),Hy=Pt(),Xy=Et(),Wy=Et(),Yy=Et(),Ky=/*#__PURE__*/f("view"),zy=/*#__PURE__*/f("configs"),qy=/*#__PURE__*/f("pivotWorldPos"),Zy=/*#__PURE__*/f("cameraOffset"),Qy=/*#__PURE__*/f("azimuth"),Jy=/*#__PURE__*/f("polar"),$y=/*#__PURE__*/f("radius"),em=/*#__PURE__*/f("pivotPosSet"),tm=/*#__PURE__*/f("pivoting"),im=/*#__PURE__*/f("shown"),rm=/*#__PURE__*/f("pivotViewPos"),nm=/*#__PURE__*/f("pivotProjPos"),om=/*#__PURE__*/f("pivotCanvasPos"),sm=/*#__PURE__*/f("cameraDirty"),am=/*#__PURE__*/f("onViewMatrix"),cm=/*#__PURE__*/f("onProjMatrix"),lm=/*#__PURE__*/f("onTick"),hm=/*#__PURE__*/f("hideTimeout"),um=/*#__PURE__*/f("pivotElement"),dm=/*#__PURE__*/f("cameraLookingDownwards"),fm=/*#__PURE__*/function(){function e(e,t){var i=this;Object.defineProperty(this,dm,{value:vm}),Object.defineProperty(this,Ky,{writable:!0,value:void 0}),Object.defineProperty(this,zy,{writable:!0,value:void 0}),Object.defineProperty(this,qy,{writable:!0,value:void 0}),Object.defineProperty(this,Zy,{writable:!0,value:void 0}),Object.defineProperty(this,Qy,{writable:!0,value:void 0}),Object.defineProperty(this,Jy,{writable:!0,value:void 0}),Object.defineProperty(this,$y,{writable:!0,value:void 0}),Object.defineProperty(this,em,{writable:!0,value:void 0}),Object.defineProperty(this,tm,{writable:!0,value:void 0}),Object.defineProperty(this,im,{writable:!0,value:void 0}),Object.defineProperty(this,rm,{writable:!0,value:void 0}),Object.defineProperty(this,nm,{writable:!0,value:void 0}),Object.defineProperty(this,om,{writable:!0,value:void 0}),Object.defineProperty(this,sm,{writable:!0,value:void 0}),Object.defineProperty(this,am,{writable:!0,value:void 0}),Object.defineProperty(this,cm,{writable:!0,value:void 0}),Object.defineProperty(this,lm,{writable:!0,value:void 0}),Object.defineProperty(this,hm,{writable:!0,value:void 0}),Object.defineProperty(this,um,{writable:!0,value:void 0}),v(this,Ky)[Ky]=e.view,v(this,zy)[zy]=t,v(this,qy)[qy]=Pt(),v(this,Zy)[Zy]=Pt(),v(this,Qy)[Qy]=0,v(this,Jy)[Jy]=0,v(this,$y)[$y]=0,v(this,em)[em]=!1,v(this,tm)[tm]=!1,v(this,im)[im]=!1,v(this,rm)[rm]=Et(),v(this,nm)[nm]=Et(),v(this,rm)[rm]=wt(),v(this,sm)[sm]=!0,v(this,am)[am]=v(this,Ky)[Ky].camera.onViewMatrix.subscribe(function(){v(i,sm)[sm]=!0}),v(this,cm)[cm]=v(this,Ky)[Ky].camera.onProjMatrix.subscribe(function(){v(i,sm)[sm]=!0}),v(this,lm)[lm]=v(this,Ky)[Ky].viewer.onTick.subscribe(function(){i.updatePivotElement()})}var t=e.prototype;return t.updatePivotElement=function(){var e=v(this,Ky)[Ky].camera,t=v(this,Ky)[Ky].canvasElement;if(v(this,tm)[tm]&&v(this,sm)[sm]){fi(e.viewMatrix,this.getPivotPos(),v(this,rm)[rm]),v(this,rm)[rm][3]=1,vi(e.projMatrix,v(this,rm)[rm],v(this,nm)[nm]);var i=v(this,Ky)[Ky].boundary,r=i[2],n=i[3];v(this,rm)[rm][0]=Math.floor((1+v(this,nm)[nm][0]/v(this,nm)[nm][3])*r/2),v(this,rm)[rm][1]=Math.floor((1-v(this,nm)[nm][1]/v(this,nm)[nm][3])*n/2);var o=t.getBoundingClientRect();v(this,um)[um]&&(v(this,um)[um].style.left=Math.floor(o.left+v(this,rm)[rm][0])-v(this,um)[um].clientWidth/2+window.scrollX+"px",v(this,um)[um].style.top=Math.floor(o.top+v(this,rm)[rm][1])-v(this,um)[um].clientHeight/2+window.scrollY+"px"),v(this,sm)[sm]=!1}},t.setPivotElement=function(e){v(this,um)[um]=e},t.startPivot=function(){if(v(this,dm)[dm]())return v(this,tm)[tm]=!1,!1;var e=v(this,Ky)[Ky].camera,t=ai(e.eye,e.look,e.worldUp);fi(t,this.getPivotPos(),v(this,Zy)[Zy]);var i=this.getPivotPos();v(this,Zy)[Zy][2]+=Vt(e.eye,i);var r=yi(t=ci(t),v(this,Zy)[Zy]),n=Pt();if(Ot(e.eye,i,n),St(n,r),e.zUp){var o=n[1];n[1]=n[2],n[2]=o}v(this,$y)[$y]=Nt(n),v(this,Jy)[Jy]=Math.acos(n[1]/v(this,$y)[$y]),v(this,Qy)[Qy]=Math.atan2(n[0],n[2]),v(this,tm)[tm]=!0},t.getPivoting=function(){return v(this,tm)[tm]},t.setPivotPos=function(e){v(this,qy)[qy].set(e),v(this,em)[em]=!0},t.setCanvasPivotPos=function(e){var t=v(this,Ky)[Ky].camera,i=Math.abs(Vt(Rr(v(this,Ky)[Ky].aabb),t.eye)),r=t.project.transposedProjMatrix,n=r.subarray(8,12),o=r.subarray(12),s=[0,0,-1,1],a=At(s,n)/At(s,o),c=Xy;t.project.unproject(e,a,Wy,Yy,c);var l=Kt(Ot(c,t.eye,Gy)),h=St(t.eye,It(l,i,Vy),Hy);this.setPivotPos(h)},t.getPivotPos=function(){return v(this,em)[em]?v(this,qy)[qy]:v(this,Ky)[Ky].camera.look},t.continuePivot=function(e,t){if(v(this,tm)[tm]&&(0!==e||0!==t)){var i=v(this,Ky)[Ky].camera,r=-e,n=-t;1===i.worldUp[2]&&(r=-r),v(this,Qy)[Qy]+=.01*-r,v(this,Jy)[Jy]+=.01*n,v(this,Jy)[Jy]=lt(v(this,Jy)[Jy],.001,Math.PI-.001);var o=[v(this,$y)[$y]*Math.sin(v(this,Jy)[Jy])*Math.sin(v(this,Qy)[Qy]),v(this,$y)[$y]*Math.cos(v(this,Jy)[Jy]),v(this,$y)[$y]*Math.sin(v(this,Jy)[Jy])*Math.cos(v(this,Qy)[Qy])];if(1===i.worldUp[2]){var s=o[1];o[1]=o[2],o[2]=s}var a=Nt(Ot(i.look,i.eye,Pt())),c=this.getPivotPos();St(o,c);var l=ai(o,c,i.worldUp),h=yi(l=ci(l),v(this,Zy)[Zy]);l[12]-=h[0],l[13]-=h[1],l[14]-=h[2];var u=[l[8],l[9],l[10]];i.eye=[l[12],l[13],l[14]],Ot(i.eye,It(u,a),i.look),i.up=[l[4],l[5],l[6]],this.showPivot()}},t.showPivot=function(){var e=this;v(this,im)[im]||(null!==v(this,hm)[hm]&&(window.clearTimeout(v(this,hm)[hm]),v(this,hm)[hm]=null),v(this,um)[um]&&(this.updatePivotElement(),v(this,um)[um].style.visibility="visible",v(this,im)[im]=!0,v(this,hm)[hm]=window.setTimeout(function(){e.hidePivot()},1e3)))},t.hidePivot=function(){v(this,im)[im]&&(null!==v(this,hm)[hm]&&(window.clearTimeout(v(this,hm)[hm]),v(this,hm)[hm]=null),v(this,um)[um]&&(v(this,um)[um].style.visibility="hidden"),v(this,im)[im]=!1)},t.endPivot=function(){v(this,tm)[tm]=!1},t.destroy=function(){v(this,Ky)[Ky].camera.onViewMatrix.unsubscribe(v(this,am)[am]),v(this,Ky)[Ky].camera.onProjMatrix.unsubscribe(v(this,cm)[cm]),v(this,Ky)[Ky].viewer.onTick.unsubscribe(v(this,lm)[lm])},e}();function vm(){var e=v(this,Ky)[Ky].camera;return Ft(Ct(Kt(Ot(e.look,e.eye,Gy)),e.worldUp,Vy))<=1e-4}var pm=/*#__PURE__*/f("view"),ym=/*#__PURE__*/f("cameraControl"),mm=/*#__PURE__*/f("config"),gm=/*#__PURE__*/f("lastPickedobjectId"),bm=/*#__PURE__*/f("needFireEvents"),wm=/*#__PURE__*/function(){function e(e,t){this.schedulePickEntity=void 0,this.schedulePickSurface=void 0,this.pickCursorPos=void 0,this.picked=void 0,this.pickedSurface=void 0,this.pickResult=void 0,Object.defineProperty(this,pm,{writable:!0,value:void 0}),Object.defineProperty(this,ym,{writable:!0,value:void 0}),Object.defineProperty(this,mm,{writable:!0,value:void 0}),Object.defineProperty(this,gm,{writable:!0,value:void 0}),Object.defineProperty(this,bm,{writable:!0,value:void 0}),v(this,pm)[pm]=e.view,v(this,ym)[ym]=e,v(this,pm)[pm].canvasElement.oncontextmenu=function(e){e.preventDefault()},v(this,mm)[mm]=t,this.schedulePickEntity=!1,this.schedulePickSurface=!1,this.pickCursorPos=wt(),this.picked=!1,this.pickedSurface=!1,this.pickResult=null,v(this,gm)[gm]=null,v(this,bm)[bm]=!1}var t=e.prototype;return t.update=function(){if(v(this,mm)[mm].pointerEnabled&&(this.schedulePickEntity||this.schedulePickSurface)){this.picked=!1,this.pickedSurface=!1,v(this,bm)[bm]=!1;var e=v(this,ym)[ym].onHoverSurface.count>0;if(this.schedulePickSurface&&this.pickResult&&this.pickResult.worldPos){var t=this.pickResult.canvasPos;if(t[0]===this.pickCursorPos[0]&&t[1]===this.pickCursorPos[1])return this.picked=!0,this.pickedSurface=!0,v(this,bm)[bm]=e,this.schedulePickEntity=!1,void(this.schedulePickSurface=!1)}if(this.schedulePickEntity&&this.pickResult){var i=this.pickResult.canvasPos;if(i[0]===this.pickCursorPos[0]&&i[1]===this.pickCursorPos[1])return this.picked=!0,this.pickedSurface=!1,v(this,bm)[bm]=!1,this.schedulePickEntity=!1,void(this.schedulePickSurface=!1)}this.schedulePickEntity=!1,this.schedulePickSurface=!1}},t.fireEvents=function(){if(v(this,bm)[bm]){if(this.picked&&this.pickResult&&this.pickResult.entity){var e=this.pickResult.entity.id;v(this,gm)[gm]!==e&&(void 0!==v(this,gm)[gm]&&null!==v(this,gm)[gm]&&v(this,ym)[ym].onHoverOut.dispatch(v(this,ym)[ym],{entity:v(this,pm)[pm].objects[v(this,gm)[gm]]}),v(this,ym)[ym].onHoverOut.dispatch(v(this,ym)[ym],this.pickResult),v(this,gm)[gm]=e),v(this,ym)[ym].onHover.dispatch(v(this,ym)[ym],this.pickResult),this.pickResult.worldPos&&(this.pickedSurface=!0,v(this,ym)[ym].onHoverSurface.dispatch(v(this,ym)[ym],this.pickResult))}else void 0!==v(this,gm)[gm]&&null!==v(this,gm)[gm]&&(v(this,ym)[ym].onHoverOut.dispatch(v(this,ym)[ym],{entity:v(this,pm)[pm].objects[v(this,gm)[gm]]}),v(this,gm)[gm]=void 0),v(this,ym)[ym].onHoverOff.dispatch(v(this,ym)[ym],{canvasPos:this.pickCursorPos});this.pickResult=null,v(this,bm)[bm]=!1}},t.destroy=function(){},e}(),Pm=wt(),Em=/*#__PURE__*/f("view"),Tm=/*#__PURE__*/f("documentKeyDownHandler"),_m=/*#__PURE__*/f("documentKeyUpHandler"),Im=/*#__PURE__*/f("mouseDownHandler"),xm=/*#__PURE__*/f("documentMouseMoveHandler"),Sm=/*#__PURE__*/f("canvasMouseMoveHandler"),Mm=/*#__PURE__*/f("documentMouseUpHandler"),Om=/*#__PURE__*/f("mouseUpHandler"),Rm=/*#__PURE__*/f("mouseEnterHandler"),jm=/*#__PURE__*/f("mouseWheelHandler"),Dm=/*#__PURE__*/function(){function e(e,t,i,r,n){var o=this;Object.defineProperty(this,Em,{writable:!0,value:void 0}),Object.defineProperty(this,Tm,{writable:!0,value:void 0}),Object.defineProperty(this,_m,{writable:!0,value:void 0}),Object.defineProperty(this,Im,{writable:!0,value:void 0}),Object.defineProperty(this,xm,{writable:!0,value:void 0}),Object.defineProperty(this,Sm,{writable:!0,value:void 0}),Object.defineProperty(this,Mm,{writable:!0,value:void 0}),Object.defineProperty(this,Om,{writable:!0,value:void 0}),Object.defineProperty(this,Rm,{writable:!0,value:void 0}),Object.defineProperty(this,jm,{writable:!0,value:void 0}),v(this,Em)[Em]=e.view;var s,a,c,l=t.pickController,h=0,u=0,d=0,f=0,p=!1,y=new Float64Array(3),m=!0,g=v(this,Em)[Em].canvasElement,b=[];function w(e){void 0===e&&(e=!0),g.style.cursor="move",h=r.pointerViewPos[0],u=r.pointerViewPos[1],d=r.pointerViewPos[0],f=r.pointerViewPos[1],e&&(l.pickCursorPos=r.pointerViewPos,l.schedulePickSurface=!0,l.update(),l.picked&&l.pickedSurface&&l.pickResult&&l.pickResult.worldPos?(p=!0,y.set(l.pickResult.worldPos)):p=!1)}document.addEventListener("keydown",v(this,Tm)[Tm]=function(e){i.active&&i.pointerEnabled&&i.keyboardEnabled&&(b[e.keyCode]=!0)}),document.addEventListener("keyup",v(this,_m)[_m]=function(e){i.active&&i.pointerEnabled&&i.keyboardEnabled&&(b[e.keyCode]=!1)}),g.addEventListener("mousedown",v(this,Im)[Im]=function(e){if(i.active&&i.pointerEnabled)switch(e.which){case 1:b[16]||i.planView?(s=!0,w()):(s=!0,w(!1));break;case 2:a=!0,w();break;case 3:c=!0,i.panRightClick&&w()}}),document.addEventListener("mousemove",v(this,xm)[xm]=function(){if(i.active&&i.pointerEnabled&&(s||a||c)){var e=v(o,Em)[Em].boundary,t=e[0],l=e[1],d=r.pointerViewPos[0],f=r.pointerViewPos[1];if(b[16]||i.planView||!i.panRightClick&&a||i.panRightClick&&c){var m=d-h,g=f-u,w=v(o,Em)[Em].camera;if(w.projectionType===tt){var P=Math.abs(p?Nt(Ot(y,v(o,Em)[Em].camera.eye,[])):v(o,Em)[Em].camera.eyeLookDist)*Math.tan(w.perspectiveProjection.fov/2*Math.PI/180);n.panDeltaX+=1.5*m*P/l,n.panDeltaY+=1.5*g*P/l}else n.panDeltaX+=.5*w.orthoProjection.scale*(m/l),n.panDeltaY+=.5*w.orthoProjection.scale*(g/l)}else!s||a||c||i.planView||(i.firstPerson?(n.rotateDeltaY-=(d-h)/t*i.dragRotationRate/2,n.rotateDeltaX+=(f-u)/l*(i.dragRotationRate/4)):(n.rotateDeltaY-=(d-h)/t*(1.5*i.dragRotationRate),n.rotateDeltaX+=(f-u)/l*(1.5*i.dragRotationRate)));h=d,u=f}}),g.addEventListener("mousemove",v(this,Sm)[Sm]=function(e){i.active&&i.pointerEnabled&&r.mouseover&&(m=!0)}),document.addEventListener("mouseup",v(this,Mm)[Mm]=function(e){if(i.active&&i.pointerEnabled)switch(e.which){case 1:case 2:case 3:s=!1,a=!1,c=!1}}),g.addEventListener("mouseup",v(this,Om)[Om]=function(e){if(i.active&&i.pointerEnabled){if(3===e.which){Am(e,Pm);var r=Pm[1];Math.abs(Pm[0]-d)<3&&Math.abs(r-f)<3&&t.cameraControl.events.fire("rightClick",{pagePos:[Math.round(e.pageX),Math.round(e.pageY)],canvasPos:Pm,event:e},!0)}g.style.removeProperty("cursor")}}),g.addEventListener("mouseenter",v(this,Rm)[Rm]=function(){});var P=1/60,E=null;g.addEventListener("wheel",v(this,jm)[jm]=function(e){if(i.active&&i.pointerEnabled){var t=performance.now()/1e3,o=null!==E?t-E:0;E=t,o>.05&&(o=.05),o<P&&(o=P);var s=Math.max(-1,Math.min(1,40*-e.deltaY));if(0!==s){var a=s/Math.abs(s);n.dollyDelta+=-a*o*i.mouseWheelDollyRate,m&&(r.followPointerDirty=!0,m=!1),e.preventDefault()}}})}var t=e.prototype;return t.reset=function(){},t.destroy=function(){var e=v(this,Em)[Em].canvasElement;document.removeEventListener("keydown",v(this,Tm)[Tm]),document.removeEventListener("keyup",v(this,_m)[_m]),e.removeEventListener("mousedown",v(this,Im)[Im]),document.removeEventListener("mousemove",v(this,xm)[xm]),e.removeEventListener("mousemove",v(this,Sm)[Sm]),document.removeEventListener("mouseup",v(this,Mm)[Mm]),e.removeEventListener("mouseup",v(this,Om)[Om]),e.removeEventListener("mouseenter",v(this,Rm)[Rm]),e.removeEventListener("wheel",v(this,jm)[jm])},e}(),Am=function(e,t){if(e){for(var i=e.target,r=0,n=0;i.offsetParent;)r+=i.offsetLeft,n+=i.offsetTop,i=i.offsetParent;t[0]=e.pageX-r,t[1]=e.pageY-n}else e=window.event,t[0]=e.x,t[1]=e.y;return t},Cm=Pt(),Bm=Pt(),km=Pt(),Lm=Pt(),Fm=Pt(),Um={eye:new Float64Array(3),look:new Float64Array(3),up:new Float64Array(3),orthoScale:1},Nm=/*#__PURE__*/f("documentKeyDownHandler"),Gm=/*#__PURE__*/function(){function e(e,t,i,r,n){Object.defineProperty(this,Nm,{writable:!0,value:void 0});var o=e.view,s=e.camera,a=t.cameraControl;document.addEventListener("keydown",v(this,Nm)[Nm]=function(e){if(i.active&&i.pointerEnabled&&i.keyboardEnabled&&r.mouseover){var n=a._isKeyDownForAction(a.AXIS_VIEW_RIGHT),c=a._isKeyDownForAction(a.AXIS_VIEW_BACK),l=a._isKeyDownForAction(a.AXIS_VIEW_LEFT),h=a._isKeyDownForAction(a.AXIS_VIEW_FRONT),u=a._isKeyDownForAction(a.AXIS_VIEW_TOP),d=a._isKeyDownForAction(a.AXIS_VIEW_BOTTOM);if(n||c||l||h||u||d){var f=o.aabb,v=Mr(f);Rr(f,Cm);var p=Math.abs(v/Math.tan(t.cameraFlight.fitFOV*ct));Um.orthoScale=1.1*v,n?(Um.eye.set(St(Cm,It(s.worldRight,p,Bm),Fm)),Um.look.set(Cm),Um.up.set(s.worldUp)):c?(Um.eye.set(St(Cm,It(s.worldForward,p,Bm),Fm)),Um.look.set(Cm),Um.up.set(s.worldUp)):l?(Um.eye.set(St(Cm,It(s.worldRight,-p,Bm),Fm)),Um.look.set(Cm),Um.up.set(s.worldUp)):h?(Um.eye.set(St(Cm,It(s.worldForward,-p,Bm),Fm)),Um.look.set(Cm),Um.up.set(s.worldUp)):u?(Um.eye.set(St(Cm,It(s.worldUp,p,Bm),Fm)),Um.look.set(Cm),Um.up.set(Kt(It(s.worldForward,1,km),Lm))):d&&(Um.eye.set(St(Cm,It(s.worldUp,-p,Bm),Fm)),Um.look.set(Cm),Um.up.set(Kt(It(s.worldForward,-1,km)))),!i.firstPerson&&i.followPointer&&t.pivotController.setPivotPos(Cm),t.cameraFlight.duration>0?t.cameraFlight.flyTo(Um,function(){t.pivotController.getPivoting()&&i.followPointer&&t.pivotController.showPivot()}):(t.cameraFlight.jumpTo(Um),t.pivotController.getPivoting()&&i.followPointer&&t.pivotController.showPivot())}}})}var t=e.prototype;return t.reset=function(){},t.destroy=function(){document.removeEventListener("keydown",v(this,Nm)[Nm])},e}(),Vm=/*#__PURE__*/f("view"),Hm=/*#__PURE__*/f("clicks"),Xm=/*#__PURE__*/f("timeout"),Wm=/*#__PURE__*/f("lastPickedobjectId"),Ym=/*#__PURE__*/f("canvasMouseMoveHandler"),Km=/*#__PURE__*/f("canvasMouseDownHandler"),zm=/*#__PURE__*/f("documentMouseUpHandler"),qm=/*#__PURE__*/f("canvasMouseUpHandler"),Zm=/*#__PURE__*/function(){function e(e,t,i,r,n){var o=this;Object.defineProperty(this,Vm,{writable:!0,value:void 0}),Object.defineProperty(this,Hm,{writable:!0,value:void 0}),Object.defineProperty(this,Xm,{writable:!0,value:void 0}),Object.defineProperty(this,Wm,{writable:!0,value:void 0}),Object.defineProperty(this,Ym,{writable:!0,value:void 0}),Object.defineProperty(this,Km,{writable:!0,value:void 0}),Object.defineProperty(this,zm,{writable:!0,value:void 0}),Object.defineProperty(this,qm,{writable:!0,value:void 0}),v(this,Vm)[Vm]=e.view;var s=t.pickController,a=t.pivotController,c=t.cameraControl;v(this,Hm)[Hm]=0,v(this,Xm)[Xm]=null,v(this,Wm)[Wm]=null;var l=!1,h=!1,u=v(this,Vm)[Vm].canvasElement,d=function(e){var i;e&&e.worldPos&&(i=e.worldPos);var r=e&&e.viewObject?e.viewObject.aabb:v(o,Vm)[Vm].aabb;if(i){var n=v(o,Vm)[Vm].camera;Ot(n.eye,n.look,[]),t.cameraFlight.flyTo({aabb:r})}else t.cameraFlight.flyTo({aabb:r})};u.addEventListener("mousemove",v(this,Ym)[Ym]=function(e){if(i.active&&i.pointerEnabled&&!l&&!h){var t=c.events.hasSubs("hover"),n=c.events.hasSubs("hoverOut"),a=c.events.hasSubs("hoverOff"),u=c.events.hasSubs("hoverSurface");if(t||n||a||u)if(s.pickCursorPos=r.pointerViewPos,s.schedulePickEntity=!0,s.schedulePickSurface=u,s.update(),s.pickResult){var d=s.pickResult.entity.id;v(o,Wm)[Wm]!==d&&(void 0!==v(o,Wm)[Wm]&&c.events.fire("hoverOut",{entity:v(o,Vm)[Vm].objects[v(o,Wm)[Wm]]},!0),c.events.fire("hoverEnter",s.pickResult,!0),v(o,Wm)[Wm]=d),c.events.fire("hover",s.pickResult,!0),s.pickResult.worldPos&&c.events.fire("hoverSurface",s.pickResult,!0)}else void 0!==v(o,Wm)[Wm]&&(c.events.fire("hoverOut",{entity:v(o,Vm)[Vm].objects[v(o,Wm)[Wm]]},!0),v(o,Wm)[Wm]=void 0),c.events.fire("hoverOff",{canvasPos:s.pickCursorPos},!0)}}),u.addEventListener("mousedown",v(this,Km)[Km]=function(e){if(1===e.which&&(l=!0),3===e.which&&(h=!0),1===e.which&&i.active&&i.pointerEnabled&&(r.mouseDownClientX=e.clientX,r.mouseDownClientY=e.clientY,r.mouseDownCursorX=r.pointerViewPos[0],r.mouseDownCursorY=r.pointerViewPos[1],!i.firstPerson&&i.followPointer&&(s.pickCursorPos=r.pointerViewPos,s.schedulePickSurface=!0,s.update(),1===e.which))){var t=s.pickResult;t&&t.worldPos?(a.setPivotPos(t.worldPos),a.startPivot()):(i.smartPivot?a.setViewPivotPos(r.pointerViewPos):a.setPivotPos(v(o,Vm)[Vm].camera.look),a.startPivot())}}),document.addEventListener("mouseup",v(this,zm)[zm]=function(e){1===e.which&&(l=!1),3===e.which&&(h=!1)}),u.addEventListener("mouseup",v(this,qm)[qm]=function(e){if(i.active&&i.pointerEnabled&&1===e.which&&(a.hidePivot(),!(Math.abs(e.clientX-r.mouseDownClientX)>3||Math.abs(e.clientY-r.mouseDownClientY)>3))){var n=c.events.hasSubs("picked"),l=c.events.hasSubs("pickedNothing"),h=c.events.hasSubs("pickedSurface"),u=c.events.hasSubs("doublePicked"),f=c.events.hasSubs("doublePickedSurface"),p=c.events.hasSubs("doublePickedNothing");if(!(i.doublePickFlyTo||u||f||p))return(n||l||h)&&(s.pickCursorPos=r.pointerViewPos,s.schedulePickEntity=!0,s.schedulePickSurface=h,s.update(),s.pickResult?(c.events.fire("picked",s.pickResult,!0),s.pickedSurface&&c.events.fire("pickedSurface",s.pickResult,!0)):c.events.fire("pickedNothing",{canvasPos:r.pointerViewPos},!0)),void(v(o,Hm)[Hm]=0);if(v(o,Hm)[Hm]++,1===v(o,Hm)[Hm])v(o,Xm)[Xm]=setTimeout(function(){s.pickCursorPos=r.pointerViewPos,s.schedulePickEntity=i.doublePickFlyTo,s.schedulePickSurface=h,s.update(),s.pickResult?(c.events.fire("picked",s.pickResult,!0),s.pickedSurface&&(c.events.fire("pickedSurface",s.pickResult,!0),!i.firstPerson&&i.followPointer&&(t.pivotController.setPivotPos(s.pickResult.worldPos),t.pivotController.startPivot()&&t.pivotController.showPivot()))):c.events.fire("pickedNothing",{canvasPos:r.pointerViewPos},!0),v(o,Hm)[Hm]=0},250);else{if(null!==v(o,Xm)[Xm]&&(window.clearTimeout(v(o,Xm)[Xm]),v(o,Xm)[Xm]=null),s.pickCursorPos=r.pointerViewPos,s.schedulePickEntity=i.doublePickFlyTo||u||f,s.schedulePickSurface=s.schedulePickEntity&&f,s.update(),s.pickResult){if(c.events.fire("doublePicked",s.pickResult,!0),s.pickedSurface&&c.onDoublePickedSurface.dispatch(s.pickResult,!0),i.doublePickFlyTo&&(d(s.pickResult),!i.firstPerson&&i.followPointer)){var y=Rr(s.pickResult.entity.aabb);t.pivotController.setPivotPos(y),t.pivotController.startPivot()&&t.pivotController.showPivot()}}else if(c.events.fire("doublePickedNothing",{canvasPos:r.pointerViewPos},!0),i.doublePickFlyTo&&(d(),!i.firstPerson&&i.followPointer)){var m=Rr(v(o,Vm)[Vm].aabb);t.pivotController.setPivotPos(m),t.pivotController.startPivot()&&t.pivotController.showPivot()}v(o,Hm)[Hm]=0}}},!1)}var t=e.prototype;return t.reset=function(){v(this,Hm)[Hm]=0,v(this,Wm)[Wm]=null,v(this,Xm)[Xm]&&(window.clearTimeout(v(this,Xm)[Xm]),v(this,Xm)[Xm]=null)},t.destroy=function(){var e=v(this,Vm)[Vm].canvasElement;e.removeEventListener("mousemove",v(this,Ym)[Ym]),e.removeEventListener("mousedown",v(this,Km)[Km]),document.removeEventListener("mouseup",v(this,zm)[zm]),e.removeEventListener("mouseup",v(this,qm)[qm]),v(this,Xm)[Xm]&&(window.clearTimeout(v(this,Xm)[Xm]),v(this,Xm)[Xm]=null)},e}(),Qm=/*#__PURE__*/f("view"),Jm=/*#__PURE__*/f("documentMouseMoveHandler"),$m=/*#__PURE__*/f("documentKeyDownHandler"),eg=/*#__PURE__*/f("documentKeyUpHandler"),tg=/*#__PURE__*/f("onTick"),ig=/*#__PURE__*/function(){function e(e,t,i,r,n){Object.defineProperty(this,Qm,{writable:!0,value:void 0}),Object.defineProperty(this,Jm,{writable:!0,value:void 0}),Object.defineProperty(this,$m,{writable:!0,value:void 0}),Object.defineProperty(this,eg,{writable:!0,value:void 0}),Object.defineProperty(this,tg,{writable:!0,value:void 0}),this.keycodes=void 0,v(this,Qm)[Qm]=e.view;var o=[],s=e.view.canvasElement,a=!0;document.addEventListener("mousemove",v(this,Jm)[Jm]=function(){a=!0}),document.addEventListener("keydown",v(this,$m)[$m]=function(e){if(i.active&&i.pointerEnabled&&i.keyboardEnabled&&r.mouseover){var t=e.keyCode;o[t]=!0,16===t&&(s.style.cursor="move")}}),document.addEventListener("keyup",v(this,eg)[eg]=function(e){if(i.active&&i.pointerEnabled&&i.keyboardEnabled&&r.mouseover){var t=e.keyCode;o[t]=!1,16===t&&(s.style.cursor=null)}}),v(this,tg)[tg]=e.view.viewer.events.on("tick",function(e){if(i.active&&i.pointerEnabled&&i.keyboardEnabled&&r.mouseover){var s=t.cameraControl,c=e.deltaTime/1e3;if(!i.planView){var l=s._isKeyDownForAction(s.ROTATE_Y_POS,o),h=s._isKeyDownForAction(s.ROTATE_Y_NEG,o),u=s._isKeyDownForAction(s.ROTATE_X_POS,o),d=s._isKeyDownForAction(s.ROTATE_X_NEG,o),f=c*i.keyboardRotationRate;(l||h||u||d)&&(!i.firstPerson&&i.followPointer&&t.pivotController.startPivot(),l?n.rotateDeltaY+=f:h&&(n.rotateDeltaY-=f),u?n.rotateDeltaX+=f:d&&(n.rotateDeltaX-=f),!i.firstPerson&&i.followPointer&&t.pivotController.startPivot())}if(!o[17]&&!o[18]){var v=s._isKeyDownForAction(s.DOLLY_BACKWARDS,o),p=s._isKeyDownForAction(s.DOLLY_FORWARDS,o);if(v||p){var y=c*i.keyboardDollyRate;!i.firstPerson&&i.followPointer&&t.pivotController.startPivot(),p?n.dollyDelta-=y:v&&(n.dollyDelta+=y),a&&(r.followPointerDirty=!0,a=!1)}}var m=s._isKeyDownForAction(s.PAN_FORWARDS,o),g=s._isKeyDownForAction(s.PAN_BACKWARDS,o),b=s._isKeyDownForAction(s.PAN_LEFT,o),w=s._isKeyDownForAction(s.PAN_RIGHT,o),P=s._isKeyDownForAction(s.PAN_UP,o),E=s._isKeyDownForAction(s.PAN_DOWN,o),T=(o[18]?.3:1)*c*i.keyboardPanRate;(m||g||b||w||P||E)&&(!i.firstPerson&&i.followPointer&&t.pivotController.startPivot(),E?n.panDeltaY+=T:P&&(n.panDeltaY+=-T),w?n.panDeltaX+=-T:b&&(n.panDeltaX+=T),g?n.panDeltaZ+=T:m&&(n.panDeltaZ+=-T))}})}var t=e.prototype;return t.reset=function(){},t.destroy=function(){v(this,Qm)[Qm].viewer.onTick.unsubscribe(v(this,tg)[tg]),document.removeEventListener("mousemove",v(this,Jm)[Jm]),document.removeEventListener("keydown",v(this,$m)[$m]),document.removeEventListener("keyup",v(this,eg)[eg])},e}(),rg=.001,ng=Pt(),og=/*#__PURE__*/f("onTick"),sg=/*#__PURE__*/f("view"),ag=/*#__PURE__*/function(){function e(e,t,i,r,n){Object.defineProperty(this,og,{writable:!0,value:void 0}),Object.defineProperty(this,sg,{writable:!0,value:void 0}),v(this,sg)[sg]=e;var o=e.camera,s=t.pickController,a=t.pivotController,c=t.panController,l=1,h=1,u=null;v(this,og)[og]=e.viewer.onTick.subscribe(function(){if(i.active&&i.pointerEnabled){var t="default";if(Math.abs(n.dollyDelta)<rg&&(n.dollyDelta=0),Math.abs(n.rotateDeltaX)<rg&&(n.rotateDeltaX=0),Math.abs(n.rotateDeltaY)<rg&&(n.rotateDeltaY=0),0===n.rotateDeltaX&&0===n.rotateDeltaY||(n.dollyDelta=0),i.followPointer&&--l<=0&&(l=1,0!==n.dollyDelta)){if(0===n.rotateDeltaY&&0===n.rotateDeltaX&&i.followPointer&&r.followPointerDirty&&(s.pickCursorPos=r.pointerViewPos,s.schedulePickSurface=!0,s.update(),s.pickResult&&s.pickResult.worldPos?u=s.pickResult.worldPos:(h=1,u=null),r.followPointerDirty=!1),u){var d=Math.abs(Nt(Ot(u,e.camera.eye,ng)));h=d/i.dollyProximityThreshold}h<i.dollyMinSpeed&&(h=i.dollyMinSpeed)}var f=n.dollyDelta*h;if(0===n.rotateDeltaY&&0===n.rotateDeltaX||(!i.firstPerson&&i.followPointer&&a.getPivoting()?(a.continuePivot(n.rotateDeltaY,n.rotateDeltaX),a.showPivot()):(0!==n.rotateDeltaX&&(i.firstPerson?o.pitch(-n.rotateDeltaX):o.orbitPitch(n.rotateDeltaX)),0!==n.rotateDeltaY&&(i.firstPerson?o.yaw(n.rotateDeltaY):o.orbitYaw(n.rotateDeltaY))),n.rotateDeltaX*=i.rotationInertia,n.rotateDeltaY*=i.rotationInertia,t="grabbing"),Math.abs(n.panDeltaX)<rg&&(n.panDeltaX=0),Math.abs(n.panDeltaY)<rg&&(n.panDeltaY=0),Math.abs(n.panDeltaZ)<rg&&(n.panDeltaZ=0),0!==n.panDeltaX||0!==n.panDeltaY||0!==n.panDeltaZ){var v,p,y=Pt();if(y[0]=n.panDeltaX,y[1]=n.panDeltaY,y[2]=n.panDeltaZ,i.constrainVertical){o.xUp?(v=o.eye[0],p=o.look[0]):o.yUp?(v=o.eye[1],p=o.look[1]):o.zUp&&(v=o.eye[2],p=o.look[2]),o.pan(y);var m=o.eye,g=o.look;o.xUp?(m[0]=v,g[0]=p):o.yUp?(m[1]=v,g[1]=p):o.zUp&&(m[2]=v,g[2]=p),o.eye=m,o.look=g}else o.pan(y);t="grabbing"}if(n.panDeltaX*=i.panInertia,n.panDeltaY*=i.panInertia,n.panDeltaZ*=i.panInertia,0!==f){var b,w;if(t=f<0?"zoom-in":"zoom-out",i.firstPerson){if(i.constrainVertical&&(o.xUp?(b=o.eye[0],w=o.look[0]):o.yUp?(b=o.eye[1],w=o.look[1]):o.zUp&&(b=o.eye[2],w=o.look[2])),i.followPointer?c.dollyToViewPos(u,r.pointerViewPos,-f)&&(r.followPointerDirty=!0):(o.pan([0,0,f]),o.orthoProjection.scale=o.orthoProjection.scale-f),i.constrainVertical){var P=o.eye,E=o.look;o.xUp?(P[0]=b,E[0]=w):o.yUp?(P[1]=b,E[1]=w):o.zUp&&(P[2]=b,E[2]=w),o.eye=P,o.look=E}}else i.followPointer?c.dollyToViewPos(u,r.pointerViewPos,-f)&&(r.followPointerDirty=!0):(o.orthoProjection.scale=o.orthoProjection.scale+f,o.zoom(f));n.dollyDelta*=i.dollyInertia}s.fireEvents(),document.body.style.cursor=t}})}return e.prototype.destroy=function(){v(this,sg)[sg].viewer.onTick.unsubscribe(v(this,og)[og])},e}(),cg=/*#__PURE__*/f("view"),lg=/*#__PURE__*/f("mouseEnterHandler"),hg=/*#__PURE__*/f("mouseMoveHandler"),ug=/*#__PURE__*/f("mouseLeaveHandler"),dg=/*#__PURE__*/f("mouseDownHandler"),fg=/*#__PURE__*/f("mouseUpHandler"),vg=/*#__PURE__*/function(){function e(e,t,i,r,n){Object.defineProperty(this,cg,{writable:!0,value:void 0}),Object.defineProperty(this,lg,{writable:!0,value:void 0}),Object.defineProperty(this,hg,{writable:!0,value:void 0}),Object.defineProperty(this,ug,{writable:!0,value:void 0}),Object.defineProperty(this,dg,{writable:!0,value:void 0}),Object.defineProperty(this,fg,{writable:!0,value:void 0}),v(this,cg)[cg]=e.view;var o=v(this,cg)[cg].canvasElement;o.addEventListener("mouseenter",v(this,lg)[lg]=function(){r.mouseover=!0}),o.addEventListener("mouseleave",v(this,ug)[ug]=function(){r.mouseover=!1,o.style.cursor=null}),document.addEventListener("mousemove",v(this,hg)[hg]=function(e){pg(e,o,r.pointerViewPos)}),o.addEventListener("mousedown",v(this,dg)[dg]=function(e){i.active&&i.pointerEnabled&&(pg(e,o,r.pointerViewPos),r.mouseover=!0)}),o.addEventListener("mouseup",v(this,fg)[fg]=function(e){})}var t=e.prototype;return t.reset=function(){},t.destroy=function(){var e=v(this,cg)[cg].canvasElement;document.removeEventListener("mousemove",v(this,hg)[hg]),e.removeEventListener("mouseenter",v(this,lg)[lg]),e.removeEventListener("mouseleave",v(this,ug)[ug]),e.removeEventListener("mousedown",v(this,dg)[dg]),e.removeEventListener("mouseup",v(this,fg)[fg])},e}();function pg(e,t,i){if(e){var r=t.getBoundingClientRect(),n=r.y;i[0]=e.clientX-r.x,i[1]=e.clientY-n}else e=window.event,i[0]=e.x,i[1]=e.y;return i}var yg=function(e,t){if(e){for(var i=e.target,r=0,n=0;i.offsetParent;)r+=i.offsetLeft,n+=i.offsetTop,i=i.offsetParent;t[0]=e.pageX-r,t[1]=e.pageY-n}else e=window.event,t[0]=e.x,t[1]=e.y;return t},mg=/*#__PURE__*/f("view"),gg=/*#__PURE__*/f("onTick"),bg=/*#__PURE__*/f("canvasTouchStartHandler"),wg=/*#__PURE__*/f("canvasTouchMoveHandler"),Pg=/*#__PURE__*/function(){function e(e,t,i,r,n){var o=this;Object.defineProperty(this,mg,{writable:!0,value:void 0}),Object.defineProperty(this,gg,{writable:!0,value:void 0}),Object.defineProperty(this,bg,{writable:!0,value:void 0}),Object.defineProperty(this,wg,{writable:!0,value:void 0}),v(this,mg)[mg]=e.view;var s=t.pickController,a=t.pivotController,c=wt(),l=wt(),h=wt(),u=wt(),d=[],f=v(this,mg)[mg].canvasElement,p=0,y=!1;v(this,gg)[gg]=v(this,mg)[mg].viewer.onTick.subscribe(function(){y=!1}),f.addEventListener("touchstart",v(this,bg)[bg]=function(e){if(i.active&&i.pointerEnabled){e.preventDefault();var t=e.touches,n=e.changedTouches;for(r.touchStartTime=Date.now(),1===t.length&&1===n.length&&(yg(t[0],c),i.followPointer&&(s.pickCursorPos=c,s.schedulePickSurface=!0,s.update(),i.planView||(s.picked&&s.pickedSurface&&s.pickResult&&s.pickResult.worldPos?(a.setPivotPos(s.pickResult.worldPos),!i.firstPerson&&a.startPivot()&&a.showPivot()):(i.smartPivot?a.setCanvasPivotPos(r.pointerCanvasPos):a.setPivotPos(v(o,mg)[mg].camera.look),!i.firstPerson&&a.startPivot()&&a.showPivot()))));d.length<t.length;)d.push(wt());for(var l=0,h=t.length;l<h;++l)yg(t[l],d[l]);p=t.length}}),f.addEventListener("touchmove",v(this,wg)[wg]=function(e){if(i.active&&i.pointerEnabled&&(e.stopPropagation(),e.preventDefault(),!y)){y=!0;var t=v(o,mg)[mg].boundary,a=t[0],c=t[1],f=e.touches;if(e.touches.length===p){if(1===p){yg(f[0],l),Rt(l,d[0],u);var m=u[0],g=u[1];if(null!==r.longTouchTimeout&&(Math.abs(m)>i.longTapRadius||Math.abs(g)>i.longTapRadius)&&(clearTimeout(r.longTouchTimeout),r.longTouchTimeout=null),i.planView){var b=v(o,mg)[mg].camera;if(b.projectionType===tt){var w=Math.abs(v(o,mg)[mg].camera.eyeLookDist)*Math.tan(b.perspectiveProjection.fov/2*Math.PI/180);n.panDeltaX+=m*w/c*i.touchPanRate,n.panDeltaY+=g*w/c*i.touchPanRate}else n.panDeltaX+=.5*b.orthoProjection.scale*(m/c)*i.touchPanRate,n.panDeltaY+=.5*b.orthoProjection.scale*(g/c)*i.touchPanRate}else n.rotateDeltaY-=m/a*(1*i.dragRotationRate),n.rotateDeltaX+=g/c*(1.5*i.dragRotationRate)}else if(2===p){var P=f[0],E=f[1];yg(P,l),yg(E,h);var T=jt(d[0],d[1]),_=jt(l,h),I=wt();Rt(T,_,I);var x=I[0],S=I[1],M=v(o,mg)[mg].camera,O=Wt([P.pageX,P.pageY],[E.pageX,E.pageY]),R=(Wt(d[0],d[1])-O)*i.touchDollyRate;if(n.dollyDelta=R,Math.abs(R)<1)if(M.projectionType===tt){var j=s.pickResult?s.pickResult.worldPos:Rr(v(o,mg)[mg].aabb),D=Math.abs(Nt(Ot(j,v(o,mg)[mg].camera.eye,[])))*Math.tan(M.perspectiveProjection.fov/2*Math.PI/180);n.panDeltaX-=x*D/c*i.touchPanRate,n.panDeltaY-=S*D/c*i.touchPanRate}else n.panDeltaX-=.5*M.orthoProjection.scale*(x/c)*i.touchPanRate,n.panDeltaY-=.5*M.orthoProjection.scale*(S/c)*i.touchPanRate;r.pointerCanvasPos=_}for(var A=0;A<p;++A)yg(f[A],d[A])}}})}var t=e.prototype;return t.reset=function(){},t.destroy=function(){var e=v(this,mg)[mg].canvasElement;e.removeEventListener("touchstart",v(this,bg)[bg]),e.removeEventListener("touchmove",v(this,wg)[wg]),v(this,mg)[mg].viewer.onTick.unsubscribe(v(this,gg)[gg])},e}(),Eg=/*#__PURE__*/f("view"),Tg=/*#__PURE__*/function(){function e(e,t,i,r,n){var o=this;Object.defineProperty(this,Eg,{writable:!0,value:void 0}),this._canvasTouchStartHandler=void 0,this._canvasTouchEndHandler=void 0,v(this,Eg)[Eg]=e.view;var s,a=t.pickController,c=t.cameraControl,l=[],h=new Float32Array(2),u=-1,d=-1,f=v(this,Eg)[Eg].canvas.canvas,p=function(e){var i;e&&e.worldPos&&(i=e.worldPos);var r=e&&e.viewObject?e.viewObject.aabb:v(o,Eg)[Eg].viewer.aabb;if(i){var n=v(o,Eg)[Eg].camera;Ot(n.eye,n.look,[]),t.cameraFlight.flyTo({aabb:r})}else t.cameraFlight.flyTo({aabb:r})};f.addEventListener("touchstart",this._canvasTouchStartHandler=function(e){if(i.active&&i.pointerEnabled){null!==r.longTouchTimeout&&(clearTimeout(r.longTouchTimeout),r.longTouchTimeout=null);var n=e.touches,o=e.changedTouches;if(s=Date.now(),1===n.length&&1===o.length){u=s,h[0]=n[0].pageX,h[1]=n[0].pageY;var a=n[0].clientX,d=n[0].clientY,f=n[0].pageX,v=n[0].pageY;r.longTouchTimeout=setTimeout(function(){t.cameraControl.onRightClick.dispatch(c,{pagePos:[Math.round(f),Math.round(v)],canvasPos:[Math.round(a),Math.round(d)],event:e}),r.longTouchTimeout=null},i.longTapTimeout)}else u=-1;for(;l.length<n.length;)l.push(new Float32Array(2));for(var p=0,y=n.length;p<y;++p)l[p][0]=n[p].pageX,l[p][1]=n[p].pageY;l.length=n.length}},{passive:!0}),f.addEventListener("touchend",this._canvasTouchEndHandler=function(e){if(i.active&&i.pointerEnabled){var t=Date.now(),n=e.touches,o=e.changedTouches,s=c.events.hasSubs("pickedSurface");null!==r.longTouchTimeout&&(clearTimeout(r.longTouchTimeout),r.longTouchTimeout=null),0===n.length&&1===o.length&&u>-1&&t-u<150&&(d>-1&&u-d<325?(a.pickCursorPos[0]=Math.round(o[0].clientX),a.pickCursorPos[1]=Math.round(o[0].clientY),a.schedulePickEntity=!0,a.schedulePickSurface=s,a.update(),a.pickResult?(c.onDoublePickedSurface.dispatch(c,a.pickResult),a.pickedSurface&&c.onPickedSurface.dispatch(c,a.pickResult),i.doublePickFlyTo&&p(a.pickResult)):(c.onDoublePickedNothing.dispatch(c,null),i.doublePickFlyTo&&p()),d=-1):Wt(l[0],h)<4&&(a.pickCursorPos[0]=Math.round(o[0].clientX),a.pickCursorPos[1]=Math.round(o[0].clientY),a.schedulePickEntity=!0,a.schedulePickSurface=s,a.update(),a.pickResult?(c.onPicked.dispatch(c,a.pickResult),a.pickedSurface&&c.onPickedSurface.dispatch(c,a.pickResult)):c.onPickedNothing.dispatch(c),d=t),u=-1),l.length=n.length;for(var f=0,v=n.length;f<v;++f)l[f][0]=n[f].pageX,l[f][1]=n[f].pageY;e.stopPropagation()}},{passive:!0})}var t=e.prototype;return t.reset=function(){},t.destroy=function(){var e=v(this,Eg)[Eg].canvas.canvas;e.removeEventListener("touchstart",this._canvasTouchStartHandler),e.removeEventListener("touchend",this._canvasTouchEndHandler)},e}(),_g=/*#__PURE__*/f("components"),Ig=/*#__PURE__*/f("configs"),xg=/*#__PURE__*/f("states"),Sg=/*#__PURE__*/f("updates"),Mg=/*#__PURE__*/f("controllers"),Og=/*#__PURE__*/f("handlers"),Rg=/*#__PURE__*/f("cameraUpdater"),jg=/*#__PURE__*/f("reset"),Dg=/*#__PURE__*/f("destroyHandlers"),Ag=/*#__PURE__*/f("destroyControllers"),Cg=/*#__PURE__*/function(e){function t(t,i){var r;return r=e.call(this,t,i)||this,Object.defineProperty(l(r),Ag,{value:Lg}),Object.defineProperty(l(r),Dg,{value:kg}),Object.defineProperty(l(r),jg,{value:Bg}),r.view=void 0,r.canvasElement=void 0,r.camera=void 0,Object.defineProperty(l(r),_g,{writable:!0,value:void 0}),Object.defineProperty(l(r),Ig,{writable:!0,value:void 0}),Object.defineProperty(l(r),xg,{writable:!0,value:void 0}),Object.defineProperty(l(r),Sg,{writable:!0,value:void 0}),Object.defineProperty(l(r),Mg,{writable:!0,value:void 0}),Object.defineProperty(l(r),Og,{writable:!0,value:void 0}),Object.defineProperty(l(r),Rg,{writable:!0,value:void 0}),r.onRightClick=void 0,r.onHover=void 0,r.onHoverSurface=void 0,r.onHoverOff=void 0,r.onHoverEnter=void 0,r.onHoverOut=void 0,r.onPicked=void 0,r.onPickedSurface=void 0,r.onPickedNothing=void 0,r.onDoublePickedSurface=void 0,r.onDoublePickedNothing=void 0,r.view=t,r.camera=t.camera,t.canvasElement.oncontextmenu=function(e){e.preventDefault()},v(l(r),_g)[_g]={view:t,camera:r.camera},v(l(r),Ig)[Ig]={longTapTimeout:600,longTapRadius:5,active:!0,keyboardLayout:"qwerty",navMode:"orbit",planView:!1,firstPerson:!1,followPointer:!0,doublePickFlyTo:!0,panRightClick:!0,showPivot:!1,pointerEnabled:!0,constrainVertical:!1,smartPivot:!1,dragRotationRate:360,keyboardRotationRate:90,rotationInertia:0,keyboardPanRate:1,touchPanRate:1,panInertia:.5,keyboardDollyRate:10,mouseWheelDollyRate:100,touchDollyRate:.2,dollyInertia:0,dollyProximityThreshold:30,dollyMinSpeed:.04,keyboardEnabled:!0,keyMap:{}},v(l(r),xg)[xg]={pointerCanvasPos:wt(),mouseover:!1,followPointerDirty:!0,mouseDownClientX:0,mouseDownClientY:0,mouseDownCursorX:0,mouseDownCursorY:0,touchStartTime:null,activeTouches:[],tapStartPos:wt(),tapStartTime:-1,lastTapTime:-1,longTouchTimeout:null,altDown:!1,ctrlDown:!1,keyDown:[],shiftDown:!1},v(l(r),Sg)[Sg]={rotateDeltaX:0,rotateDeltaY:0,panDeltaX:0,panDeltaY:0,panDeltaZ:0,dollyDelta:0},v(l(r),Mg)[Mg]={cameraControl:l(r),pickController:new wm(l(r),v(l(r),Ig)[Ig]),pivotController:new fm(l(r),v(l(r),Ig)[Ig]),panController:new Uy(l(r)),cameraFlight:new sl(r.view,{duration:.5})},v(l(r),Og)[Og]=[new vg(v(l(r),_g)[_g],v(l(r),Mg)[Mg],v(l(r),Ig)[Ig],v(l(r),xg)[xg],v(l(r),Sg)[Sg]),new Pg(v(l(r),_g)[_g],v(l(r),Mg)[Mg],v(l(r),Ig)[Ig],v(l(r),xg)[xg],v(l(r),Sg)[Sg]),new Dm(v(l(r),_g)[_g],v(l(r),Mg)[Mg],v(l(r),Ig)[Ig],v(l(r),xg)[xg],v(l(r),Sg)[Sg]),new Gm(v(l(r),_g)[_g],v(l(r),Mg)[Mg],v(l(r),Ig)[Ig],v(l(r),xg)[xg],v(l(r),Sg)[Sg]),new Zm(v(l(r),_g)[_g],v(l(r),Mg)[Mg],v(l(r),Ig)[Ig],v(l(r),xg)[xg],v(l(r),Sg)[Sg]),new Tg(v(l(r),_g)[_g],v(l(r),Mg)[Mg],v(l(r),Ig)[Ig],v(l(r),xg)[xg],v(l(r),Sg)[Sg]),new ig(v(l(r),_g)[_g],v(l(r),Mg)[Mg],v(l(r),Ig)[Ig],v(l(r),xg)[xg],v(l(r),Sg)[Sg])],v(l(r),Rg)[Rg]=new ag(l(r),v(l(r),Mg)[Mg],v(l(r),Ig)[Ig],v(l(r),xg)[xg],v(l(r),Sg)[Sg]),r.onHover=new y(new ie.EventDispatcher),r.onHoverOff=new y(new ie.EventDispatcher),r.onHoverEnter=new y(new ie.EventDispatcher),r.onHoverOut=new y(new ie.EventDispatcher),r.navMode=i.navMode,r.constrainVertical=i.constrainVertical,r.keyMap=i.keyMap,r.doublePickFlyTo=i.doublePickFlyTo,r.panRightClick=i.panRightClick,r.active=i.active,r.followPointer=i.followPointer,r.rotationInertia=i.rotationInertia,r.keyboardPanRate=i.keyboardPanRate,r.touchPanRate=i.touchPanRate,r.keyboardRotationRate=i.keyboardRotationRate,r.dragRotationRate=i.dragRotationRate,r.touchDollyRate=i.touchDollyRate,r.dollyInertia=i.dollyInertia,r.dollyProximityThreshold=i.dollyProximityThreshold,r.dollyMinSpeed=i.dollyMinSpeed,r.panInertia=i.panInertia,r.pointerEnabled=!0,r.keyboardDollyRate=i.keyboardDollyRate,r.mouseWheelDollyRate=i.mouseWheelDollyRate,r.keyboardEnabled=i.keyboardEnabled,r}n(t,e);var i=t.prototype;return i._isKeyDownForAction=function(e,t){var i=v(this,Ig)[Ig].keyMap[e];if(!i)return!1;t||(t=v(this,xg)[xg].keyDown);for(var r=0,n=i.length;r<n;r++)if(t[i[r]])return!0;return!1},i.destroy=function(){v(this,Dg)[Dg](),v(this,Ag)[Ag](),v(this,Rg)[Rg].destroy(),this.onHover.clear(),this.onHoverOff.clear(),this.onHoverEnter.clear(),this.onHoverOut.clear(),e.prototype.destroy.call(this)},r(t,[{key:"keyMap",get:function(){return v(this,Ig)[Ig].keyMap},set:function(e){if(ir(e=e||"qwerty")){var i={};switch(e){default:this.error("Unsupported value for 'keyMap': "+e+" defaulting to 'qwerty'");case"qwerty":i[t.PAN_LEFT]=[65],i[t.PAN_RIGHT]=[68],i[t.PAN_UP]=[90],i[t.PAN_DOWN]=[88],i[t.PAN_BACKWARDS]=[],i[t.PAN_FORWARDS]=[],i[t.DOLLY_FORWARDS]=[87,107],i[t.DOLLY_BACKWARDS]=[83,109],i[t.ROTATE_X_POS]=[40],i[t.ROTATE_X_NEG]=[38],i[t.ROTATE_Y_POS]=[81,37],i[t.ROTATE_Y_NEG]=[69,39],i[t.AXIS_VIEW_RIGHT]=[49],i[t.AXIS_VIEW_BACK]=[50],i[t.AXIS_VIEW_LEFT]=[51],i[t.AXIS_VIEW_FRONT]=[52],i[t.AXIS_VIEW_TOP]=[53],i[t.AXIS_VIEW_BOTTOM]=[54];break;case"azerty":i[t.PAN_LEFT]=[81],i[t.PAN_RIGHT]=[68],i[t.PAN_UP]=[87],i[t.PAN_DOWN]=[88],i[t.PAN_BACKWARDS]=[],i[t.PAN_FORWARDS]=[],i[t.DOLLY_FORWARDS]=[90,107],i[t.DOLLY_BACKWARDS]=[83,109],i[t.ROTATE_X_POS]=[40],i[t.ROTATE_X_NEG]=[38],i[t.ROTATE_Y_POS]=[65,37],i[t.ROTATE_Y_NEG]=[69,39],i[t.AXIS_VIEW_RIGHT]=[49],i[t.AXIS_VIEW_BACK]=[50],i[t.AXIS_VIEW_LEFT]=[51],i[t.AXIS_VIEW_FRONT]=[52],i[t.AXIS_VIEW_TOP]=[53],i[t.AXIS_VIEW_BOTTOM]=[54]}v(this,Ig)[Ig].keyMap=i}else{var r=e;v(this,Ig)[Ig].keyMap=r}}},{key:"pivotElement",set:function(e){v(this,Mg)[Mg].pivotController.setPivotElement(e)}},{key:"active",get:function(){return v(this,Ig)[Ig].active},set:function(e){v(this,Ig)[Ig].active=!1!==e}},{key:"navMode",get:function(){return v(this,Ig)[Ig].navMode},set:function(e){"firstPerson"!==(e=e||"orbit")&&"orbit"!==e&&"planView"!==e&&(this.error("Unsupported value for navMode: "+e+" - supported values are 'orbit', 'firstPerson' and 'planView' - defaulting to 'orbit'"),e="orbit"),v(this,Ig)[Ig].firstPerson="firstPerson"===e,v(this,Ig)[Ig].planView="planView"===e,(v(this,Ig)[Ig].firstPerson||v(this,Ig)[Ig].planView)&&(v(this,Mg)[Mg].pivotController.hidePivot(),v(this,Mg)[Mg].pivotController.endPivot()),v(this,Ig)[Ig].navMode=e}},{key:"pointerEnabled",get:function(){return v(this,Ig)[Ig].pointerEnabled},set:function(e){v(this,jg)[jg](),v(this,Ig)[Ig].pointerEnabled=!!e}},{key:"followPointer",get:function(){return v(this,Ig)[Ig].followPointer},set:function(e){v(this,Ig)[Ig].followPointer=!1!==e}},{key:"pivotPos",get:function(){return v(this,Mg)[Mg].pivotController.getPivotPos()},set:function(e){v(this,Mg)[Mg].pivotController.setPivotPos(e)}},{key:"dollyToPointer",get:function(){return this.warn("dollyToPointer property is deprecated - replaced with followPointer"),this.followPointer},set:function(e){this.warn("dollyToPointer property is deprecated - replaced with followPointer"),this.followPointer=e}},{key:"panToPointer",get:function(){return this.warn("panToPointer property is deprecated - replaced with followPointer"),!1},set:function(e){this.warn("panToPointer property is deprecated - replaced with followPointer")}},{key:"planView",get:function(){return this.warn("planView property is deprecated - replaced with navMode"),v(this,Ig)[Ig].planView},set:function(e){v(this,Ig)[Ig].planView=!!e,v(this,Ig)[Ig].firstPerson=!1,v(this,Ig)[Ig].planView&&(v(this,Mg)[Mg].pivotController.hidePivot(),v(this,Mg)[Mg].pivotController.endPivot()),this.warn("planView property is deprecated - replaced with navMode")}},{key:"firstPerson",get:function(){return this.warn("firstPerson property is deprecated - replaced with navMode"),v(this,Ig)[Ig].firstPerson},set:function(e){this.warn("firstPerson property is deprecated - replaced with navMode"),v(this,Ig)[Ig].firstPerson=!!e,v(this,Ig)[Ig].planView=!1,v(this,Ig)[Ig].firstPerson&&(v(this,Mg)[Mg].pivotController.hidePivot(),v(this,Mg)[Mg].pivotController.endPivot())}},{key:"constrainVertical",get:function(){return v(this,Ig)[Ig].constrainVertical},set:function(e){v(this,Ig)[Ig].constrainVertical=!!e}},{key:"doublePickFlyTo",get:function(){return v(this,Ig)[Ig].doublePickFlyTo},set:function(e){v(this,Ig)[Ig].doublePickFlyTo=!1!==e}},{key:"panRightClick",get:function(){return v(this,Ig)[Ig].panRightClick},set:function(e){v(this,Ig)[Ig].panRightClick=!1!==e}},{key:"rotationInertia",get:function(){return v(this,Ig)[Ig].rotationInertia},set:function(e){v(this,Ig)[Ig].rotationInertia=null!=e?e:0}},{key:"touchPanRate",get:function(){return v(this,Ig)[Ig].touchPanRate},set:function(e){v(this,Ig)[Ig].touchPanRate=null!=e?e:1}},{key:"keyboardPanRate",get:function(){return v(this,Ig)[Ig].keyboardPanRate},set:function(e){v(this,Ig)[Ig].keyboardPanRate=null!=e?e:5}},{key:"keyboardRotationRate",get:function(){return v(this,Ig)[Ig].keyboardRotationRate},set:function(e){v(this,Ig)[Ig].keyboardRotationRate=null!=e?e:90}},{key:"dragRotationRate",get:function(){return v(this,Ig)[Ig].dragRotationRate},set:function(e){v(this,Ig)[Ig].dragRotationRate=null!=e?e:360}},{key:"keyboardDollyRate",get:function(){return v(this,Ig)[Ig].keyboardDollyRate},set:function(e){v(this,Ig)[Ig].keyboardDollyRate=null!=e?e:15}},{key:"touchDollyRate",get:function(){return v(this,Ig)[Ig].touchDollyRate},set:function(e){v(this,Ig)[Ig].touchDollyRate=null!=e?e:.2}},{key:"mouseWheelDollyRate",get:function(){return v(this,Ig)[Ig].mouseWheelDollyRate},set:function(e){v(this,Ig)[Ig].mouseWheelDollyRate=null!=e?e:100}},{key:"dollyInertia",get:function(){return v(this,Ig)[Ig].dollyInertia},set:function(e){v(this,Ig)[Ig].dollyInertia=null!=e?e:0}},{key:"dollyProximityThreshold",get:function(){return v(this,Ig)[Ig].dollyProximityThreshold},set:function(e){v(this,Ig)[Ig].dollyProximityThreshold=null!=e?e:35}},{key:"dollyMinSpeed",get:function(){return v(this,Ig)[Ig].dollyMinSpeed},set:function(e){v(this,Ig)[Ig].dollyMinSpeed=null!=e?e:.04}},{key:"panInertia",get:function(){return v(this,Ig)[Ig].panInertia},set:function(e){v(this,Ig)[Ig].panInertia=null!=e?e:.5}},{key:"keyboardLayout",get:function(){return v(this,Ig)[Ig].keyboardLayout},set:function(e){"qwerty"!==(e=e||"qwerty")&&"azerty"!==e&&(this.error("Unsupported value for keyboardLayout - defaulting to 'qwerty'"),e="qwerty"),v(this,Ig)[Ig].keyboardLayout=e,this.keyMap=v(this,Ig)[Ig].keyboardLayout}},{key:"smartPivot",get:function(){return v(this,Ig)[Ig].smartPivot},set:function(e){v(this,Ig)[Ig].smartPivot=!1!==e}},{key:"keyboardEnabled",get:function(){return v(this,Ig)[Ig].keyboardEnabled},set:function(e){v(this,Ig)[Ig].keyboardEnabled=!1!==e}}]),t}(ce);function Bg(){for(var e=0,t=v(this,Og)[Og].length;e<t;e++){var i=v(this,Og)[Og][e];i.reset&&i.reset()}v(this,Sg)[Sg].panDeltaX=0,v(this,Sg)[Sg].panDeltaY=0,v(this,Sg)[Sg].rotateDeltaX=0,v(this,Sg)[Sg].rotateDeltaY=0,v(this,Sg)[Sg].dollyDelta=0}function kg(){for(var e=0,t=v(this,Og)[Og].length;e<t;e++){var i=v(this,Og)[Og][e];i.destroy&&i.destroy()}}function Lg(){for(var e in v(this,Mg)[Mg]){var t=v(this,Mg)[Mg][e];t.destroy&&t.destroy()}}Cg.PAN_LEFT=0,Cg.PAN_RIGHT=1,Cg.PAN_UP=2,Cg.PAN_DOWN=3,Cg.PAN_FORWARDS=4,Cg.PAN_BACKWARDS=5,Cg.ROTATE_X_POS=6,Cg.ROTATE_X_NEG=7,Cg.ROTATE_Y_POS=8,Cg.ROTATE_Y_NEG=9,Cg.DOLLY_FORWARDS=10,Cg.DOLLY_BACKWARDS=11,Cg.AXIS_VIEW_RIGHT=12,Cg.AXIS_VIEW_BACK=13,Cg.AXIS_VIEW_LEFT=14,Cg.AXIS_VIEW_FRONT=15,Cg.AXIS_VIEW_TOP=16,Cg.AXIS_VIEW_BOTTOM=17;var Fg={__proto__:null,keycodes:{__proto__:null,KEY_BACKSPACE:8,KEY_TAB:9,KEY_ENTER:13,KEY_SHIFT:16,KEY_CTRL:17,KEY_ALT:18,KEY_PAUSE_BREAK:19,KEY_CAPS_LOCK:20,KEY_ESCAPE:27,KEY_PAGE_UP:33,KEY_PAGE_DOWN:34,KEY_END:35,KEY_HOME:36,KEY_LEFT_ARROW:37,KEY_UP_ARROW:38,KEY_RIGHT_ARROW:39,KEY_DOWN_ARROW:40,KEY_INSERT:45,KEY_DELETE:46,KEY_NUM_0:48,KEY_NUM_1:49,KEY_NUM_2:50,KEY_NUM_3:51,KEY_NUM_4:52,KEY_NUM_5:53,KEY_NUM_6:54,KEY_NUM_7:55,KEY_NUM_8:56,KEY_NUM_9:57,KEY_A:65,KEY_B:66,KEY_C:67,KEY_D:68,KEY_E:69,KEY_F:70,KEY_G:71,KEY_H:72,KEY_I:73,KEY_J:74,KEY_K:75,KEY_L:76,KEY_M:77,KEY_N:78,KEY_O:79,KEY_P:80,KEY_Q:81,KEY_R:82,KEY_S:83,KEY_T:84,KEY_U:85,KEY_V:86,KEY_W:87,KEY_X:88,KEY_Y:89,KEY_Z:90,KEY_LEFT_WINDOW:91,KEY_RIGHT_WINDOW:92,KEY_SELECT_KEY:93,KEY_NUMPAD_0:96,KEY_NUMPAD_1:97,KEY_NUMPAD_2:98,KEY_NUMPAD_3:99,KEY_NUMPAD_4:100,KEY_NUMPAD_5:101,KEY_NUMPAD_6:102,KEY_NUMPAD_7:103,KEY_NUMPAD_8:104,KEY_NUMPAD_9:105,KEY_MULTIPLY:106,KEY_ADD:107,KEY_SUBTRACT:109,KEY_DECIMAL_POINT:110,KEY_DIVIDE:111,KEY_F1:112,KEY_F2:113,KEY_F3:114,KEY_F4:115,KEY_F5:116,KEY_F6:117,KEY_F7:118,KEY_F8:119,KEY_F9:120,KEY_F10:121,KEY_F11:122,KEY_F12:123,KEY_NUM_LOCK:144,KEY_SCROLL_LOCK:145,KEY_SEMI_COLON:186,KEY_EQUAL_SIGN:187,KEY_COMMA:188,KEY_DASH:189,KEY_PERIOD:190,KEY_FORWARD_SLASH:191,KEY_GRAVE_ACCENT:192,KEY_OPEN_BRACKET:219,KEY_BACK_SLASH:220,KEY_CLOSE_BRACKET:221,KEY_SINGLE_QUOTE:222,KEY_SPACE:32},CameraControl:Cg};e.basictypes=Ko,e.bcf={__proto__:null,loadBCFViewpoint:function(e){},saveBCFViewpoint:function(e){return{}}},e.boundaries=Yr,e.cameracontrol=Fg,e.cityjson=Ns,e.cityjsontypes=Jo,e.compression=br,e.constants=ot,e.core=de,e.curves={__proto__:null,"tangentQuadraticBzier":function(e,t,i,r){return 2*(1-e)*(i-t)+2*e*(r-i)},"tangentQuadraticBzier3":function(e,t,i,r,n){return-3*t*(1-e)*(1-e)+3*i*(1-e)*(1-e)-6*e*i*(1-e)+6*e*r*(1-e)-3*e*e*r+3*e*e*n},tangentSpline:function(e){return 6*e*e-6*e+(3*e*e-4*e+1)+(-6*e*e+6*e)+(3*e*e-2*e)},catmullRomInterpolate:function(e,t,i,r,n){var o=.5*(i-e),s=.5*(r-t),a=n*n;return(2*t-2*i+o+s)*(n*a)+(-3*t+3*i-2*o-s)*a+o*n+t},b2p0:function(e,t){var i=1-e;return i*i*t},b2p1:function(e,t){return 2*(1-e)*e*t},b2p2:function(e,t){return e*e*t},b2:function(e,t,i,r){return this.b2p0(e,t)+this.b2p1(e,i)+this.b2p2(e,r)},b3p0:function(e,t){var i=1-e;return i*i*i*t},b3p1:function(e,t){var i=1-e;return 3*i*i*e*t},b3p2:function(e,t){return 3*(1-e)*e*e*t},b3p3:function(e,t){return e*e*e*t},b3:function(e,t,i,r,n){return this.b3p0(e,t)+this.b3p1(e,i)+this.b3p2(e,r)+this.b3p3(e,n)}},e.data=mn,e.dotbim=Gs,e.ifctypes={__proto__:null,IfcActionRequest:1e3,IfcActor:1001,IfcActorRole:1002,IfcActuator:1003,IfcActuatorType:1004,IfcAddress:1005,IfcAdvancedBrep:1006,IfcAdvancedBrepWithVoids:1007,IfcAdvancedFace:1008,IfcAirTerminal:1009,IfcAirTerminalBox:1010,IfcAirTerminalBoxType:1011,IfcAirTerminalType:1012,IfcAirToAirHeatRecovery:1013,IfcAirToAirHeatRecoveryType:1014,IfcAlarm:1015,IfcAlarmType:1016,IfcAnnotation:1017,IfcAnnotationFillArea:1018,IfcApplication:1019,IfcAppliedValue:1020,IfcApproval:1021,IfcApprovalRelationship:1022,IfcArbitraryClosedProfileDef:1023,IfcArbitraryOpenProfileDef:1024,IfcArbitraryProfileDefWithVoids:1025,IfcAsset:1026,IfcAsymmetricIShapeProfileDef:1027,IfcAudioVisualAppliance:1028,IfcAudioVisualApplianceType:1029,IfcAxis1Placement:1030,IfcAxis2Placement2D:1031,IfcAxis2Placement3D:1032,IfcBeam:1033,IfcBeamStandardCase:1034,IfcBeamType:1035,IfcBlobTexture:1036,IfcBlock:1037,IfcBoiler:1038,IfcBoilerType:1039,IfcBooleanClippingResult:1040,IfcBooleanResult:1041,IfcBoundaryCondition:1042,IfcBoundaryCurve:1043,IfcBoundaryEdgeCondition:1044,IfcBoundaryFaceCondition:1045,IfcBoundaryNodeCondition:1046,IfcBoundaryNodeConditionWarping:1047,IfcBoundedCurve:1048,IfcBoundedSurface:1049,IfcBoundingBox:1050,IfcBoxedHalfSpace:1051,IfcBSplineCurve:1052,IfcBSplineCurveWithKnots:1053,IfcBSplineSurface:1054,IfcBSplineSurfaceWithKnots:1055,IfcBuilding:1056,IfcBuildingElementPart:1057,IfcBuildingElementPartType:1058,IfcBuildingElementProxy:1059,IfcBuildingElementProxyType:1060,IfcBuildingStorey:1061,IfcBuildingSystem:1062,IfcBurner:1063,IfcBurnerType:1064,IfcCableCarrierFitting:1065,IfcCableCarrierFittingType:1066,IfcCableCarrierSegment:1067,IfcCableCarrierSegmentType:1068,IfcCableFitting:1069,IfcCableFittingType:1070,IfcCableSegment:1071,IfcCableSegmentType:1072,IfcCartesianPoint:1073,IfcCartesianPointList:1074,IfcCartesianPointList2D:1075,IfcCartesianPointList3D:1076,IfcCartesianTransformationOperator:1077,IfcCartesianTransformationOperator2D:1078,IfcCartesianTransformationOperator2DnonUniform:1079,IfcCartesianTransformationOperator3D:1080,IfcCartesianTransformationOperator3DnonUniform:1081,IfcCenterLineProfileDef:1082,IfcChiller:1083,IfcChillerType:1084,IfcChimney:1085,IfcChimneyType:1086,IfcCircle:1087,IfcCircleHollowProfileDef:1088,IfcCircleProfileDef:1089,IfcCivilElement:1090,IfcCivilElementType:1091,IfcClassification:1092,IfcClassificationReference:1093,IfcClosedShell:1094,IfcCoil:1095,IfcCoilType:1096,IfcColourRgb:1097,IfcColourRgbList:1098,IfcColourSpecification:1099,IfcColumn:1100,IfcColumnStandardCase:1101,IfcColumnType:1102,IfcCommunicationsAppliance:1103,IfcCommunicationsApplianceType:1104,IfcComplexProperty:1105,IfcComplexPropertyTemplate:1106,IfcCompositeCurve:1107,IfcCompositeCurveOnSurface:1108,IfcCompositeCurveSegment:1109,IfcCompositeProfileDef:1110,IfcCompressor:1111,IfcCompressorType:1112,IfcCondenser:1113,IfcCondenserType:1114,IfcConic:1115,IfcConnectedFaceSet:1116,IfcConnectionCurveGeometry:1117,IfcConnectionGeometry:1118,IfcConnectionPointEccentricity:1119,IfcConnectionPointGeometry:1120,IfcConnectionSurfaceGeometry:1121,IfcConnectionVolumeGeometry:1122,IfcConstraint:1123,IfcConstructionEquipmentResource:1124,IfcConstructionEquipmentResourceType:1125,IfcConstructionMaterialResource:1126,IfcConstructionMaterialResourceType:1127,IfcConstructionProductResource:1128,IfcConstructionProductResourceType:1129,IfcConstructionResource:1130,IfcConstructionResourceType:1131,IfcContext:1132,IfcContextDependentUnit:1133,IfcControl:1134,IfcController:1135,IfcControllerType:1136,IfcConversionBasedUnit:1137,IfcConversionBasedUnitWithOffset:1138,IfcCooledBeam:1139,IfcCooledBeamType:1140,IfcCoolingTower:1141,IfcCoolingTowerType:1142,IfcCoordinateOperation:1143,IfcCoordinateReferenceSystem:1144,IfcCostItem:1145,IfcCostSchedule:1146,IfcCostValue:1147,IfcCovering:1148,IfcCoveringType:1149,IfcCrewResource:1150,IfcCrewResourceType:1151,IfcCsgPrimitive3D:1152,IfcCsgSolid:1153,IfcCShapeProfileDef:1154,IfcCurrencyRelationship:1155,IfcCurtainWall:1156,IfcCurtainWallType:1157,IfcCurve:1158,IfcCurveBoundedPlane:1159,IfcCurveBoundedSurface:1160,IfcCurveStyle:1161,IfcCurveStyleFont:1162,IfcCurveStyleFontAndScaling:1163,IfcCurveStyleFontPattern:1164,IfcCylindricalSurface:1165,IfcDamper:1166,IfcDamperType:1167,IfcDerivedProfileDef:1168,IfcDerivedUnit:1169,IfcDerivedUnitElement:1170,IfcDimensionalExponents:1171,IfcDirection:1172,IfcDiscreteAccessory:1173,IfcDiscreteAccessoryType:1174,IfcDistributionChamberElement:1175,IfcDistributionChamberElementType:1176,IfcDistributionCircuit:1177,IfcDistributionControlElement:1178,IfcDistributionControlElementType:1179,IfcDistributionElement:1180,IfcDistributionElementType:1181,IfcDistributionFlowElement:1182,IfcDistributionFlowElementType:1183,IfcDistributionPort:1184,IfcDistributionSystem:1185,IfcDocumentInformation:1186,IfcDocumentInformationRelationship:1187,IfcDocumentReference:1188,IfcDoor:1189,IfcDoorLiningProperties:1190,IfcDoorPanelProperties:1191,IfcDoorStandardCase:1192,IfcDoorStyle:1193,IfcDoorType:1194,IfcDraughtingPreDefinedColour:1195,IfcDraughtingPreDefinedCurveFont:1196,IfcDuctFitting:1197,IfcDuctFittingType:1198,IfcDuctSegment:1199,IfcDuctSegmentType:1200,IfcDuctSilencer:1201,IfcDuctSilencerType:1202,IfcEdge:1203,IfcEdgeCurve:1204,IfcEdgeLoop:1205,IfcElectricAppliance:1206,IfcElectricApplianceType:1207,IfcElectricDistributionBoard:1208,IfcElectricDistributionBoardType:1209,IfcElectricFlowStorageDevice:1210,IfcElectricFlowStorageDeviceType:1211,IfcElectricGenerator:1212,IfcElectricGeneratorType:1213,IfcElectricMotor:1214,IfcElectricMotorType:1215,IfcElectricTimeControl:1216,IfcElectricTimeControlType:1217,IfcElement:1218,IfcElementarySurface:1219,IfcElementAssembly:1220,IfcElementAssemblyType:1221,IfcElementComponent:1222,IfcElementComponentType:1223,IfcElementQuantity:1224,IfcElementType:1225,IfcEllipse:1226,IfcEllipseProfileDef:1227,IfcEnergyConversionDevice:1228,IfcEnergyConversionDeviceType:1229,IfcEngine:1230,IfcEngineType:1231,IfcEvaporativeCooler:1232,IfcEvaporativeCoolerType:1233,IfcEvaporator:1234,IfcEvaporatorType:1235,IfcEvent:1236,IfcEventTime:1237,IfcEventType:1238,IfcExtendedProperties:1239,IfcExternalInformation:1240,IfcExternallyDefinedHatchStyle:1241,IfcExternallyDefinedSurfaceStyle:1242,IfcExternallyDefinedTextFont:1243,IfcExternalReference:1244,IfcExternalReferenceRelationship:1245,IfcExternalSpatialElement:1246,IfcExternalSpatialStructureElement:1247,IfcExtrudedAreaSolid:1248,IfcExtrudedAreaSolidTapered:1249,IfcFace:1250,IfcFaceBasedSurfaceModel:1251,IfcFaceBound:1252,IfcFaceOuterBound:1253,IfcFaceSurface:1254,IfcFacetedBrep:1255,IfcFacetedBrepWithVoids:1256,IfcFailureConnectionCondition:1257,IfcFan:1258,IfcFanType:1259,IfcFastener:1260,IfcFastenerType:1261,IfcFeatureElement:1262,IfcFeatureElementAddition:1263,IfcFeatureElementSubtraction:1264,IfcFillAreaStyle:1265,IfcFillAreaStyleHatching:1266,IfcFillAreaStyleTiles:1267,IfcFilter:1268,IfcFilterType:1269,IfcFireSuppressionTerminal:1270,IfcFireSuppressionTerminalType:1271,IfcFixedReferenceSweptAreaSolid:1272,IfcFlowController:1273,IfcFlowControllerType:1274,IfcFlowFitting:1275,IfcFlowFittingType:1276,IfcFlowInstrument:1277,IfcFlowInstrumentType:1278,IfcFlowMeter:1279,IfcFlowMeterType:1280,IfcFlowMovingDevice:1281,IfcFlowMovingDeviceType:1282,IfcFlowSegment:1283,IfcFlowSegmentType:1284,IfcFlowStorageDevice:1285,IfcFlowStorageDeviceType:1286,IfcFlowTerminal:1287,IfcFlowTerminalType:1288,IfcFlowTreatmentDevice:1289,IfcFlowTreatmentDeviceType:1290,IfcFooting:1291,IfcFootingType:1292,IfcFurnishingElement:1293,IfcFurnishingElementType:1294,IfcFurniture:1295,IfcFurnitureType:1296,IfcGeographicElement:1297,IfcGeographicElementType:1298,IfcGeometricCurveSet:1299,IfcGeometricRepresentationContext:1300,IfcGeometricRepresentationItem:1301,IfcGeometricRepresentationSubContext:1302,IfcGeometricSet:1303,IfcGrid:1304,IfcGridAxis:1305,IfcGridPlacement:1306,IfcGroup:1307,IfcHalfSpaceSolid:1308,IfcHeatExchanger:1309,IfcHeatExchangerType:1310,IfcHumidifier:1311,IfcHumidifierType:1312,IfcImageTexture:1313,IfcIndexedColourMap:1314,IfcIndexedPolyCurve:1315,IfcIndexedPolygonalFace:1316,IfcIndexedPolygonalFaceWithVoids:1317,IfcIndexedTextureMap:1318,IfcIndexedTriangleTextureMap:1319,IfcInterceptor:1320,IfcInterceptorType:1321,IfcIntersectionCurve:1322,IfcInventory:1323,IfcIrregularTimeSeries:1324,IfcIrregularTimeSeriesValue:1325,IfcIShapeProfileDef:1326,IfcJunctionBox:1327,IfcJunctionBoxType:1328,IfcLaborResource:1329,IfcLaborResourceType:1330,IfcLagTime:1331,IfcLamp:1332,IfcLampType:1333,IfcLibraryInformation:1334,IfcLibraryReference:1335,IfcLightDistributionData:1336,IfcLightFixture:1337,IfcLightFixtureType:1338,IfcLightIntensityDistribution:1339,IfcLightSource:1340,IfcLightSourceAmbient:1341,IfcLightSourceDirectional:1342,IfcLightSourceGoniometric:1343,IfcLightSourcePositional:1344,IfcLightSourceSpot:1345,IfcLine:1346,IfcLocalPlacement:1347,IfcLoop:1348,IfcLShapeProfileDef:1349,IfcManifoldSolidBrep:1350,IfcMapConversion:1351,IfcMappedItem:1352,IfcMaterial:1353,IfcMaterialClassificationRelationship:1354,IfcMaterialConstituent:1355,IfcMaterialConstituentSet:1356,IfcMaterialDefinition:1357,IfcMaterialDefinitionRepresentation:1358,IfcMaterialLayer:1359,IfcMaterialLayerSet:1360,IfcMaterialLayerSetUsage:1361,IfcMaterialLayerWithOffsets:1362,IfcMaterialList:1363,IfcMaterialProfile:1364,IfcMaterialProfileSet:1365,IfcMaterialProfileSetUsage:1366,IfcMaterialProfileSetUsageTapering:1367,IfcMaterialProfileWithOffsets:1368,IfcMaterialProperties:1369,IfcMaterialRelationship:1370,IfcMaterialUsageDefinition:1371,IfcMeasureWithUnit:1372,IfcMechanicalFastener:1373,IfcMechanicalFastenerType:1374,IfcMedicalDevice:1375,IfcMedicalDeviceType:1376,IfcMember:1377,IfcMemberStandardCase:1378,IfcMemberType:1379,IfcMetric:1380,IfcMirroredProfileDef:1381,IfcMonetaryUnit:1382,IfcMotorConnection:1383,IfcMotorConnectionType:1384,IfcNamedUnit:1385,IfcObject:1386,IfcObjectDefinition:1387,IfcObjective:1388,IfcObjectPlacement:1389,IfcOccupant:1390,IfcOffsetCurve2D:1391,IfcOffsetCurve3D:1392,IfcOpeningElement:1393,IfcOpeningStandardCase:1394,IfcOpenShell:1395,IfcOrganization:1396,IfcOrganizationRelationship:1397,IfcOrientedEdge:1398,IfcOuterBoundaryCurve:1399,IfcOutlet:1400,IfcOutletType:1401,IfcOwnerHistory:1402,IfcParameterizedProfileDef:1403,IfcPath:1404,IfcPcurve:1405,IfcPerformanceHistory:1406,IfcPermeableCoveringProperties:1407,IfcPermit:1408,IfcPerson:1409,IfcPersonAndOrganization:1410,IfcPhysicalComplexQuantity:1411,IfcPhysicalQuantity:1412,IfcPhysicalSimpleQuantity:1413,IfcPile:1414,IfcPileType:1415,IfcPipeFitting:1416,IfcPipeFittingType:1417,IfcPipeSegment:1418,IfcPipeSegmentType:1419,IfcPixelTexture:1420,IfcPlacement:1421,IfcPlanarBox:1422,IfcPlanarExtent:1423,IfcPlane:1424,IfcPlate:1425,IfcPlateStandardCase:1426,IfcPlateType:1427,IfcPoint:1428,IfcPointOnCurve:1429,IfcPointOnSurface:1430,IfcPolygonalBoundedHalfSpace:1431,IfcPolygonalFaceSet:1432,IfcPolyline:1433,IfcPolyLoop:1434,IfcPort:1435,IfcPostalAddress:1436,IfcPreDefinedColour:1437,IfcPreDefinedCurveFont:1438,IfcPreDefinedItem:1439,IfcPreDefinedProperties:1440,IfcPreDefinedPropertySet:1441,IfcPreDefinedTextFont:1442,IfcPresentationItem:1443,IfcPresentationLayerAssignment:1444,IfcPresentationLayerWithStyle:1445,IfcPresentationStyle:1446,IfcPresentationStyleAssignment:1447,IfcProcedure:1448,IfcProcedureType:1449,IfcProcess:1450,IfcProduct:1451,IfcProductDefinitionShape:1452,IfcProductRepresentation:1453,IfcProfileDef:1454,IfcProfileProperties:1455,IfcProject:1456,IfcProjectedCRS:1457,IfcProjectionElement:1458,IfcProjectLibrary:1459,IfcProjectOrder:1460,IfcProperty:1461,IfcPropertyAbstraction:1462,IfcPropertyBoundedValue:1463,IfcPropertyDefinition:1464,IfcPropertyDependencyRelationship:1465,IfcPropertyEnumeratedValue:1466,IfcPropertyEnumeration:1467,IfcPropertyListValue:1468,IfcPropertyReferenceValue:1469,IfcPropertySet:1470,IfcPropertySetDefinition:1471,IfcPropertySetTemplate:1472,IfcPropertySingleValue:1473,IfcPropertyTableValue:1474,IfcPropertyTemplate:1475,IfcPropertyTemplateDefinition:1476,IfcProtectiveDevice:1477,IfcProtectiveDeviceTrippingUnit:1478,IfcProtectiveDeviceTrippingUnitType:1479,IfcProtectiveDeviceType:1480,IfcProxy:1481,IfcPump:1482,IfcPumpType:1483,IfcQuantityArea:1484,IfcQuantityCount:1485,IfcQuantityLength:1486,IfcQuantitySet:1487,IfcQuantityTime:1488,IfcQuantityVolume:1489,IfcQuantityWeight:1490,IfcRailing:1491,IfcRailingType:1492,IfcRamp:1493,IfcRampFlight:1494,IfcRampFlightType:1495,IfcRampType:1496,IfcRationalBSplineCurveWithKnots:1497,IfcRationalBSplineSurfaceWithKnots:1498,IfcRectangleHollowProfileDef:1499,IfcRectangleProfileDef:1500,IfcRectangularPyramid:1501,IfcRectangularTrimmedSurface:1502,IfcRecurrencePattern:1503,IfcReference:1504,IfcRegularTimeSeries:1505,IfcReinforcementBarProperties:1506,IfcReinforcementDefinitionProperties:1507,IfcReinforcingBar:1508,IfcReinforcingBarType:1509,IfcReinforcingElement:1510,IfcReinforcingElementType:1511,IfcReinforcingMesh:1512,IfcReinforcingMeshType:1513,IfcRelAggregates:1514,IfcRelAssigns:1515,IfcRelAssignsToActor:1516,IfcRelAssignsToControl:1517,IfcRelAssignsToGroup:1518,IfcRelAssignsToGroupByFactor:1519,IfcRelAssignsToProcess:1520,IfcRelAssignsToProduct:1521,IfcRelAssignsToResource:1522,IfcRelAssociates:1523,IfcRelAssociatesApproval:1524,IfcRelAssociatesClassification:1525,IfcRelAssociatesConstraint:1526,IfcRelAssociatesDocument:1527,IfcRelAssociatesLibrary:1528,IfcRelAssociatesMaterial:1529,IfcRelationship:1530,IfcRelConnects:1531,IfcRelConnectsElements:1532,IfcRelConnectsPathElements:1533,IfcRelConnectsPorts:1534,IfcRelConnectsPortToElement:1535,IfcRelConnectsStructuralActivity:1536,IfcRelConnectsStructuralMember:1537,IfcRelConnectsWithEccentricity:1538,IfcRelConnectsWithRealizingElements:1539,IfcRelContainedInSpatialStructure:1540,IfcRelCoversBldgElements:1541,IfcRelCoversSpaces:1542,IfcRelDeclares:1543,IfcRelDecomposes:1544,IfcRelDefines:1545,IfcRelDefinesByObject:1546,IfcRelDefinesByProperties:1547,IfcRelDefinesByTemplate:1548,IfcRelDefinesByType:1549,IfcRelFillsElement:1550,IfcRelFlowControlElements:1551,IfcRelInterferesElements:1552,IfcRelNests:1553,IfcRelProjectsElement:1554,IfcRelReferencedInSpatialStructure:1555,IfcRelSequence:1556,IfcRelServicesBuildings:1557,IfcRelSpaceBoundary:1558,IfcRelSpaceBoundary1stLevel:1559,IfcRelSpaceBoundary2ndLevel:1560,IfcRelVoidsElement:1561,IfcReparametrisedCompositeCurveSegment:1562,IfcRepresentation:1563,IfcRepresentationContext:1564,IfcRepresentationItem:1565,IfcRepresentationMap:1566,IfcResource:1567,IfcResourceApprovalRelationship:1568,IfcResourceConstraintRelationship:1569,IfcResourceLevelRelationship:1570,IfcResourceTime:1571,IfcRevolvedAreaSolid:1572,IfcRevolvedAreaSolidTapered:1573,IfcRightCircularCone:1574,IfcRightCircularCylinder:1575,IfcRoof:1576,IfcRoofType:1577,IfcRoot:1578,IfcRoundedRectangleProfileDef:1579,IfcSanitaryTerminal:1580,IfcSanitaryTerminalType:1581,IfcSchedulingTime:1582,IfcSeamCurve:1583,IfcSectionedSpine:1584,IfcSectionProperties:1585,IfcSectionReinforcementProperties:1586,IfcSensor:1587,IfcSensorType:1588,IfcShadingDevice:1589,IfcShadingDeviceType:1590,IfcShapeAspect:1591,IfcShapeModel:1592,IfcShapeRepresentation:1593,IfcShellBasedSurfaceModel:1594,IfcSimpleProperty:1595,IfcSimplePropertyTemplate:1596,IfcSite:1597,IfcSIUnit:1598,IfcSlab:1599,IfcSlabElementedCase:1600,IfcSlabStandardCase:1601,IfcSlabType:1602,IfcSlippageConnectionCondition:1603,IfcSolarDevice:1604,IfcSolarDeviceType:1605,IfcSolidModel:1606,IfcSpace:1607,IfcSpaceHeater:1608,IfcSpaceHeaterType:1609,IfcSpaceType:1610,IfcSpatialElement:1611,IfcSpatialElementType:1612,IfcSpatialStructureElement:1613,IfcSpatialStructureElementType:1614,IfcSpatialZone:1615,IfcSpatialZoneType:1616,IfcSphere:1617,IfcSphericalSurface:1618,IfcStackTerminal:1619,IfcStackTerminalType:1620,IfcStair:1621,IfcStairFlight:1622,IfcStairFlightType:1623,IfcStairType:1624,IfcStructuralAction:1625,IfcStructuralActivity:1626,IfcStructuralAnalysisModel:1627,IfcStructuralConnection:1628,IfcStructuralConnectionCondition:1629,IfcStructuralCurveAction:1630,IfcStructuralCurveConnection:1631,IfcStructuralCurveMember:1632,IfcStructuralCurveMemberVarying:1633,IfcStructuralCurveReaction:1634,IfcStructuralItem:1635,IfcStructuralLinearAction:1636,IfcStructuralLoad:1637,IfcStructuralLoadCase:1638,IfcStructuralLoadConfiguration:1639,IfcStructuralLoadGroup:1640,IfcStructuralLoadLinearForce:1641,IfcStructuralLoadOrResult:1642,IfcStructuralLoadPlanarForce:1643,IfcStructuralLoadSingleDisplacement:1644,IfcStructuralLoadSingleDisplacementDistortion:1645,IfcStructuralLoadSingleForce:1646,IfcStructuralLoadSingleForceWarping:1647,IfcStructuralLoadStatic:1648,IfcStructuralLoadTemperature:1649,IfcStructuralMember:1650,IfcStructuralPlanarAction:1651,IfcStructuralPointAction:1652,IfcStructuralPointConnection:1653,IfcStructuralPointReaction:1654,IfcStructuralReaction:1655,IfcStructuralResultGroup:1656,IfcStructuralSurfaceAction:1657,IfcStructuralSurfaceConnection:1658,IfcStructuralSurfaceMember:1659,IfcStructuralSurfaceMemberVarying:1660,IfcStructuralSurfaceReaction:1661,IfcStyledItem:1662,IfcStyledRepresentation:1663,IfcStyleModel:1664,IfcSubContractResource:1665,IfcSubContractResourceType:1666,IfcSubedge:1667,IfcSurface:1668,IfcSurfaceCurve:1669,IfcSurfaceCurveSweptAreaSolid:1670,IfcSurfaceFeature:1671,IfcSurfaceOfLinearExtrusion:1672,IfcSurfaceOfRevolution:1673,IfcSurfaceReinforcementArea:1674,IfcSurfaceStyle:1675,IfcSurfaceStyleLighting:1676,IfcSurfaceStyleRefraction:1677,IfcSurfaceStyleRendering:1678,IfcSurfaceStyleShading:1679,IfcSurfaceStyleWithTextures:1680,IfcSurfaceTexture:1681,IfcSweptAreaSolid:1682,IfcSweptDiskSolid:1683,IfcSweptDiskSolidPolygonal:1684,IfcSweptSurface:1685,IfcSwitchingDevice:1686,IfcSwitchingDeviceType:1687,IfcSystem:1688,IfcSystemFurnitureElement:1689,IfcSystemFurnitureElementType:1690,IfcTable:1691,IfcTableColumn:1692,IfcTableRow:1693,IfcTank:1694,IfcTankType:1695,IfcTask:1696,IfcTaskTime:1697,IfcTaskTimeRecurring:1698,IfcTaskType:1699,IfcTelecomAddress:1700,IfcTendon:1701,IfcTendonAnchor:1702,IfcTendonAnchorType:1703,IfcTendonType:1704,IfcTessellatedFaceSet:1705,IfcTessellatedItem:1706,IfcTextLiteral:1707,IfcTextLiteralWithExtent:1708,IfcTextStyle:1709,IfcTextStyleFontModel:1710,IfcTextStyleForDefinedFont:1711,IfcTextStyleTextModel:1712,IfcTextureCoordinate:1713,IfcTextureCoordinateGenerator:1714,IfcTextureMap:1715,IfcTextureVertex:1716,IfcTextureVertexList:1717,IfcTimePeriod:1718,IfcTimeSeries:1719,IfcTimeSeriesValue:1720,IfcTopologicalRepresentationItem:1721,IfcTopologyRepresentation:1722,IfcToroidalSurface:1723,IfcTransformer:1724,IfcTransformerType:1725,IfcTransportElement:1726,IfcTransportElementType:1727,IfcTrapeziumProfileDef:1728,IfcTriangulatedFaceSet:1729,IfcTrimmedCurve:1730,IfcTShapeProfileDef:1731,IfcTubeBundle:1732,IfcTubeBundleType:1733,IfcTypeObject:1734,IfcTypeProcess:1735,IfcTypeProduct:1736,IfcTypeResource:1737,IfcUnitaryControlElement:1738,IfcUnitaryControlElementType:1739,IfcUnitaryEquipment:1740,IfcUnitaryEquipmentType:1741,IfcUnitAssignment:1742,IfcUShapeProfileDef:1743,IfcValve:1744,IfcValveType:1745,IfcVector:1746,IfcVertex:1747,IfcVertexLoop:1748,IfcVertexPoint:1749,IfcVibrationIsolator:1750,IfcVibrationIsolatorType:1751,IfcVirtualElement:1752,IfcVirtualGridIntersection:1753,IfcVoidingFeature:1754,IfcWall:1755,IfcWallElementedCase:1756,IfcWallStandardCase:1757,IfcWallType:1758,IfcWasteTerminal:1759,IfcWasteTerminalType:1760,IfcWindow:1761,IfcWindowLiningProperties:1762,IfcWindowPanelProperties:1763,IfcWindowStandardCase:1764,IfcWindowStyle:1765,IfcWindowType:1766,IfcWorkCalendar:1767,IfcWorkControl:1768,IfcWorkPlan:1769,IfcWorkSchedule:1770,IfcWorkTime:1771,IfcZone:1772,IfcZShapeProfileDef:1773,typeNames:{},typeCodes:{}},e.kdtree2=xo,e.kdtree3=Xo,e.ktx2=Ch,e.locale=sn,e.math=ut,e.matrix=Ni,e.rtc=$r,e.scene=Po,e.utils=ar,e.viewer=mh,e.webglrenderer=Oy});
//# sourceMappingURL=xeokit-bundle.umd.js.map
